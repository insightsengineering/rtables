<!DOCTYPE html>
<!-- Generated by pkgdown + https://github.com/insightsengineering/r-pkgdown-multiversion -->
<html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Example Clinical Trials Tables • rtables</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Example Clinical Trials Tables">
<link rel="stylesheet" href="../consent.css">
<script src="../consent.js" type="text/javascript" charset="utf-8"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rtables</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6.14.9001</small>

    <div style="width: 140px; margin-left: 0.5rem;"> <small class="nav-text text-muted me-auto">part of</small> <img src="https://github.com/insightsengineering/hex-stickers/blob/main/PNG/nest.png?raw=true" alt="NEST" style="height: 30px;"><a href="https://pharmaverse.org/" class="external-link"><img src="https://github.com/insightsengineering/hex-stickers/blob/main/PNG/pharmaverse.png?raw=true" alt="pharmaverse" style="height: 28px;"></a> </div>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/rtables.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Getting Started</h6></li>
    <li><a class="dropdown-item" href="../articles/exploratory_analysis.html">Exploratory Analysis</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Guided Tour</h6></li>
    <li><a class="dropdown-item" href="../articles/guided_intermediate.html">A Guided Tour of rtables - Intermediate</a></li>
    <li><a class="dropdown-item" href="../articles/guided_intermediate_translating_shells.html">Intermediate rtables - Translating Shells To Layouts</a></li>
    <li><a class="dropdown-item" href="../articles/guided_intermediate_afun_reqs.html">Intermediate rtables - Identifying Required Analysis Behavior</a></li>
    <li><a class="dropdown-item" href="../articles/guided_intermediate_split_reqs.html">Intermediate rtables - Identifying Required Faceting Behavior</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Clinical Trials</h6></li>
    <li><a class="dropdown-item" href="../articles/clinical_trials.html">Example Clinical Trials Tables</a></li>
    <li><a class="dropdown-item" href="../articles/baseline.html">Comparing Against Baselines or Control</a></li>
    <li><a class="dropdown-item" href="../articles/ard_how_to.html">Generating QC-Ready Result Data Frames (ARDs) from Tables</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Table Customization</h6></li>
    <li><a class="dropdown-item" href="../articles/custom_appearance.html">Customizing Appearance</a></li>
    <li><a class="dropdown-item" href="../articles/title_footer.html">Titles, Footers, and Referential Footnotes</a></li>
    <li><a class="dropdown-item" href="../articles/sorting_pruning.html">Pruning and Sorting Tables</a></li>
    <li><a class="dropdown-item" href="../articles/col_counts.html">Column Counts and Formats</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-developer-guide" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Developer Guide</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-developer-guide">
<li><a class="dropdown-item" href="../articles/dev-guide/dg_split_machinery.html">Split Machinery</a></li>
    <li><a class="dropdown-item" href="../articles/dev-guide/dg_tabulation.html">Tabulation</a></li>
    <li><a class="dropdown-item" href="../articles/dev-guide/dg_table_hierarchy.html">Table Hierarchy</a></li>
    <li><a class="dropdown-item" href="../articles/dev-guide/dg_debug_rtables.html">Debugging in {rtables} and Beyond</a></li>
    <li><a class="dropdown-item" href="../articles/dev-guide/dg_notes.html">Sparse Notes on {rtables} Internals</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-reports" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Reports</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-reports">
<li><a class="dropdown-item" href="../coverage-report/">Coverage report</a></li>
    <li><a class="dropdown-item" href="../unit-test-report/">Unit test report</a></li>
    <li><a class="dropdown-item" href="../unit-test-report-non-cran/">Non-CRAN unit test report</a></li>
  </ul>
</li>
      <div><li class="nav-item dropdown">
    <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-versions">Versions</a>
    <div class="dropdown-menu" aria-labelledby="dropdown-versions">
    <a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/release-candidate">release-candidate</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/main">main</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/latest-tag">latest-tag</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.14">v0.6.14</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.13">v0.6.13</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.13-rc2">v0.6.13-rc2</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.13-rc1">v0.6.13-rc1</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.12">v0.6.12</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.12-rc2">v0.6.12-rc2</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.12-rc1">v0.6.12-rc1</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.11">v0.6.11</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.10">v0.6.10</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.9">v0.6.9</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.8">v0.6.8</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.7">v0.6.7</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.6">v0.6.6</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.6-rc1">v0.6.6-rc1</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.5">v0.6.5</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.4">v0.6.4</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.3">v0.6.3</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.2">v0.6.2</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.1">v0.6.1</a>
</div>
</li></div>
</ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/insightsengineering/rtables"><span class="fa fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Example Clinical Trials Tables</h1>
                        <h4 data-toc-skip class="author">Gabriel Becker
and Adrian Waddell</h4>
            
            <h4 data-toc-skip class="date">2025-11-26</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/insightsengineering/rtables/blob/main/vignettes/clinical_trials.Rmd" class="external-link"><code>vignettes/clinical_trials.Rmd</code></a></small>
      <div class="d-none name"><code>clinical_trials.Rmd</code></div>
    </div>

    
    
<style type="text/css">
.reveal .r code {
    white-space: pre;
}
</style>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In this vignette we create a</p>
<ul>
<li>demographic table</li>
<li>adverse event table</li>
<li>response table</li>
<li>time-to-event analysis table</li>
</ul>
<p>using the <code>rtables</code> layout facility. That is, we
demonstrate how the layout based tabulation framework can specify the
structure and relations that are commonly found when analyzing clinical
trials data.</p>
<p>Note that all the data is created using random number generators. All
<code>ex_*</code> data which is currently attached to the
<code>rtables</code> package is provided by the <a href="https://insightsengineering.github.io/formatters/" class="external-link"><code>formatters</code></a>
package and was created using the publicly available <a href="https://insightsengineering.github.io/random.cdisc.data/" class="external-link"><code>random.cdisc.data</code></a>
R package.</p>
<p>The packages used in this vignette are:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/insightsengineering/rtables" class="external-link">rtables</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="demographic-table">Demographic Table<a class="anchor" aria-label="anchor" href="#demographic-table"></a>
</h2>
<p>Demographic tables summarize the variables content for different
population subsets (encoded in the columns).</p>
<p>One feature of <code><a href="../reference/analyze.html">analyze()</a></code> that we have not introduced in
the previous vignette is that the analysis function <code>afun</code>
can specify multiple rows with the <code><a href="../reference/in_rows.html">in_rows()</a></code> function:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ADSL</span> <span class="op">&lt;-</span> <span class="va">ex_adsl</span> <span class="co"># Example ADSL dataset</span></span>
<span></span>
<span><span class="va">lyt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_table.html">basic_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"ARM"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span>vars <span class="op">=</span> <span class="st">"AGE"</span>, afun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/in_rows.html">in_rows</a></span><span class="op">(</span></span>
<span>      <span class="st">"Mean (sd)"</span> <span class="op">=</span> <span class="fu"><a href="../reference/rcell.html">rcell</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">"xx.xx (xx.xx)"</span><span class="op">)</span>,</span>
<span>      <span class="st">"Range"</span> <span class="op">=</span> <span class="fu"><a href="../reference/rcell.html">rcell</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">"xx.xx - xx.xx"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">lyt</span>, <span class="va">ADSL</span><span class="op">)</span></span>
<span><span class="va">tbl</span></span>
<span><span class="co">#               A: Drug X      B: Placebo     C: Combination</span></span>
<span><span class="co"># ——————————————————————————————————————————————————————————</span></span>
<span><span class="co"># Mean (sd)   33.77 (6.55)    35.43 (7.90)     35.43 (7.72) </span></span>
<span><span class="co"># Range       21.00 - 50.00   21.00 - 62.00   20.00 - 69.00</span></span></code></pre></div>
<p>Multiple variables can be analyzed in one <code><a href="../reference/analyze.html">analyze()</a></code>
call:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lyt2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_table.html">basic_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"ARM"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span>vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AGE"</span>, <span class="st">"BMRKR1"</span><span class="op">)</span>, afun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/in_rows.html">in_rows</a></span><span class="op">(</span></span>
<span>      <span class="st">"Mean (sd)"</span> <span class="op">=</span> <span class="fu"><a href="../reference/rcell.html">rcell</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">"xx.xx (xx.xx)"</span><span class="op">)</span>,</span>
<span>      <span class="st">"Range"</span> <span class="op">=</span> <span class="fu"><a href="../reference/rcell.html">rcell</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">"xx.xx - xx.xx"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tbl2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">lyt2</span>, <span class="va">ADSL</span><span class="op">)</span></span>
<span><span class="va">tbl2</span></span>
<span><span class="co">#                 A: Drug X      B: Placebo     C: Combination</span></span>
<span><span class="co"># ————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># AGE                                                         </span></span>
<span><span class="co">#   Mean (sd)   33.77 (6.55)    35.43 (7.90)     35.43 (7.72) </span></span>
<span><span class="co">#   Range       21.00 - 50.00   21.00 - 62.00   20.00 - 69.00 </span></span>
<span><span class="co"># BMRKR1                                                      </span></span>
<span><span class="co">#   Mean (sd)    5.97 (3.55)     5.70 (3.31)     5.62 (3.49)  </span></span>
<span><span class="co">#   Range       0.41 - 17.67    0.65 - 14.24     0.17 - 21.39</span></span></code></pre></div>
<p>Hence, if <code>afun</code> can process different data vector types
(i.e. variables selected from the data) then we are fairly close to a
standard demographic table. Here is a function that either creates a
count table or some number summary if the argument <code>x</code> is a
factor or numeric, respectively:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s_summary</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">is.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/in_rows.html">in_rows</a></span><span class="op">(</span></span>
<span>      <span class="st">"n"</span> <span class="op">=</span> <span class="fu"><a href="../reference/rcell.html">rcell</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">"xx"</span><span class="op">)</span>,</span>
<span>      <span class="st">"Mean (sd)"</span> <span class="op">=</span> <span class="fu"><a href="../reference/rcell.html">rcell</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">"xx.xx (xx.xx)"</span><span class="op">)</span>,</span>
<span>      <span class="st">"IQR"</span> <span class="op">=</span> <span class="fu"><a href="../reference/rcell.html">rcell</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/IQR.html" class="external-link">IQR</a></span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">"xx.xx"</span><span class="op">)</span>,</span>
<span>      <span class="st">"min - max"</span> <span class="op">=</span> <span class="fu"><a href="../reference/rcell.html">rcell</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">"xx.xx - xx.xx"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">is.factor</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">vs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">in_rows</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">vs</span>, <span class="va">rcell</span>, format <span class="op">=</span> <span class="st">"xx"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"type not supported"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Note we use <code>rcell</code> to wrap the results in order to add
formatting instructions for <code>rtables</code>. We can use
<code>s_summary</code> outside the context of tabulation:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">s_summary</span><span class="op">(</span><span class="va">ADSL</span><span class="op">$</span><span class="va">AGE</span><span class="op">)</span></span>
<span><span class="co"># RowsVerticalSection (in_rows) object print method:</span></span>
<span><span class="co"># ----------------------------</span></span>
<span><span class="co">#    row_name formatted_cell indent_mod row_label</span></span>
<span><span class="co"># 1         n            400          0         n</span></span>
<span><span class="co"># 2 Mean (sd)   34.88 (7.44)          0 Mean (sd)</span></span>
<span><span class="co"># 3       IQR          10.00          0       IQR</span></span>
<span><span class="co"># 4 min - max  20.00 - 69.00          0 min - max</span></span></code></pre></div>
<p>and</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">s_summary</span><span class="op">(</span><span class="va">ADSL</span><span class="op">$</span><span class="va">SEX</span><span class="op">)</span></span>
<span><span class="co"># RowsVerticalSection (in_rows) object print method:</span></span>
<span><span class="co"># ----------------------------</span></span>
<span><span class="co">#           row_name formatted_cell indent_mod        row_label</span></span>
<span><span class="co"># 1                F            222          0                F</span></span>
<span><span class="co"># 2                M            166          0                M</span></span>
<span><span class="co"># 3                U              9          0                U</span></span>
<span><span class="co"># 4 UNDIFFERENTIATED              3          0 UNDIFFERENTIATED</span></span></code></pre></div>
<p>We can now create a commonly used variant of the demographic
table:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">summary_lyt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_table.html">basic_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">"ARM"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AGE"</span>, <span class="st">"SEX"</span><span class="op">)</span>, afun <span class="op">=</span> <span class="va">s_summary</span><span class="op">)</span></span>
<span></span>
<span><span class="va">summary_tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">summary_lyt</span>, <span class="va">ADSL</span><span class="op">)</span></span>
<span><span class="va">summary_tbl</span></span>
<span><span class="co">#                        A: Drug X      B: Placebo     C: Combination</span></span>
<span><span class="co"># ———————————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># AGE                                                                </span></span>
<span><span class="co">#   n                       134             134             132      </span></span>
<span><span class="co">#   Mean (sd)          33.77 (6.55)    35.43 (7.90)     35.43 (7.72) </span></span>
<span><span class="co">#   IQR                    11.00           10.00           10.00     </span></span>
<span><span class="co">#   min - max          21.00 - 50.00   21.00 - 62.00   20.00 - 69.00 </span></span>
<span><span class="co"># SEX                                                                </span></span>
<span><span class="co">#   F                       79              77               66      </span></span>
<span><span class="co">#   M                       51              55               60      </span></span>
<span><span class="co">#   U                        3               2               4       </span></span>
<span><span class="co">#   UNDIFFERENTIATED         1               0               2</span></span></code></pre></div>
<p>Note that <code><a href="../reference/analyze.html">analyze()</a></code> can also be called multiple times in
sequence:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">summary_lyt2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_table.html">basic_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">"ARM"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"AGE"</span>, <span class="va">s_summary</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"SEX"</span>, <span class="va">s_summary</span><span class="op">)</span></span>
<span></span>
<span><span class="va">summary_tbl2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">summary_lyt2</span>, <span class="va">ADSL</span><span class="op">)</span></span>
<span><span class="va">summary_tbl2</span></span>
<span><span class="co">#                        A: Drug X      B: Placebo     C: Combination</span></span>
<span><span class="co"># ———————————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># AGE                                                                </span></span>
<span><span class="co">#   n                       134             134             132      </span></span>
<span><span class="co">#   Mean (sd)          33.77 (6.55)    35.43 (7.90)     35.43 (7.72) </span></span>
<span><span class="co">#   IQR                    11.00           10.00           10.00     </span></span>
<span><span class="co">#   min - max          21.00 - 50.00   21.00 - 62.00   20.00 - 69.00 </span></span>
<span><span class="co"># SEX                                                                </span></span>
<span><span class="co">#   F                       79              77               66      </span></span>
<span><span class="co">#   M                       51              55               60      </span></span>
<span><span class="co">#   U                        3               2               4       </span></span>
<span><span class="co">#   UNDIFFERENTIATED         1               0               2</span></span></code></pre></div>
<p>which leads to the table identical to <code>summary_tbl</code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">summary_tbl</span>, <span class="va">summary_tbl2</span><span class="op">)</span></span>
<span><span class="co"># [1] TRUE</span></span></code></pre></div>
<p>In clinical trials analyses the number of patients per column is
often referred to as <code>N</code> (rather than the overall population
which outside of clinical trials is commonly referred to as
<code>N</code>). Column <code>N</code>s are added by setting the
<code>show_colcounts</code> argument in <code><a href="../reference/basic_table.html">basic_table()</a></code> to
<code>TRUE</code>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">summary_lyt3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_table.html">basic_table</a></span><span class="op">(</span>show_colcounts <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">"ARMCD"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AGE"</span>, <span class="st">"SEX"</span><span class="op">)</span>, <span class="va">s_summary</span><span class="op">)</span></span>
<span></span>
<span><span class="va">summary_tbl3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">summary_lyt3</span>, <span class="va">ADSL</span><span class="op">)</span></span>
<span><span class="va">summary_tbl3</span></span>
<span><span class="co">#                          ARM A           ARM B           ARM C    </span></span>
<span><span class="co">#                         (N=134)         (N=134)         (N=132)   </span></span>
<span><span class="co"># ——————————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># AGE                                                               </span></span>
<span><span class="co">#   n                       134             134             132     </span></span>
<span><span class="co">#   Mean (sd)          33.77 (6.55)    35.43 (7.90)    35.43 (7.72) </span></span>
<span><span class="co">#   IQR                    11.00           10.00           10.00    </span></span>
<span><span class="co">#   min - max          21.00 - 50.00   21.00 - 62.00   20.00 - 69.00</span></span>
<span><span class="co"># SEX                                                               </span></span>
<span><span class="co">#   F                       79              77              66      </span></span>
<span><span class="co">#   M                       51              55              60      </span></span>
<span><span class="co">#   U                        3               2               4      </span></span>
<span><span class="co">#   UNDIFFERENTIATED         1               0               2</span></span></code></pre></div>
<div class="section level3">
<h3 id="variations-on-the-demographic-table">Variations on the Demographic Table<a class="anchor" aria-label="anchor" href="#variations-on-the-demographic-table"></a>
</h3>
<p>We will now show a couple of variations of the demographic table that
we developed above. These variations are in structure and not in
analysis, hence they don’t require a modification to the
<code>s_summary</code> function.</p>
<p>We will start with a standard table analyzing the variables
<code>AGE</code> and <code>BMRKR2</code> variables:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lyt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_table.html">basic_table</a></span><span class="op">(</span>show_colcounts <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">"ARM"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AGE"</span>, <span class="st">"BMRKR2"</span><span class="op">)</span>, <span class="va">s_summary</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">lyt</span>, <span class="va">ADSL</span><span class="op">)</span></span>
<span><span class="va">tbl</span></span>
<span><span class="co">#                 A: Drug X      B: Placebo     C: Combination</span></span>
<span><span class="co">#                  (N=134)         (N=134)         (N=132)    </span></span>
<span><span class="co"># ————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># AGE                                                         </span></span>
<span><span class="co">#   n                134             134             132      </span></span>
<span><span class="co">#   Mean (sd)   33.77 (6.55)    35.43 (7.90)     35.43 (7.72) </span></span>
<span><span class="co">#   IQR             11.00           10.00           10.00     </span></span>
<span><span class="co">#   min - max   21.00 - 50.00   21.00 - 62.00   20.00 - 69.00 </span></span>
<span><span class="co"># BMRKR2                                                      </span></span>
<span><span class="co">#   LOW              50              45               40      </span></span>
<span><span class="co">#   MEDIUM           37              56               42      </span></span>
<span><span class="co">#   HIGH             47              33               50</span></span></code></pre></div>
<p>Assume we would like to have this analysis carried out per gender
encoded in the row space:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lyt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_table.html">basic_table</a></span><span class="op">(</span>show_colcounts <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">"ARM"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_rows_by.html">split_rows_by</a></span><span class="op">(</span><span class="st">"SEX"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AGE"</span>, <span class="st">"BMRKR2"</span><span class="op">)</span>, <span class="va">s_summary</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">lyt</span>, <span class="va">ADSL</span><span class="op">)</span></span>
<span><span class="va">tbl</span></span>
<span><span class="co">#                      A: Drug X      B: Placebo     C: Combination</span></span>
<span><span class="co">#                       (N=134)         (N=134)         (N=132)    </span></span>
<span><span class="co"># —————————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># F                                                                </span></span>
<span><span class="co">#   AGE                                                            </span></span>
<span><span class="co">#     n                   79              77               66      </span></span>
<span><span class="co">#     Mean (sd)      32.76 (6.09)    34.12 (7.06)     35.20 (7.43) </span></span>
<span><span class="co">#     IQR                9.00            8.00             6.75     </span></span>
<span><span class="co">#     min - max      21.00 - 47.00   23.00 - 58.00   21.00 - 64.00 </span></span>
<span><span class="co">#   BMRKR2                                                         </span></span>
<span><span class="co">#     LOW                 26              21               26      </span></span>
<span><span class="co">#     MEDIUM              21              38               17      </span></span>
<span><span class="co">#     HIGH                32              18               23      </span></span>
<span><span class="co"># M                                                                </span></span>
<span><span class="co">#   AGE                                                            </span></span>
<span><span class="co">#     n                   51              55               60      </span></span>
<span><span class="co">#     Mean (sd)      35.57 (7.08)    37.44 (8.69)     35.38 (8.24) </span></span>
<span><span class="co">#     IQR                11.00           9.00            11.00     </span></span>
<span><span class="co">#     min - max      23.00 - 50.00   21.00 - 62.00   20.00 - 69.00 </span></span>
<span><span class="co">#   BMRKR2                                                         </span></span>
<span><span class="co">#     LOW                 21              23               11      </span></span>
<span><span class="co">#     MEDIUM              15              18               23      </span></span>
<span><span class="co">#     HIGH                15              14               26      </span></span>
<span><span class="co"># U                                                                </span></span>
<span><span class="co">#   AGE                                                            </span></span>
<span><span class="co">#     n                    3               2               4       </span></span>
<span><span class="co">#     Mean (sd)      31.67 (3.21)    31.00 (5.66)     35.25 (3.10) </span></span>
<span><span class="co">#     IQR                3.00            4.00             3.25     </span></span>
<span><span class="co">#     min - max      28.00 - 34.00   27.00 - 35.00   31.00 - 38.00 </span></span>
<span><span class="co">#   BMRKR2                                                         </span></span>
<span><span class="co">#     LOW                  2               1               1       </span></span>
<span><span class="co">#     MEDIUM               1               0               2       </span></span>
<span><span class="co">#     HIGH                 0               1               1       </span></span>
<span><span class="co"># UNDIFFERENTIATED                                                 </span></span>
<span><span class="co">#   AGE                                                            </span></span>
<span><span class="co">#     n                    1               0               2       </span></span>
<span><span class="co">#     Mean (sd)       28.00 (NA)          NA          45.00 (1.41) </span></span>
<span><span class="co">#     IQR                0.00             NA              1.00     </span></span>
<span><span class="co">#     min - max      28.00 - 28.00    Inf - -Inf     44.00 - 46.00 </span></span>
<span><span class="co">#   BMRKR2                                                         </span></span>
<span><span class="co">#     LOW                  1               0               2       </span></span>
<span><span class="co">#     MEDIUM               0               0               0       </span></span>
<span><span class="co">#     HIGH                 0               0               0</span></span></code></pre></div>
<p>We will now subset <code>ADSL</code> to include only males and
females in the analysis in order to reduce the number of rows in the
table:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ADSL_M_F</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ADSL</span>, <span class="va">SEX</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"M"</span>, <span class="st">"F"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lyt2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_table.html">basic_table</a></span><span class="op">(</span>show_colcounts <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">"ARM"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_rows_by.html">split_rows_by</a></span><span class="op">(</span><span class="st">"SEX"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AGE"</span>, <span class="st">"BMRKR2"</span><span class="op">)</span>, <span class="va">s_summary</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tbl2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">lyt2</span>, <span class="va">ADSL_M_F</span><span class="op">)</span></span>
<span><span class="va">tbl2</span></span>
<span><span class="co">#                      A: Drug X      B: Placebo     C: Combination</span></span>
<span><span class="co">#                       (N=130)         (N=132)         (N=126)    </span></span>
<span><span class="co"># —————————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># F                                                                </span></span>
<span><span class="co">#   AGE                                                            </span></span>
<span><span class="co">#     n                   79              77               66      </span></span>
<span><span class="co">#     Mean (sd)      32.76 (6.09)    34.12 (7.06)     35.20 (7.43) </span></span>
<span><span class="co">#     IQR                9.00            8.00             6.75     </span></span>
<span><span class="co">#     min - max      21.00 - 47.00   23.00 - 58.00   21.00 - 64.00 </span></span>
<span><span class="co">#   BMRKR2                                                         </span></span>
<span><span class="co">#     LOW                 26              21               26      </span></span>
<span><span class="co">#     MEDIUM              21              38               17      </span></span>
<span><span class="co">#     HIGH                32              18               23      </span></span>
<span><span class="co"># M                                                                </span></span>
<span><span class="co">#   AGE                                                            </span></span>
<span><span class="co">#     n                   51              55               60      </span></span>
<span><span class="co">#     Mean (sd)      35.57 (7.08)    37.44 (8.69)     35.38 (8.24) </span></span>
<span><span class="co">#     IQR                11.00           9.00            11.00     </span></span>
<span><span class="co">#     min - max      23.00 - 50.00   21.00 - 62.00   20.00 - 69.00 </span></span>
<span><span class="co">#   BMRKR2                                                         </span></span>
<span><span class="co">#     LOW                 21              23               11      </span></span>
<span><span class="co">#     MEDIUM              15              18               23      </span></span>
<span><span class="co">#     HIGH                15              14               26      </span></span>
<span><span class="co"># U                                                                </span></span>
<span><span class="co">#   AGE                                                            </span></span>
<span><span class="co">#     n                    0               0               0       </span></span>
<span><span class="co">#     Mean (sd)           NA              NA               NA      </span></span>
<span><span class="co">#     IQR                 NA              NA               NA      </span></span>
<span><span class="co">#     min - max       Inf - -Inf      Inf - -Inf       Inf - -Inf  </span></span>
<span><span class="co">#   BMRKR2                                                         </span></span>
<span><span class="co">#     LOW                  0               0               0       </span></span>
<span><span class="co">#     MEDIUM               0               0               0       </span></span>
<span><span class="co">#     HIGH                 0               0               0       </span></span>
<span><span class="co"># UNDIFFERENTIATED                                                 </span></span>
<span><span class="co">#   AGE                                                            </span></span>
<span><span class="co">#     n                    0               0               0       </span></span>
<span><span class="co">#     Mean (sd)           NA              NA               NA      </span></span>
<span><span class="co">#     IQR                 NA              NA               NA      </span></span>
<span><span class="co">#     min - max       Inf - -Inf      Inf - -Inf       Inf - -Inf  </span></span>
<span><span class="co">#   BMRKR2                                                         </span></span>
<span><span class="co">#     LOW                  0               0               0       </span></span>
<span><span class="co">#     MEDIUM               0               0               0       </span></span>
<span><span class="co">#     HIGH                 0               0               0</span></span></code></pre></div>
<p>Note that the <code>UNDIFFERENTIATED</code> and <code>U</code> levels
still show up in the table. This is because tabulation respects the
factor levels and level order, exactly as the <code>split</code> and
<code>table</code> function do. If empty levels should be dropped then
<code>rtables</code> needs to know that at splitting time via the
<code>split_fun</code> argument in <code><a href="../reference/split_rows_by.html">split_rows_by()</a></code>. There
are a number of predefined functions. For this example
<code><a href="../reference/split_funcs.html">drop_split_levels()</a></code> is required to drop the empty levels at
splitting time. Splitting is a big topic and will be eventually
addressed in a specific package vignette.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lyt3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_table.html">basic_table</a></span><span class="op">(</span>show_colcounts <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">"ARM"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_rows_by.html">split_rows_by</a></span><span class="op">(</span><span class="st">"SEX"</span>, split_fun <span class="op">=</span> <span class="va">drop_split_levels</span>, child_labels <span class="op">=</span> <span class="st">"visible"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AGE"</span>, <span class="st">"BMRKR2"</span><span class="op">)</span>, <span class="va">s_summary</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tbl3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">lyt3</span>, <span class="va">ADSL_M_F</span><span class="op">)</span></span>
<span><span class="va">tbl3</span></span>
<span><span class="co">#                   A: Drug X      B: Placebo     C: Combination</span></span>
<span><span class="co">#                    (N=130)         (N=132)         (N=126)    </span></span>
<span><span class="co"># ——————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># F                                                             </span></span>
<span><span class="co">#   AGE                                                         </span></span>
<span><span class="co">#     n                79              77               66      </span></span>
<span><span class="co">#     Mean (sd)   32.76 (6.09)    34.12 (7.06)     35.20 (7.43) </span></span>
<span><span class="co">#     IQR             9.00            8.00             6.75     </span></span>
<span><span class="co">#     min - max   21.00 - 47.00   23.00 - 58.00   21.00 - 64.00 </span></span>
<span><span class="co">#   BMRKR2                                                      </span></span>
<span><span class="co">#     LOW              26              21               26      </span></span>
<span><span class="co">#     MEDIUM           21              38               17      </span></span>
<span><span class="co">#     HIGH             32              18               23      </span></span>
<span><span class="co"># M                                                             </span></span>
<span><span class="co">#   AGE                                                         </span></span>
<span><span class="co">#     n                51              55               60      </span></span>
<span><span class="co">#     Mean (sd)   35.57 (7.08)    37.44 (8.69)     35.38 (8.24) </span></span>
<span><span class="co">#     IQR             11.00           9.00            11.00     </span></span>
<span><span class="co">#     min - max   23.00 - 50.00   21.00 - 62.00   20.00 - 69.00 </span></span>
<span><span class="co">#   BMRKR2                                                      </span></span>
<span><span class="co">#     LOW              21              23               11      </span></span>
<span><span class="co">#     MEDIUM           15              18               23      </span></span>
<span><span class="co">#     HIGH             15              14               26</span></span></code></pre></div>
<p>In the table above the labels <code>M</code> and <code>F</code> are
not very descriptive. You can add the full labels as follows:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ADSL_M_F_l</span> <span class="op">&lt;-</span> <span class="va">ADSL_M_F</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>lbl_sex <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>    <span class="va">SEX</span> <span class="op">==</span> <span class="st">"M"</span> <span class="op">~</span> <span class="st">"Male"</span>,</span>
<span>    <span class="va">SEX</span> <span class="op">==</span> <span class="st">"F"</span> <span class="op">~</span> <span class="st">"Female"</span>,</span>
<span>    <span class="va">SEX</span> <span class="op">==</span> <span class="st">"U"</span> <span class="op">~</span> <span class="st">"Unknown"</span>,</span>
<span>    <span class="va">SEX</span> <span class="op">==</span> <span class="st">"UNDIFFERENTIATED"</span> <span class="op">~</span> <span class="st">"Undifferentiated"</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lyt4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_table.html">basic_table</a></span><span class="op">(</span>show_colcounts <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">"ARM"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_rows_by.html">split_rows_by</a></span><span class="op">(</span><span class="st">"SEX"</span>, labels_var <span class="op">=</span> <span class="st">"lbl_sex"</span>, split_fun <span class="op">=</span> <span class="va">drop_split_levels</span>, child_labels <span class="op">=</span> <span class="st">"visible"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AGE"</span>, <span class="st">"BMRKR2"</span><span class="op">)</span>, <span class="va">s_summary</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tbl4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">lyt4</span>, <span class="va">ADSL_M_F_l</span><span class="op">)</span></span>
<span><span class="va">tbl4</span></span>
<span><span class="co">#                   A: Drug X      B: Placebo     C: Combination</span></span>
<span><span class="co">#                    (N=130)         (N=132)         (N=126)    </span></span>
<span><span class="co"># ——————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># Female                                                        </span></span>
<span><span class="co">#   AGE                                                         </span></span>
<span><span class="co">#     n                79              77               66      </span></span>
<span><span class="co">#     Mean (sd)   32.76 (6.09)    34.12 (7.06)     35.20 (7.43) </span></span>
<span><span class="co">#     IQR             9.00            8.00             6.75     </span></span>
<span><span class="co">#     min - max   21.00 - 47.00   23.00 - 58.00   21.00 - 64.00 </span></span>
<span><span class="co">#   BMRKR2                                                      </span></span>
<span><span class="co">#     LOW              26              21               26      </span></span>
<span><span class="co">#     MEDIUM           21              38               17      </span></span>
<span><span class="co">#     HIGH             32              18               23      </span></span>
<span><span class="co"># Male                                                          </span></span>
<span><span class="co">#   AGE                                                         </span></span>
<span><span class="co">#     n                51              55               60      </span></span>
<span><span class="co">#     Mean (sd)   35.57 (7.08)    37.44 (8.69)     35.38 (8.24) </span></span>
<span><span class="co">#     IQR             11.00           9.00            11.00     </span></span>
<span><span class="co">#     min - max   23.00 - 50.00   21.00 - 62.00   20.00 - 69.00 </span></span>
<span><span class="co">#   BMRKR2                                                      </span></span>
<span><span class="co">#     LOW              21              23               11      </span></span>
<span><span class="co">#     MEDIUM           15              18               23      </span></span>
<span><span class="co">#     HIGH             15              14               26</span></span></code></pre></div>
<p>For the next table variation we only stratify by gender for the
<code>AGE</code> analysis. To do this the <code>nested</code> argument
has to be set to <code>FALSE</code> in <code><a href="../reference/analyze.html">analyze()</a></code> call:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lyt5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_table.html">basic_table</a></span><span class="op">(</span>show_colcounts <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">"ARM"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_rows_by.html">split_rows_by</a></span><span class="op">(</span><span class="st">"SEX"</span>, labels_var <span class="op">=</span> <span class="st">"lbl_sex"</span>, split_fun <span class="op">=</span> <span class="va">drop_split_levels</span>, child_labels <span class="op">=</span> <span class="st">"visible"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"AGE"</span>, <span class="va">s_summary</span>, show_labels <span class="op">=</span> <span class="st">"visible"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"BMRKR2"</span>, <span class="va">s_summary</span>, nested <span class="op">=</span> <span class="cn">FALSE</span>, show_labels <span class="op">=</span> <span class="st">"visible"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tbl5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">lyt5</span>, <span class="va">ADSL_M_F_l</span><span class="op">)</span></span>
<span><span class="va">tbl5</span></span>
<span><span class="co">#                   A: Drug X      B: Placebo     C: Combination</span></span>
<span><span class="co">#                    (N=130)         (N=132)         (N=126)    </span></span>
<span><span class="co"># ——————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># Female                                                        </span></span>
<span><span class="co">#   AGE                                                         </span></span>
<span><span class="co">#     n                79              77               66      </span></span>
<span><span class="co">#     Mean (sd)   32.76 (6.09)    34.12 (7.06)     35.20 (7.43) </span></span>
<span><span class="co">#     IQR             9.00            8.00             6.75     </span></span>
<span><span class="co">#     min - max   21.00 - 47.00   23.00 - 58.00   21.00 - 64.00 </span></span>
<span><span class="co"># Male                                                          </span></span>
<span><span class="co">#   AGE                                                         </span></span>
<span><span class="co">#     n                51              55               60      </span></span>
<span><span class="co">#     Mean (sd)   35.57 (7.08)    37.44 (8.69)     35.38 (8.24) </span></span>
<span><span class="co">#     IQR             11.00           9.00            11.00     </span></span>
<span><span class="co">#     min - max   23.00 - 50.00   21.00 - 62.00   20.00 - 69.00 </span></span>
<span><span class="co"># BMRKR2                                                        </span></span>
<span><span class="co">#   LOW                47              44               37      </span></span>
<span><span class="co">#   MEDIUM             36              56               40      </span></span>
<span><span class="co">#   HIGH               47              32               49</span></span></code></pre></div>
<p>Once we split the rows into groups (<code>Male</code> and
<code>Female</code> here) one might want to summarize groups: usually by
showing count and column percentages. This is especially important if we
have missing data. For example, if we create the above table but add
missing data to the <code>AGE</code> variable:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">insert_NAs</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.8</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span>  <span class="va">x</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">ADSL_NA</span> <span class="op">&lt;-</span> <span class="va">ADSL_M_F_l</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>AGE <span class="op">=</span> <span class="fu">insert_NAs</span><span class="op">(</span><span class="va">AGE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lyt6</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_table.html">basic_table</a></span><span class="op">(</span>show_colcounts <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">"ARM"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_rows_by.html">split_rows_by</a></span><span class="op">(</span></span>
<span>    <span class="st">"SEX"</span>,</span>
<span>    labels_var <span class="op">=</span> <span class="st">"lbl_sex"</span>,</span>
<span>    split_fun <span class="op">=</span> <span class="va">drop_split_levels</span>,</span>
<span>    child_labels <span class="op">=</span> <span class="st">"visible"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"AGE"</span>, <span class="va">s_summary</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"BMRKR2"</span>, <span class="va">s_summary</span>, nested <span class="op">=</span> <span class="cn">FALSE</span>, show_labels <span class="op">=</span> <span class="st">"visible"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tbl6</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">lyt6</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ADSL_NA</span>, <span class="va">SEX</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"M"</span>, <span class="st">"F"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tbl6</span></span>
<span><span class="co">#                 A: Drug X      B: Placebo     C: Combination</span></span>
<span><span class="co">#                  (N=130)         (N=132)         (N=126)    </span></span>
<span><span class="co"># ————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># Female                                                      </span></span>
<span><span class="co">#   n                65              61               54      </span></span>
<span><span class="co">#   Mean (sd)   32.71 (6.07)    34.33 (7.31)     34.61 (6.78) </span></span>
<span><span class="co">#   IQR             9.00            10.00            6.75     </span></span>
<span><span class="co">#   min - max   21.00 - 47.00   23.00 - 58.00   21.00 - 54.00 </span></span>
<span><span class="co"># Male                                                        </span></span>
<span><span class="co">#   n                44              44               50      </span></span>
<span><span class="co">#   Mean (sd)   35.66 (6.78)    36.93 (8.18)     35.64 (8.42) </span></span>
<span><span class="co">#   IQR             10.50           8.25            10.75     </span></span>
<span><span class="co">#   min - max   24.00 - 48.00   21.00 - 58.00   20.00 - 69.00 </span></span>
<span><span class="co"># BMRKR2                                                      </span></span>
<span><span class="co">#   LOW              47              44               37      </span></span>
<span><span class="co">#   MEDIUM           36              56               40      </span></span>
<span><span class="co">#   HIGH             47              32               49</span></span></code></pre></div>
<p>Here it is not easy to see how many females and males there are in
each arm as <code>n</code> represents the number of non-missing data
elements in the variables. Groups within rows that are defined by
splitting can be summarized with <code><a href="../reference/summarize_row_groups.html">summarize_row_groups()</a></code>,
for example:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lyt7</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_table.html">basic_table</a></span><span class="op">(</span>show_colcounts <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">"ARM"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_rows_by.html">split_rows_by</a></span><span class="op">(</span><span class="st">"SEX"</span>, labels_var <span class="op">=</span> <span class="st">"lbl_sex"</span>, split_fun <span class="op">=</span> <span class="va">drop_split_levels</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/summarize_row_groups.html">summarize_row_groups</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"AGE"</span>, <span class="va">s_summary</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"BMRKR2"</span>, afun <span class="op">=</span> <span class="va">s_summary</span>, nested <span class="op">=</span> <span class="cn">FALSE</span>, show_labels <span class="op">=</span> <span class="st">"visible"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tbl7</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">lyt7</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ADSL_NA</span>, <span class="va">SEX</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"M"</span>, <span class="st">"F"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tbl7</span></span>
<span><span class="co">#                 A: Drug X      B: Placebo     C: Combination</span></span>
<span><span class="co">#                  (N=130)         (N=132)         (N=126)    </span></span>
<span><span class="co"># ————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># Female         79 (60.8%)      77 (58.3%)       66 (52.4%)  </span></span>
<span><span class="co">#   n                65              61               54      </span></span>
<span><span class="co">#   Mean (sd)   32.71 (6.07)    34.33 (7.31)     34.61 (6.78) </span></span>
<span><span class="co">#   IQR             9.00            10.00            6.75     </span></span>
<span><span class="co">#   min - max   21.00 - 47.00   23.00 - 58.00   21.00 - 54.00 </span></span>
<span><span class="co"># Male           51 (39.2%)      55 (41.7%)       60 (47.6%)  </span></span>
<span><span class="co">#   n                44              44               50      </span></span>
<span><span class="co">#   Mean (sd)   35.66 (6.78)    36.93 (8.18)     35.64 (8.42) </span></span>
<span><span class="co">#   IQR             10.50           8.25            10.75     </span></span>
<span><span class="co">#   min - max   24.00 - 48.00   21.00 - 58.00   20.00 - 69.00 </span></span>
<span><span class="co"># BMRKR2                                                      </span></span>
<span><span class="co">#   LOW              47              44               37      </span></span>
<span><span class="co">#   MEDIUM           36              56               40      </span></span>
<span><span class="co">#   HIGH             47              32               49</span></span></code></pre></div>
<p>There are a couple of things to note here:</p>
<ul>
<li>Group summaries produce “content” rows. Visually, it’s impossible to
distinguish data rows from content rows. Their difference is justified
(and it’s an important design decision) because when we paginate tables
the content rows are by default repeated if a group gets divided via
pagination.</li>
<li>Conceptually the content rows summarize the patient population which
is analyzed and hence are often the count &amp; group percentages
(default behavior of <code><a href="../reference/summarize_row_groups.html">summarize_row_groups()</a></code>).</li>
</ul>
<p>We can recreate this default behavior (count percentage) by defining
a <code>cfun</code> for illustrative purposes here as it results in the
same table as above:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lyt8</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_table.html">basic_table</a></span><span class="op">(</span>show_colcounts <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">"ARM"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_rows_by.html">split_rows_by</a></span><span class="op">(</span><span class="st">"SEX"</span>, labels_var <span class="op">=</span> <span class="st">"lbl_sex"</span>, split_fun <span class="op">=</span> <span class="va">drop_split_levels</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/summarize_row_groups.html">summarize_row_groups</a></span><span class="op">(</span>cfun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">labelstr</span>, <span class="va">.N_col</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/in_rows.html">in_rows</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="../reference/rcell.html">rcell</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span> <span class="op">/</span> <span class="va">.N_col</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">"xx (xx.xx%)"</span><span class="op">)</span>,</span>
<span>      .labels <span class="op">=</span> <span class="va">labelstr</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"AGE"</span>, <span class="va">s_summary</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"BEP01FL"</span>, afun <span class="op">=</span> <span class="va">s_summary</span>, nested <span class="op">=</span> <span class="cn">FALSE</span>, show_labels <span class="op">=</span> <span class="st">"visible"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tbl8</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">lyt8</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ADSL_NA</span>, <span class="va">SEX</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"M"</span>, <span class="st">"F"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tbl8</span></span>
<span><span class="co">#                 A: Drug X      B: Placebo     C: Combination</span></span>
<span><span class="co">#                  (N=130)         (N=132)         (N=126)    </span></span>
<span><span class="co"># ————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># Female         79 (60.77%)     77 (58.33%)     66 (52.38%)  </span></span>
<span><span class="co">#   n                65              61               54      </span></span>
<span><span class="co">#   Mean (sd)   32.71 (6.07)    34.33 (7.31)     34.61 (6.78) </span></span>
<span><span class="co">#   IQR             9.00            10.00            6.75     </span></span>
<span><span class="co">#   min - max   21.00 - 47.00   23.00 - 58.00   21.00 - 54.00 </span></span>
<span><span class="co"># Male           51 (39.23%)     55 (41.67%)     60 (47.62%)  </span></span>
<span><span class="co">#   n                44              44               50      </span></span>
<span><span class="co">#   Mean (sd)   35.66 (6.78)    36.93 (8.18)     35.64 (8.42) </span></span>
<span><span class="co">#   IQR             10.50           8.25            10.75     </span></span>
<span><span class="co">#   min - max   24.00 - 48.00   21.00 - 58.00   20.00 - 69.00 </span></span>
<span><span class="co"># BEP01FL                                                     </span></span>
<span><span class="co">#   Y                67              63               65      </span></span>
<span><span class="co">#   N                63              69               61</span></span></code></pre></div>
<p>Note that <code>cfun</code>, like <code>afun</code> (which is used in
<code><a href="../reference/analyze.html">analyze()</a></code>), can operate on either variables, passed via the
<code>x</code> argument, or <code>data.frame</code>s or
<code>tibble</code>s, which are passed via the <code>df</code> argument
(<code>afun</code> can optionally request <code>df</code> too). Unlike
<code>afun</code>, <code>cfun</code> must accept <code>labelstr</code>
as the second argument which gives the default group label (factor level
from splitting) and hence it could be modified:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lyt9</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_table.html">basic_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">"ARM"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_rows_by.html">split_rows_by</a></span><span class="op">(</span><span class="st">"SEX"</span>, labels_var <span class="op">=</span> <span class="st">"lbl_sex"</span>, split_fun <span class="op">=</span> <span class="va">drop_split_levels</span>, child_labels <span class="op">=</span> <span class="st">"hidden"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/summarize_row_groups.html">summarize_row_groups</a></span><span class="op">(</span>cfun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">labelstr</span>, <span class="va">.N_col</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/in_rows.html">in_rows</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="../reference/rcell.html">rcell</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span> <span class="op">/</span> <span class="va">.N_col</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">"xx (xx.xx%)"</span><span class="op">)</span>,</span>
<span>      .labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">labelstr</span>, <span class="st">": count (perc.)"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"AGE"</span>, <span class="va">s_summary</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"BEP01FL"</span>, <span class="va">s_summary</span>, nested <span class="op">=</span> <span class="cn">FALSE</span>, show_labels <span class="op">=</span> <span class="st">"visible"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tbl9</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">lyt9</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ADSL_NA</span>, <span class="va">SEX</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"M"</span>, <span class="st">"F"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tbl9</span></span>
<span><span class="co">#                           A: Drug X      B: Placebo     C: Combination</span></span>
<span><span class="co"># ——————————————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># Female: count (perc.)    79 (60.77%)     77 (58.33%)     66 (52.38%)  </span></span>
<span><span class="co">#   n                          65              61               54      </span></span>
<span><span class="co">#   Mean (sd)             32.71 (6.07)    34.33 (7.31)     34.61 (6.78) </span></span>
<span><span class="co">#   IQR                       9.00            10.00            6.75     </span></span>
<span><span class="co">#   min - max             21.00 - 47.00   23.00 - 58.00   21.00 - 54.00 </span></span>
<span><span class="co"># Male: count (perc.)      51 (39.23%)     55 (41.67%)     60 (47.62%)  </span></span>
<span><span class="co">#   n                          44              44               50      </span></span>
<span><span class="co">#   Mean (sd)             35.66 (6.78)    36.93 (8.18)     35.64 (8.42) </span></span>
<span><span class="co">#   IQR                       10.50           8.25            10.75     </span></span>
<span><span class="co">#   min - max             24.00 - 48.00   21.00 - 58.00   20.00 - 69.00 </span></span>
<span><span class="co"># BEP01FL                                                               </span></span>
<span><span class="co">#   Y                          67              63               65      </span></span>
<span><span class="co">#   N                          63              69               61</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="using-layouts">Using Layouts<a class="anchor" aria-label="anchor" href="#using-layouts"></a>
</h3>
<p>Layouts have a couple of advantages over tabulating the tables
directly:</p>
<ul>
<li>the creation of layouts requires the analyst to describe the problem
in an abstract way
<ul>
<li>i.e. they separate the analyses description from the actual
data</li>
</ul>
</li>
<li>referencing variable names happens via strings (no non-standard
evaluation (NSE) is needed, though this is arguably either a feature or
a shortcoming)</li>
<li>layouts can be reused</li>
</ul>
<p>Here is an example that demonstrates the reusability of layouts:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adsl_lyt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_table.html">basic_table</a></span><span class="op">(</span>show_colcounts <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"ARM"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AGE"</span>, <span class="st">"SEX"</span><span class="op">)</span>, afun <span class="op">=</span> <span class="va">s_summary</span><span class="op">)</span></span>
<span></span>
<span><span class="va">adsl_lyt</span></span>
<span><span class="co"># A Pre-data Table Layout</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Column-Split Structure:</span></span>
<span><span class="co"># ARM (lvls) </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Row-Split Structure:</span></span>
<span><span class="co"># AGE:SEX (** multivar analysis **)</span></span></code></pre></div>
<p>We can now build a table for <code>ADSL</code></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adsl_tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">adsl_lyt</span>, <span class="va">ADSL</span><span class="op">)</span></span>
<span><span class="va">adsl_tbl</span></span>
<span><span class="co">#                        A: Drug X      B: Placebo     C: Combination</span></span>
<span><span class="co">#                         (N=134)         (N=134)         (N=132)    </span></span>
<span><span class="co"># ———————————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># AGE                                                                </span></span>
<span><span class="co">#   n                       134             134             132      </span></span>
<span><span class="co">#   Mean (sd)          33.77 (6.55)    35.43 (7.90)     35.43 (7.72) </span></span>
<span><span class="co">#   IQR                    11.00           10.00           10.00     </span></span>
<span><span class="co">#   min - max          21.00 - 50.00   21.00 - 62.00   20.00 - 69.00 </span></span>
<span><span class="co"># SEX                                                                </span></span>
<span><span class="co">#   F                       79              77               66      </span></span>
<span><span class="co">#   M                       51              55               60      </span></span>
<span><span class="co">#   U                        3               2               4       </span></span>
<span><span class="co">#   UNDIFFERENTIATED         1               0               2</span></span></code></pre></div>
<p>or for all patients that are older than 18:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adsl_f_tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">lyt</span>, <span class="va">ADSL</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">AGE</span> <span class="op">&gt;</span> <span class="fl">18</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Warning in min(x): no non-missing arguments to min; returning Inf</span></span>
<span><span class="co"># Warning in max(x): no non-missing arguments to max; returning -Inf</span></span>
<span><span class="va">adsl_f_tbl</span></span>
<span><span class="co">#                      A: Drug X      B: Placebo     C: Combination</span></span>
<span><span class="co">#                       (N=134)         (N=134)         (N=132)    </span></span>
<span><span class="co"># —————————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># F                                                                </span></span>
<span><span class="co">#   AGE                                                            </span></span>
<span><span class="co">#     n                   79              77               66      </span></span>
<span><span class="co">#     Mean (sd)      32.76 (6.09)    34.12 (7.06)     35.20 (7.43) </span></span>
<span><span class="co">#     IQR                9.00            8.00             6.75     </span></span>
<span><span class="co">#     min - max      21.00 - 47.00   23.00 - 58.00   21.00 - 64.00 </span></span>
<span><span class="co">#   BMRKR2                                                         </span></span>
<span><span class="co">#     LOW                 26              21               26      </span></span>
<span><span class="co">#     MEDIUM              21              38               17      </span></span>
<span><span class="co">#     HIGH                32              18               23      </span></span>
<span><span class="co"># M                                                                </span></span>
<span><span class="co">#   AGE                                                            </span></span>
<span><span class="co">#     n                   51              55               60      </span></span>
<span><span class="co">#     Mean (sd)      35.57 (7.08)    37.44 (8.69)     35.38 (8.24) </span></span>
<span><span class="co">#     IQR                11.00           9.00            11.00     </span></span>
<span><span class="co">#     min - max      23.00 - 50.00   21.00 - 62.00   20.00 - 69.00 </span></span>
<span><span class="co">#   BMRKR2                                                         </span></span>
<span><span class="co">#     LOW                 21              23               11      </span></span>
<span><span class="co">#     MEDIUM              15              18               23      </span></span>
<span><span class="co">#     HIGH                15              14               26      </span></span>
<span><span class="co"># U                                                                </span></span>
<span><span class="co">#   AGE                                                            </span></span>
<span><span class="co">#     n                    3               2               4       </span></span>
<span><span class="co">#     Mean (sd)      31.67 (3.21)    31.00 (5.66)     35.25 (3.10) </span></span>
<span><span class="co">#     IQR                3.00            4.00             3.25     </span></span>
<span><span class="co">#     min - max      28.00 - 34.00   27.00 - 35.00   31.00 - 38.00 </span></span>
<span><span class="co">#   BMRKR2                                                         </span></span>
<span><span class="co">#     LOW                  2               1               1       </span></span>
<span><span class="co">#     MEDIUM               1               0               2       </span></span>
<span><span class="co">#     HIGH                 0               1               1       </span></span>
<span><span class="co"># UNDIFFERENTIATED                                                 </span></span>
<span><span class="co">#   AGE                                                            </span></span>
<span><span class="co">#     n                    1               0               2       </span></span>
<span><span class="co">#     Mean (sd)       28.00 (NA)          NA          45.00 (1.41) </span></span>
<span><span class="co">#     IQR                0.00             NA              1.00     </span></span>
<span><span class="co">#     min - max      28.00 - 28.00    Inf - -Inf     44.00 - 46.00 </span></span>
<span><span class="co">#   BMRKR2                                                         </span></span>
<span><span class="co">#     LOW                  1               0               2       </span></span>
<span><span class="co">#     MEDIUM               0               0               0       </span></span>
<span><span class="co">#     HIGH                 0               0               0</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="adverse-events">Adverse Events<a class="anchor" aria-label="anchor" href="#adverse-events"></a>
</h2>
<p>There are a number of different adverse event tables. We will now
present two tables that show adverse events by ID and then by grade and
by ID.</p>
<p>This time we won’t use the <code>ADAE</code> dataset from <a href="https://insightsengineering.github.io/random.cdisc.data/" class="external-link"><code>random.cdisc.data</code></a>
but rather generate a dataset on the fly (see <a href="https://github.com/waddella/phuse2016_adverse_events" class="external-link">Adrian’s
2016 Phuse paper</a>):</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lookup</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">AEDECOD</span>,                          <span class="op">~</span><span class="va">AEBODSYS</span>,                                         <span class="op">~</span><span class="va">AETOXGR</span>,</span>
<span>  <span class="st">"HEADACHE"</span>,                        <span class="st">"NERVOUS SYSTEM DISORDERS"</span>,                        <span class="st">"5"</span>,</span>
<span>  <span class="st">"BACK PAIN"</span>,                       <span class="st">"MUSCULOSKELETAL AND CONNECTIVE TISSUE DISORDERS"</span>, <span class="st">"2"</span>,</span>
<span>  <span class="st">"GINGIVAL BLEEDING"</span>,               <span class="st">"GASTROINTESTINAL DISORDERS"</span>,                      <span class="st">"1"</span>,</span>
<span>  <span class="st">"HYPOTENSION"</span>,                     <span class="st">"VASCULAR DISORDERS"</span>,                              <span class="st">"3"</span>,</span>
<span>  <span class="st">"FAECES SOFT"</span>,                     <span class="st">"GASTROINTESTINAL DISORDERS"</span>,                      <span class="st">"2"</span>,</span>
<span>  <span class="st">"ABDOMINAL DISCOMFORT"</span>,            <span class="st">"GASTROINTESTINAL DISORDERS"</span>,                      <span class="st">"1"</span>,</span>
<span>  <span class="st">"DIARRHEA"</span>,                        <span class="st">"GASTROINTESTINAL DISORDERS"</span>,                      <span class="st">"1"</span>,</span>
<span>  <span class="st">"ABDOMINAL FULLNESS DUE TO GAS"</span>,   <span class="st">"GASTROINTESTINAL DISORDERS"</span>,                      <span class="st">"1"</span>,</span>
<span>  <span class="st">"NAUSEA (INTERMITTENT)"</span>,           <span class="st">"GASTROINTESTINAL DISORDERS"</span>,                      <span class="st">"2"</span>,</span>
<span>  <span class="st">"WEAKNESS"</span>,                        <span class="st">"MUSCULOSKELETAL AND CONNECTIVE TISSUE DISORDERS"</span>, <span class="st">"3"</span>,</span>
<span>  <span class="st">"ORTHOSTATIC HYPOTENSION"</span>,         <span class="st">"VASCULAR DISORDERS"</span>,                              <span class="st">"4"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">normalize</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="va">weightsA</span> <span class="op">&lt;-</span> <span class="fu">normalize</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">dlnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, length.out <span class="op">=</span> <span class="fl">25</span><span class="op">)</span>, meanlog <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">weightsB</span> <span class="op">&lt;-</span> <span class="fu">normalize</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">dlnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, length.out <span class="op">=</span> <span class="fl">25</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">N_pop</span> <span class="op">&lt;-</span> <span class="fl">300</span></span>
<span><span class="va">ADSL2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  USUBJID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">N_pop</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  ARM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ARM A"</span>, <span class="st">"ARM B"</span><span class="op">)</span>, <span class="va">N_pop</span>, <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  SEX <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"F"</span>, <span class="st">"M"</span><span class="op">)</span>, <span class="va">N_pop</span>, <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  AGE <span class="op">=</span> <span class="fl">20</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">N_pop</span>, size <span class="op">=</span> <span class="fl">40</span>, prob <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">l.adae</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html" class="external-link">mapply</a></span><span class="op">(</span></span>
<span>  <span class="va">ADSL2</span><span class="op">$</span><span class="va">USUBJID</span>,</span>
<span>  <span class="va">ADSL2</span><span class="op">$</span><span class="va">ARM</span>,</span>
<span>  <span class="va">ADSL2</span><span class="op">$</span><span class="va">SEX</span>,</span>
<span>  <span class="va">ADSL2</span><span class="op">$</span><span class="va">AGE</span>,</span>
<span>  FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">id</span>, <span class="va">arm</span>, <span class="va">sex</span>, <span class="va">age</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">n_ae</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">25</span>, <span class="fl">1</span>, prob <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="va">arm</span> <span class="op">==</span> <span class="st">"ARM A"</span><span class="op">)</span> <span class="va">weightsA</span> <span class="kw">else</span> <span class="va">weightsB</span><span class="op">)</span></span>
<span>    <span class="va">i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">lookup</span><span class="op">)</span><span class="op">)</span>, size <span class="op">=</span> <span class="va">n_ae</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fl">16</span><span class="op">)</span></span>
<span>    <span class="va">lookup</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        AESEQ <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        USUBJID <span class="op">=</span> <span class="va">id</span>, ARM <span class="op">=</span> <span class="va">arm</span>, SEX <span class="op">=</span> <span class="va">sex</span>, AGE <span class="op">=</span> <span class="va">age</span></span>
<span>      <span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  SIMPLIFY <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">ADAE2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">l.adae</span><span class="op">)</span></span>
<span><span class="va">ADAE2</span> <span class="op">&lt;-</span> <span class="va">ADAE2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    ARM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">ARM</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ARM A"</span>, <span class="st">"ARM B"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    AEDECOD <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">AEDECOD</span><span class="op">)</span>,</span>
<span>    AEBODSYS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">AEBODSYS</span><span class="op">)</span>,</span>
<span>    AETOXGR <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">AETOXGR</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">USUBJID</span>, <span class="va">ARM</span>, <span class="va">AGE</span>, <span class="va">SEX</span>, <span class="va">AESEQ</span>, <span class="va">AEDECOD</span>, <span class="va">AEBODSYS</span>, <span class="va">AETOXGR</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ADAE2</span></span>
<span><span class="co"># <span style="color: #949494;"># A tibble: 3,118 × 8</span></span></span>
<span><span class="co">#    USUBJID ARM     AGE SEX   AESEQ AEDECOD               AEBODSYS        AETOXGR</span></span>
<span><span class="co">#      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  </span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 1</span>       1 ARM A    45 F         1 NAUSEA (INTERMITTENT) GASTROINTESTIN… 2      </span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 2</span>       1 ARM A    45 F         2 HEADACHE              NERVOUS SYSTEM… 5      </span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 3</span>       1 ARM A    45 F         3 HEADACHE              NERVOUS SYSTEM… 5      </span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 4</span>       1 ARM A    45 F         4 HEADACHE              NERVOUS SYSTEM… 5      </span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 5</span>       1 ARM A    45 F         5 HEADACHE              NERVOUS SYSTEM… 5      </span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 6</span>       1 ARM A    45 F         6 HEADACHE              NERVOUS SYSTEM… 5      </span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 7</span>       1 ARM A    45 F         7 HEADACHE              NERVOUS SYSTEM… 5      </span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 8</span>       1 ARM A    45 F         8 HEADACHE              NERVOUS SYSTEM… 5      </span></span>
<span><span class="co"># <span style="color: #BCBCBC;"> 9</span>       1 ARM A    45 F         9 HEADACHE              NERVOUS SYSTEM… 5      </span></span>
<span><span class="co"># <span style="color: #BCBCBC;">10</span>       1 ARM A    45 F        10 FAECES SOFT           GASTROINTESTIN… 2      </span></span>
<span><span class="co"># <span style="color: #949494;"># ℹ 3,108 more rows</span></span></span></code></pre></div>
<div class="section level3">
<h3 id="adverse-events-by-id">Adverse Events By ID<a class="anchor" aria-label="anchor" href="#adverse-events-by-id"></a>
</h3>
<p>We start by defining an events summary function:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s_events_patients</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">labelstr</span>, <span class="va">.N_col</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/in_rows.html">in_rows</a></span><span class="op">(</span></span>
<span>    <span class="st">"Total number of patients with at least one event"</span> <span class="op">=</span></span>
<span>      <span class="fu"><a href="../reference/rcell.html">rcell</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span> <span class="op">/</span> <span class="va">.N_col</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">"xx (xx.xx%)"</span><span class="op">)</span>,</span>
<span>    <span class="st">"Total number of events"</span> <span class="op">=</span> <span class="fu"><a href="../reference/rcell.html">rcell</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">"xx"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>So, for a population of <code>5</code> patients where</p>
<ul>
<li>one patient has 2 <code>AE</code>s</li>
<li>one patient has 1 <code>AE</code>
</li>
<li>three patients have no <code>AE</code>s</li>
</ul>
<p>we would get the following summary:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">s_events_patients</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id 1"</span>, <span class="st">"id 1"</span>, <span class="st">"id 2"</span><span class="op">)</span>, .N_col <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co"># RowsVerticalSection (in_rows) object print method:</span></span>
<span><span class="co"># ----------------------------</span></span>
<span><span class="co">#                                           row_name formatted_cell indent_mod</span></span>
<span><span class="co"># 1 Total number of patients with at least one event     2 (40.00%)          0</span></span>
<span><span class="co"># 2                           Total number of events              3          0</span></span>
<span><span class="co">#                                          row_label</span></span>
<span><span class="co"># 1 Total number of patients with at least one event</span></span>
<span><span class="co"># 2                           Total number of events</span></span></code></pre></div>
<p>The <code>.N_col</code> argument is a special keyword argument by
which <code><a href="../reference/build_table.html">build_table()</a></code> passes the population size for each
respective column. For a list of keyword arguments for the functions
passed to <code>afun</code> in <code><a href="../reference/analyze.html">analyze()</a></code>, refer to the
documentation with <code><a href="../reference/analyze.html">?analyze</a></code>.</p>
<p>We now use the <code>s_events_patients</code> summary function in a
tabulation:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adae_lyt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_table.html">basic_table</a></span><span class="op">(</span>show_colcounts <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"ARM"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"USUBJID"</span>, <span class="va">s_events_patients</span><span class="op">)</span></span>
<span></span>
<span><span class="va">adae_tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">adae_lyt</span>, <span class="va">ADAE2</span><span class="op">)</span></span>
<span><span class="va">adae_tbl</span></span>
<span><span class="co">#                                                       ARM A         ARM B    </span></span>
<span><span class="co">#                                                     (N=2060)       (N=1058)  </span></span>
<span><span class="co"># —————————————————————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># Total number of patients with at least one event   114 (5.53%)   150 (14.18%)</span></span>
<span><span class="co"># Total number of events                                2060           1058</span></span></code></pre></div>
<p>Note that the column <code>N</code>s are wrong as by default they are
set to the number of rows per group (i.e. number of <code>AE</code>s per
arm here). This also affects the percentages. For this table we are
interested in the number of patients per column/arm which is usually
taken from <code>ADSL</code> (var <code>ADSL2</code> here).</p>
<p><code>rtables</code> handles this by allowing us to override how the
column counts are computed. We can specify an <code>alt_counts_df</code>
in <code><a href="../reference/build_table.html">build_table()</a></code>. When we do this, <code>rtables</code>
calculates the column counts by applying the same column faceting to
<code>alt_counts_df</code> as it does to the primary data during
tabulation:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adae_adsl_tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">adae_lyt</span>, <span class="va">ADAE2</span>, alt_counts_df <span class="op">=</span> <span class="va">ADSL2</span><span class="op">)</span></span>
<span><span class="va">adae_adsl_tbl</span></span>
<span><span class="co">#                                                       ARM A          ARM B    </span></span>
<span><span class="co">#                                                      (N=146)        (N=154)   </span></span>
<span><span class="co"># ——————————————————————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># Total number of patients with at least one event   114 (78.08%)   150 (97.40%)</span></span>
<span><span class="co"># Total number of events                                 2060           1058</span></span></code></pre></div>
<p>Alternatively, if the desired column counts are already calculated,
they can be specified directly via the <code>col_counts</code> argument
to <code><a href="../reference/build_table.html">build_table()</a></code>, though specifying an
<code>alt_counts_df</code> is the preferred mechanism (the number of
rows will be used, but no duplicate checking!!!).</p>
<p>We next calculate this information per system organ class:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adae_soc_lyt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_table.html">basic_table</a></span><span class="op">(</span>show_colcounts <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"ARM"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"USUBJID"</span>, <span class="va">s_events_patients</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_rows_by.html">split_rows_by</a></span><span class="op">(</span><span class="st">"AEBODSYS"</span>, child_labels <span class="op">=</span> <span class="st">"visible"</span>, nested <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/summarize_row_groups.html">summarize_row_groups</a></span><span class="op">(</span><span class="st">"USUBJID"</span>, cfun <span class="op">=</span> <span class="va">s_events_patients</span><span class="op">)</span></span>
<span></span>
<span><span class="va">adae_soc_tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">adae_soc_lyt</span>, <span class="va">ADAE2</span>, alt_counts_df <span class="op">=</span> <span class="va">ADSL2</span><span class="op">)</span></span>
<span><span class="va">adae_soc_tbl</span></span>
<span><span class="co">#                                                         ARM A          ARM B    </span></span>
<span><span class="co">#                                                        (N=146)        (N=154)   </span></span>
<span><span class="co"># ————————————————————————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># Total number of patients with at least one event     114 (78.08%)   150 (97.40%)</span></span>
<span><span class="co"># Total number of events                                   2060           1058    </span></span>
<span><span class="co"># GASTROINTESTINAL DISORDERS                                                      </span></span>
<span><span class="co">#   Total number of patients with at least one event   114 (78.08%)   130 (84.42%)</span></span>
<span><span class="co">#   Total number of events                                 760            374     </span></span>
<span><span class="co"># MUSCULOSKELETAL AND CONNECTIVE TISSUE DISORDERS                                 </span></span>
<span><span class="co">#   Total number of patients with at least one event   98 (67.12%)    81 (52.60%) </span></span>
<span><span class="co">#   Total number of events                                 273            142     </span></span>
<span><span class="co"># NERVOUS SYSTEM DISORDERS                                                        </span></span>
<span><span class="co">#   Total number of patients with at least one event   113 (77.40%)   133 (86.36%)</span></span>
<span><span class="co">#   Total number of events                                 787            420     </span></span>
<span><span class="co"># VASCULAR DISORDERS                                                              </span></span>
<span><span class="co">#   Total number of patients with at least one event   93 (63.70%)    75 (48.70%) </span></span>
<span><span class="co">#   Total number of events                                 240            122</span></span></code></pre></div>
<p>We now have to add a count table of <code>AEDECOD</code> for each
<code>AEBODSYS</code>. The default <code><a href="../reference/analyze.html">analyze()</a></code> behavior for a
factor is to create the count table per level (using
<code>rtab_inner</code>):</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adae_soc_lyt2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_table.html">basic_table</a></span><span class="op">(</span>show_colcounts <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"ARM"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_rows_by.html">split_rows_by</a></span><span class="op">(</span><span class="st">"AEBODSYS"</span>, child_labels <span class="op">=</span> <span class="st">"visible"</span>, indent_mod <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/summarize_row_groups.html">summarize_row_groups</a></span><span class="op">(</span><span class="st">"USUBJID"</span>, cfun <span class="op">=</span> <span class="va">s_events_patients</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"AEDECOD"</span>, indent_mod <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">adae_soc_tbl2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">adae_soc_lyt2</span>, <span class="va">ADAE2</span>, alt_counts_df <span class="op">=</span> <span class="va">ADSL2</span><span class="op">)</span></span>
<span><span class="va">adae_soc_tbl2</span></span>
<span><span class="co">#                                                           ARM A          ARM B    </span></span>
<span><span class="co">#                                                          (N=146)        (N=154)   </span></span>
<span><span class="co"># ——————————————————————————————————————————————————————————————————————————————————</span></span>
<span><span class="co">#   GASTROINTESTINAL DISORDERS                                                      </span></span>
<span><span class="co">#     Total number of patients with at least one event   114 (78.08%)   130 (84.42%)</span></span>
<span><span class="co">#     Total number of events                                 760            374     </span></span>
<span><span class="co">#     ABDOMINAL DISCOMFORT                                   113             65     </span></span>
<span><span class="co">#     ABDOMINAL FULLNESS DUE TO GAS                          119             65     </span></span>
<span><span class="co">#     BACK PAIN                                               0              0      </span></span>
<span><span class="co">#     DIARRHEA                                               107             53     </span></span>
<span><span class="co">#     FAECES SOFT                                            122             58     </span></span>
<span><span class="co">#     GINGIVAL BLEEDING                                      147             71     </span></span>
<span><span class="co">#     HEADACHE                                                0              0      </span></span>
<span><span class="co">#     HYPOTENSION                                             0              0      </span></span>
<span><span class="co">#     NAUSEA (INTERMITTENT)                                  152             62     </span></span>
<span><span class="co">#     ORTHOSTATIC HYPOTENSION                                 0              0      </span></span>
<span><span class="co">#     WEAKNESS                                                0              0      </span></span>
<span><span class="co">#   MUSCULOSKELETAL AND CONNECTIVE TISSUE DISORDERS                                 </span></span>
<span><span class="co">#     Total number of patients with at least one event   98 (67.12%)    81 (52.60%) </span></span>
<span><span class="co">#     Total number of events                                 273            142     </span></span>
<span><span class="co">#     ABDOMINAL DISCOMFORT                                    0              0      </span></span>
<span><span class="co">#     ABDOMINAL FULLNESS DUE TO GAS                           0              0      </span></span>
<span><span class="co">#     BACK PAIN                                              135             75     </span></span>
<span><span class="co">#     DIARRHEA                                                0              0      </span></span>
<span><span class="co">#     FAECES SOFT                                             0              0      </span></span>
<span><span class="co">#     GINGIVAL BLEEDING                                       0              0      </span></span>
<span><span class="co">#     HEADACHE                                                0              0      </span></span>
<span><span class="co">#     HYPOTENSION                                             0              0      </span></span>
<span><span class="co">#     NAUSEA (INTERMITTENT)                                   0              0      </span></span>
<span><span class="co">#     ORTHOSTATIC HYPOTENSION                                 0              0      </span></span>
<span><span class="co">#     WEAKNESS                                               138             67     </span></span>
<span><span class="co">#   NERVOUS SYSTEM DISORDERS                                                        </span></span>
<span><span class="co">#     Total number of patients with at least one event   113 (77.40%)   133 (86.36%)</span></span>
<span><span class="co">#     Total number of events                                 787            420     </span></span>
<span><span class="co">#     ABDOMINAL DISCOMFORT                                    0              0      </span></span>
<span><span class="co">#     ABDOMINAL FULLNESS DUE TO GAS                           0              0      </span></span>
<span><span class="co">#     BACK PAIN                                               0              0      </span></span>
<span><span class="co">#     DIARRHEA                                                0              0      </span></span>
<span><span class="co">#     FAECES SOFT                                             0              0      </span></span>
<span><span class="co">#     GINGIVAL BLEEDING                                       0              0      </span></span>
<span><span class="co">#     HEADACHE                                               787            420     </span></span>
<span><span class="co">#     HYPOTENSION                                             0              0      </span></span>
<span><span class="co">#     NAUSEA (INTERMITTENT)                                   0              0      </span></span>
<span><span class="co">#     ORTHOSTATIC HYPOTENSION                                 0              0      </span></span>
<span><span class="co">#     WEAKNESS                                                0              0      </span></span>
<span><span class="co">#   VASCULAR DISORDERS                                                              </span></span>
<span><span class="co">#     Total number of patients with at least one event   93 (63.70%)    75 (48.70%) </span></span>
<span><span class="co">#     Total number of events                                 240            122     </span></span>
<span><span class="co">#     ABDOMINAL DISCOMFORT                                    0              0      </span></span>
<span><span class="co">#     ABDOMINAL FULLNESS DUE TO GAS                           0              0      </span></span>
<span><span class="co">#     BACK PAIN                                               0              0      </span></span>
<span><span class="co">#     DIARRHEA                                                0              0      </span></span>
<span><span class="co">#     FAECES SOFT                                             0              0      </span></span>
<span><span class="co">#     GINGIVAL BLEEDING                                       0              0      </span></span>
<span><span class="co">#     HEADACHE                                                0              0      </span></span>
<span><span class="co">#     HYPOTENSION                                            104             58     </span></span>
<span><span class="co">#     NAUSEA (INTERMITTENT)                                   0              0      </span></span>
<span><span class="co">#     ORTHOSTATIC HYPOTENSION                                136             64     </span></span>
<span><span class="co">#     WEAKNESS                                                0              0</span></span></code></pre></div>
<p>The <code>indent_mod</code> argument enables relative indenting
changes if the tree structure of the table does not result in the
desired indentation by default.</p>
<p>This table so far is however not the usual adverse event table as it
counts the total number of events and not the number of subjects for one
or more events for a particular term. To get the correct table we need
to write a custom analysis function:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">table_count_once_per_id</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">termvar</span> <span class="op">=</span> <span class="st">"AEDECOD"</span>, <span class="va">idvar</span> <span class="op">=</span> <span class="st">"USUBJID"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[[</span><span class="va">termvar</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">id</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[[</span><span class="va">idvar</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span>  <span class="va">counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="../reference/in_rows.html">in_rows</a></span><span class="op">(</span></span>
<span>    .list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">counts</span><span class="op">)</span>,</span>
<span>    .labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">counts</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">table_count_once_per_id</span><span class="op">(</span><span class="va">ADAE2</span><span class="op">)</span></span>
<span><span class="co"># RowsVerticalSection (in_rows) object print method:</span></span>
<span><span class="co"># ----------------------------</span></span>
<span><span class="co">#                         row_name formatted_cell indent_mod</span></span>
<span><span class="co"># 1           ABDOMINAL DISCOMFORT             23          0</span></span>
<span><span class="co"># 2  ABDOMINAL FULLNESS DUE TO GAS             21          0</span></span>
<span><span class="co"># 3                      BACK PAIN             20          0</span></span>
<span><span class="co"># 4                       DIARRHEA              7          0</span></span>
<span><span class="co"># 5                    FAECES SOFT             11          0</span></span>
<span><span class="co"># 6              GINGIVAL BLEEDING             15          0</span></span>
<span><span class="co"># 7                       HEADACHE            100          0</span></span>
<span><span class="co"># 8                    HYPOTENSION             16          0</span></span>
<span><span class="co"># 9          NAUSEA (INTERMITTENT)             21          0</span></span>
<span><span class="co"># 10       ORTHOSTATIC HYPOTENSION             14          0</span></span>
<span><span class="co"># 11                      WEAKNESS             16          0</span></span>
<span><span class="co">#                        row_label</span></span>
<span><span class="co"># 1           ABDOMINAL DISCOMFORT</span></span>
<span><span class="co"># 2  ABDOMINAL FULLNESS DUE TO GAS</span></span>
<span><span class="co"># 3                      BACK PAIN</span></span>
<span><span class="co"># 4                       DIARRHEA</span></span>
<span><span class="co"># 5                    FAECES SOFT</span></span>
<span><span class="co"># 6              GINGIVAL BLEEDING</span></span>
<span><span class="co"># 7                       HEADACHE</span></span>
<span><span class="co"># 8                    HYPOTENSION</span></span>
<span><span class="co"># 9          NAUSEA (INTERMITTENT)</span></span>
<span><span class="co"># 10       ORTHOSTATIC HYPOTENSION</span></span>
<span><span class="co"># 11                      WEAKNESS</span></span></code></pre></div>
<p>So the desired <code>AE</code> table is:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adae_soc_lyt3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_table.html">basic_table</a></span><span class="op">(</span>show_colcounts <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"ARM"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_rows_by.html">split_rows_by</a></span><span class="op">(</span><span class="st">"AEBODSYS"</span>, child_labels <span class="op">=</span> <span class="st">"visible"</span>, indent_mod <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/summarize_row_groups.html">summarize_row_groups</a></span><span class="op">(</span><span class="st">"USUBJID"</span>, cfun <span class="op">=</span> <span class="va">s_events_patients</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"AEDECOD"</span>, afun <span class="op">=</span> <span class="va">table_count_once_per_id</span>, show_labels <span class="op">=</span> <span class="st">"hidden"</span>, indent_mod <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">adae_soc_tbl3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">adae_soc_lyt3</span>, <span class="va">ADAE2</span>, alt_counts_df <span class="op">=</span> <span class="va">ADSL2</span><span class="op">)</span></span>
<span><span class="va">adae_soc_tbl3</span></span>
<span><span class="co">#                                                           ARM A          ARM B    </span></span>
<span><span class="co">#                                                          (N=146)        (N=154)   </span></span>
<span><span class="co"># ——————————————————————————————————————————————————————————————————————————————————</span></span>
<span><span class="co">#   GASTROINTESTINAL DISORDERS                                                      </span></span>
<span><span class="co">#     Total number of patients with at least one event   114 (78.08%)   130 (84.42%)</span></span>
<span><span class="co">#     Total number of events                                 760            374     </span></span>
<span><span class="co">#     ABDOMINAL DISCOMFORT                                    24             28     </span></span>
<span><span class="co">#     ABDOMINAL FULLNESS DUE TO GAS                           18             26     </span></span>
<span><span class="co">#     BACK PAIN                                               0              0      </span></span>
<span><span class="co">#     DIARRHEA                                                17             17     </span></span>
<span><span class="co">#     FAECES SOFT                                             17             14     </span></span>
<span><span class="co">#     GINGIVAL BLEEDING                                       18             25     </span></span>
<span><span class="co">#     HEADACHE                                                0              0      </span></span>
<span><span class="co">#     HYPOTENSION                                             0              0      </span></span>
<span><span class="co">#     NAUSEA (INTERMITTENT)                                   20             20     </span></span>
<span><span class="co">#     ORTHOSTATIC HYPOTENSION                                 0              0      </span></span>
<span><span class="co">#     WEAKNESS                                                0              0      </span></span>
<span><span class="co">#   MUSCULOSKELETAL AND CONNECTIVE TISSUE DISORDERS                                 </span></span>
<span><span class="co">#     Total number of patients with at least one event   98 (67.12%)    81 (52.60%) </span></span>
<span><span class="co">#     Total number of events                                 273            142     </span></span>
<span><span class="co">#     ABDOMINAL DISCOMFORT                                    0              0      </span></span>
<span><span class="co">#     ABDOMINAL FULLNESS DUE TO GAS                           0              0      </span></span>
<span><span class="co">#     BACK PAIN                                               58             45     </span></span>
<span><span class="co">#     DIARRHEA                                                0              0      </span></span>
<span><span class="co">#     FAECES SOFT                                             0              0      </span></span>
<span><span class="co">#     GINGIVAL BLEEDING                                       0              0      </span></span>
<span><span class="co">#     HEADACHE                                                0              0      </span></span>
<span><span class="co">#     HYPOTENSION                                             0              0      </span></span>
<span><span class="co">#     NAUSEA (INTERMITTENT)                                   0              0      </span></span>
<span><span class="co">#     ORTHOSTATIC HYPOTENSION                                 0              0      </span></span>
<span><span class="co">#     WEAKNESS                                                40             36     </span></span>
<span><span class="co">#   NERVOUS SYSTEM DISORDERS                                                        </span></span>
<span><span class="co">#     Total number of patients with at least one event   113 (77.40%)   133 (86.36%)</span></span>
<span><span class="co">#     Total number of events                                 787            420     </span></span>
<span><span class="co">#     ABDOMINAL DISCOMFORT                                    0              0      </span></span>
<span><span class="co">#     ABDOMINAL FULLNESS DUE TO GAS                           0              0      </span></span>
<span><span class="co">#     BACK PAIN                                               0              0      </span></span>
<span><span class="co">#     DIARRHEA                                                0              0      </span></span>
<span><span class="co">#     FAECES SOFT                                             0              0      </span></span>
<span><span class="co">#     GINGIVAL BLEEDING                                       0              0      </span></span>
<span><span class="co">#     HEADACHE                                               113            133     </span></span>
<span><span class="co">#     HYPOTENSION                                             0              0      </span></span>
<span><span class="co">#     NAUSEA (INTERMITTENT)                                   0              0      </span></span>
<span><span class="co">#     ORTHOSTATIC HYPOTENSION                                 0              0      </span></span>
<span><span class="co">#     WEAKNESS                                                0              0      </span></span>
<span><span class="co">#   VASCULAR DISORDERS                                                              </span></span>
<span><span class="co">#     Total number of patients with at least one event   93 (63.70%)    75 (48.70%) </span></span>
<span><span class="co">#     Total number of events                                 240            122     </span></span>
<span><span class="co">#     ABDOMINAL DISCOMFORT                                    0              0      </span></span>
<span><span class="co">#     ABDOMINAL FULLNESS DUE TO GAS                           0              0      </span></span>
<span><span class="co">#     BACK PAIN                                               0              0      </span></span>
<span><span class="co">#     DIARRHEA                                                0              0      </span></span>
<span><span class="co">#     FAECES SOFT                                             0              0      </span></span>
<span><span class="co">#     GINGIVAL BLEEDING                                       0              0      </span></span>
<span><span class="co">#     HEADACHE                                                0              0      </span></span>
<span><span class="co">#     HYPOTENSION                                             44             31     </span></span>
<span><span class="co">#     NAUSEA (INTERMITTENT)                                   0              0      </span></span>
<span><span class="co">#     ORTHOSTATIC HYPOTENSION                                 49             44     </span></span>
<span><span class="co">#     WEAKNESS                                                0              0</span></span></code></pre></div>
<p>Note that we are missing the overall summary in the first two rows.
This can be added with an initial <code><a href="../reference/analyze.html">analyze()</a></code> call.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adae_soc_lyt4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_table.html">basic_table</a></span><span class="op">(</span>show_colcounts <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"ARM"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"USUBJID"</span>, afun <span class="op">=</span> <span class="va">s_events_patients</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_rows_by.html">split_rows_by</a></span><span class="op">(</span><span class="st">"AEBODSYS"</span>, child_labels <span class="op">=</span> <span class="st">"visible"</span>, indent_mod <span class="op">=</span> <span class="fl">1</span>, section_div <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/summarize_row_groups.html">summarize_row_groups</a></span><span class="op">(</span><span class="st">"USUBJID"</span>, cfun <span class="op">=</span> <span class="va">s_events_patients</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"AEDECOD"</span>, <span class="va">table_count_once_per_id</span>, show_labels <span class="op">=</span> <span class="st">"hidden"</span>, indent_mod <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">adae_soc_tbl4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">adae_soc_lyt4</span>, <span class="va">ADAE2</span>, alt_counts_df <span class="op">=</span> <span class="va">ADSL2</span><span class="op">)</span></span>
<span><span class="va">adae_soc_tbl4</span></span>
<span><span class="co">#                                                           ARM A          ARM B    </span></span>
<span><span class="co">#                                                          (N=146)        (N=154)   </span></span>
<span><span class="co"># ——————————————————————————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># Total number of patients with at least one event       114 (78.08%)   150 (97.40%)</span></span>
<span><span class="co"># Total number of events                                     2060           1058    </span></span>
<span><span class="co">#   GASTROINTESTINAL DISORDERS                                                      </span></span>
<span><span class="co">#     Total number of patients with at least one event   114 (78.08%)   130 (84.42%)</span></span>
<span><span class="co">#     Total number of events                                 760            374     </span></span>
<span><span class="co">#     ABDOMINAL DISCOMFORT                                    24             28     </span></span>
<span><span class="co">#     ABDOMINAL FULLNESS DUE TO GAS                           18             26     </span></span>
<span><span class="co">#     BACK PAIN                                               0              0      </span></span>
<span><span class="co">#     DIARRHEA                                                17             17     </span></span>
<span><span class="co">#     FAECES SOFT                                             17             14     </span></span>
<span><span class="co">#     GINGIVAL BLEEDING                                       18             25     </span></span>
<span><span class="co">#     HEADACHE                                                0              0      </span></span>
<span><span class="co">#     HYPOTENSION                                             0              0      </span></span>
<span><span class="co">#     NAUSEA (INTERMITTENT)                                   20             20     </span></span>
<span><span class="co">#     ORTHOSTATIC HYPOTENSION                                 0              0      </span></span>
<span><span class="co">#     WEAKNESS                                                0              0      </span></span>
<span><span class="co"># </span></span>
<span><span class="co">#   MUSCULOSKELETAL AND CONNECTIVE TISSUE DISORDERS                                 </span></span>
<span><span class="co">#     Total number of patients with at least one event   98 (67.12%)    81 (52.60%) </span></span>
<span><span class="co">#     Total number of events                                 273            142     </span></span>
<span><span class="co">#     ABDOMINAL DISCOMFORT                                    0              0      </span></span>
<span><span class="co">#     ABDOMINAL FULLNESS DUE TO GAS                           0              0      </span></span>
<span><span class="co">#     BACK PAIN                                               58             45     </span></span>
<span><span class="co">#     DIARRHEA                                                0              0      </span></span>
<span><span class="co">#     FAECES SOFT                                             0              0      </span></span>
<span><span class="co">#     GINGIVAL BLEEDING                                       0              0      </span></span>
<span><span class="co">#     HEADACHE                                                0              0      </span></span>
<span><span class="co">#     HYPOTENSION                                             0              0      </span></span>
<span><span class="co">#     NAUSEA (INTERMITTENT)                                   0              0      </span></span>
<span><span class="co">#     ORTHOSTATIC HYPOTENSION                                 0              0      </span></span>
<span><span class="co">#     WEAKNESS                                                40             36     </span></span>
<span><span class="co"># </span></span>
<span><span class="co">#   NERVOUS SYSTEM DISORDERS                                                        </span></span>
<span><span class="co">#     Total number of patients with at least one event   113 (77.40%)   133 (86.36%)</span></span>
<span><span class="co">#     Total number of events                                 787            420     </span></span>
<span><span class="co">#     ABDOMINAL DISCOMFORT                                    0              0      </span></span>
<span><span class="co">#     ABDOMINAL FULLNESS DUE TO GAS                           0              0      </span></span>
<span><span class="co">#     BACK PAIN                                               0              0      </span></span>
<span><span class="co">#     DIARRHEA                                                0              0      </span></span>
<span><span class="co">#     FAECES SOFT                                             0              0      </span></span>
<span><span class="co">#     GINGIVAL BLEEDING                                       0              0      </span></span>
<span><span class="co">#     HEADACHE                                               113            133     </span></span>
<span><span class="co">#     HYPOTENSION                                             0              0      </span></span>
<span><span class="co">#     NAUSEA (INTERMITTENT)                                   0              0      </span></span>
<span><span class="co">#     ORTHOSTATIC HYPOTENSION                                 0              0      </span></span>
<span><span class="co">#     WEAKNESS                                                0              0      </span></span>
<span><span class="co"># </span></span>
<span><span class="co">#   VASCULAR DISORDERS                                                              </span></span>
<span><span class="co">#     Total number of patients with at least one event   93 (63.70%)    75 (48.70%) </span></span>
<span><span class="co">#     Total number of events                                 240            122     </span></span>
<span><span class="co">#     ABDOMINAL DISCOMFORT                                    0              0      </span></span>
<span><span class="co">#     ABDOMINAL FULLNESS DUE TO GAS                           0              0      </span></span>
<span><span class="co">#     BACK PAIN                                               0              0      </span></span>
<span><span class="co">#     DIARRHEA                                                0              0      </span></span>
<span><span class="co">#     FAECES SOFT                                             0              0      </span></span>
<span><span class="co">#     GINGIVAL BLEEDING                                       0              0      </span></span>
<span><span class="co">#     HEADACHE                                                0              0      </span></span>
<span><span class="co">#     HYPOTENSION                                             44             31     </span></span>
<span><span class="co">#     NAUSEA (INTERMITTENT)                                   0              0      </span></span>
<span><span class="co">#     ORTHOSTATIC HYPOTENSION                                 49             44     </span></span>
<span><span class="co">#     WEAKNESS                                                0              0</span></span></code></pre></div>
<p>Finally, if we wanted to prune the 0 count rows we can do that with
the <code><a href="../reference/trim_rows.html">trim_rows()</a></code> function:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/trim_rows.html">trim_rows</a></span><span class="op">(</span><span class="va">adae_soc_tbl4</span><span class="op">)</span></span>
<span><span class="co">#                                                           ARM A          ARM B    </span></span>
<span><span class="co">#                                                          (N=146)        (N=154)   </span></span>
<span><span class="co"># ——————————————————————————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># Total number of patients with at least one event       114 (78.08%)   150 (97.40%)</span></span>
<span><span class="co"># Total number of events                                     2060           1058    </span></span>
<span><span class="co">#   GASTROINTESTINAL DISORDERS                                                      </span></span>
<span><span class="co">#     Total number of patients with at least one event   114 (78.08%)   130 (84.42%)</span></span>
<span><span class="co">#     Total number of events                                 760            374     </span></span>
<span><span class="co">#     ABDOMINAL DISCOMFORT                                    24             28     </span></span>
<span><span class="co">#     ABDOMINAL FULLNESS DUE TO GAS                           18             26     </span></span>
<span><span class="co">#     DIARRHEA                                                17             17     </span></span>
<span><span class="co">#     FAECES SOFT                                             17             14     </span></span>
<span><span class="co">#     GINGIVAL BLEEDING                                       18             25     </span></span>
<span><span class="co">#     NAUSEA (INTERMITTENT)                                   20             20     </span></span>
<span><span class="co"># </span></span>
<span><span class="co">#   MUSCULOSKELETAL AND CONNECTIVE TISSUE DISORDERS                                 </span></span>
<span><span class="co">#     Total number of patients with at least one event   98 (67.12%)    81 (52.60%) </span></span>
<span><span class="co">#     Total number of events                                 273            142     </span></span>
<span><span class="co">#     BACK PAIN                                               58             45     </span></span>
<span><span class="co">#     WEAKNESS                                                40             36     </span></span>
<span><span class="co"># </span></span>
<span><span class="co">#   NERVOUS SYSTEM DISORDERS                                                        </span></span>
<span><span class="co">#     Total number of patients with at least one event   113 (77.40%)   133 (86.36%)</span></span>
<span><span class="co">#     Total number of events                                 787            420     </span></span>
<span><span class="co">#     HEADACHE                                               113            133     </span></span>
<span><span class="co"># </span></span>
<span><span class="co">#   VASCULAR DISORDERS                                                              </span></span>
<span><span class="co">#     Total number of patients with at least one event   93 (63.70%)    75 (48.70%) </span></span>
<span><span class="co">#     Total number of events                                 240            122     </span></span>
<span><span class="co">#     HYPOTENSION                                             44             31     </span></span>
<span><span class="co">#     ORTHOSTATIC HYPOTENSION                                 49             44</span></span></code></pre></div>
<p>Pruning is a larger topic with a <a href="https://insightsengineering.github.io/rtables/latest-tag/articles/sorting_pruning.html">separate
<code>rtables</code> package vignette</a>.</p>
</div>
<div class="section level3">
<h3 id="adverse-events-by-id-and-by-grade">Adverse Events By ID and By Grade<a class="anchor" aria-label="anchor" href="#adverse-events-by-id-and-by-grade"></a>
</h3>
<p>The adverse events table by ID and by grade shows how many patients
had at least one adverse event per grade for different subsets of the
data (e.g. defined by system organ class).</p>
<p>For this table we do not show the zero count grades. Note that we add
the “overall” groups with a custom split function.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">table_count_grade_once_per_id</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>,</span>
<span>                                          <span class="va">labelstr</span> <span class="op">=</span> <span class="st">""</span>,</span>
<span>                                          <span class="va">gradevar</span> <span class="op">=</span> <span class="st">"AETOXGR"</span>,</span>
<span>                                          <span class="va">idvar</span> <span class="op">=</span> <span class="st">"USUBJID"</span>,</span>
<span>                                          <span class="va">grade_levels</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">id</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[[</span><span class="va">idvar</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">grade</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[[</span><span class="va">gradevar</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">grade_levels</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">grade</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">grade_levels</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">grade</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">grade</span>, levels <span class="op">=</span> <span class="va">grade_levels</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">id_sel</span> <span class="op">&lt;-</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="../reference/in_rows.html">in_rows</a></span><span class="op">(</span></span>
<span>    <span class="st">"--Any Grade--"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">id_sel</span><span class="op">)</span>,</span>
<span>    .list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">grade</span><span class="op">[</span><span class="va">id_sel</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">table_count_grade_once_per_id</span><span class="op">(</span><span class="va">ex_adae</span>, grade_levels <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="co"># RowsVerticalSection (in_rows) object print method:</span></span>
<span><span class="co"># ----------------------------</span></span>
<span><span class="co">#        row_name formatted_cell indent_mod     row_label</span></span>
<span><span class="co"># 1 --Any Grade--            365          0 --Any Grade--</span></span>
<span><span class="co"># 2             1            131          0             1</span></span>
<span><span class="co"># 3             2             70          0             2</span></span>
<span><span class="co"># 4             3             74          0             3</span></span>
<span><span class="co"># 5             4             25          0             4</span></span>
<span><span class="co"># 6             5             65          0             5</span></span></code></pre></div>
<p>All of the layouting concepts needed to create this table have
already been introduced so far:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adae_grade_lyt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_table.html">basic_table</a></span><span class="op">(</span>show_colcounts <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"ARM"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span></span>
<span>    <span class="st">"AETOXGR"</span>,</span>
<span>    afun <span class="op">=</span> <span class="va">table_count_grade_once_per_id</span>,</span>
<span>    extra_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>grade_levels <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>,</span>
<span>    var_labels <span class="op">=</span> <span class="st">"- Any adverse events -"</span>,</span>
<span>    show_labels <span class="op">=</span> <span class="st">"visible"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_rows_by.html">split_rows_by</a></span><span class="op">(</span><span class="st">"AEBODSYS"</span>, child_labels <span class="op">=</span> <span class="st">"visible"</span>, indent_mod <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/summarize_row_groups.html">summarize_row_groups</a></span><span class="op">(</span>cfun <span class="op">=</span> <span class="va">table_count_grade_once_per_id</span>, format <span class="op">=</span> <span class="st">"xx"</span>, indent_mod <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_rows_by.html">split_rows_by</a></span><span class="op">(</span><span class="st">"AEDECOD"</span>, child_labels <span class="op">=</span> <span class="st">"visible"</span>, indent_mod <span class="op">=</span> <span class="op">-</span><span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span></span>
<span>    <span class="st">"AETOXGR"</span>,</span>
<span>    afun <span class="op">=</span> <span class="va">table_count_grade_once_per_id</span>,</span>
<span>    extra_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>grade_levels <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>,</span>
<span>    show_labels <span class="op">=</span> <span class="st">"hidden"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">adae_grade_tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">adae_grade_lyt</span>, <span class="va">ADAE2</span>, alt_counts_df <span class="op">=</span> <span class="va">ADSL2</span><span class="op">)</span></span>
<span><span class="va">adae_grade_tbl</span></span>
<span><span class="co">#                                                      ARM A     ARM B </span></span>
<span><span class="co">#                                                     (N=146)   (N=154)</span></span>
<span><span class="co"># —————————————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># - Any adverse events -                                               </span></span>
<span><span class="co">#   --Any Grade--                                       114       150  </span></span>
<span><span class="co">#   1                                                   32        34   </span></span>
<span><span class="co">#   2                                                   22        30   </span></span>
<span><span class="co">#   3                                                   11        21   </span></span>
<span><span class="co">#   4                                                    8         6   </span></span>
<span><span class="co">#   5                                                   41        59   </span></span>
<span><span class="co">#   GASTROINTESTINAL DISORDERS                                         </span></span>
<span><span class="co">#         --Any Grade--                                 114       130  </span></span>
<span><span class="co">#         1                                             77        96   </span></span>
<span><span class="co">#         2                                             37        34   </span></span>
<span><span class="co">#         3                                              0         0   </span></span>
<span><span class="co">#         4                                              0         0   </span></span>
<span><span class="co">#         5                                              0         0   </span></span>
<span><span class="co">#     ABDOMINAL DISCOMFORT                                             </span></span>
<span><span class="co">#       --Any Grade--                                   68        49   </span></span>
<span><span class="co">#       1                                               68        49   </span></span>
<span><span class="co">#       2                                                0         0   </span></span>
<span><span class="co">#       3                                                0         0   </span></span>
<span><span class="co">#       4                                                0         0   </span></span>
<span><span class="co">#       5                                                0         0   </span></span>
<span><span class="co">#     ABDOMINAL FULLNESS DUE TO GAS                                    </span></span>
<span><span class="co">#       --Any Grade--                                   73        51   </span></span>
<span><span class="co">#       1                                               73        51   </span></span>
<span><span class="co">#       2                                                0         0   </span></span>
<span><span class="co">#       3                                                0         0   </span></span>
<span><span class="co">#       4                                                0         0   </span></span>
<span><span class="co">#       5                                                0         0   </span></span>
<span><span class="co">#     BACK PAIN                                                        </span></span>
<span><span class="co">#       --Any Grade--                                    0         0   </span></span>
<span><span class="co">#       1                                                0         0   </span></span>
<span><span class="co">#       2                                                0         0   </span></span>
<span><span class="co">#       3                                                0         0   </span></span>
<span><span class="co">#       4                                                0         0   </span></span>
<span><span class="co">#       5                                                0         0   </span></span>
<span><span class="co">#     DIARRHEA                                                         </span></span>
<span><span class="co">#       --Any Grade--                                   68        40   </span></span>
<span><span class="co">#       1                                               68        40   </span></span>
<span><span class="co">#       2                                                0         0   </span></span>
<span><span class="co">#       3                                                0         0   </span></span>
<span><span class="co">#       4                                                0         0   </span></span>
<span><span class="co">#       5                                                0         0   </span></span>
<span><span class="co">#     FAECES SOFT                                                      </span></span>
<span><span class="co">#       --Any Grade--                                   76        44   </span></span>
<span><span class="co">#       1                                                0         0   </span></span>
<span><span class="co">#       2                                               76        44   </span></span>
<span><span class="co">#       3                                                0         0   </span></span>
<span><span class="co">#       4                                                0         0   </span></span>
<span><span class="co">#       5                                                0         0   </span></span>
<span><span class="co">#     GINGIVAL BLEEDING                                                </span></span>
<span><span class="co">#       --Any Grade--                                   80        52   </span></span>
<span><span class="co">#       1                                               80        52   </span></span>
<span><span class="co">#       2                                                0         0   </span></span>
<span><span class="co">#       3                                                0         0   </span></span>
<span><span class="co">#       4                                                0         0   </span></span>
<span><span class="co">#       5                                                0         0   </span></span>
<span><span class="co">#     HEADACHE                                                         </span></span>
<span><span class="co">#       --Any Grade--                                    0         0   </span></span>
<span><span class="co">#       1                                                0         0   </span></span>
<span><span class="co">#       2                                                0         0   </span></span>
<span><span class="co">#       3                                                0         0   </span></span>
<span><span class="co">#       4                                                0         0   </span></span>
<span><span class="co">#       5                                                0         0   </span></span>
<span><span class="co">#     HYPOTENSION                                                      </span></span>
<span><span class="co">#       --Any Grade--                                    0         0   </span></span>
<span><span class="co">#       1                                                0         0   </span></span>
<span><span class="co">#       2                                                0         0   </span></span>
<span><span class="co">#       3                                                0         0   </span></span>
<span><span class="co">#       4                                                0         0   </span></span>
<span><span class="co">#       5                                                0         0   </span></span>
<span><span class="co">#     NAUSEA (INTERMITTENT)                                            </span></span>
<span><span class="co">#       --Any Grade--                                   83        50   </span></span>
<span><span class="co">#       1                                                0         0   </span></span>
<span><span class="co">#       2                                               83        50   </span></span>
<span><span class="co">#       3                                                0         0   </span></span>
<span><span class="co">#       4                                                0         0   </span></span>
<span><span class="co">#       5                                                0         0   </span></span>
<span><span class="co">#     ORTHOSTATIC HYPOTENSION                                          </span></span>
<span><span class="co">#       --Any Grade--                                    0         0   </span></span>
<span><span class="co">#       1                                                0         0   </span></span>
<span><span class="co">#       2                                                0         0   </span></span>
<span><span class="co">#       3                                                0         0   </span></span>
<span><span class="co">#       4                                                0         0   </span></span>
<span><span class="co">#       5                                                0         0   </span></span>
<span><span class="co">#     WEAKNESS                                                         </span></span>
<span><span class="co">#       --Any Grade--                                    0         0   </span></span>
<span><span class="co">#       1                                                0         0   </span></span>
<span><span class="co">#       2                                                0         0   </span></span>
<span><span class="co">#       3                                                0         0   </span></span>
<span><span class="co">#       4                                                0         0   </span></span>
<span><span class="co">#       5                                                0         0   </span></span>
<span><span class="co">#   MUSCULOSKELETAL AND CONNECTIVE TISSUE DISORDERS                    </span></span>
<span><span class="co">#         --Any Grade--                                 98        81   </span></span>
<span><span class="co">#         1                                              0         0   </span></span>
<span><span class="co">#         2                                             58        45   </span></span>
<span><span class="co">#         3                                             40        36   </span></span>
<span><span class="co">#         4                                              0         0   </span></span>
<span><span class="co">#         5                                              0         0   </span></span>
<span><span class="co">#     ABDOMINAL DISCOMFORT                                             </span></span>
<span><span class="co">#       --Any Grade--                                    0         0   </span></span>
<span><span class="co">#       1                                                0         0   </span></span>
<span><span class="co">#       2                                                0         0   </span></span>
<span><span class="co">#       3                                                0         0   </span></span>
<span><span class="co">#       4                                                0         0   </span></span>
<span><span class="co">#       5                                                0         0   </span></span>
<span><span class="co">#     ABDOMINAL FULLNESS DUE TO GAS                                    </span></span>
<span><span class="co">#       --Any Grade--                                    0         0   </span></span>
<span><span class="co">#       1                                                0         0   </span></span>
<span><span class="co">#       2                                                0         0   </span></span>
<span><span class="co">#       3                                                0         0   </span></span>
<span><span class="co">#       4                                                0         0   </span></span>
<span><span class="co">#       5                                                0         0   </span></span>
<span><span class="co">#     BACK PAIN                                                        </span></span>
<span><span class="co">#       --Any Grade--                                   79        62   </span></span>
<span><span class="co">#       1                                                0         0   </span></span>
<span><span class="co">#       2                                               79        62   </span></span>
<span><span class="co">#       3                                                0         0   </span></span>
<span><span class="co">#       4                                                0         0   </span></span>
<span><span class="co">#       5                                                0         0   </span></span>
<span><span class="co">#     DIARRHEA                                                         </span></span>
<span><span class="co">#       --Any Grade--                                    0         0   </span></span>
<span><span class="co">#       1                                                0         0   </span></span>
<span><span class="co">#       2                                                0         0   </span></span>
<span><span class="co">#       3                                                0         0   </span></span>
<span><span class="co">#       4                                                0         0   </span></span>
<span><span class="co">#       5                                                0         0   </span></span>
<span><span class="co">#     FAECES SOFT                                                      </span></span>
<span><span class="co">#       --Any Grade--                                    0         0   </span></span>
<span><span class="co">#       1                                                0         0   </span></span>
<span><span class="co">#       2                                                0         0   </span></span>
<span><span class="co">#       3                                                0         0   </span></span>
<span><span class="co">#       4                                                0         0   </span></span>
<span><span class="co">#       5                                                0         0   </span></span>
<span><span class="co">#     GINGIVAL BLEEDING                                                </span></span>
<span><span class="co">#       --Any Grade--                                    0         0   </span></span>
<span><span class="co">#       1                                                0         0   </span></span>
<span><span class="co">#       2                                                0         0   </span></span>
<span><span class="co">#       3                                                0         0   </span></span>
<span><span class="co">#       4                                                0         0   </span></span>
<span><span class="co">#       5                                                0         0   </span></span>
<span><span class="co">#     HEADACHE                                                         </span></span>
<span><span class="co">#       --Any Grade--                                    0         0   </span></span>
<span><span class="co">#       1                                                0         0   </span></span>
<span><span class="co">#       2                                                0         0   </span></span>
<span><span class="co">#       3                                                0         0   </span></span>
<span><span class="co">#       4                                                0         0   </span></span>
<span><span class="co">#       5                                                0         0   </span></span>
<span><span class="co">#     HYPOTENSION                                                      </span></span>
<span><span class="co">#       --Any Grade--                                    0         0   </span></span>
<span><span class="co">#       1                                                0         0   </span></span>
<span><span class="co">#       2                                                0         0   </span></span>
<span><span class="co">#       3                                                0         0   </span></span>
<span><span class="co">#       4                                                0         0   </span></span>
<span><span class="co">#       5                                                0         0   </span></span>
<span><span class="co">#     NAUSEA (INTERMITTENT)                                            </span></span>
<span><span class="co">#       --Any Grade--                                    0         0   </span></span>
<span><span class="co">#       1                                                0         0   </span></span>
<span><span class="co">#       2                                                0         0   </span></span>
<span><span class="co">#       3                                                0         0   </span></span>
<span><span class="co">#       4                                                0         0   </span></span>
<span><span class="co">#       5                                                0         0   </span></span>
<span><span class="co">#     ORTHOSTATIC HYPOTENSION                                          </span></span>
<span><span class="co">#       --Any Grade--                                    0         0   </span></span>
<span><span class="co">#       1                                                0         0   </span></span>
<span><span class="co">#       2                                                0         0   </span></span>
<span><span class="co">#       3                                                0         0   </span></span>
<span><span class="co">#       4                                                0         0   </span></span>
<span><span class="co">#       5                                                0         0   </span></span>
<span><span class="co">#     WEAKNESS                                                         </span></span>
<span><span class="co">#       --Any Grade--                                   73        43   </span></span>
<span><span class="co">#       1                                                0         0   </span></span>
<span><span class="co">#       2                                                0         0   </span></span>
<span><span class="co">#       3                                               73        43   </span></span>
<span><span class="co">#       4                                                0         0   </span></span>
<span><span class="co">#       5                                                0         0   </span></span>
<span><span class="co">#   NERVOUS SYSTEM DISORDERS                                           </span></span>
<span><span class="co">#         --Any Grade--                                 113       133  </span></span>
<span><span class="co">#         1                                              0         0   </span></span>
<span><span class="co">#         2                                              0         0   </span></span>
<span><span class="co">#         3                                              0         0   </span></span>
<span><span class="co">#         4                                              0         0   </span></span>
<span><span class="co">#         5                                             113       133  </span></span>
<span><span class="co">#     ABDOMINAL DISCOMFORT                                             </span></span>
<span><span class="co">#       --Any Grade--                                    0         0   </span></span>
<span><span class="co">#       1                                                0         0   </span></span>
<span><span class="co">#       2                                                0         0   </span></span>
<span><span class="co">#       3                                                0         0   </span></span>
<span><span class="co">#       4                                                0         0   </span></span>
<span><span class="co">#       5                                                0         0   </span></span>
<span><span class="co">#     ABDOMINAL FULLNESS DUE TO GAS                                    </span></span>
<span><span class="co">#       --Any Grade--                                    0         0   </span></span>
<span><span class="co">#       1                                                0         0   </span></span>
<span><span class="co">#       2                                                0         0   </span></span>
<span><span class="co">#       3                                                0         0   </span></span>
<span><span class="co">#       4                                                0         0   </span></span>
<span><span class="co">#       5                                                0         0   </span></span>
<span><span class="co">#     BACK PAIN                                                        </span></span>
<span><span class="co">#       --Any Grade--                                    0         0   </span></span>
<span><span class="co">#       1                                                0         0   </span></span>
<span><span class="co">#       2                                                0         0   </span></span>
<span><span class="co">#       3                                                0         0   </span></span>
<span><span class="co">#       4                                                0         0   </span></span>
<span><span class="co">#       5                                                0         0   </span></span>
<span><span class="co">#     DIARRHEA                                                         </span></span>
<span><span class="co">#       --Any Grade--                                    0         0   </span></span>
<span><span class="co">#       1                                                0         0   </span></span>
<span><span class="co">#       2                                                0         0   </span></span>
<span><span class="co">#       3                                                0         0   </span></span>
<span><span class="co">#       4                                                0         0   </span></span>
<span><span class="co">#       5                                                0         0   </span></span>
<span><span class="co">#     FAECES SOFT                                                      </span></span>
<span><span class="co">#       --Any Grade--                                    0         0   </span></span>
<span><span class="co">#       1                                                0         0   </span></span>
<span><span class="co">#       2                                                0         0   </span></span>
<span><span class="co">#       3                                                0         0   </span></span>
<span><span class="co">#       4                                                0         0   </span></span>
<span><span class="co">#       5                                                0         0   </span></span>
<span><span class="co">#     GINGIVAL BLEEDING                                                </span></span>
<span><span class="co">#       --Any Grade--                                    0         0   </span></span>
<span><span class="co">#       1                                                0         0   </span></span>
<span><span class="co">#       2                                                0         0   </span></span>
<span><span class="co">#       3                                                0         0   </span></span>
<span><span class="co">#       4                                                0         0   </span></span>
<span><span class="co">#       5                                                0         0   </span></span>
<span><span class="co">#     HEADACHE                                                         </span></span>
<span><span class="co">#       --Any Grade--                                   113       133  </span></span>
<span><span class="co">#       1                                                0         0   </span></span>
<span><span class="co">#       2                                                0         0   </span></span>
<span><span class="co">#       3                                                0         0   </span></span>
<span><span class="co">#       4                                                0         0   </span></span>
<span><span class="co">#       5                                               113       133  </span></span>
<span><span class="co">#     HYPOTENSION                                                      </span></span>
<span><span class="co">#       --Any Grade--                                    0         0   </span></span>
<span><span class="co">#       1                                                0         0   </span></span>
<span><span class="co">#       2                                                0         0   </span></span>
<span><span class="co">#       3                                                0         0   </span></span>
<span><span class="co">#       4                                                0         0   </span></span>
<span><span class="co">#       5                                                0         0   </span></span>
<span><span class="co">#     NAUSEA (INTERMITTENT)                                            </span></span>
<span><span class="co">#       --Any Grade--                                    0         0   </span></span>
<span><span class="co">#       1                                                0         0   </span></span>
<span><span class="co">#       2                                                0         0   </span></span>
<span><span class="co">#       3                                                0         0   </span></span>
<span><span class="co">#       4                                                0         0   </span></span>
<span><span class="co">#       5                                                0         0   </span></span>
<span><span class="co">#     ORTHOSTATIC HYPOTENSION                                          </span></span>
<span><span class="co">#       --Any Grade--                                    0         0   </span></span>
<span><span class="co">#       1                                                0         0   </span></span>
<span><span class="co">#       2                                                0         0   </span></span>
<span><span class="co">#       3                                                0         0   </span></span>
<span><span class="co">#       4                                                0         0   </span></span>
<span><span class="co">#       5                                                0         0   </span></span>
<span><span class="co">#     WEAKNESS                                                         </span></span>
<span><span class="co">#       --Any Grade--                                    0         0   </span></span>
<span><span class="co">#       1                                                0         0   </span></span>
<span><span class="co">#       2                                                0         0   </span></span>
<span><span class="co">#       3                                                0         0   </span></span>
<span><span class="co">#       4                                                0         0   </span></span>
<span><span class="co">#       5                                                0         0   </span></span>
<span><span class="co">#   VASCULAR DISORDERS                                                 </span></span>
<span><span class="co">#         --Any Grade--                                 93        75   </span></span>
<span><span class="co">#         1                                              0         0   </span></span>
<span><span class="co">#         2                                              0         0   </span></span>
<span><span class="co">#         3                                             44        31   </span></span>
<span><span class="co">#         4                                             49        44   </span></span>
<span><span class="co">#         5                                              0         0   </span></span>
<span><span class="co">#     ABDOMINAL DISCOMFORT                                             </span></span>
<span><span class="co">#       --Any Grade--                                    0         0   </span></span>
<span><span class="co">#       1                                                0         0   </span></span>
<span><span class="co">#       2                                                0         0   </span></span>
<span><span class="co">#       3                                                0         0   </span></span>
<span><span class="co">#       4                                                0         0   </span></span>
<span><span class="co">#       5                                                0         0   </span></span>
<span><span class="co">#     ABDOMINAL FULLNESS DUE TO GAS                                    </span></span>
<span><span class="co">#       --Any Grade--                                    0         0   </span></span>
<span><span class="co">#       1                                                0         0   </span></span>
<span><span class="co">#       2                                                0         0   </span></span>
<span><span class="co">#       3                                                0         0   </span></span>
<span><span class="co">#       4                                                0         0   </span></span>
<span><span class="co">#       5                                                0         0   </span></span>
<span><span class="co">#     BACK PAIN                                                        </span></span>
<span><span class="co">#       --Any Grade--                                    0         0   </span></span>
<span><span class="co">#       1                                                0         0   </span></span>
<span><span class="co">#       2                                                0         0   </span></span>
<span><span class="co">#       3                                                0         0   </span></span>
<span><span class="co">#       4                                                0         0   </span></span>
<span><span class="co">#       5                                                0         0   </span></span>
<span><span class="co">#     DIARRHEA                                                         </span></span>
<span><span class="co">#       --Any Grade--                                    0         0   </span></span>
<span><span class="co">#       1                                                0         0   </span></span>
<span><span class="co">#       2                                                0         0   </span></span>
<span><span class="co">#       3                                                0         0   </span></span>
<span><span class="co">#       4                                                0         0   </span></span>
<span><span class="co">#       5                                                0         0   </span></span>
<span><span class="co">#     FAECES SOFT                                                      </span></span>
<span><span class="co">#       --Any Grade--                                    0         0   </span></span>
<span><span class="co">#       1                                                0         0   </span></span>
<span><span class="co">#       2                                                0         0   </span></span>
<span><span class="co">#       3                                                0         0   </span></span>
<span><span class="co">#       4                                                0         0   </span></span>
<span><span class="co">#       5                                                0         0   </span></span>
<span><span class="co">#     GINGIVAL BLEEDING                                                </span></span>
<span><span class="co">#       --Any Grade--                                    0         0   </span></span>
<span><span class="co">#       1                                                0         0   </span></span>
<span><span class="co">#       2                                                0         0   </span></span>
<span><span class="co">#       3                                                0         0   </span></span>
<span><span class="co">#       4                                                0         0   </span></span>
<span><span class="co">#       5                                                0         0   </span></span>
<span><span class="co">#     HEADACHE                                                         </span></span>
<span><span class="co">#       --Any Grade--                                    0         0   </span></span>
<span><span class="co">#       1                                                0         0   </span></span>
<span><span class="co">#       2                                                0         0   </span></span>
<span><span class="co">#       3                                                0         0   </span></span>
<span><span class="co">#       4                                                0         0   </span></span>
<span><span class="co">#       5                                                0         0   </span></span>
<span><span class="co">#     HYPOTENSION                                                      </span></span>
<span><span class="co">#       --Any Grade--                                   66        43   </span></span>
<span><span class="co">#       1                                                0         0   </span></span>
<span><span class="co">#       2                                                0         0   </span></span>
<span><span class="co">#       3                                               66        43   </span></span>
<span><span class="co">#       4                                                0         0   </span></span>
<span><span class="co">#       5                                                0         0   </span></span>
<span><span class="co">#     NAUSEA (INTERMITTENT)                                            </span></span>
<span><span class="co">#       --Any Grade--                                    0         0   </span></span>
<span><span class="co">#       1                                                0         0   </span></span>
<span><span class="co">#       2                                                0         0   </span></span>
<span><span class="co">#       3                                                0         0   </span></span>
<span><span class="co">#       4                                                0         0   </span></span>
<span><span class="co">#       5                                                0         0   </span></span>
<span><span class="co">#     ORTHOSTATIC HYPOTENSION                                          </span></span>
<span><span class="co">#       --Any Grade--                                   70        54   </span></span>
<span><span class="co">#       1                                                0         0   </span></span>
<span><span class="co">#       2                                                0         0   </span></span>
<span><span class="co">#       3                                                0         0   </span></span>
<span><span class="co">#       4                                               70        54   </span></span>
<span><span class="co">#       5                                                0         0   </span></span>
<span><span class="co">#     WEAKNESS                                                         </span></span>
<span><span class="co">#       --Any Grade--                                    0         0   </span></span>
<span><span class="co">#       1                                                0         0   </span></span>
<span><span class="co">#       2                                                0         0   </span></span>
<span><span class="co">#       3                                                0         0   </span></span>
<span><span class="co">#       4                                                0         0   </span></span>
<span><span class="co">#       5                                                0         0</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="response-table">Response Table<a class="anchor" aria-label="anchor" href="#response-table"></a>
</h2>
<p>The response table that we will create here is composed of 3
parts:</p>
<ol style="list-style-type: decimal">
<li>Binary response table</li>
<li>Unstratified analysis comparison vs. control group</li>
<li>Multinomial response table</li>
</ol>
<p>Let’s start with the first part which is fairly simple to derive:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ADRS_BESRSPI</span> <span class="op">&lt;-</span> <span class="va">ex_adrs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">PARAMCD</span> <span class="op">==</span> <span class="st">"BESRSPI"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    rsp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">AVALC</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CR"</span>, <span class="st">"PR"</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Responders"</span>, <span class="st">"Non-Responders"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    is_rsp <span class="op">=</span> <span class="op">(</span><span class="va">rsp</span> <span class="op">==</span> <span class="st">"Responders"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">s_proportion</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">.N_col</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/in_rows.html">in_rows</a></span><span class="op">(</span></span>
<span>    .list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      <span class="kw">function</span><span class="op">(</span><span class="va">xi</span><span class="op">)</span> <span class="fu"><a href="../reference/rcell.html">rcell</a></span><span class="op">(</span><span class="va">xi</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span> <span class="op">/</span> <span class="va">.N_col</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">"xx.xx (xx.xx%)"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">rsp_lyt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_table.html">basic_table</a></span><span class="op">(</span>show_colcounts <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"ARMCD"</span>, ref_group <span class="op">=</span> <span class="st">"ARM A"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"rsp"</span>, <span class="va">s_proportion</span>, show_labels <span class="op">=</span> <span class="st">"hidden"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rsp_tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">rsp_lyt</span>, <span class="va">ADRS_BESRSPI</span><span class="op">)</span></span>
<span><span class="va">rsp_tbl</span></span>
<span><span class="co">#                       ARM A            ARM B             ARM C     </span></span>
<span><span class="co">#                      (N=134)          (N=134)           (N=132)    </span></span>
<span><span class="co"># ———————————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># Responders       114.00 (85.07%)   90.00 (67.16%)   120.00 (90.91%)</span></span>
<span><span class="co"># Non-Responders   20.00 (14.93%)    44.00 (32.84%)    12.00 (9.09%)</span></span></code></pre></div>
<p>Note that we did set the <code>ref_group</code> argument in
<code><a href="../reference/split_cols_by.html">split_cols_by()</a></code> which for the current table had no effect
as we only use the cell data for the responder and non-responder counts.
The <code>ref_group</code> argument is needed for the part 2 and 3 of
the table.</p>
<p>We will now look the implementation of part 2: unstratified analysis
comparison vs. control group. Let’s start with the analysis
function:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s_unstrat_resp</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">.ref_group</span>, <span class="va">.in_ref_col</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">.in_ref_col</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="../reference/in_rows.html">in_rows</a></span><span class="op">(</span></span>
<span>      <span class="st">"Difference in Response Rates (%)"</span> <span class="op">=</span> <span class="fu"><a href="../reference/rcell.html">rcell</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      <span class="st">"95% CI (Wald, with correction)"</span> <span class="op">=</span> <span class="fu"><a href="../reference/rcell.html">rcell</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      <span class="st">"p-value (Chi-Squared Test)"</span> <span class="op">=</span> <span class="fu"><a href="../reference/rcell.html">rcell</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      <span class="st">"Odds Ratio (95% CI)"</span> <span class="op">=</span> <span class="fu"><a href="../reference/rcell.html">rcell</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/prop.test.html" class="external-link">prop.test</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">.ref_group</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">.ref_group</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    correct <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="va">fit_glm</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span></span>
<span>    formula <span class="op">=</span> <span class="va">rsp</span> <span class="op">~</span> <span class="va">group</span>,</span>
<span>    data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      rsp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">.ref_group</span>, <span class="va">x</span><span class="op">)</span>,</span>
<span>      group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ref"</span>, <span class="st">"x"</span><span class="op">)</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">.ref_group</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ref"</span>, <span class="st">"x"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="../reference/in_rows.html">in_rows</a></span><span class="op">(</span></span>
<span>    <span class="st">"Difference in Response Rates (%)"</span> <span class="op">=</span> <span class="fu"><a href="../reference/rcell.html">non_ref_rcell</a></span><span class="op">(</span></span>
<span>      <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">.ref_group</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>,</span>
<span>      <span class="va">.in_ref_col</span>,</span>
<span>      format <span class="op">=</span> <span class="st">"xx.xx"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="st">"95% CI (Wald, with correction)"</span> <span class="op">=</span> <span class="fu"><a href="../reference/rcell.html">non_ref_rcell</a></span><span class="op">(</span></span>
<span>      <span class="va">fit</span><span class="op">$</span><span class="va">conf.int</span> <span class="op">*</span> <span class="fl">100</span>,</span>
<span>      <span class="va">.in_ref_col</span>,</span>
<span>      format <span class="op">=</span> <span class="st">"(xx.xx, xx.xx)"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="st">"p-value (Chi-Squared Test)"</span> <span class="op">=</span> <span class="fu"><a href="../reference/rcell.html">non_ref_rcell</a></span><span class="op">(</span></span>
<span>      <span class="va">fit</span><span class="op">$</span><span class="va">p.value</span>,</span>
<span>      <span class="va">.in_ref_col</span>,</span>
<span>      format <span class="op">=</span> <span class="st">"x.xxxx | (&lt;0.0001)"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="st">"Odds Ratio (95% CI)"</span> <span class="op">=</span> <span class="fu"><a href="../reference/rcell.html">non_ref_rcell</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit_glm</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint.default</a></span><span class="op">(</span><span class="va">fit_glm</span>, level <span class="op">=</span> <span class="fl">.95</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>, , drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span><span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>      <span class="va">.in_ref_col</span>,</span>
<span>      format <span class="op">=</span> <span class="st">"xx.xx (xx.xx - xx.xx)"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">s_unstrat_resp</span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">ADRS_BESRSPI</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ARM</span> <span class="op">==</span> <span class="st">"A: Drug X"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">is_rsp</span><span class="op">)</span>,</span>
<span>  .ref_group <span class="op">=</span> <span class="va">ADRS_BESRSPI</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ARM</span> <span class="op">==</span> <span class="st">"B: Placebo"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">is_rsp</span><span class="op">)</span>,</span>
<span>  .in_ref_col <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># RowsVerticalSection (in_rows) object print method:</span></span>
<span><span class="co"># ----------------------------</span></span>
<span><span class="co">#                           row_name     formatted_cell indent_mod</span></span>
<span><span class="co"># 1 Difference in Response Rates (%)              17.91          0</span></span>
<span><span class="co"># 2   95% CI (Wald, with correction)      (7.93, 27.89)          0</span></span>
<span><span class="co"># 3       p-value (Chi-Squared Test)             0.0006          0</span></span>
<span><span class="co"># 4              Odds Ratio (95% CI) 2.79 (1.53 - 5.06)          0</span></span>
<span><span class="co">#                          row_label</span></span>
<span><span class="co"># 1 Difference in Response Rates (%)</span></span>
<span><span class="co"># 2   95% CI (Wald, with correction)</span></span>
<span><span class="co"># 3       p-value (Chi-Squared Test)</span></span>
<span><span class="co"># 4              Odds Ratio (95% CI)</span></span></code></pre></div>
<p>Hence we can now add the next vignette to the table:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rsp_lyt2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_table.html">basic_table</a></span><span class="op">(</span>show_colcounts <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"ARMCD"</span>, ref_group <span class="op">=</span> <span class="st">"ARM A"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"rsp"</span>, <span class="va">s_proportion</span>, show_labels <span class="op">=</span> <span class="st">"hidden"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span></span>
<span>    <span class="st">"is_rsp"</span>, <span class="va">s_unstrat_resp</span>,</span>
<span>    show_labels <span class="op">=</span> <span class="st">"visible"</span>,</span>
<span>    var_labels <span class="op">=</span> <span class="st">"Unstratified Response Analysis"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">rsp_tbl2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">rsp_lyt2</span>, <span class="va">ADRS_BESRSPI</span><span class="op">)</span></span>
<span><span class="va">rsp_tbl2</span></span>
<span><span class="co">#                                           ARM A              ARM B                ARM C       </span></span>
<span><span class="co">#                                          (N=134)            (N=134)              (N=132)      </span></span>
<span><span class="co"># ——————————————————————————————————————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># Responders                           114.00 (85.07%)     90.00 (67.16%)      120.00 (90.91%)  </span></span>
<span><span class="co"># Non-Responders                       20.00 (14.93%)      44.00 (32.84%)       12.00 (9.09%)   </span></span>
<span><span class="co"># Unstratified Response Analysis                                                                </span></span>
<span><span class="co">#   Difference in Response Rates (%)                           -17.91                5.83       </span></span>
<span><span class="co">#   95% CI (Wald, with correction)                        (-27.89, -7.93)       (-1.94, 13.61)  </span></span>
<span><span class="co">#   p-value (Chi-Squared Test)                                 0.0006               0.1436      </span></span>
<span><span class="co">#   Odds Ratio (95% CI)                                  0.36 (0.20 - 0.65)   1.75 (0.82 - 3.75)</span></span></code></pre></div>
<p>Next we will add part 3: the multinomial response table. To do so, we
are adding a row-split by response level, and then doing the same thing
as we did for the binary response table above.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s_prop</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">.N_col</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/in_rows.html">in_rows</a></span><span class="op">(</span></span>
<span>    <span class="st">"95% CI (Wald, with correction)"</span> <span class="op">=</span> <span class="fu"><a href="../reference/rcell.html">rcell</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/binom.test.html" class="external-link">binom.test</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>, <span class="va">.N_col</span><span class="op">)</span><span class="op">$</span><span class="va">conf.int</span> <span class="op">*</span> <span class="fl">100</span>, format <span class="op">=</span> <span class="st">"(xx.xx, xx.xx)"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">s_prop</span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">ADRS_BESRSPI</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ARM</span> <span class="op">==</span> <span class="st">"A: Drug X"</span>, <span class="va">AVALC</span> <span class="op">==</span> <span class="st">"CR"</span><span class="op">)</span>,</span>
<span>  .N_col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">ADRS_BESRSPI</span><span class="op">$</span><span class="va">ARM</span> <span class="op">==</span> <span class="st">"A: Drug X"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># RowsVerticalSection (in_rows) object print method:</span></span>
<span><span class="co"># ----------------------------</span></span>
<span><span class="co">#                         row_name formatted_cell indent_mod</span></span>
<span><span class="co"># 1 95% CI (Wald, with correction) (49.38, 66.67)          0</span></span>
<span><span class="co">#                        row_label</span></span>
<span><span class="co"># 1 95% CI (Wald, with correction)</span></span></code></pre></div>
<p>We can now create the final response table with all three parts:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rsp_lyt3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_table.html">basic_table</a></span><span class="op">(</span>show_colcounts <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"ARMCD"</span>, ref_group <span class="op">=</span> <span class="st">"ARM A"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"rsp"</span>, <span class="va">s_proportion</span>, show_labels <span class="op">=</span> <span class="st">"hidden"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span></span>
<span>    <span class="st">"is_rsp"</span>, <span class="va">s_unstrat_resp</span>,</span>
<span>    show_labels <span class="op">=</span> <span class="st">"visible"</span>, var_labels <span class="op">=</span> <span class="st">"Unstratified Response Analysis"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_rows_by.html">split_rows_by</a></span><span class="op">(</span></span>
<span>    var <span class="op">=</span> <span class="st">"AVALC"</span>,</span>
<span>    split_fun <span class="op">=</span> <span class="fu"><a href="../reference/split_funcs.html">reorder_split_levels</a></span><span class="op">(</span>neworder <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CR"</span>, <span class="st">"PR"</span>, <span class="st">"SD"</span>, <span class="st">"PD"</span>, <span class="st">"NE"</span><span class="op">)</span>, drlevels <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    nested <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/summarize_row_groups.html">summarize_row_groups</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"AVALC"</span>, afun <span class="op">=</span> <span class="va">s_prop</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rsp_tbl3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">rsp_lyt3</span>, <span class="va">ADRS_BESRSPI</span><span class="op">)</span></span>
<span><span class="va">rsp_tbl3</span></span>
<span><span class="co">#                                           ARM A              ARM B                ARM C       </span></span>
<span><span class="co">#                                          (N=134)            (N=134)              (N=132)      </span></span>
<span><span class="co"># ——————————————————————————————————————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># Responders                           114.00 (85.07%)     90.00 (67.16%)      120.00 (90.91%)  </span></span>
<span><span class="co"># Non-Responders                       20.00 (14.93%)      44.00 (32.84%)       12.00 (9.09%)   </span></span>
<span><span class="co"># Unstratified Response Analysis                                                                </span></span>
<span><span class="co">#   Difference in Response Rates (%)                           -17.91                5.83       </span></span>
<span><span class="co">#   95% CI (Wald, with correction)                        (-27.89, -7.93)       (-1.94, 13.61)  </span></span>
<span><span class="co">#   p-value (Chi-Squared Test)                                 0.0006               0.1436      </span></span>
<span><span class="co">#   Odds Ratio (95% CI)                                  0.36 (0.20 - 0.65)   1.75 (0.82 - 3.75)</span></span>
<span><span class="co"># CR                                     78 (58.2%)          55 (41.0%)           97 (73.5%)    </span></span>
<span><span class="co">#   95% CI (Wald, with correction)     (49.38, 66.67)      (32.63, 49.87)       (65.10, 80.79)  </span></span>
<span><span class="co"># PR                                     36 (26.9%)          35 (26.1%)           23 (17.4%)    </span></span>
<span><span class="co">#   95% CI (Wald, with correction)     (19.58, 35.20)      (18.92, 34.41)       (11.38, 24.99)  </span></span>
<span><span class="co"># SD                                     20 (14.9%)          44 (32.8%)           12 (9.1%)     </span></span>
<span><span class="co">#   95% CI (Wald, with correction)      (9.36, 22.11)      (24.97, 41.47)       (4.79, 15.34)   </span></span>
<span><span class="co"># PD                                      0 (0.0%)            0 (0.0%)             0 (0.0%)     </span></span>
<span><span class="co">#   95% CI (Wald, with correction)      (0.00, 2.72)        (0.00, 2.72)         (0.00, 2.76)   </span></span>
<span><span class="co"># NE                                      0 (0.0%)            0 (0.0%)             0 (0.0%)     </span></span>
<span><span class="co">#   95% CI (Wald, with correction)      (0.00, 2.72)        (0.00, 2.72)         (0.00, 2.76)</span></span></code></pre></div>
<p>In the case that we wanted to rename the levels of <code>AVALC</code>
and remove the CI for <code>NE</code> we could do that as follows:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rsp_label</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">rsp_full_label</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    CR <span class="op">=</span> <span class="st">"Complete Response (CR)"</span>,</span>
<span>    PR <span class="op">=</span> <span class="st">"Partial Response (PR)"</span>,</span>
<span>    SD <span class="op">=</span> <span class="st">"Stable Disease (SD)"</span>,</span>
<span>    `NON CR/PD` <span class="op">=</span> <span class="st">"Non-CR or Non-PD (NON CR/PD)"</span>,</span>
<span>    PD <span class="op">=</span> <span class="st">"Progressive Disease (PD)"</span>,</span>
<span>    NE <span class="op">=</span> <span class="st">"Not Evaluable (NE)"</span>,</span>
<span>    Missing <span class="op">=</span> <span class="st">"Missing"</span>,</span>
<span>    `NE/Missing` <span class="op">=</span> <span class="st">"Missing or unevaluable"</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">rsp_full_label</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">rsp_full_label</span><span class="op">[</span><span class="va">x</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="va">rsp_lyt4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_table.html">basic_table</a></span><span class="op">(</span>show_colcounts <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"ARMCD"</span>, ref_group <span class="op">=</span> <span class="st">"ARM A"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"rsp"</span>, <span class="va">s_proportion</span>, show_labels <span class="op">=</span> <span class="st">"hidden"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span></span>
<span>    <span class="st">"is_rsp"</span>, <span class="va">s_unstrat_resp</span>,</span>
<span>    show_labels <span class="op">=</span> <span class="st">"visible"</span>, var_labels <span class="op">=</span> <span class="st">"Unstratified Response Analysis"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_rows_by.html">split_rows_by</a></span><span class="op">(</span></span>
<span>    var <span class="op">=</span> <span class="st">"AVALC"</span>,</span>
<span>    split_fun <span class="op">=</span> <span class="fu"><a href="../reference/split_funcs.html">keep_split_levels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CR"</span>, <span class="st">"PR"</span>, <span class="st">"SD"</span>, <span class="st">"PD"</span><span class="op">)</span>, reorder <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    nested <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/summarize_row_groups.html">summarize_row_groups</a></span><span class="op">(</span>cfun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">labelstr</span>, <span class="va">.N_col</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/in_rows.html">in_rows</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span> <span class="op">/</span> <span class="va">.N_col</span><span class="op">)</span>, .formats <span class="op">=</span> <span class="st">"xx (xx.xx%)"</span>, .labels <span class="op">=</span> <span class="fu">rsp_label</span><span class="op">(</span><span class="va">labelstr</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"AVALC"</span>, afun <span class="op">=</span> <span class="va">s_prop</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"AVALC"</span>, afun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">.N_col</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/in_rows.html">in_rows</a></span><span class="op">(</span><span class="fu"><a href="../reference/rcell.html">rcell</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span> <span class="op">==</span> <span class="st">"NE"</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span> <span class="op">/</span> <span class="va">.N_col</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">"xx.xx (xx.xx%)"</span><span class="op">)</span>, .labels <span class="op">=</span> <span class="fu">rsp_label</span><span class="op">(</span><span class="st">"NE"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span>, nested <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rsp_tbl4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">rsp_lyt4</span>, <span class="va">ADRS_BESRSPI</span><span class="op">)</span></span>
<span><span class="co"># Modifying subtable (or row) names to ensure uniqueness among direct siblings</span></span>
<span><span class="co"># [AVALC  -&gt; { AVALC, AVALC[2] }]</span></span>
<span><span class="co">#   To control table names use split_rows_by*(, parent_name =.) or  analyze(., table_names = .) when analyzing a single variable, or analyze(., parent_name = .) when analyzing multiple variables in a single call.FALSE</span></span>
<span><span class="va">rsp_tbl4</span></span>
<span><span class="co">#                                           ARM A              ARM B                ARM C       </span></span>
<span><span class="co">#                                          (N=134)            (N=134)              (N=132)      </span></span>
<span><span class="co"># ——————————————————————————————————————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># Responders                           114.00 (85.07%)     90.00 (67.16%)      120.00 (90.91%)  </span></span>
<span><span class="co"># Non-Responders                       20.00 (14.93%)      44.00 (32.84%)       12.00 (9.09%)   </span></span>
<span><span class="co"># Unstratified Response Analysis                                                                </span></span>
<span><span class="co">#   Difference in Response Rates (%)                           -17.91                5.83       </span></span>
<span><span class="co">#   95% CI (Wald, with correction)                        (-27.89, -7.93)       (-1.94, 13.61)  </span></span>
<span><span class="co">#   p-value (Chi-Squared Test)                                 0.0006               0.1436      </span></span>
<span><span class="co">#   Odds Ratio (95% CI)                                  0.36 (0.20 - 0.65)   1.75 (0.82 - 3.75)</span></span>
<span><span class="co"># Complete Response (CR)                 78 (58.21%)        55 (41.04%)          97 (73.48%)    </span></span>
<span><span class="co">#   95% CI (Wald, with correction)     (49.38, 66.67)      (32.63, 49.87)       (65.10, 80.79)  </span></span>
<span><span class="co"># Partial Response (PR)                  36 (26.87%)        35 (26.12%)          23 (17.42%)    </span></span>
<span><span class="co">#   95% CI (Wald, with correction)     (19.58, 35.20)      (18.92, 34.41)       (11.38, 24.99)  </span></span>
<span><span class="co"># Stable Disease (SD)                    20 (14.93%)        44 (32.84%)           12 (9.09%)    </span></span>
<span><span class="co">#   95% CI (Wald, with correction)      (9.36, 22.11)      (24.97, 41.47)       (4.79, 15.34)   </span></span>
<span><span class="co"># Progressive Disease (PD)                0 (0.00%)          0 (0.00%)            0 (0.00%)     </span></span>
<span><span class="co">#   95% CI (Wald, with correction)      (0.00, 2.72)        (0.00, 2.72)         (0.00, 2.76)   </span></span>
<span><span class="co"># Not Evaluable (NE)                    0.00 (0.00%)        0.00 (0.00%)         0.00 (0.00%)</span></span></code></pre></div>
<p>Note that the table is missing the rows gaps to make it more
readable. The row spacing feature is on the <code>rtables</code> roadmap
and will be implemented in future.</p>
</div>
<div class="section level2">
<h2 id="time-to-event-analysis-table">Time to Event Analysis Table<a class="anchor" aria-label="anchor" href="#time-to-event-analysis-table"></a>
</h2>
<p>The time to event analysis table that will be constructed consists of
four parts:</p>
<ol style="list-style-type: decimal">
<li>Overall subject counts</li>
<li>Censored subjects summary</li>
<li>Cox proportional-hazards analysis</li>
<li>Time-to-event analysis</li>
</ol>
<p>The table is constructed by sequential use of the
<code><a href="../reference/analyze.html">analyze()</a></code> function, with four custom analysis functions
corresponding to each of the four parts listed above. In addition the
table includes referential footnotes relevant to the table contents. The
table will be faceted column-wise by arm.</p>
<p>First we will start by loading the necessary packages and preparing
the data to be used in the construction of this table.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">adtte</span> <span class="op">&lt;-</span> <span class="va">ex_adaette</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">PARAMCD</span> <span class="op">==</span> <span class="st">"AETTE2"</span>, <span class="va">SAFFL</span> <span class="op">==</span> <span class="st">"Y"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add censoring to data for example</span></span>
<span><span class="va">adtte</span><span class="op">[</span><span class="va">adtte</span><span class="op">$</span><span class="va">AVAL</span> <span class="op">&gt;</span> <span class="fl">1.0</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">adtte</span><span class="op">[</span><span class="va">adtte</span><span class="op">$</span><span class="va">AVAL</span> <span class="op">&gt;</span> <span class="fl">1.0</span>, <span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>AVAL <span class="op">=</span> <span class="fl">1.0</span>, CNSR <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">adtte2</span> <span class="op">&lt;-</span> <span class="va">adtte</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>CNSDTDSC <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">CNSDTDSC</span> <span class="op">==</span> <span class="st">""</span>, <span class="st">"__none__"</span>, <span class="va">CNSDTDSC</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The <code>adtte</code> dataset will be used in preparing the models
while the <code>adtte2</code> dataset handles missing values in the
“Censor Date Description” column and will be used to produce the final
table. We add censoring into the data for example purposes.</p>
<p>Next we create a basic analysis function, <code>a_count_subjs</code>
which prints the overall unique subject counts and percentages within
the data.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">a_count_subjs</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">.N_col</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/in_rows.html">in_rows</a></span><span class="op">(</span></span>
<span>    <span class="st">"Subjects with Adverse Events n (%)"</span> <span class="op">=</span> <span class="fu"><a href="../reference/rcell.html">rcell</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span> <span class="op">/</span> <span class="va">.N_col</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">"xx (xx.xx%)"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Then an analysis function is created to generate the counts of
censored subjects for each level of a factor variable in the dataset. In
this case the <code>cnsr_counter</code> function will be applied with
the <code>CNSDTDSC</code> variable which contains a censor date
description for each censored subject.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cnsr_counter</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">.var</span>, <span class="va">.N_col</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">USUBJID</span><span class="op">)</span>, <span class="va">.var</span><span class="op">]</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="va">x</span> <span class="op">!=</span> <span class="st">"__none__"</span><span class="op">]</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">xi</span><span class="op">)</span> <span class="fu"><a href="../reference/rcell.html">rcell</a></span><span class="op">(</span><span class="va">xi</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span> <span class="op">/</span> <span class="va">.N_col</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">"xx (xx.xx%)"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>This function generates counts and fractions of unique subjects
corresponding to each factor level, excluding missing values (uncensored
patients).</p>
<p>A Cox proportional-hazards (Cox P-H) analysis is generated next with
a third custom analysis function, <code>a_cph</code>. Prior to creating
the analysis function, the Cox P-H model is fit to our data using the
<code><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph()</a></code> and <code><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv()</a></code> functions from the
<code>survival</code> package. Then this model is used as input to the
<code>a_cph</code> analysis function which returns hazard ratios, 95%
confidence intervals, and p-values comparing against the reference group
- in this case the leftmost column.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cph</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">AVAL</span>, <span class="va">CNSR</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">~</span> <span class="va">ACTARM</span> <span class="op">+</span> <span class="va">STRATA1</span>, ties <span class="op">=</span> <span class="st">"exact"</span>, data <span class="op">=</span> <span class="va">adtte</span><span class="op">)</span></span>
<span></span>
<span><span class="va">a_cph</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">.var</span>, <span class="va">.in_ref_col</span>, <span class="va">.ref_full</span>, <span class="va">full_cox_fit</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">.in_ref_col</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">ret</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="../reference/rcell.html">rcell</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">curtrt</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[[</span><span class="va">.var</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">coefs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">full_cox_fit</span><span class="op">)</span></span>
<span>    <span class="va">sel_pos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="va">curtrt</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">coefs</span><span class="op">)</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="va">hrval</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">coefs</span><span class="op">[</span><span class="va">sel_pos</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">sdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/survdiff.html" class="external-link">survdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">AVAL</span>, <span class="va">CNSR</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">~</span> <span class="va">ACTARM</span> <span class="op">+</span> <span class="va">STRATA1</span>, data <span class="op">=</span> <span class="fu"><a href="../reference/rbind.html">rbind</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">.ref_full</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">pval</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Chisquare.html" class="external-link">pchisq</a></span><span class="op">(</span><span class="va">sdf</span><span class="op">$</span><span class="va">chisq</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sdf</span><span class="op">$</span><span class="va">n</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span>    <span class="va">ci_val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">full_cox_fit</span><span class="op">)</span><span class="op">[</span><span class="va">sel_pos</span>, <span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">ret</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="../reference/rcell.html">rcell</a></span><span class="op">(</span><span class="va">hrval</span>, format <span class="op">=</span> <span class="st">"xx.x"</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="../reference/rcell.html">rcell</a></span><span class="op">(</span><span class="va">ci_val</span>, format <span class="op">=</span> <span class="st">"(xx.x, xx.x)"</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="../reference/rcell.html">rcell</a></span><span class="op">(</span><span class="va">pval</span>, format <span class="op">=</span> <span class="st">"x.xxxx | (&lt;0.0001)"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="../reference/in_rows.html">in_rows</a></span><span class="op">(</span></span>
<span>    .list <span class="op">=</span> <span class="va">ret</span>,</span>
<span>    .names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Hazard ratio"</span>, <span class="st">"95% confidence interval"</span>, <span class="st">"p-value (one-sided stratified log rank)"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The fourth and final analysis function, <code>a_tte</code>, generates
a time to first adverse event table with three rows corresponding to
Median, 95% Confidence Interval, and Min Max respectively. First a
survival table is constructed from the summary table of a survival model
using the <code><a href="https://rdrr.io/pkg/survival/man/survfit.html" class="external-link">survfit()</a></code> and <code><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv()</a></code> functions from
the <code>survival</code> package. This table is then given as input to
<code>a_tte</code> which produces the table of time to first adverse
event consisting of the previously mentioned summary statistics.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surv_tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/survfit.html" class="external-link">survfit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">AVAL</span>, <span class="va">CNSR</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">~</span> <span class="va">ACTARM</span>, data <span class="op">=</span> <span class="va">adtte</span>, conf.type <span class="op">=</span> <span class="st">"log-log"</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">table</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    ACTARM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"ACTARM="</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">adtte</span><span class="op">$</span><span class="va">ACTARM</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    ind <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">a_tte</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">.var</span>, <span class="va">kp_table</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">ind</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="va">df</span><span class="op">[[</span><span class="va">.var</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">kp_table</span><span class="op">)</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">minmax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">df</span><span class="op">[[</span><span class="st">"AVAL"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">mm_val_str</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://insightsengineering.github.io/formatters/latest-tag/reference/format_value.html" class="external-link">format_value</a></span><span class="op">(</span><span class="va">minmax</span>, format <span class="op">=</span> <span class="st">"xx.x, xx.x"</span><span class="op">)</span></span>
<span>  <span class="va">rowfn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">CNSR</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">AVAL</span> <span class="op">==</span> <span class="va">minmax</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">mm_val_str</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">mm_val_str</span>, <span class="st">"*"</span><span class="op">)</span></span>
<span>    <span class="va">rowfn</span> <span class="op">&lt;-</span> <span class="st">"* indicates censoring"</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="../reference/in_rows.html">in_rows</a></span><span class="op">(</span></span>
<span>    Median <span class="op">=</span> <span class="va">kp_table</span><span class="op">[</span><span class="va">ind</span>, <span class="st">"median"</span>, drop <span class="op">=</span> <span class="cn">TRUE</span><span class="op">]</span>,</span>
<span>    <span class="st">"95% confidence interval"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">kp_table</span><span class="op">[</span><span class="va">ind</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0.95LCL"</span>, <span class="st">"0.95UCL"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,</span>
<span>    <span class="st">"Min Max"</span> <span class="op">=</span> <span class="va">mm_val_str</span>,</span>
<span>    .formats <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"xx.xx"</span>, <span class="st">"xx.xx - xx.xx"</span>, <span class="st">"xx"</span><span class="op">)</span>,</span>
<span>    .row_footnotes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="cn">NULL</span>, <span class="va">rowfn</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Additionally, the <code>a_tte</code> function creates a referential
footnote within the table to indicate where censoring occurred in the
data.</p>
<p>Now we are able to use these four analysis functions to build our
time to event analysis table.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lyt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_table.html">basic_table</a></span><span class="op">(</span>show_colcounts <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co">## Column faceting</span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"ARM"</span>, ref_group <span class="op">=</span> <span class="st">"A: Drug X"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co">## Overall count</span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"USUBJID"</span>, <span class="va">a_count_subjs</span>, show_labels <span class="op">=</span> <span class="st">"hidden"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co">## Censored subjects summary</span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"CNSDTDSC"</span>, <span class="va">cnsr_counter</span>, var_labels <span class="op">=</span> <span class="st">"Censored Subjects"</span>, show_labels <span class="op">=</span> <span class="st">"visible"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co">## Cox P-H analysis</span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"ARM"</span>, <span class="va">a_cph</span>, extra_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>full_cox_fit <span class="op">=</span> <span class="va">cph</span><span class="op">)</span>, show_labels <span class="op">=</span> <span class="st">"hidden"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co">## Time-to-event analysis</span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span></span>
<span>    <span class="st">"ARM"</span>, <span class="va">a_tte</span>,</span>
<span>    var_labels <span class="op">=</span> <span class="st">"Time to first adverse event"</span>, show_labels <span class="op">=</span> <span class="st">"visible"</span>,</span>
<span>    extra_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>kp_table <span class="op">=</span> <span class="va">surv_tbl</span><span class="op">)</span>,</span>
<span>    table_names <span class="op">=</span> <span class="st">"kapmeier"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">tbl_tte</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">lyt</span>, <span class="va">adtte2</span><span class="op">)</span></span></code></pre></div>
<p>We set the <code>show_colcounts</code> argument of
<code><a href="../reference/basic_table.html">basic_table()</a></code> to <code>TRUE</code> to first print the total
subject counts for each column. Next we use <code><a href="../reference/split_cols_by.html">split_cols_by()</a></code>
to split the table into three columns corresponding to the three
different levels of <code>ARM</code>, and specify that the first arm,
<code>"A: Drug X"</code> should act as the reference group to be
compared against - this reference group is used for the Cox P-H
analysis. Then we call <code><a href="../reference/analyze.html">analyze()</a></code> sequentially using each of
the four custom analysis functions as argument <code>afun</code> and
specifying additional arguments where necessary. Then we use
<code><a href="../reference/build_table.html">build_table()</a></code> to construct our <code>rtable</code> using
the <code>adtte2</code> dataset.</p>
<p>Finally, we annotate the table using the
<code>fnotes_at_path()</code> function to specify that product-limit
estimates are used to calculate the statistics listed under the “Time to
first adverse event” heading within the table. The referential footnote
created earlier in the time-to-event analysis function
(<code>a_tte</code>) is also displayed.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">fnotes_at_path</span><span class="op">(</span></span>
<span>  <span class="va">tbl_tte</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ma_USUBJID_CNSDTDSC_ARM_kapmeier"</span>, <span class="st">"kapmeier"</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"Product-limit (Kaplan-Meier) estimates."</span></span>
<span></span>
<span><span class="va">tbl_tte</span></span>
<span><span class="co">#                                             A: Drug X      B: Placebo     C: Combination</span></span>
<span><span class="co">#                                              (N=134)         (N=134)         (N=132)    </span></span>
<span><span class="co"># ————————————————————————————————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># Subjects with Adverse Events n (%)        134 (100.00%)   134 (100.00%)   132 (100.00%) </span></span>
<span><span class="co"># Censored Subjects                                                                       </span></span>
<span><span class="co">#   Clinical Cut Off                          6 (4.48%)       3 (2.24%)      14 (10.61%)  </span></span>
<span><span class="co">#   Completion or Discontinuation             9 (6.72%)       5 (3.73%)       9 (6.82%)   </span></span>
<span><span class="co">#   End of AE Reporting Period               14 (10.45%)      7 (5.22%)      14 (10.61%)  </span></span>
<span><span class="co">#   Preferred Term                           11 (8.21%)       5 (3.73%)       13 (9.85%)  </span></span>
<span><span class="co"># Hazard ratio                                                   0.7             1.0      </span></span>
<span><span class="co"># 95% confidence interval                                    (0.5, 0.9)       (0.8, 1.4)  </span></span>
<span><span class="co"># p-value (one-sided stratified log rank)                      0.1070           0.4880    </span></span>
<span><span class="co"># Time to first adverse event {1}                                                         </span></span>
<span><span class="co">#   Median                                      0.23            0.39             0.29     </span></span>
<span><span class="co">#   95% confidence interval                  0.18 - 0.33     0.29 - 0.49     0.22 - 0.35  </span></span>
<span><span class="co">#   Min Max {2}                               0.0, 1.0*       0.0, 1.0*       0.0, 1.0*   </span></span>
<span><span class="co"># ————————————————————————————————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># {1} - Product-limit (Kaplan-Meier) estimates.</span></span>
<span><span class="co"># {2} - * indicates censoring</span></span>
<span><span class="co"># ————————————————————————————————————————————————————————————————————————————————————————</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="nest">
  <p>rtables is a part of the <strong>NEST</strong> and <a href="https://pharmaverse.org/" class="external-link"><strong>pharmaverse</strong></a>.</p>
</div>
<script type="text/javascript" src="../analytics.js"></script></footer>
</div>





  </body>
</html>
