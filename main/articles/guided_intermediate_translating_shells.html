<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Intermediate rtables - Translating Shells To Layouts • rtables</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Intermediate rtables - Translating Shells To Layouts">
<link rel="stylesheet" href="../consent.css">
<script src="../consent.js" type="text/javascript" charset="utf-8"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rtables</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6.13.9002</small>

    <div style="width: 140px; margin-left: 0.5rem;"> <small class="nav-text text-muted me-auto">part of</small> <img src="https://github.com/insightsengineering/hex-stickers/blob/main/PNG/nest.png?raw=true" alt="NEST" style="height: 30px;"><a href="https://pharmaverse.org/" class="external-link"><img src="https://github.com/insightsengineering/hex-stickers/blob/main/PNG/pharmaverse.png?raw=true" alt="pharmaverse" style="height: 28px;"></a> </div>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/rtables.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Getting Started</h6></li>
    <li><a class="dropdown-item" href="../articles/exploratory_analysis.html">Exploratory Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/guided_intermediate_translating_shells.html">Intermediate rtables - Translating Shells To Layouts</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Clinical Trials</h6></li>
    <li><a class="dropdown-item" href="../articles/clinical_trials.html">Example Clinical Trials Tables</a></li>
    <li><a class="dropdown-item" href="../articles/baseline.html">Comparing Against Baselines or Control</a></li>
    <li><a class="dropdown-item" href="../articles/ard_how_to.html">Generating QC-Ready Result Data Frames (ARDs) from Tables</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Table Customization</h6></li>
    <li><a class="dropdown-item" href="../articles/custom_appearance.html">Customizing Appearance</a></li>
    <li><a class="dropdown-item" href="../articles/title_footer.html">Titles, Footers, and Referential Footnotes</a></li>
    <li><a class="dropdown-item" href="../articles/sorting_pruning.html">Pruning and Sorting Tables</a></li>
    <li><a class="dropdown-item" href="../articles/col_counts.html">Column Counts and Formats</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-developer-guide" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Developer Guide</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-developer-guide">
<li><a class="dropdown-item" href="../articles/dev-guide/dg_split_machinery.html">Split Machinery</a></li>
    <li><a class="dropdown-item" href="../articles/dev-guide/dg_tabulation.html">Tabulation</a></li>
    <li><a class="dropdown-item" href="../articles/dev-guide/dg_table_hierarchy.html">Table Hierarchy</a></li>
    <li><a class="dropdown-item" href="../articles/dev-guide/dg_debug_rtables.html">Debugging in {rtables} and Beyond</a></li>
    <li><a class="dropdown-item" href="../articles/dev-guide/dg_notes.html">Sparse Notes on {rtables} Internals</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-reports" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Reports</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-reports">
<li><a class="dropdown-item" href="../coverage-report/">Coverage report</a></li>
    <li><a class="dropdown-item" href="../unit-test-report/">Unit test report</a></li>
    <li><a class="dropdown-item" href="../unit-test-report-non-cran/">Non-CRAN unit test report</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/insightsengineering/rtables"><span class="fa fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Intermediate rtables - Translating Shells To Layouts</h1>
            <h3 data-toc-skip class="subtitle">Contributed by Johnson
&amp; Johnson Innovative Medicine</h3>
                        <h4 data-toc-skip class="author">Gabriel
Becker</h4>
                        <h4 data-toc-skip class="author">Dan
Hofstaedter</h4>
            
            <h4 data-toc-skip class="date">2025-06-17</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/insightsengineering/rtables/blob/main/vignettes/guided_intermediate_translating_shells.Rmd" class="external-link"><code>vignettes/guided_intermediate_translating_shells.Rmd</code></a></small>
      <div class="d-none name"><code>guided_intermediate_translating_shells.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The first - and often largest - hurdle to creating a table via
<code>rtables</code> is translating the desired table structure
(typically in the form of a <em>table shell</em>) into an
<code>rtables</code> <em>layout</em>. We will cover that translation
process in this vignette.</p>
<div class="section level3">
<h3 id="a-table-shell">A Table Shell<a class="anchor" aria-label="anchor" href="#a-table-shell"></a>
</h3>
<p>Table shells can come in various forms. We will begin with a table
shell which is essentially the entire table with desired formatting
indicated instead of values:</p>
<pre><code><span><span class="co">## Loading required package: formatters</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'formatters'</span></span></code></pre>
<pre><code><span><span class="co">## The following object is masked from 'package:base':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     %||%</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: magrittr</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'rtables'</span></span></code></pre>
<pre><code><span><span class="co">## The following object is masked from 'package:utils':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     str</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'dplyr'</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:stats':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     filter, lag</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:base':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     intersect, setdiff, setequal, union</span></span></code></pre>
<pre><code>Subject Response by Race and Sex; Treated Subjects

————————————————————————————————————————————————————————————————
                          A                         B           
RACE           A: Drug X    B: Placebo   A: Drug X    B: Placebo
  SEX            (N=xx)       (N=xx)       (N=xx)       (N=xx)  
————————————————————————————————————————————————————————————————
All Patients       -            -            -            -     
  Yes          xx (xx.x%)   xx (xx.x%)   xx (xx.x%)   xx (xx.x%)
  No           xx (xx.x%)   xx (xx.x%)   xx (xx.x%)   xx (xx.x%)
Asian              -            -            -            -     
  Male             xx           xx           xx           xx    
    Yes        xx (xx.x%)   xx (xx.x%)   xx (xx.x%)   xx (xx.x%)
    No         xx (xx.x%)   xx (xx.x%)   xx (xx.x%)   xx (xx.x%)
  Female           xx           xx           xx           xx    
    Yes        xx (xx.x%)   xx (xx.x%)   xx (xx.x%)   xx (xx.x%)
    No         xx (xx.x%)   xx (xx.x%)   xx (xx.x%)   xx (xx.x%)
Black              -            -            -            -     
  Male             xx           xx           xx           xx    
    Yes        xx (xx.x%)   xx (xx.x%)   xx (xx.x%)   xx (xx.x%)
    No         xx (xx.x%)   xx (xx.x%)   xx (xx.x%)   xx (xx.x%)
  Female           xx           xx           xx           xx    
    Yes        xx (xx.x%)   xx (xx.x%)   xx (xx.x%)   xx (xx.x%)
    No         xx (xx.x%)   xx (xx.x%)   xx (xx.x%)   xx (xx.x%)
White              -            -            -            -     
  Male             xx           xx           xx           xx    
    Yes        xx (xx.x%)   xx (xx.x%)   xx (xx.x%)   xx (xx.x%)
    No         xx (xx.x%)   xx (xx.x%)   xx (xx.x%)   xx (xx.x%)
  Female           xx           xx           xx           xx    
    Yes        xx (xx.x%)   xx (xx.x%)   xx (xx.x%)   xx (xx.x%)
    No         xx (xx.x%)   xx (xx.x%)   xx (xx.x%)   xx (xx.x%)</code></pre>
<p>We will use this shell to illustrate the translation process to an
rtables layout, and thus ultimately a table output.</p>
</div>
<div class="section level3">
<h3 id="a-brief-review-of-rtables-layouts">A <em>Brief</em> Review Of <code>rtables</code> Layouts<a class="anchor" aria-label="anchor" href="#a-brief-review-of-rtables-layouts"></a>
</h3>
<p>For an in-depth discussion of how constructing a layout works we
refer the reader to other documentation. That said, there are a couple
things to remember as we consider translating shells into layouts:</p>
<ol style="list-style-type: decimal">
<li>Individual rows are declared by <code>analyze*</code> calls</li>
<li>Individual columns are the result of column faceting</li>
<li>New faceting will be nested within existing faceting in the same
dimension (row/col) by default</li>
<li>All row faceting structures must be terminated with at least one
analysis (<code>analyze</code>)</li>
<li>Row faceting which occurs directly after an <code>analyze</code>
will <em>not</em> be nested</li>
</ol>
<p>With those in mind, we will now discuss how to translate shells into
layouts.</p>
</div>
</div>
<div class="section level2">
<h2 id="translating">Translating<a class="anchor" aria-label="anchor" href="#translating"></a>
</h2>
<p>There are three aspects to a shell that we must translate:</p>
<ol style="list-style-type: decimal">
<li>Column faceting structure</li>
<li>Row faceting structure</li>
<li>Cell contents
<ul>
<li>Marginal content for row facet structure</li>
<li>Individual facet content</li>
</ul>
</li>
</ol>
<p>We will explore each portion of the translation process
separately.</p>
<div class="section level3">
<h3 id="translating-column-structure">Translating Column Structure<a class="anchor" aria-label="anchor" href="#translating-column-structure"></a>
</h3>
<p>Our first task, translating column structure, revolves around
identifying faceting in the column dimension of a shell or desired
table.</p>
<p>Our shell gives us the following to indicate column structure:</p>
<pre><code>             A                        B           
   A: Drug X   B: Placebo   A: Drug X   B: Placebo
    (N=xx)       (N=xx)      (N=xx)       (N=xx)  
——————————————————————————————————————————————————</code></pre>
<p>The easiest way to identify faceting is to look at column- or
row-labels and determine the scope (i.e., the set of individual columns
or rows) they apply to.</p>
<p>For example, we see that the <code>"A"</code> column label applies to
a group of multiple columns each of which represent an individual
arm:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">fixed_shell</span><span class="op">(</span><span class="va">result</span><span class="op">[</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"*"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code>             A           
   A: Drug X   B: Placebo
    (N=xx)       (N=xx)  
—————————————————————————</code></pre>
<p>Thus we have strata faceting with arm faceting nested within it.</p>
<p>Faceting most commonly represents partitioning the data being
tabulated by the values of a categorical variable, though
<code>rtables</code> supports a generalized concept of faceting where
the data group can overlap and need not be exhaustive.</p>
<p>For our table, the faceting is nested faceting by the
<code>"STRATA1"</code>, and <code>"ARM"</code> variables. We achieve
this by repeated calls to <code>split_cols_by</code> (with the default
<code>nested = TRUE</code>), with the call declaring the outermost
faceting first:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lyt_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_table.html">basic_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"STRATA1"</span>, split_fun <span class="op">=</span> <span class="fu"><a href="../reference/split_funcs.html">keep_split_levels</a></span><span class="op">(</span>only <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"ARM"</span>, split_fun <span class="op">=</span> <span class="fu"><a href="../reference/split_funcs.html">keep_split_levels</a></span><span class="op">(</span>only <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A: Drug X"</span>, <span class="st">"B: Placebo"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">lyt_cols</span>, <span class="va">adsl</span><span class="op">)</span></span></code></pre></div>
<pre><code>             A                        B           
   A: Drug X   B: Placebo   A: Drug X   B: Placebo
——————————————————————————————————————————————————</code></pre>
<p>This is almost correct. To fully achieve our shell we need the column
counts to show up, which we do via the <code>show_colcounts</code>
argument in the relevant <code>split_cols_by</code> call:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lyt_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_table.html">basic_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"STRATA1"</span>, split_fun <span class="op">=</span> <span class="fu"><a href="../reference/split_funcs.html">keep_split_levels</a></span><span class="op">(</span>only <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"ARM"</span>,</span>
<span>    split_fun <span class="op">=</span> <span class="fu"><a href="../reference/split_funcs.html">keep_split_levels</a></span><span class="op">(</span>only <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A: Drug X"</span>, <span class="st">"B: Placebo"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    show_colcounts <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">lyt_cols</span>, <span class="va">adsl</span><span class="op">)</span></span></code></pre></div>
<pre><code>             A                        B           
   A: Drug X   B: Placebo   A: Drug X   B: Placebo
    (N=36)       (N=41)      (N=40)       (N=41)  
——————————————————————————————————————————————————</code></pre>
<p>This is a relatively straightforward column structure. We will cover
more complex ones later. Nevertheless we have translated our shell’s
column space into <code>rtables</code> layouting instructions.</p>
</div>
<div class="section level3">
<h3 id="translating-row-structure">Translating Row Structure<a class="anchor" aria-label="anchor" href="#translating-row-structure"></a>
</h3>
<p>Moving to the second aspect of translation, we will now translate the
row structure of our shell. Interpreting row structure is similar to
interpreting column structure with the caveat that individual rows do
not come from faceting, but rather from analysis (which is in charge of
populating the contents of the table’s primary, non-marginal cells).</p>
<p>Our row structure is slightly less trivial than our column structure.
We can see two sections in our shell, one that displays the response
(<code>"BMEASIFL"</code>) of all patients collectively (by the column
structure):</p>
<pre><code>                          A                         B           
RACE           A: Drug X    B: Placebo   A: Drug X    B: Placebo
  SEX            (N=xx)       (N=xx)       (N=xx)       (N=xx)  
————————————————————————————————————————————————————————————————
All Patients       -            -            -            -     
  Yes          xx (xx.x%)   xx (xx.x%)   xx (xx.x%)   xx (xx.x%)
  No           xx (xx.x%)   xx (xx.x%)   xx (xx.x%)   xx (xx.x%)</code></pre>
<p>and one that subsets the patients before displaying the response
within each subset, and with some marginal rows for context.</p>
<pre><code>                      A                         B           
RACE       A: Drug X    B: Placebo   A: Drug X    B: Placebo
  SEX        (N=xx)       (N=xx)       (N=xx)       (N=xx)  
————————————————————————————————————————————————————————————
Asian          -            -            -            -     
  Male         xx           xx           xx           xx    
    Yes    xx (xx.x%)   xx (xx.x%)   xx (xx.x%)   xx (xx.x%)
    No     xx (xx.x%)   xx (xx.x%)   xx (xx.x%)   xx (xx.x%)
  Female       xx           xx           xx           xx    
    Yes    xx (xx.x%)   xx (xx.x%)   xx (xx.x%)   xx (xx.x%)
    No     xx (xx.x%)   xx (xx.x%)   xx (xx.x%)   xx (xx.x%)
Black          -            -            -            -     
  Male         xx           xx           xx           xx    
    Yes    xx (xx.x%)   xx (xx.x%)   xx (xx.x%)   xx (xx.x%)
    No     xx (xx.x%)   xx (xx.x%)   xx (xx.x%)   xx (xx.x%)
  Female       xx           xx           xx           xx    
    Yes    xx (xx.x%)   xx (xx.x%)   xx (xx.x%)   xx (xx.x%)
    No     xx (xx.x%)   xx (xx.x%)   xx (xx.x%)   xx (xx.x%)
White          -            -            -            -     
  Male         xx           xx           xx           xx    
    Yes    xx (xx.x%)   xx (xx.x%)   xx (xx.x%)   xx (xx.x%)
    No     xx (xx.x%)   xx (xx.x%)   xx (xx.x%)   xx (xx.x%)
  Female       xx           xx           xx           xx    
    Yes    xx (xx.x%)   xx (xx.x%)   xx (xx.x%)   xx (xx.x%)
    No     xx (xx.x%)   xx (xx.x%)   xx (xx.x%)   xx (xx.x%)</code></pre>
<p>Because none of the labels or cell-values from the all patients
portion of the table apply directly to the subset analysis portion - and
vice versa - we can treat these separately.</p>
<p>In point of fact, the first portion does not require any structure
beyond an analysis of the `“BMEASIFL” variable with a label, so we can
leave that for the third translation step.</p>
<p>We can illustrate this using a dummy analyze as follows:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dummy_afun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="fu"><a href="../reference/in_rows.html">in_rows</a></span><span class="op">(</span><span class="st">"Analysis"</span> <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span></span>
<span><span class="va">lyt_a</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_table.html">basic_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"BMEASIFL"</span>,</span>
<span>    afun <span class="op">=</span> <span class="va">dummy_afun</span>,</span>
<span>    var_labels <span class="op">=</span> <span class="st">"All Patients"</span>,</span>
<span>    show_labels <span class="op">=</span> <span class="st">"visible"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">lyt_a</span>, <span class="va">adsl</span><span class="op">)</span></span></code></pre></div>
<pre><code>               all obs
——————————————————————
All Patients          
  Analysis        -   </code></pre>
<p>While we do not have the individual rows we desired, as that is left
to step 3 of translation, we can see that we have successfully created
the first portion of the row <em>structure</em>.</p>
<p>Note that in most tables the column and row structure are orthogonal
and so we do not need to worry about columns when we are translating the
row structure.</p>
<p>Also note we <em>could</em> say that there is a facet there which
contains all the patients and has the name/label
<code>"All Patients"</code>; this would result in an equivalent table
from an output perspective but there isn’t really any benefit to the
added layouting instructions that would be required, so we will not do
so here.</p>
<p>The second portion of the table contains labels and rows which
<em>do</em> apply to multiple individual rows.</p>
<p>We see that the <code>"Asian"</code> label, for example, applies
across the corresponding <code>"Male"</code> and <code>"Female"</code>
labels/marginal rows, each of which in turn applies to a group of
individual rows (<code>"Yes"</code>, and <code>"No"</code>).</p>
<p>Thus we can recreate this section via nested faceting, this time
with</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lyt_b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_table.html">basic_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/split_rows_by.html">split_rows_by</a></span><span class="op">(</span><span class="st">"RACE"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/split_rows_by.html">split_rows_by</a></span><span class="op">(</span><span class="st">"SEX"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"BMEASIFL"</span>, afun <span class="op">=</span> <span class="va">dummy_afun</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/head_tail.html">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">lyt_b</span>, <span class="va">adsl</span><span class="op">)</span>, <span class="fl">30</span><span class="op">)</span></span></code></pre></div>
<pre><code>                     all obs
————————————————————————————
Asian                       
  Male                      
    Analysis            -   
  Female                    
    Analysis            -   
  Undifferentiated          
    Analysis            -   
  Unknown                   
    Analysis            -   
Black                       
  Male                      
    Analysis            -   
  Female                    
    Analysis            -   
  Undifferentiated          
    Analysis            -   
  Unknown                   
    Analysis            -   
White                       
  Male                      
    Analysis            -   
  Female                    
    Analysis            -   
  Undifferentiated          
    Analysis            -   
  Unknown                   
    Analysis            -   </code></pre>
<p>We are almost there, but we see extra <code>"SEX"</code> values that
weren’t in our shell. We can prevent this with the
<code>keep_split_levels</code> function provided by
<code>rtables</code>:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lyt_b2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_table.html">basic_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/split_rows_by.html">split_rows_by</a></span><span class="op">(</span><span class="st">"RACE"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/split_rows_by.html">split_rows_by</a></span><span class="op">(</span><span class="st">"SEX"</span>, split_fun <span class="op">=</span> <span class="fu"><a href="../reference/split_funcs.html">keep_split_levels</a></span><span class="op">(</span>only <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Male"</span>, <span class="st">"Female"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"BMEASIFL"</span>, afun <span class="op">=</span> <span class="va">dummy_afun</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">lyt_b2</span>, <span class="va">adsl</span><span class="op">)</span></span></code></pre></div>
<pre><code>               all obs
——————————————————————
Asian                 
  Male                
    Analysis      -   
  Female              
    Analysis      -   
Black                 
  Male                
    Analysis      -   
  Female              
    Analysis      -   
White                 
  Male                
    Analysis      -   
  Female              
    Analysis      -   </code></pre>
<p>Finally, we can combine the two sections by simply combining the
relevant layout instructions:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lyt_b3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_table.html">basic_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"BMEASIFL"</span>,</span>
<span>    afun <span class="op">=</span> <span class="va">dummy_afun</span>,</span>
<span>    var_labels <span class="op">=</span> <span class="st">"All Patients"</span>,</span>
<span>    show_labels <span class="op">=</span> <span class="st">"visible"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/split_rows_by.html">split_rows_by</a></span><span class="op">(</span><span class="st">"RACE"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/split_rows_by.html">split_rows_by</a></span><span class="op">(</span><span class="st">"SEX"</span>, split_fun <span class="op">=</span> <span class="fu"><a href="../reference/split_funcs.html">keep_split_levels</a></span><span class="op">(</span>only <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Male"</span>, <span class="st">"Female"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"BMEASIFL"</span>, afun <span class="op">=</span> <span class="va">dummy_afun</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">lyt_b3</span>, <span class="va">adsl</span><span class="op">)</span></span></code></pre></div>
<pre><code>               all obs
——————————————————————
All Patients          
  Analysis        -   
Asian                 
  Male                
    Analysis      -   
  Female              
    Analysis      -   
Black                 
  Male                
    Analysis      -   
  Female              
    Analysis      -   
White                 
  Male                
    Analysis      -   
  Female              
    Analysis      -   </code></pre>
<p>Note here that row split instructions which directly follow an
<code>analyze</code> call will automatically be non-nested, so we do not
need to specify <code>nested = FALSE</code> in the <code>"RACE"</code>
split, though doing so would not harm anything.</p>
<p>We can convince ourselves that treating the column and row structure
separately by combining the layouting instructions for both to receive
something equivalent in structure (i.e., up individual rows and marginal
cell contents) to our shell:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lyt_struct</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_table.html">basic_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"STRATA1"</span>, split_fun <span class="op">=</span> <span class="fu"><a href="../reference/split_funcs.html">keep_split_levels</a></span><span class="op">(</span>only <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"ARM"</span>,</span>
<span>    split_fun <span class="op">=</span> <span class="fu"><a href="../reference/split_funcs.html">keep_split_levels</a></span><span class="op">(</span>only <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A: Drug X"</span>, <span class="st">"B: Placebo"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    show_colcounts <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"BMEASIFL"</span>,</span>
<span>    afun <span class="op">=</span> <span class="va">dummy_afun</span>,</span>
<span>    var_labels <span class="op">=</span> <span class="st">"All Patients"</span>,</span>
<span>    show_labels <span class="op">=</span> <span class="st">"visible"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/split_rows_by.html">split_rows_by</a></span><span class="op">(</span><span class="st">"RACE"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/split_rows_by.html">split_rows_by</a></span><span class="op">(</span><span class="st">"SEX"</span>, split_fun <span class="op">=</span> <span class="fu"><a href="../reference/split_funcs.html">keep_split_levels</a></span><span class="op">(</span>only <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Male"</span>, <span class="st">"Female"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"BMEASIFL"</span>, afun <span class="op">=</span> <span class="va">dummy_afun</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">lyt_struct</span>, <span class="va">adsl</span><span class="op">)</span></span></code></pre></div>
<pre><code>                         A                        B           
               A: Drug X   B: Placebo   A: Drug X   B: Placebo
                (N=36)       (N=41)      (N=40)       (N=41)  
——————————————————————————————————————————————————————————————
All Patients                                                  
  Analysis         -           -            -           -     
Asian                                                         
  Male                                                        
    Analysis       -           -            -           -     
  Female                                                      
    Analysis       -           -            -           -     
Black                                                         
  Male                                                        
    Analysis       -           -            -           -     
  Female                                                      
    Analysis       -           -            -           -     
White                                                         
  Male                                                        
    Analysis       -           -            -           -     
  Female                                                      
    Analysis       -           -            -           -     </code></pre>
<p>We can see that the marginal cells for <code>"Male"</code> and
<code>"Female"</code> within each race are not present, but we will
handle those in the third translation step.</p>
</div>
<div class="section level3">
<h3 id="translating-cell-contents">Translating Cell Contents<a class="anchor" aria-label="anchor" href="#translating-cell-contents"></a>
</h3>
<p>Finally, we will finish our translation with the third step:
translating cell contents.</p>
<p>Tables can contain up to two types of rows with non-empty cells as
reckoned by the <code>rtables</code> conceptual model: individual
analysis rows, and marginal group summary rows (called <em>content</em>
rows by the <code>rtables</code> internals).</p>
<p>Analysis rows are declared via <code>analyze</code> during layout
construction; an analysis function (the <code>afun</code> argument)
specifying how <em>all cells within a single facet pane should be
simultaneously created</em>.</p>
<p>We see in our shell that we want two rows whenever we analyze
<code>BMEASIFL</code> response: one for <code>"Yes"</code> and one for
<code>"No"</code>.</p>
<p>Most analysis functions provided by <code>rtables</code> or
extensions like <code>tern</code> or <code>junco</code> will
automatically generate multiple rows when analyzing a categorical
variable (i.e., factor):</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rw_lyt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_table.html">basic_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"BMEASIFL"</span>,</span>
<span>    var_labels <span class="op">=</span> <span class="st">"All Patients"</span>,</span>
<span>    show_labels <span class="op">=</span> <span class="st">"visible"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">rw_lyt</span>, <span class="va">adsl</span><span class="op">)</span></span></code></pre></div>
<pre><code>               all obs
——————————————————————
All Patients          
  Yes            182  
  No             179  </code></pre>
<p>Further, recall that the faceting does the work of identifying
subsets and applying our analyses within those facets/subsets
automatically. Thus by applying the <em>structural</em> layout
instructions we translated above, we get something that is getting
pretty close to our desired table:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rw_lyt_struct</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_table.html">basic_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"STRATA1"</span>, split_fun <span class="op">=</span> <span class="fu"><a href="../reference/split_funcs.html">keep_split_levels</a></span><span class="op">(</span>only <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"ARM"</span>,</span>
<span>    split_fun <span class="op">=</span> <span class="fu"><a href="../reference/split_funcs.html">keep_split_levels</a></span><span class="op">(</span>only <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A: Drug X"</span>, <span class="st">"B: Placebo"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    show_colcounts <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"BMEASIFL"</span>,</span>
<span>    var_labels <span class="op">=</span> <span class="st">"All Patients"</span>,</span>
<span>    show_labels <span class="op">=</span> <span class="st">"visible"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/split_rows_by.html">split_rows_by</a></span><span class="op">(</span><span class="st">"RACE"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/split_rows_by.html">split_rows_by</a></span><span class="op">(</span><span class="st">"SEX"</span>, split_fun <span class="op">=</span> <span class="fu"><a href="../reference/split_funcs.html">keep_split_levels</a></span><span class="op">(</span>only <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Male"</span>, <span class="st">"Female"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"BMEASIFL"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">rw_lyt_struct</span>, <span class="va">adsl</span><span class="op">)</span></span></code></pre></div>
<pre><code>                         A                        B           
               A: Drug X   B: Placebo   A: Drug X   B: Placebo
                (N=36)       (N=41)      (N=40)       (N=41)  
——————————————————————————————————————————————————————————————
All Patients                                                  
  Yes             13           27          20           19    
  No              23           14          20           22    
Asian                                                         
  Male                                                        
    Yes            2           6            1           3     
    No             8           4            8           4     
  Female                                                      
    Yes            5           11           9           8     
    No             6           3            2           7     
Black                                                         
  Male                                                        
    Yes            0           4            3           3     
    No             2           2            2           1     
  Female                                                      
    Yes            2           4            3           2     
    No             3           1            3           1     
White                                                         
  Male                                                        
    Yes            2           1            2           0     
    No             1           2            2           4     
  Female                                                      
    Yes            2           1            2           3     
    No             3           2            3           5     </code></pre>
<p>Two aspects remain before we have matched our desired shell: our
marginal counts in the the individual gender rows within each race are
missing, and our analysis rows contain only counts rather than matching
the desired <code>"xx (xx.x%)"</code> format of count and percent.</p>
<p><code>rtables</code> provides a (<em>very</em>) simple afun to
calculate count percent values (<code>counts_wpcts</code>) which we can
use for illustration purposes here. We will see later that it is not
flexible enough to meet a study team’s full set of needs and more
complex afuns will be used in practice in production.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rw_lyt_structb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_table.html">basic_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"STRATA1"</span>, split_fun <span class="op">=</span> <span class="fu"><a href="../reference/split_funcs.html">keep_split_levels</a></span><span class="op">(</span>only <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"ARM"</span>,</span>
<span>    split_fun <span class="op">=</span> <span class="fu"><a href="../reference/split_funcs.html">keep_split_levels</a></span><span class="op">(</span>only <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A: Drug X"</span>, <span class="st">"B: Placebo"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    show_colcounts <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"BMEASIFL"</span>,</span>
<span>    afun <span class="op">=</span> <span class="va">counts_wpcts</span>,</span>
<span>    var_labels <span class="op">=</span> <span class="st">"All Patients"</span>,</span>
<span>    show_labels <span class="op">=</span> <span class="st">"visible"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/split_rows_by.html">split_rows_by</a></span><span class="op">(</span><span class="st">"RACE"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/split_rows_by.html">split_rows_by</a></span><span class="op">(</span><span class="st">"SEX"</span>, split_fun <span class="op">=</span> <span class="fu"><a href="../reference/split_funcs.html">keep_split_levels</a></span><span class="op">(</span>only <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Male"</span>, <span class="st">"Female"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"BMEASIFL"</span>, afun <span class="op">=</span> <span class="va">counts_wpcts</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">rw_lyt_structb</span>, <span class="va">adsl</span><span class="op">)</span></span></code></pre></div>
<pre><code>                          A                         B           
               A: Drug X    B: Placebo   A: Drug X    B: Placebo
                 (N=36)       (N=41)       (N=40)       (N=41)  
————————————————————————————————————————————————————————————————
All Patients                                                    
  Yes          13 (36.1%)   27 (65.9%)   20 (50.0%)   19 (46.3%)
  No           23 (63.9%)   14 (34.1%)   20 (50.0%)   22 (53.7%)
Asian                                                           
  Male                                                          
    Yes         2 (5.6%)    6 (14.6%)     1 (2.5%)     3 (7.3%) 
    No         8 (22.2%)     4 (9.8%)    8 (20.0%)     4 (9.8%) 
  Female                                                        
    Yes        5 (13.9%)    11 (26.8%)   9 (22.5%)    8 (19.5%) 
    No         6 (16.7%)     3 (7.3%)     2 (5.0%)    7 (17.1%) 
Black                                                           
  Male                                                          
    Yes         0 (0.0%)     4 (9.8%)     3 (7.5%)     3 (7.3%) 
    No          2 (5.6%)     2 (4.9%)     2 (5.0%)     1 (2.4%) 
  Female                                                        
    Yes         2 (5.6%)     4 (9.8%)     3 (7.5%)     2 (4.9%) 
    No          3 (8.3%)     1 (2.4%)     3 (7.5%)     1 (2.4%) 
White                                                           
  Male                                                          
    Yes         2 (5.6%)     1 (2.4%)     2 (5.0%)     0 (0.0%) 
    No          1 (2.8%)     2 (4.9%)     2 (5.0%)     4 (9.8%) 
  Female                                                        
    Yes         2 (5.6%)     1 (2.4%)     2 (5.0%)     3 (7.3%) 
    No          3 (8.3%)     2 (4.9%)     3 (7.5%)    5 (12.2%) </code></pre>
<p>Now, all we need is the marginal gender counts. We do this by adding
<code>summarize_row_groups</code> <em>directly after</em> the relevant
row faceting (<code>split_rows_by</code>) instruction in the layout.
This function can accept a fully custom function (the <code>cfun</code>
argument), but for our purposes, we can control whether the percent is
included in the default group summary with the <code>format</code>
argument.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lyt_final</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_table.html">basic_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"STRATA1"</span>, split_fun <span class="op">=</span> <span class="fu"><a href="../reference/split_funcs.html">keep_split_levels</a></span><span class="op">(</span>only <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"ARM"</span>,</span>
<span>    split_fun <span class="op">=</span> <span class="fu"><a href="../reference/split_funcs.html">keep_split_levels</a></span><span class="op">(</span>only <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A: Drug X"</span>, <span class="st">"B: Placebo"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    show_colcounts <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"BMEASIFL"</span>,</span>
<span>    afun <span class="op">=</span> <span class="va">counts_wpcts</span>,</span>
<span>    var_labels <span class="op">=</span> <span class="st">"All Patients"</span>,</span>
<span>    show_labels <span class="op">=</span> <span class="st">"visible"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/split_rows_by.html">split_rows_by</a></span><span class="op">(</span><span class="st">"RACE"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/split_rows_by.html">split_rows_by</a></span><span class="op">(</span><span class="st">"SEX"</span>, split_fun <span class="op">=</span> <span class="fu"><a href="../reference/split_funcs.html">keep_split_levels</a></span><span class="op">(</span>only <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Male"</span>, <span class="st">"Female"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/summarize_row_groups.html">summarize_row_groups</a></span><span class="op">(</span>format <span class="op">=</span> <span class="st">"xx"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"BMEASIFL"</span>, afun <span class="op">=</span> <span class="va">counts_wpcts</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">lyt_final</span>, <span class="va">adsl</span><span class="op">)</span></span></code></pre></div>
<pre><code>                          A                         B           
               A: Drug X    B: Placebo   A: Drug X    B: Placebo
                 (N=36)       (N=41)       (N=40)       (N=41)  
————————————————————————————————————————————————————————————————
All Patients                                                    
  Yes          13 (36.1%)   27 (65.9%)   20 (50.0%)   19 (46.3%)
  No           23 (63.9%)   14 (34.1%)   20 (50.0%)   22 (53.7%)
Asian                                                           
  Male             10           10           9            7     
    Yes         2 (5.6%)    6 (14.6%)     1 (2.5%)     3 (7.3%) 
    No         8 (22.2%)     4 (9.8%)    8 (20.0%)     4 (9.8%) 
  Female           11           14           11           15    
    Yes        5 (13.9%)    11 (26.8%)   9 (22.5%)    8 (19.5%) 
    No         6 (16.7%)     3 (7.3%)     2 (5.0%)    7 (17.1%) 
Black                                                           
  Male             2            6            5            4     
    Yes         0 (0.0%)     4 (9.8%)     3 (7.5%)     3 (7.3%) 
    No          2 (5.6%)     2 (4.9%)     2 (5.0%)     1 (2.4%) 
  Female           5            5            6            3     
    Yes         2 (5.6%)     4 (9.8%)     3 (7.5%)     2 (4.9%) 
    No          3 (8.3%)     1 (2.4%)     3 (7.5%)     1 (2.4%) 
White                                                           
  Male             3            3            4            4     
    Yes         2 (5.6%)     1 (2.4%)     2 (5.0%)     0 (0.0%) 
    No          1 (2.8%)     2 (4.9%)     2 (5.0%)     4 (9.8%) 
  Female           5            3            5            8     
    Yes         2 (5.6%)     1 (2.4%)     2 (5.0%)     3 (7.3%) 
    No          3 (8.3%)     2 (4.9%)     3 (7.5%)    5 (12.2%) </code></pre>
<p>Thus, we have fully translated our shell into an <code>rtables</code>
declarative layout and realized our desired table output.</p>
<p>In the remainder of this vignette we will walk through a number of
shells with more complex structural elements and how to translate them
into <code>rtables</code> layouts.</p>
</div>
</div>
<div class="section level2">
<h2 id="spanning-column-headers">Spanning Column Headers<a class="anchor" aria-label="anchor" href="#spanning-column-headers"></a>
</h2>
<p>Some shells will call for spanning labels in column space which do
not directly reflect a categorical variable in the raw data, but rather
represent groups of levels in a variable, e.g., trial arms.</p>
<p>For example, we might have the following column structure in a
shell:</p>
<pre><code>        Active Treatment                  
   A: Drug X   C: Combination   B: Placebo
    (N=xx)        (N=xx)         (N=xx)   
——————————————————————————————————————————</code></pre>
<p>Here we see the “Active Treatment” label spanning arms A and C, while
no label appears above the column for arm B. There are a couple things
to decode here that will collapse this column structure into a nested
faceting structure as we saw above.</p>
<p>Most importantly, while uneven splitting <em>is</em> possible with
<code>rtables</code>, including in column space, we can get our desired
output by allowing the B arm to have an invisible spanning label which
is simply a single space (<code>" "</code>). Viewing the structure this
way, we can see that we have two levels of faceting, one which splits
between so called active treatments and the remaining arms, and within
that, we facet on individual arm.</p>
<p>This brings us to our second issue: we don’t have a variable for
active vs non-active treatments. There are a few ways to address this,
but the most user-friendly way is simply to create one as a
preprocessing step on the data before we make our table:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adsl_forspans</span> <span class="op">&lt;-</span> <span class="va">adsl</span></span>
<span><span class="va">adsl_forspans</span><span class="op">$</span><span class="va">span_label</span> <span class="op">&lt;-</span> <span class="st">"Active Treatment"</span></span>
<span><span class="va">adsl_forspans</span><span class="op">$</span><span class="va">span_label</span><span class="op">[</span><span class="va">adsl_forspans</span><span class="op">$</span><span class="va">ARM</span> <span class="op">==</span> <span class="st">"B: Placebo"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">" "</span></span>
<span></span>
<span><span class="fu"><a href="../reference/qtable_layout.html">qtable</a></span><span class="op">(</span><span class="va">adsl_forspans</span>, <span class="st">"ARM"</span>, <span class="st">"span_label"</span><span class="op">)</span></span></code></pre></div>
<pre><code>                 Active Treatment          
count                (N=242)        (N=119)
———————————————————————————————————————————
A: Drug X              122             0   
B: Placebo              0             119  
C: Combination         120             0   </code></pre>
<p>With that we can build a table with the desired nested splitting:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lyt_cspan</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_table.html">basic_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"span_label"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"ARM"</span>, show_colcounts <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">lyt_cspan</span>, <span class="va">adsl_forspans</span><span class="op">)</span></span></code></pre></div>
<pre><code>              Active Treatment                                                      
   A: Drug X   B: Placebo   C: Combination   A: Drug X   B: Placebo   C: Combination
    (N=122)      (N=0)         (N=120)         (N=0)      (N=119)         (N=0)     
————————————————————————————————————————————————————————————————————————————————————</code></pre>
<p>So we are getting close, but our individual arm columns are not only
showing up under their correct spanning label (though we see that the
<em>data</em> are being siphoned under the correct labels by the column
counts).</p>
<p>This type of non-full-factorial nesting is common; we often only want
facets that <em>make logical sense</em> within a nested faceting
structure, while wanting to omit any that don’t (e.g., in our table, the
Active Treatment - Placebo facet).</p>
<p><code>rtables</code> provides multiple ways to declare this behavior
in the form of both full <em>split functions</em> and <em>split function
behavior building blocks</em>, the latter being for use within
<code>make_split_fun</code>. For now, we will use a built-in full split
function as we will be covering <code>make_split_fun</code> in a
different vignette.</p>
<p>Our two options for split functions are
<code>trim_levels_in_group</code> and <code>trim_levels_to_map</code>;
the former is empirical and will keep all combinations which are
<em>observed in the data</em>, omitting any that aren’t. The latter
requires us to provide a map of all combinations to be displayed, but is
more robust to sparse data (e.g., a data snapshot from an in-flight
trial) and allows for displaying zero counts for unobserved but desired
combinations.</p>
<p>Other than being empirical and declarative, respectively,
<code>trim_levels_in_group</code> and <code>trim_levels_to_map</code>
behave similarly: when used while splitting on a variable (the “outer
variable”), the observations and factor levels of of another (“inner”)
variable are restricted independently within each facet for the outer
variable.</p>
<p>In our case, our outer variable is <code>"span_label"</code>, while
our inner variable would be <code>"ARM"</code>. Thus we want to restrict
the levels of <code>"ARM"</code> within each facet of
<code>"span_label"</code>. For our toy example here, the two split
functions will be equivalent, but we will use
<code>trim_levels_to_map</code> as it is more robust and appropriate for
more cases of production use.</p>
<p>Thus we need to create our map, a <code>data.frame</code> that
contains the two variables with each desired combination as a separate
row:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">span_label_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">span_label</span>, <span class="op">~</span><span class="va">ARM</span>,</span>
<span>  <span class="st">"Active Treatment"</span>, <span class="st">"A: Drug X"</span>,</span>
<span>  <span class="st">"Active Treatment"</span>, <span class="st">"C: Combination"</span>,</span>
<span>  <span class="st">" "</span>, <span class="st">"B: Placebo"</span>,</span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">lyt_cspan_final</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_table.html">basic_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"span_label"</span>,</span>
<span>    split_fun <span class="op">=</span> <span class="fu"><a href="../reference/trim_levels_to_map.html">trim_levels_to_map</a></span><span class="op">(</span><span class="va">span_label_map</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"ARM"</span>, show_colcounts <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">lyt_cspan_final</span>, <span class="va">adsl_forspans</span><span class="op">)</span></span></code></pre></div>
<pre><code>        Active Treatment                  
   A: Drug X   C: Combination   B: Placebo
    (N=122)       (N=120)        (N=119)  
——————————————————————————————————————————</code></pre>
<p>Thus we have again achieved a “table” matching our desired shell. We
can consider only the column structure because in this case as
previously the column structure, row structure, and analysis are all
orthogonal. We will see an example where that isn’t fully the case
below</p>
<p><strong>Note:</strong> in the general case, the level map used in
<code>trim_levels_to_map</code> will be a function of the data
dictionaries for the relevant variables within your study, thus for
combinations of actual variables these maps should not require manual
construction as we did above.</p>
</div>
<div class="section level2">
<h2 id="heterogeneous-column-structures-e-g--risk-difference-columns">Heterogeneous Column Structures (e.g., Risk Difference Columns)<a class="anchor" aria-label="anchor" href="#heterogeneous-column-structures-e-g--risk-difference-columns"></a>
</h2>
<p>In our previous examples, the column structure was simple nested
faceting, both in the case of faceting on two variables from the data,
and in the case we wanted spanning labels.</p>
<p>While this simple nesting structure is relatively common,
particularly for column structure, it does not fit the shells for all
tables we might need to create. One example of this is risk difference
columns, as found in modern FDA guidance for Adverse Event (AE)
tables.</p>
<p>In this section we will translate a shell with both spanning headers
and risk difference columns into a layout. To avoid subtleties about
counting we will analyze the <code>BMRKR2</code> variable in our
synthetic <code>ADSL</code> dataset rather than going for a realistic AE
table. These counting issues and realistic AE tables will be addressed
elsewhere in this series of vignettes.</p>
<div class="section level3">
<h3 id="risk-difference-columns">Risk Difference Columns<a class="anchor" aria-label="anchor" href="#risk-difference-columns"></a>
</h3>
<p>Many tables call for “risk difference”, or comparison columns, in
addition to those used for the primary counts. When combined with
spanning labels, the column structure of our shell would look something
like:</p>
<pre><code>        Active Treatment                                                                           
   A: Drug X   C: Combination   B: Placebo                      Risk Differences                   
    (N=xx)        (N=xx)         (N=xx)      A: Drug X vs B: Placebo   C: Combination vs B: Placebo
———————————————————————————————————————————————————————————————————————————————————————————————————</code></pre>
<p>We see that the first portion of the column structure is the same,
but we now have the risk difference structure in addition. There are a
number of different ways to model risk difference columns but we will do
so as a separate nested substructure. Thus as we did with the “Active
Treatment” spanning label, we will create and then facet on a variable
that gives us the “Risk Differences” label.</p>
<p>We can build up this substructure separately and then combine it with
the structure we created above to match the full shell.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adsl_rr</span> <span class="op">&lt;-</span> <span class="va">adsl_forspans</span></span>
<span><span class="va">adsl_rr</span><span class="op">$</span><span class="va">rr_header</span> <span class="op">&lt;-</span> <span class="st">"Risk Differences"</span></span>
<span></span>
<span><span class="va">lyt_only_rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_table.html">basic_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"rr_header"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"ARM"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">lyt_only_rr</span>, <span class="va">adsl_rr</span><span class="op">)</span></span></code></pre></div>
<pre><code>              Risk Differences            
   A: Drug X   B: Placebo   C: Combination
——————————————————————————————————————————</code></pre>
<p>This is getting close there are two issues: first, we don’t want a
placebo column (which would nonsensically compare placebo against
itself), and the labels are simply the individual arms rather than the
pair of arms being compared as in our shell.</p>
<p>We can restrict the facets generated using the
<code>remove_split_levels</code> (or sibling
<code>keep_split_levels</code>) split function provided by
<code>rtables</code>. In addition the <code>split_*_by</code> functions
accept the <code>labels_var</code> argument which specifies an
additional variable which should be used for the <em>labels</em> (not
names) of the facets generated. With preprocessing to create such a
variable, and combining these two approaches, we can achieve the risk
difference structure:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adsl_rr</span><span class="op">$</span><span class="va">rr_label</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">adsl_rr</span><span class="op">$</span><span class="va">ARM</span>, <span class="st">"vs B: Placebo"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lyt_only_rr2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_table.html">basic_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"rr_header"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"ARM"</span>,</span>
<span>    split_fun <span class="op">=</span> <span class="fu"><a href="../reference/split_funcs.html">remove_split_levels</a></span><span class="op">(</span><span class="st">"B: Placebo"</span><span class="op">)</span>,</span>
<span>    labels_var <span class="op">=</span> <span class="st">"rr_label"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">lyt_only_rr2</span>, <span class="va">adsl_rr</span><span class="op">)</span></span></code></pre></div>
<pre><code>                      Risk Differences                   
   A: Drug X vs B: Placebo   C: Combination vs B: Placebo
—————————————————————————————————————————————————————————</code></pre>
<p>To combine our two sections of column structure, we simply combine
the sets of layouting instructions and add <code>nested = FALSE</code>
to our split on <code>"rr_header"</code>:</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lyt_rr_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_table.html">basic_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"span_label"</span>,</span>
<span>    split_fun <span class="op">=</span> <span class="fu"><a href="../reference/trim_levels_to_map.html">trim_levels_to_map</a></span><span class="op">(</span><span class="va">span_label_map</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"ARM"</span>, show_colcounts <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"rr_header"</span>, nested <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"ARM"</span>,</span>
<span>    split_fun <span class="op">=</span> <span class="fu"><a href="../reference/split_funcs.html">remove_split_levels</a></span><span class="op">(</span><span class="st">"B: Placebo"</span><span class="op">)</span>,</span>
<span>    labels_var <span class="op">=</span> <span class="st">"rr_label"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">lyt_rr_cols</span>, <span class="va">adsl_rr</span><span class="op">)</span></span></code></pre></div>
<pre><code>        Active Treatment                                                                           
   A: Drug X   C: Combination   B: Placebo                      Risk Differences                   
    (N=122)       (N=120)        (N=119)     A: Drug X vs B: Placebo   C: Combination vs B: Placebo
———————————————————————————————————————————————————————————————————————————————————————————————————</code></pre>
<p>Note that because we used <code>show_colcounts</code> in our
<code>split_cols_by</code> call for <code>"ARM"</code>, rather than in
<code>build_table</code>, we have counts for our main arm columns but
not for our comparison columns, as desired.</p>
<p>One caveat here, however, is that we will need a more sophisticated
analysis function because its behavior is no longer independent of which
facet it is in: it might generate e.g., counts for the primary arm
columns and then confidence intervals for our risk difference
columns.</p>
<p>Typically trial teams will be using pre-existing analysis functions
for this, but we will illustrate these can be constructed now.</p>
</div>
<div class="section level3">
<h3 id="column-structure-aware-analysis-functions">Column-structure Aware Analysis Functions<a class="anchor" aria-label="anchor" href="#column-structure-aware-analysis-functions"></a>
</h3>
<p>Our analysis function needs two “modes”: the primary arm column mode
and the risk difference mode, and it needs to be able to distinguish
between them.</p>
<p>Analysis (and content, i.e., row group summary) functions can accept
the optional <code>.spl_context</code> argument to receive information
where in the faceting structure the facet they are currently populating
is. We will leave a detailed discussion of the full contents of the
split context to other documentation and simply use the portions we need
here.</p>
<p>In particular, we will use the <code>cur_col_id</code> column of
<code>.spl_context</code> to determine which section of the column
structure we are under. Note that due to the vagaries of the current
implementation, this is constructed of the <em>labels</em> for the
column facets rather than their names. This is the split/value pairs of
each column split in order concatenated together, so it suffices to
define</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">in_risk_diff</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">spl_context</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"Risk Differences"</span>, <span class="va">spl_context</span><span class="op">$</span><span class="va">cur_col_id</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>For simplicity, we will not worry about <em>calculating</em> risk
differences here, and simply write an analysis function that emits
something different to show that it can tell it is in “risk difference
mode”.</p>
<p>Thus a very simplistic afun is as follows:</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rr_afun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">.N_col</span>, <span class="va">.spl_context</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">xtbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu">in_risk_diff</span><span class="op">(</span><span class="va">.spl_context</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">armlabel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/head_tail.html">tail</a></span><span class="op">(</span><span class="va">.spl_context</span><span class="op">$</span><span class="va">cur_col_split_val</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="fl">1</span><span class="op">)</span> <span class="co"># last split value, ie arm</span></span>
<span>    <span class="va">armletter</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">armlabel</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="va">vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">armletter</span>, <span class="st">"vs B"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">xtbl</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">fmts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"xx"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">xtbl</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">xtbl</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span> <span class="op">/</span> <span class="va">.N_col</span><span class="op">)</span><span class="op">)</span> <span class="co">## count and pct</span></span>
<span>    <span class="va">fmts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"xx.x (xx.x%)"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">xtbl</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">vals</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">xtbl</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">fmts</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">vals</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/in_rows.html">in_rows</a></span><span class="op">(</span>.list <span class="op">=</span> <span class="va">vals</span>, .formats <span class="op">=</span> <span class="va">fmts</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>With this we can create a table. We will analyze <code>BMRKR2</code>
(biomarker 2) for the sake of brevity. This is an oversimplifaction, as
typically this would be, e.g., <code>AEDECOD</code> in an
<code>adae</code> dataset, but this requires more sophisticated
calculation of counts and/or percents that is important but not germane
to this specific issue.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lyt_rr_full</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_table.html">basic_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"span_label"</span>,</span>
<span>    split_fun <span class="op">=</span> <span class="fu"><a href="../reference/trim_levels_to_map.html">trim_levels_to_map</a></span><span class="op">(</span><span class="va">span_label_map</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"ARM"</span>, show_colcounts <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"rr_header"</span>, nested <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"ARM"</span>,</span>
<span>    split_fun <span class="op">=</span> <span class="fu"><a href="../reference/split_funcs.html">remove_split_levels</a></span><span class="op">(</span><span class="st">"B: Placebo"</span><span class="op">)</span>,</span>
<span>    labels_var <span class="op">=</span> <span class="st">"rr_label"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"BMRKR2"</span>, afun <span class="op">=</span> <span class="va">rr_afun</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">lyt_rr_full</span>, <span class="va">adsl_rr</span><span class="op">)</span></span></code></pre></div>
<pre><code>               Active Treatment                                                                               
          A: Drug X     C: Combination    B: Placebo                       Risk Differences                   
           (N=122)         (N=120)         (N=119)      A: Drug X vs B: Placebo   C: Combination vs B: Placebo
——————————————————————————————————————————————————————————————————————————————————————————————————————————————
LOW      42.0 (34.4%)    37.0 (30.8%)    41.0 (34.5%)           A vs B                       C vs B           
MEDIUM   34.0 (27.9%)    37.0 (30.8%)    48.0 (40.3%)           A vs B                       C vs B           
HIGH     46.0 (37.7%)    46.0 (38.3%)    30.0 (25.2%)           A vs B                       C vs B           </code></pre>
<p>The blank space above the column counts is a known issue which we
expect to be resolved in a future release due to the fact that the
header construction/wrapping behavior is not accounting for the fact
that the two sections of the column structure are independent.</p>
<p>Note that while our analysis function was dependent on where in the
<em>column</em> structure we are, it remains independent of where in the
<em>row</em> faceting structure we are. Thus we can use our analysis
function within row faceting without changes:</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lyt_rr_full2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_table.html">basic_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"span_label"</span>,</span>
<span>    split_fun <span class="op">=</span> <span class="fu"><a href="../reference/trim_levels_to_map.html">trim_levels_to_map</a></span><span class="op">(</span><span class="va">span_label_map</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"ARM"</span>, show_colcounts <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"rr_header"</span>, nested <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"ARM"</span>,</span>
<span>    split_fun <span class="op">=</span> <span class="fu"><a href="../reference/split_funcs.html">remove_split_levels</a></span><span class="op">(</span><span class="st">"B: Placebo"</span><span class="op">)</span>,</span>
<span>    labels_var <span class="op">=</span> <span class="st">"rr_label"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/split_rows_by.html">split_rows_by</a></span><span class="op">(</span><span class="st">"STRATA1"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/split_rows_by.html">split_rows_by</a></span><span class="op">(</span><span class="st">"SEX"</span>, split_fun <span class="op">=</span> <span class="fu"><a href="../reference/split_funcs.html">keep_split_levels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Female"</span>, <span class="st">"Male"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"BMRKR2"</span>, afun <span class="op">=</span> <span class="va">rr_afun</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">lyt_rr_full2</span>, <span class="va">adsl_rr</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cwidths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://insightsengineering.github.io/formatters/latest-tag/reference/propose_column_widths.html" class="external-link">propose_column_widths</a></span><span class="op">(</span><span class="va">tbl</span><span class="op">)</span></span>
<span><span class="va">cwidths</span><span class="op">[</span><span class="va">cwidths</span> <span class="op">&gt;</span> <span class="fl">15</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">15</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://insightsengineering.github.io/formatters/latest-tag/reference/export_as_txt.html" class="external-link">export_as_txt</a></span><span class="op">(</span><span class="va">tbl</span>, colwidths <span class="op">=</span> <span class="va">cwidths</span><span class="op">)</span><span class="op">)</span> <span class="co">## for wrapping</span></span></code></pre></div>
<pre><code>                   Active Treatment                                                          
              A: Drug X     C: Combination    B: Placebo            Risk Differences         
                                                            A: Drug X vs B:   C: Combination 
               (N=122)         (N=120)         (N=119)          Placebo        vs B: Placebo 
—————————————————————————————————————————————————————————————————————————————————————————————
A                                                                                            
  Female                                                                                     
    LOW       9.0 (7.4%)     10.0 (8.3%)      6.0 (5.0%)        A vs B            C vs B     
    MEDIUM    5.0 (4.1%)      3.0 (2.5%)     10.0 (8.4%)        A vs B            C vs B     
    HIGH      7.0 (5.7%)      4.0 (3.3%)      6.0 (5.0%)        A vs B            C vs B     
  Male                                                                                       
    LOW       3.0 (2.5%)      3.0 (2.5%)      8.0 (6.7%)        A vs B            C vs B     
    MEDIUM    4.0 (3.3%)      9.0 (7.5%)      6.0 (5.0%)        A vs B            C vs B     
    HIGH      8.0 (6.6%)      7.0 (5.8%)      5.0 (4.2%)        A vs B            C vs B     
B                                                                                            
  Female                                                                                     
    LOW       6.0 (4.9%)      6.0 (5.0%)      6.0 (5.0%)        A vs B            C vs B     
    MEDIUM    6.0 (4.9%)      8.0 (6.7%)     15.0 (12.6%)       A vs B            C vs B     
    HIGH     10.0 (8.2%)      6.0 (5.0%)      5.0 (4.2%)        A vs B            C vs B     
  Male                                                                                       
    LOW       8.0 (6.6%)      3.0 (2.5%)      5.0 (4.2%)        A vs B            C vs B     
    MEDIUM    5.0 (4.1%)      6.0 (5.0%)      6.0 (5.0%)        A vs B            C vs B     
    HIGH      5.0 (4.1%)     11.0 (9.2%)      4.0 (3.4%)        A vs B            C vs B     
C                                                                                            
  Female                                                                                     
    LOW      10.0 (8.2%)     10.0 (8.3%)      8.0 (6.7%)        A vs B            C vs B     
    MEDIUM    8.0 (6.6%)      5.0 (4.2%)      7.0 (5.9%)        A vs B            C vs B     
    HIGH     15.0 (12.3%)    12.0 (10.0%)     6.0 (5.0%)        A vs B            C vs B     
  Male                                                                                       
    LOW       6.0 (4.9%)      5.0 (4.2%)      8.0 (6.7%)        A vs B            C vs B     
    MEDIUM    6.0 (4.9%)      6.0 (5.0%)      4.0 (3.4%)        A vs B            C vs B     
    HIGH      1.0 (0.8%)      6.0 (5.0%)      4.0 (3.4%)        A vs B            C vs B     </code></pre>
<p>A more complete exploration of creating production ready analysis
functions will be presented elsewhere in this vignette series.</p>
</div>
</div>
<div class="section level2">
<h2 id="mixed-nesting-levels">Mixed Nesting Levels<a class="anchor" aria-label="anchor" href="#mixed-nesting-levels"></a>
</h2>
<p>In practice, the row structure in most shells can be translated to a
layout using combinations of the methods shown above. Some shells,
however, essentially call for group summaries for all levels of a
categorical variable, but additionally call for analysis within those
groups <em>for only some levels of the variable</em>.</p>
<p>In clinical trial outputs we have seen this most commonly in
disposition tables, the shells of which might look something like:</p>
<pre><code>                                         Active Treatment                   
                                    A: Drug X    C: Combination   B: Placebo
                                     (N=xx)         (N=xx)         (N=xx)   
————————————————————————————————————————————————————————————————————————————
Asian                                   -              -              -     
  COMPLETED                         xx (xx.x%)     xx (xx.x%)     xx (xx.x%)
  DISCONTINUED                      xx (xx.x%)     xx (xx.x%)     xx (xx.x%)
    ADVERSE EVENT                   xx (xx.x%)     xx (xx.x%)     xx (xx.x%)
    LACK OF EFFICACY                xx (xx.x%)     xx (xx.x%)     xx (xx.x%)
    PHYSICIAN DECISION              xx (xx.x%)     xx (xx.x%)     xx (xx.x%)
    PROTOCOL VIOLATION              xx (xx.x%)     xx (xx.x%)     xx (xx.x%)
    WITHDRAWAL BY PARENT/GUARDIAN   xx (xx.x%)     xx (xx.x%)     xx (xx.x%)
    WITHDRAWAL BY SUBJECT           xx (xx.x%)     xx (xx.x%)     xx (xx.x%)
  ONGOING                           xx (xx.x%)     xx (xx.x%)     xx (xx.x%)
Black                                   -              -              -     
  COMPLETED                         xx (xx.x%)     xx (xx.x%)     xx (xx.x%)
  DISCONTINUED                      xx (xx.x%)     xx (xx.x%)     xx (xx.x%)
    ADVERSE EVENT                   xx (xx.x%)     xx (xx.x%)     xx (xx.x%)
    LACK OF EFFICACY                xx (xx.x%)     xx (xx.x%)     xx (xx.x%)
    PHYSICIAN DECISION              xx (xx.x%)     xx (xx.x%)     xx (xx.x%)
    PROTOCOL VIOLATION              xx (xx.x%)     xx (xx.x%)     xx (xx.x%)
    WITHDRAWAL BY PARENT/GUARDIAN   xx (xx.x%)     xx (xx.x%)     xx (xx.x%)
    WITHDRAWAL BY SUBJECT           xx (xx.x%)     xx (xx.x%)     xx (xx.x%)
  ONGOING                           xx (xx.x%)     xx (xx.x%)     xx (xx.x%)</code></pre>
<p>In this shell, the <code>COMPLETED</code>, <code>DISCONTINUED</code>
and <code>ONGOING</code> rows are siblings (derived from the
<code>EOSSTT</code> variable), however only the
<code>DISCONTINUED</code> row acts as a group summary row for a facet
containing further analysis; the other two essentially act as individual
rows.</p>
<p>This type of structure where individual analysis rows and
facets/group summary rows are direct siblings is not currently supported
by the <code>rtables</code> layouting and tabulation engines, and is
<em>somewhat</em> supported when created via, e.g., trimming rows of a
created table.</p>
<p>The above said, we can arrive at a table which renders as desired
using the <em>two-tier analysis function</em> strategy. A <a href="variable_nesting_depth.html">vignette</a> discussing this is in
detail is included with <code>rtables</code>; for completeness of the
training curriculum we will briefly reiterate here.</p>
<p>The key to the two-tier analysis function strategy is to generate
both levels of row in the same analysis function and simply use indent
modifiers to differentiate them.</p>
<p>Below is a simple <code>afun</code> that implements this strategy.
For the purposes of this lesson readers can ignore the details of what
this function does if desired; analysis function design and
implementation will be covered in another vignette in the advanced
section.</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simple_two_tier</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">.var</span>, <span class="va">.N_col</span>, <span class="va">inner_var</span>, <span class="va">drill_down_levs</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co">## group EOSSTT counts</span></span>
<span>  <span class="va">outer_tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">df</span><span class="op">[[</span><span class="va">.var</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">cells</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">outer_tbl</span><span class="op">)</span>,</span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">nm</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="co">## simulated group summary rows</span></span>
<span>      <span class="va">cont_cell</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rcell.html">rcell</a></span><span class="op">(</span><span class="va">outer_tbl</span><span class="op">[</span><span class="va">nm</span><span class="op">]</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span> <span class="op">/</span> <span class="va">.N_col</span><span class="op">)</span>,</span>
<span>        format <span class="op">=</span> <span class="st">"xx (xx.x%)"</span></span>
<span>      <span class="op">)</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="va">nm</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">drill_down_levs</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="co">## detail (DCSREAS) counts</span></span>
<span>        <span class="va">inner_tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">df</span><span class="op">[[</span><span class="va">inner_var</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>        <span class="co">## note indent_mod</span></span>
<span>        <span class="va">detail_cells</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">inner_tbl</span><span class="op">)</span>,</span>
<span>          <span class="kw">function</span><span class="op">(</span><span class="va">innm</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="fu"><a href="../reference/rcell.html">rcell</a></span><span class="op">(</span><span class="va">inner_tbl</span><span class="op">[</span><span class="va">innm</span><span class="op">]</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span> <span class="op">/</span> <span class="va">.N_col</span><span class="op">)</span>,</span>
<span>              format <span class="op">=</span> <span class="st">"xx (xx.x%)"</span>,</span>
<span>              <span class="co">## appearance of "detail drill-down"</span></span>
<span>              indent_mod <span class="op">=</span> <span class="fl">1L</span></span>
<span>            <span class="op">)</span></span>
<span>          <span class="op">}</span></span>
<span>        <span class="op">)</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">detail_cells</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">inner_tbl</span><span class="op">)</span></span>
<span>      <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>        <span class="va">detail_cells</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>      <span class="op">}</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">cont_cell</span><span class="op">)</span>, <span class="va">nm</span><span class="op">)</span>, <span class="va">detail_cells</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="../reference/in_rows.html">in_rows</a></span><span class="op">(</span>.list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">cells</span>, recursive <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">lyt_two_tier</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_table.html">basic_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"EOSSTT"</span>,</span>
<span>    afun <span class="op">=</span> <span class="va">simple_two_tier</span>,</span>
<span>    extra_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>inner_var <span class="op">=</span> <span class="st">"DCSREAS"</span>, drill_down_levs <span class="op">=</span> <span class="st">"DISCONTINUED"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">lyt_two_tier</span>, <span class="va">adsl_rr</span><span class="op">)</span></span></code></pre></div>
<pre><code>                                    all obs  
—————————————————————————————————————————————
COMPLETED                         181 (50.1%)
DISCONTINUED                      112 (31.0%)
  ADVERSE EVENT                    18 (5.0%) 
  LACK OF EFFICACY                 24 (6.6%) 
  PHYSICIAN DECISION               15 (4.2%) 
  PROTOCOL VIOLATION               20 (5.5%) 
  WITHDRAWAL BY PARENT/GUARDIAN    14 (3.9%) 
  WITHDRAWAL BY SUBJECT            21 (5.8%) 
ONGOING                           68 (18.8%) </code></pre>
<p>As in other cases, we can add the row- and column- structure
orthogonally (provided the analysis behavior is truly orthogonal to the
faceting, as it is in this shell):</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lyt_two_tier_full</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_table.html">basic_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"span_label"</span>,</span>
<span>    split_fun <span class="op">=</span> <span class="fu"><a href="../reference/trim_levels_to_map.html">trim_levels_to_map</a></span><span class="op">(</span><span class="va">span_label_map</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"ARM"</span>, show_colcounts <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/split_rows_by.html">split_rows_by</a></span><span class="op">(</span><span class="st">"RACE"</span>, split_fun <span class="op">=</span> <span class="fu"><a href="../reference/split_funcs.html">keep_split_levels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Asian"</span>, <span class="st">"Black"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"EOSSTT"</span>,</span>
<span>    afun <span class="op">=</span> <span class="va">simple_two_tier</span>,</span>
<span>    extra_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>inner_var <span class="op">=</span> <span class="st">"DCSREAS"</span>, drill_down_levs <span class="op">=</span> <span class="st">"DISCONTINUED"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">lyt_two_tier_full</span>, <span class="va">adsl_rr</span><span class="op">)</span></span></code></pre></div>
<pre><code>                                         Active Treatment                   
                                    A: Drug X    C: Combination   B: Placebo
                                     (N=122)        (N=120)        (N=119)  
————————————————————————————————————————————————————————————————————————————
Asian                                                                       
  COMPLETED                         32 (26.2%)     35 (29.2%)     31 (26.1%)
  DISCONTINUED                      18 (14.8%)     23 (19.2%)     26 (21.8%)
    ADVERSE EVENT                    4 (3.3%)       5 (4.2%)       4 (3.4%) 
    LACK OF EFFICACY                 5 (4.1%)       2 (1.7%)       5 (4.2%) 
    PHYSICIAN DECISION               2 (1.6%)       4 (3.3%)       4 (3.4%) 
    PROTOCOL VIOLATION               1 (0.8%)       5 (4.2%)       7 (5.9%) 
    WITHDRAWAL BY PARENT/GUARDIAN    3 (2.5%)       2 (1.7%)       1 (0.8%) 
    WITHDRAWAL BY SUBJECT            3 (2.5%)       5 (4.2%)       5 (4.2%) 
  ONGOING                           16 (13.1%)     13 (10.8%)      9 (7.6%) 
Black                                                                       
  COMPLETED                         13 (10.7%)     19 (15.8%)     16 (13.4%)
  DISCONTINUED                      12 (9.8%)       6 (5.0%)       6 (5.0%) 
    ADVERSE EVENT                    2 (1.6%)       1 (0.8%)       0 (0.0%) 
    LACK OF EFFICACY                 4 (3.3%)       1 (0.8%)       2 (1.7%) 
    PHYSICIAN DECISION               1 (0.8%)       1 (0.8%)       2 (1.7%) 
    PROTOCOL VIOLATION               3 (2.5%)       0 (0.0%)       1 (0.8%) 
    WITHDRAWAL BY PARENT/GUARDIAN    2 (1.6%)       0 (0.0%)       0 (0.0%) 
    WITHDRAWAL BY SUBJECT            0 (0.0%)       3 (2.5%)       1 (0.8%) 
  ONGOING                            5 (4.1%)       3 (2.5%)       6 (5.0%) </code></pre>
<p>Thus we have created our desired output.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="nest">
  <p>rtables is a part of the <strong>NEST</strong> and <a href="https://pharmaverse.org/" class="external-link"><strong>pharmaverse</strong></a>.</p>
</div>
<script type="text/javascript" src="../analytics.js"></script></footer>
</div>





  </body>
</html>
