<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rtables">
<title>Pruning and Sorting Tables • rtables</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Pruning and Sorting Tables">
<meta property="og:description" content="rtables">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-default navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rtables</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5.3.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../articles/index.html">Articles</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/roche/rtables">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Pruning and Sorting Tables</h1>
                        <h4 data-toc-skip class="author">Gabriel Becker
and Adrian Waddell</h4>
            
            <h4 data-toc-skip class="date">2022-11-10</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/roche/rtables/blob/HEAD/vignettes/sorting_pruning.Rmd" class="external-link"><code>vignettes/sorting_pruning.Rmd</code></a></small>
      <div class="d-none name"><code>sorting_pruning.Rmd</code></div>
    </div>

    
    
<style type="text/css">
.reveal .r code {
    white-space: pre;
}
</style>
<div class="section level3">
<h3 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h3>
<p>Often we want to filter or reorder subsections of a table in ways
that take into account the table structure. For example</p>
<ul>
<li>sorting subtables corresponding to factor levels so that most
commonly observed levels occur first in the table</li>
<li>Removing subtables which represent 0 observations or which after
other filtering contain 0 rows</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/roche/rtables" class="external-link">rtables</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co"># Loading required package: magrittr</span></span></code></pre>
<pre><code><span><span class="co"># Loading required package: formatters</span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co"># </span></span>
<span><span class="co"># Attaching package: 'dplyr'</span></span></code></pre>
<pre><code><span><span class="co"># The following objects are masked from 'package:stats':</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#     filter, lag</span></span></code></pre>
<pre><code><span><span class="co"># The following objects are masked from 'package:base':</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#     intersect, setdiff, setequal, union</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="a-table-in-need-of-attention">A Table In Need of Attention<a class="anchor" aria-label="anchor" href="#a-table-in-need-of-attention"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rawtable</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_table.html">basic_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"ARM"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"SEX"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/split_rows_by.html">split_rows_by</a></span><span class="op">(</span><span class="st">"RACE"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/summarize_row_groups.html">summarize_row_groups</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/split_rows_by.html">split_rows_by</a></span><span class="op">(</span><span class="st">"STRATA1"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/summarize_row_groups.html">summarize_row_groups</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"AGE"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">DM</span><span class="op">)</span></span>
<span><span class="va">rawtable</span></span></code></pre></div>
<pre><code><span><span class="co">#                                                                  A: Drug X                                              B: Placebo                                           C: Combination                   </span></span>
<span><span class="co">#                                                 F            M           U      UNDIFFERENTIATED       F            M           U      UNDIFFERENTIATED       F            M           U      UNDIFFERENTIATED</span></span>
<span><span class="co"># ——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># ASIAN                                       44 (62.9%)   35 (68.6%)   0 (NA%)       0 (NA%)        37 (66.1%)   31 (62.0%)   0 (NA%)       0 (NA%)        40 (65.6%)   44 (64.7%)   0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#   A                                         15 (21.4%)   12 (23.5%)   0 (NA%)       0 (NA%)        14 (25.0%)   6 (12.0%)    0 (NA%)       0 (NA%)        15 (24.6%)   16 (23.5%)   0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                                      30.40        34.42        NA             NA            35.43        30.33        NA             NA            37.40        36.25        NA             NA       </span></span>
<span><span class="co">#   B                                         16 (22.9%)   8 (15.7%)    0 (NA%)       0 (NA%)        13 (23.2%)   16 (32.0%)   0 (NA%)       0 (NA%)        10 (16.4%)   12 (17.6%)   0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                                      33.75        34.88        NA             NA            32.46        30.94        NA             NA            33.30        35.92        NA             NA       </span></span>
<span><span class="co">#   C                                         13 (18.6%)   15 (29.4%)   0 (NA%)       0 (NA%)        10 (17.9%)   9 (18.0%)    0 (NA%)       0 (NA%)        15 (24.6%)   16 (23.5%)   0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                                      36.92        35.60        NA             NA            34.00        31.89        NA             NA            33.47        31.38        NA             NA       </span></span>
<span><span class="co"># BLACK OR AFRICAN AMERICAN                   18 (25.7%)   10 (19.6%)   0 (NA%)       0 (NA%)        12 (21.4%)   12 (24.0%)   0 (NA%)       0 (NA%)        13 (21.3%)   14 (20.6%)   0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#   A                                          5 (7.1%)     1 (2.0%)    0 (NA%)       0 (NA%)         5 (8.9%)     2 (4.0%)    0 (NA%)       0 (NA%)         4 (6.6%)     4 (5.9%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                                      31.20        33.00        NA             NA            28.00        30.00        NA             NA            30.75        36.50        NA             NA       </span></span>
<span><span class="co">#   B                                         7 (10.0%)     3 (5.9%)    0 (NA%)       0 (NA%)         3 (5.4%)     3 (6.0%)    0 (NA%)       0 (NA%)         6 (9.8%)     6 (8.8%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                                      36.14        34.33        NA             NA            29.67        32.00        NA             NA            36.33        31.00        NA             NA       </span></span>
<span><span class="co">#   C                                          6 (8.6%)    6 (11.8%)    0 (NA%)       0 (NA%)         4 (7.1%)    7 (14.0%)    0 (NA%)       0 (NA%)         3 (4.9%)     4 (5.9%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                                      31.33        39.67        NA             NA            34.50        34.00        NA             NA            33.00        36.50        NA             NA       </span></span>
<span><span class="co"># WHITE                                       8 (11.4%)    6 (11.8%)    0 (NA%)       0 (NA%)        7 (12.5%)    7 (14.0%)    0 (NA%)       0 (NA%)        8 (13.1%)    10 (14.7%)   0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#   A                                          2 (2.9%)     1 (2.0%)    0 (NA%)       0 (NA%)         3 (5.4%)     3 (6.0%)    0 (NA%)       0 (NA%)         1 (1.6%)     5 (7.4%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                                      34.00        45.00        NA             NA            29.33        33.33        NA             NA            35.00        32.80        NA             NA       </span></span>
<span><span class="co">#   B                                          4 (5.7%)     3 (5.9%)    0 (NA%)       0 (NA%)         1 (1.8%)     4 (8.0%)    0 (NA%)       0 (NA%)         3 (4.9%)     1 (1.5%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                                      37.00        43.67        NA             NA            48.00        36.75        NA             NA            34.33        36.00        NA             NA       </span></span>
<span><span class="co">#   C                                          2 (2.9%)     2 (3.9%)    0 (NA%)       0 (NA%)         3 (5.4%)     0 (0.0%)    0 (NA%)       0 (NA%)         4 (6.6%)     4 (5.9%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                                      35.50        44.00        NA             NA            44.67          NA         NA             NA            38.50        35.00        NA             NA       </span></span>
<span><span class="co"># AMERICAN INDIAN OR ALASKA NATIVE             0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#   A                                          0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                                        NA           NA         NA             NA              NA           NA         NA             NA              NA           NA         NA             NA       </span></span>
<span><span class="co">#   B                                          0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                                        NA           NA         NA             NA              NA           NA         NA             NA              NA           NA         NA             NA       </span></span>
<span><span class="co">#   C                                          0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                                        NA           NA         NA             NA              NA           NA         NA             NA              NA           NA         NA             NA       </span></span>
<span><span class="co"># MULTIPLE                                     0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#   A                                          0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                                        NA           NA         NA             NA              NA           NA         NA             NA              NA           NA         NA             NA       </span></span>
<span><span class="co">#   B                                          0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                                        NA           NA         NA             NA              NA           NA         NA             NA              NA           NA         NA             NA       </span></span>
<span><span class="co">#   C                                          0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                                        NA           NA         NA             NA              NA           NA         NA             NA              NA           NA         NA             NA       </span></span>
<span><span class="co"># NATIVE HAWAIIAN OR OTHER PACIFIC ISLANDER    0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#   A                                          0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                                        NA           NA         NA             NA              NA           NA         NA             NA              NA           NA         NA             NA       </span></span>
<span><span class="co">#   B                                          0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                                        NA           NA         NA             NA              NA           NA         NA             NA              NA           NA         NA             NA       </span></span>
<span><span class="co">#   C                                          0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                                        NA           NA         NA             NA              NA           NA         NA             NA              NA           NA         NA             NA       </span></span>
<span><span class="co"># OTHER                                        0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#   A                                          0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                                        NA           NA         NA             NA              NA           NA         NA             NA              NA           NA         NA             NA       </span></span>
<span><span class="co">#   B                                          0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                                        NA           NA         NA             NA              NA           NA         NA             NA              NA           NA         NA             NA       </span></span>
<span><span class="co">#   C                                          0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                                        NA           NA         NA             NA              NA           NA         NA             NA              NA           NA         NA             NA       </span></span>
<span><span class="co"># UNKNOWN                                      0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#   A                                          0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                                        NA           NA         NA             NA              NA           NA         NA             NA              NA           NA         NA             NA       </span></span>
<span><span class="co">#   B                                          0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                                        NA           NA         NA             NA              NA           NA         NA             NA              NA           NA         NA             NA       </span></span>
<span><span class="co">#   C                                          0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                                        NA           NA         NA             NA              NA           NA         NA             NA              NA           NA         NA             NA</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="trimming">Trimming<a class="anchor" aria-label="anchor" href="#trimming"></a>
</h3>
<div class="section level4">
<h4 id="rows">Rows<a class="anchor" aria-label="anchor" href="#rows"></a>
</h4>
<p>Trimming represents a convenience wrapper around simple, direct
subsetting of the rows of a <code>TableTree</code>.</p>
<p>We use the <code><a href="../reference/trim_rows.html">trim_rows()</a></code> function and pass it our table
and a critera function. All rows where the criteria function returns
<code>TRUE</code> will be removed, all others will be retained.</p>
<p><strong>NOTE</strong>: each row is kept or removed completely
independently, with no awareness of the surrounding structure. This
means, for example, that a subtree could have all its analysis rows
removed and not be removed itself. For structure-aware filtering of a
table, we will use <em>pruning</em> described in the next section.</p>
<p>A <em>trimming function</em> accepts a <code>TableRow</code> object
and returns <code>TRUE</code> if the row should be removed.</p>
<p>The default trimming function removes rows that have no values in
them that have all <code>NA</code> values or all <code>0</code> values
(but not if there is a mix)</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/trim_rows.html">trim_rows</a></span><span class="op">(</span><span class="va">rawtable</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#                                                  A: Drug X                                              B: Placebo                                           C: Combination                   </span></span>
<span><span class="co">#                                 F            M           U      UNDIFFERENTIATED       F            M           U      UNDIFFERENTIATED       F            M           U      UNDIFFERENTIATED</span></span>
<span><span class="co"># ——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># ASIAN                       44 (62.9%)   35 (68.6%)   0 (NA%)       0 (NA%)        37 (66.1%)   31 (62.0%)   0 (NA%)       0 (NA%)        40 (65.6%)   44 (64.7%)   0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#   A                         15 (21.4%)   12 (23.5%)   0 (NA%)       0 (NA%)        14 (25.0%)   6 (12.0%)    0 (NA%)       0 (NA%)        15 (24.6%)   16 (23.5%)   0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                      30.40        34.42        NA             NA            35.43        30.33        NA             NA            37.40        36.25        NA             NA       </span></span>
<span><span class="co">#   B                         16 (22.9%)   8 (15.7%)    0 (NA%)       0 (NA%)        13 (23.2%)   16 (32.0%)   0 (NA%)       0 (NA%)        10 (16.4%)   12 (17.6%)   0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                      33.75        34.88        NA             NA            32.46        30.94        NA             NA            33.30        35.92        NA             NA       </span></span>
<span><span class="co">#   C                         13 (18.6%)   15 (29.4%)   0 (NA%)       0 (NA%)        10 (17.9%)   9 (18.0%)    0 (NA%)       0 (NA%)        15 (24.6%)   16 (23.5%)   0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                      36.92        35.60        NA             NA            34.00        31.89        NA             NA            33.47        31.38        NA             NA       </span></span>
<span><span class="co"># BLACK OR AFRICAN AMERICAN   18 (25.7%)   10 (19.6%)   0 (NA%)       0 (NA%)        12 (21.4%)   12 (24.0%)   0 (NA%)       0 (NA%)        13 (21.3%)   14 (20.6%)   0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#   A                          5 (7.1%)     1 (2.0%)    0 (NA%)       0 (NA%)         5 (8.9%)     2 (4.0%)    0 (NA%)       0 (NA%)         4 (6.6%)     4 (5.9%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                      31.20        33.00        NA             NA            28.00        30.00        NA             NA            30.75        36.50        NA             NA       </span></span>
<span><span class="co">#   B                         7 (10.0%)     3 (5.9%)    0 (NA%)       0 (NA%)         3 (5.4%)     3 (6.0%)    0 (NA%)       0 (NA%)         6 (9.8%)     6 (8.8%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                      36.14        34.33        NA             NA            29.67        32.00        NA             NA            36.33        31.00        NA             NA       </span></span>
<span><span class="co">#   C                          6 (8.6%)    6 (11.8%)    0 (NA%)       0 (NA%)         4 (7.1%)    7 (14.0%)    0 (NA%)       0 (NA%)         3 (4.9%)     4 (5.9%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                      31.33        39.67        NA             NA            34.50        34.00        NA             NA            33.00        36.50        NA             NA       </span></span>
<span><span class="co"># WHITE                       8 (11.4%)    6 (11.8%)    0 (NA%)       0 (NA%)        7 (12.5%)    7 (14.0%)    0 (NA%)       0 (NA%)        8 (13.1%)    10 (14.7%)   0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#   A                          2 (2.9%)     1 (2.0%)    0 (NA%)       0 (NA%)         3 (5.4%)     3 (6.0%)    0 (NA%)       0 (NA%)         1 (1.6%)     5 (7.4%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                      34.00        45.00        NA             NA            29.33        33.33        NA             NA            35.00        32.80        NA             NA       </span></span>
<span><span class="co">#   B                          4 (5.7%)     3 (5.9%)    0 (NA%)       0 (NA%)         1 (1.8%)     4 (8.0%)    0 (NA%)       0 (NA%)         3 (4.9%)     1 (1.5%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                      37.00        43.67        NA             NA            48.00        36.75        NA             NA            34.33        36.00        NA             NA       </span></span>
<span><span class="co">#   C                          2 (2.9%)     2 (3.9%)    0 (NA%)       0 (NA%)         3 (5.4%)     0 (0.0%)    0 (NA%)       0 (NA%)         4 (6.6%)     4 (5.9%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                      35.50        44.00        NA             NA            44.67          NA         NA             NA            38.50        35.00        NA             NA</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="trimming-columns">Trimming Columns<a class="anchor" aria-label="anchor" href="#trimming-columns"></a>
</h4>
<p>There are currently no special utilities for trimming columns but we
can remove the empty columns with fairly straightforward column
subsetting:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coltrimmed</span> <span class="op">&lt;-</span> <span class="va">rawtable</span><span class="op">[</span>, <span class="fu"><a href="../reference/col_accessors.html">col_counts</a></span><span class="op">(</span><span class="va">rawtable</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co"># Note: method with signature 'VTableTree#missing#ANY' chosen for function '[',</span></span>
<span><span class="co">#  target signature 'TableTree#missing#logical'.</span></span>
<span><span class="co">#  "VTableTree#ANY#logical" would also be valid</span></span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/head_tail.html">head</a></span><span class="op">(</span><span class="va">coltrimmed</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#                   A: Drug X                B: Placebo              C: Combination     </span></span>
<span><span class="co">#                F            M            F            M            F            M     </span></span>
<span><span class="co"># ——————————————————————————————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># ASIAN      44 (62.9%)   35 (68.6%)   37 (66.1%)   31 (62.0%)   40 (65.6%)   44 (64.7%)</span></span>
<span><span class="co">#   A        15 (21.4%)   12 (23.5%)   14 (25.0%)   6 (12.0%)    15 (24.6%)   16 (23.5%)</span></span>
<span><span class="co">#     Mean     30.40        34.42        35.43        30.33        37.40        36.25   </span></span>
<span><span class="co">#   B        16 (22.9%)   8 (15.7%)    13 (23.2%)   16 (32.0%)   10 (16.4%)   12 (17.6%)</span></span>
<span><span class="co">#     Mean     33.75        34.88        32.46        30.94        33.30        35.92   </span></span>
<span><span class="co">#   C        13 (18.6%)   15 (29.4%)   10 (17.9%)   9 (18.0%)    15 (24.6%)   16 (23.5%)</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="pruning">Pruning<a class="anchor" aria-label="anchor" href="#pruning"></a>
</h3>
<p>Pruning is similar in outcome to trimming, but more powerful and more
complex, as it takes structure into account.</p>
<p>Pruning is applied recursively, in that at each structural unit
(subtable, row) it both applies the pruning function at that level and
to all it’s children (up to a user-specifiable maximum depth).</p>
<p>The default pruning funciton, for example, determines if a subtree is
empty by</p>
<ol style="list-style-type: lower-alpha">
<li>Removing all children which contain a single content row which
contains all zeros or all <code>NA</code>s</li>
<li>Removing rows which contain either all zeros or all
<code>NA</code>s</li>
<li>Removing the full subtree if no unpruned children remain</li>
</ol>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pruned</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prune_table.html">prune_table</a></span><span class="op">(</span><span class="va">coltrimmed</span><span class="op">)</span></span>
<span><span class="va">pruned</span></span></code></pre></div>
<pre><code><span><span class="co">#                                    A: Drug X                B: Placebo              C: Combination     </span></span>
<span><span class="co">#                                 F            M            F            M            F            M     </span></span>
<span><span class="co"># ———————————————————————————————————————————————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># ASIAN                       44 (62.9%)   35 (68.6%)   37 (66.1%)   31 (62.0%)   40 (65.6%)   44 (64.7%)</span></span>
<span><span class="co">#   A                         15 (21.4%)   12 (23.5%)   14 (25.0%)   6 (12.0%)    15 (24.6%)   16 (23.5%)</span></span>
<span><span class="co">#     Mean                      30.40        34.42        35.43        30.33        37.40        36.25   </span></span>
<span><span class="co">#   B                         16 (22.9%)   8 (15.7%)    13 (23.2%)   16 (32.0%)   10 (16.4%)   12 (17.6%)</span></span>
<span><span class="co">#     Mean                      33.75        34.88        32.46        30.94        33.30        35.92   </span></span>
<span><span class="co">#   C                         13 (18.6%)   15 (29.4%)   10 (17.9%)   9 (18.0%)    15 (24.6%)   16 (23.5%)</span></span>
<span><span class="co">#     Mean                      36.92        35.60        34.00        31.89        33.47        31.38   </span></span>
<span><span class="co"># BLACK OR AFRICAN AMERICAN   18 (25.7%)   10 (19.6%)   12 (21.4%)   12 (24.0%)   13 (21.3%)   14 (20.6%)</span></span>
<span><span class="co">#   A                          5 (7.1%)     1 (2.0%)     5 (8.9%)     2 (4.0%)     4 (6.6%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      31.20        33.00        28.00        30.00        30.75        36.50   </span></span>
<span><span class="co">#   B                         7 (10.0%)     3 (5.9%)     3 (5.4%)     3 (6.0%)     6 (9.8%)     6 (8.8%) </span></span>
<span><span class="co">#     Mean                      36.14        34.33        29.67        32.00        36.33        31.00   </span></span>
<span><span class="co">#   C                          6 (8.6%)    6 (11.8%)     4 (7.1%)    7 (14.0%)     3 (4.9%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      31.33        39.67        34.50        34.00        33.00        36.50   </span></span>
<span><span class="co"># WHITE                       8 (11.4%)    6 (11.8%)    7 (12.5%)    7 (14.0%)    8 (13.1%)    10 (14.7%)</span></span>
<span><span class="co">#   A                          2 (2.9%)     1 (2.0%)     3 (5.4%)     3 (6.0%)     1 (1.6%)     5 (7.4%) </span></span>
<span><span class="co">#     Mean                      34.00        45.00        29.33        33.33        35.00        32.80   </span></span>
<span><span class="co">#   B                          4 (5.7%)     3 (5.9%)     1 (1.8%)     4 (8.0%)     3 (4.9%)     1 (1.5%) </span></span>
<span><span class="co">#     Mean                      37.00        43.67        48.00        36.75        34.33        36.00   </span></span>
<span><span class="co">#   C                          2 (2.9%)     2 (3.9%)     3 (5.4%)     0 (0.0%)     4 (6.6%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      35.50        44.00        44.67          NA         38.50        35.00</span></span></code></pre>
<p>We can also use the <code>low_obs_pruner</code> pruning function
constructor to create a pruning function which removes subtrees with
content summaries whose first entries for each column sum or average to
below a specified number. (In the default summaries the first entry per
column is the count).</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pruned2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prune_table.html">prune_table</a></span><span class="op">(</span><span class="va">coltrimmed</span>, <span class="fu"><a href="../reference/trim_prune_funs.html">low_obs_pruner</a></span><span class="op">(</span><span class="fl">10</span>, <span class="st">"mean"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pruned2</span></span></code></pre></div>
<pre><code><span><span class="co">#                   A: Drug X                B: Placebo              C: Combination     </span></span>
<span><span class="co">#                F            M            F            M            F            M     </span></span>
<span><span class="co"># ——————————————————————————————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># ASIAN      44 (62.9%)   35 (68.6%)   37 (66.1%)   31 (62.0%)   40 (65.6%)   44 (64.7%)</span></span>
<span><span class="co">#   A        15 (21.4%)   12 (23.5%)   14 (25.0%)   6 (12.0%)    15 (24.6%)   16 (23.5%)</span></span>
<span><span class="co">#     Mean     30.40        34.42        35.43        30.33        37.40        36.25   </span></span>
<span><span class="co">#   B        16 (22.9%)   8 (15.7%)    13 (23.2%)   16 (32.0%)   10 (16.4%)   12 (17.6%)</span></span>
<span><span class="co">#     Mean     33.75        34.88        32.46        30.94        33.30        35.92   </span></span>
<span><span class="co">#   C        13 (18.6%)   15 (29.4%)   10 (17.9%)   9 (18.0%)    15 (24.6%)   16 (23.5%)</span></span>
<span><span class="co">#     Mean     36.92        35.60        34.00        31.89        33.47        31.38</span></span></code></pre>
<p>Note that because the pruning is being applied recursively, only the
<code>ASIAN</code> subtree remains because even though the full
<code>BLACK OR AFRICAN AMERICAN</code> subtree encompassed enough
observations, the strata within it did not. We can take care of this by
setting the <code>stop_depth</code> for pruning to <code>1</code>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pruned3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prune_table.html">prune_table</a></span><span class="op">(</span><span class="va">coltrimmed</span>, <span class="fu"><a href="../reference/trim_prune_funs.html">low_obs_pruner</a></span><span class="op">(</span><span class="fl">10</span>, <span class="st">"sum"</span><span class="op">)</span>, stop_depth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">pruned3</span></span></code></pre></div>
<pre><code><span><span class="co">#                                    A: Drug X                B: Placebo              C: Combination     </span></span>
<span><span class="co">#                                 F            M            F            M            F            M     </span></span>
<span><span class="co"># ———————————————————————————————————————————————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># ASIAN                       44 (62.9%)   35 (68.6%)   37 (66.1%)   31 (62.0%)   40 (65.6%)   44 (64.7%)</span></span>
<span><span class="co">#   A                         15 (21.4%)   12 (23.5%)   14 (25.0%)   6 (12.0%)    15 (24.6%)   16 (23.5%)</span></span>
<span><span class="co">#     Mean                      30.40        34.42        35.43        30.33        37.40        36.25   </span></span>
<span><span class="co">#   B                         16 (22.9%)   8 (15.7%)    13 (23.2%)   16 (32.0%)   10 (16.4%)   12 (17.6%)</span></span>
<span><span class="co">#     Mean                      33.75        34.88        32.46        30.94        33.30        35.92   </span></span>
<span><span class="co">#   C                         13 (18.6%)   15 (29.4%)   10 (17.9%)   9 (18.0%)    15 (24.6%)   16 (23.5%)</span></span>
<span><span class="co">#     Mean                      36.92        35.60        34.00        31.89        33.47        31.38   </span></span>
<span><span class="co"># BLACK OR AFRICAN AMERICAN   18 (25.7%)   10 (19.6%)   12 (21.4%)   12 (24.0%)   13 (21.3%)   14 (20.6%)</span></span>
<span><span class="co">#   A                          5 (7.1%)     1 (2.0%)     5 (8.9%)     2 (4.0%)     4 (6.6%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      31.20        33.00        28.00        30.00        30.75        36.50   </span></span>
<span><span class="co">#   B                         7 (10.0%)     3 (5.9%)     3 (5.4%)     3 (6.0%)     6 (9.8%)     6 (8.8%) </span></span>
<span><span class="co">#     Mean                      36.14        34.33        29.67        32.00        36.33        31.00   </span></span>
<span><span class="co">#   C                          6 (8.6%)    6 (11.8%)     4 (7.1%)    7 (14.0%)     3 (4.9%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      31.33        39.67        34.50        34.00        33.00        36.50   </span></span>
<span><span class="co"># WHITE                       8 (11.4%)    6 (11.8%)    7 (12.5%)    7 (14.0%)    8 (13.1%)    10 (14.7%)</span></span>
<span><span class="co">#   A                          2 (2.9%)     1 (2.0%)     3 (5.4%)     3 (6.0%)     1 (1.6%)     5 (7.4%) </span></span>
<span><span class="co">#     Mean                      34.00        45.00        29.33        33.33        35.00        32.80   </span></span>
<span><span class="co">#   B                          4 (5.7%)     3 (5.9%)     1 (1.8%)     4 (8.0%)     3 (4.9%)     1 (1.5%) </span></span>
<span><span class="co">#     Mean                      37.00        43.67        48.00        36.75        34.33        36.00   </span></span>
<span><span class="co">#   C                          2 (2.9%)     2 (3.9%)     3 (5.4%)     0 (0.0%)     4 (6.6%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      35.50        44.00        44.67          NA         38.50        35.00</span></span></code></pre>
<p>We can also see that pruning to a lower number of observations, say,
to a total of <code>16</code>, with no <code>stop_depth</code> removes
some but not all of the strata from our third race
(<code>WHITE</code>)</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pruned4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prune_table.html">prune_table</a></span><span class="op">(</span><span class="va">coltrimmed</span>, <span class="fu"><a href="../reference/trim_prune_funs.html">low_obs_pruner</a></span><span class="op">(</span><span class="fl">16</span>, <span class="st">"sum"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pruned4</span></span></code></pre></div>
<pre><code><span><span class="co">#                                    A: Drug X                B: Placebo              C: Combination     </span></span>
<span><span class="co">#                                 F            M            F            M            F            M     </span></span>
<span><span class="co"># ———————————————————————————————————————————————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># ASIAN                       44 (62.9%)   35 (68.6%)   37 (66.1%)   31 (62.0%)   40 (65.6%)   44 (64.7%)</span></span>
<span><span class="co">#   A                         15 (21.4%)   12 (23.5%)   14 (25.0%)   6 (12.0%)    15 (24.6%)   16 (23.5%)</span></span>
<span><span class="co">#     Mean                      30.40        34.42        35.43        30.33        37.40        36.25   </span></span>
<span><span class="co">#   B                         16 (22.9%)   8 (15.7%)    13 (23.2%)   16 (32.0%)   10 (16.4%)   12 (17.6%)</span></span>
<span><span class="co">#     Mean                      33.75        34.88        32.46        30.94        33.30        35.92   </span></span>
<span><span class="co">#   C                         13 (18.6%)   15 (29.4%)   10 (17.9%)   9 (18.0%)    15 (24.6%)   16 (23.5%)</span></span>
<span><span class="co">#     Mean                      36.92        35.60        34.00        31.89        33.47        31.38   </span></span>
<span><span class="co"># BLACK OR AFRICAN AMERICAN   18 (25.7%)   10 (19.6%)   12 (21.4%)   12 (24.0%)   13 (21.3%)   14 (20.6%)</span></span>
<span><span class="co">#   A                          5 (7.1%)     1 (2.0%)     5 (8.9%)     2 (4.0%)     4 (6.6%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      31.20        33.00        28.00        30.00        30.75        36.50   </span></span>
<span><span class="co">#   B                         7 (10.0%)     3 (5.9%)     3 (5.4%)     3 (6.0%)     6 (9.8%)     6 (8.8%) </span></span>
<span><span class="co">#     Mean                      36.14        34.33        29.67        32.00        36.33        31.00   </span></span>
<span><span class="co">#   C                          6 (8.6%)    6 (11.8%)     4 (7.1%)    7 (14.0%)     3 (4.9%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      31.33        39.67        34.50        34.00        33.00        36.50   </span></span>
<span><span class="co"># WHITE                       8 (11.4%)    6 (11.8%)    7 (12.5%)    7 (14.0%)    8 (13.1%)    10 (14.7%)</span></span>
<span><span class="co">#   B                          4 (5.7%)     3 (5.9%)     1 (1.8%)     4 (8.0%)     3 (4.9%)     1 (1.5%) </span></span>
<span><span class="co">#     Mean                      37.00        43.67        48.00        36.75        34.33        36.00</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="sorting">Sorting<a class="anchor" aria-label="anchor" href="#sorting"></a>
</h3>
<p>Sorting an rtable is done <strong>at a path</strong> and recursively,
meaning a sort opreation will occur at a particular location within the
table, and the subtables( children) will both be reordered themselves
and potentially have their own children reordered as well.</p>
<p>This is done by giving a <em>score function</em> which accepts a
subtree or TableRow and returns a single numeric value. Within the
context currently being sorted, the subtrees are then reordered by the
value of the score function.</p>
<p>Another difference between pruning and sorting is that sorting occurs
at particular places in the table, as defined by a path. The path can
contain “*” to indicate that at that portion of the structure sorting
should occur <strong>separately</strong> within branch of the path.</p>
<p>Sort the strata by observation counts within just the
<code>ASIAN</code> subtable:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/sort_at_path.html">sort_at_path</a></span><span class="op">(</span><span class="va">pruned</span>, path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"RACE"</span>, <span class="st">"ASIAN"</span>, <span class="st">"STRATA1"</span><span class="op">)</span>, scorefun <span class="op">=</span> <span class="va">cont_n_allcols</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#                                    A: Drug X                B: Placebo              C: Combination     </span></span>
<span><span class="co">#                                 F            M            F            M            F            M     </span></span>
<span><span class="co"># ———————————————————————————————————————————————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># ASIAN                       44 (62.9%)   35 (68.6%)   37 (66.1%)   31 (62.0%)   40 (65.6%)   44 (64.7%)</span></span>
<span><span class="co">#   A                         15 (21.4%)   12 (23.5%)   14 (25.0%)   6 (12.0%)    15 (24.6%)   16 (23.5%)</span></span>
<span><span class="co">#     Mean                      30.40        34.42        35.43        30.33        37.40        36.25   </span></span>
<span><span class="co">#   C                         13 (18.6%)   15 (29.4%)   10 (17.9%)   9 (18.0%)    15 (24.6%)   16 (23.5%)</span></span>
<span><span class="co">#     Mean                      36.92        35.60        34.00        31.89        33.47        31.38   </span></span>
<span><span class="co">#   B                         16 (22.9%)   8 (15.7%)    13 (23.2%)   16 (32.0%)   10 (16.4%)   12 (17.6%)</span></span>
<span><span class="co">#     Mean                      33.75        34.88        32.46        30.94        33.30        35.92   </span></span>
<span><span class="co"># BLACK OR AFRICAN AMERICAN   18 (25.7%)   10 (19.6%)   12 (21.4%)   12 (24.0%)   13 (21.3%)   14 (20.6%)</span></span>
<span><span class="co">#   A                          5 (7.1%)     1 (2.0%)     5 (8.9%)     2 (4.0%)     4 (6.6%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      31.20        33.00        28.00        30.00        30.75        36.50   </span></span>
<span><span class="co">#   B                         7 (10.0%)     3 (5.9%)     3 (5.4%)     3 (6.0%)     6 (9.8%)     6 (8.8%) </span></span>
<span><span class="co">#     Mean                      36.14        34.33        29.67        32.00        36.33        31.00   </span></span>
<span><span class="co">#   C                          6 (8.6%)    6 (11.8%)     4 (7.1%)    7 (14.0%)     3 (4.9%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      31.33        39.67        34.50        34.00        33.00        36.50   </span></span>
<span><span class="co"># WHITE                       8 (11.4%)    6 (11.8%)    7 (12.5%)    7 (14.0%)    8 (13.1%)    10 (14.7%)</span></span>
<span><span class="co">#   A                          2 (2.9%)     1 (2.0%)     3 (5.4%)     3 (6.0%)     1 (1.6%)     5 (7.4%) </span></span>
<span><span class="co">#     Mean                      34.00        45.00        29.33        33.33        35.00        32.80   </span></span>
<span><span class="co">#   B                          4 (5.7%)     3 (5.9%)     1 (1.8%)     4 (8.0%)     3 (4.9%)     1 (1.5%) </span></span>
<span><span class="co">#     Mean                      37.00        43.67        48.00        36.75        34.33        36.00   </span></span>
<span><span class="co">#   C                          2 (2.9%)     2 (3.9%)     3 (5.4%)     0 (0.0%)     4 (6.6%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      35.50        44.00        44.67          NA         38.50        35.00</span></span></code></pre>
<p>Sort the ethnicities by observations, increasing</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ethsort</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sort_at_path.html">sort_at_path</a></span><span class="op">(</span><span class="va">pruned</span>, path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"RACE"</span><span class="op">)</span>, scorefun <span class="op">=</span> <span class="va">cont_n_allcols</span>, decreasing <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">ethsort</span></span></code></pre></div>
<pre><code><span><span class="co">#                                    A: Drug X                B: Placebo              C: Combination     </span></span>
<span><span class="co">#                                 F            M            F            M            F            M     </span></span>
<span><span class="co"># ———————————————————————————————————————————————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># WHITE                       8 (11.4%)    6 (11.8%)    7 (12.5%)    7 (14.0%)    8 (13.1%)    10 (14.7%)</span></span>
<span><span class="co">#   A                          2 (2.9%)     1 (2.0%)     3 (5.4%)     3 (6.0%)     1 (1.6%)     5 (7.4%) </span></span>
<span><span class="co">#     Mean                      34.00        45.00        29.33        33.33        35.00        32.80   </span></span>
<span><span class="co">#   B                          4 (5.7%)     3 (5.9%)     1 (1.8%)     4 (8.0%)     3 (4.9%)     1 (1.5%) </span></span>
<span><span class="co">#     Mean                      37.00        43.67        48.00        36.75        34.33        36.00   </span></span>
<span><span class="co">#   C                          2 (2.9%)     2 (3.9%)     3 (5.4%)     0 (0.0%)     4 (6.6%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      35.50        44.00        44.67          NA         38.50        35.00   </span></span>
<span><span class="co"># BLACK OR AFRICAN AMERICAN   18 (25.7%)   10 (19.6%)   12 (21.4%)   12 (24.0%)   13 (21.3%)   14 (20.6%)</span></span>
<span><span class="co">#   A                          5 (7.1%)     1 (2.0%)     5 (8.9%)     2 (4.0%)     4 (6.6%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      31.20        33.00        28.00        30.00        30.75        36.50   </span></span>
<span><span class="co">#   B                         7 (10.0%)     3 (5.9%)     3 (5.4%)     3 (6.0%)     6 (9.8%)     6 (8.8%) </span></span>
<span><span class="co">#     Mean                      36.14        34.33        29.67        32.00        36.33        31.00   </span></span>
<span><span class="co">#   C                          6 (8.6%)    6 (11.8%)     4 (7.1%)    7 (14.0%)     3 (4.9%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      31.33        39.67        34.50        34.00        33.00        36.50   </span></span>
<span><span class="co"># ASIAN                       44 (62.9%)   35 (68.6%)   37 (66.1%)   31 (62.0%)   40 (65.6%)   44 (64.7%)</span></span>
<span><span class="co">#   A                         15 (21.4%)   12 (23.5%)   14 (25.0%)   6 (12.0%)    15 (24.6%)   16 (23.5%)</span></span>
<span><span class="co">#     Mean                      30.40        34.42        35.43        30.33        37.40        36.25   </span></span>
<span><span class="co">#   B                         16 (22.9%)   8 (15.7%)    13 (23.2%)   16 (32.0%)   10 (16.4%)   12 (17.6%)</span></span>
<span><span class="co">#     Mean                      33.75        34.88        32.46        30.94        33.30        35.92   </span></span>
<span><span class="co">#   C                         13 (18.6%)   15 (29.4%)   10 (17.9%)   9 (18.0%)    15 (24.6%)   16 (23.5%)</span></span>
<span><span class="co">#     Mean                      36.92        35.60        34.00        31.89        33.47        31.38</span></span></code></pre>
<p>Within each ethnicity separately, sort the strata by number of
females in arm c (ie column position <code>5</code>)</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/sort_at_path.html">sort_at_path</a></span><span class="op">(</span><span class="va">pruned</span>, path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"RACE"</span>, <span class="st">"*"</span>, <span class="st">"STRATA1"</span><span class="op">)</span>, <span class="fu"><a href="../reference/score_funs.html">cont_n_onecol</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#                                    A: Drug X                B: Placebo              C: Combination     </span></span>
<span><span class="co">#                                 F            M            F            M            F            M     </span></span>
<span><span class="co"># ———————————————————————————————————————————————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># ASIAN                       44 (62.9%)   35 (68.6%)   37 (66.1%)   31 (62.0%)   40 (65.6%)   44 (64.7%)</span></span>
<span><span class="co">#   A                         15 (21.4%)   12 (23.5%)   14 (25.0%)   6 (12.0%)    15 (24.6%)   16 (23.5%)</span></span>
<span><span class="co">#     Mean                      30.40        34.42        35.43        30.33        37.40        36.25   </span></span>
<span><span class="co">#   C                         13 (18.6%)   15 (29.4%)   10 (17.9%)   9 (18.0%)    15 (24.6%)   16 (23.5%)</span></span>
<span><span class="co">#     Mean                      36.92        35.60        34.00        31.89        33.47        31.38   </span></span>
<span><span class="co">#   B                         16 (22.9%)   8 (15.7%)    13 (23.2%)   16 (32.0%)   10 (16.4%)   12 (17.6%)</span></span>
<span><span class="co">#     Mean                      33.75        34.88        32.46        30.94        33.30        35.92   </span></span>
<span><span class="co"># BLACK OR AFRICAN AMERICAN   18 (25.7%)   10 (19.6%)   12 (21.4%)   12 (24.0%)   13 (21.3%)   14 (20.6%)</span></span>
<span><span class="co">#   B                         7 (10.0%)     3 (5.9%)     3 (5.4%)     3 (6.0%)     6 (9.8%)     6 (8.8%) </span></span>
<span><span class="co">#     Mean                      36.14        34.33        29.67        32.00        36.33        31.00   </span></span>
<span><span class="co">#   A                          5 (7.1%)     1 (2.0%)     5 (8.9%)     2 (4.0%)     4 (6.6%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      31.20        33.00        28.00        30.00        30.75        36.50   </span></span>
<span><span class="co">#   C                          6 (8.6%)    6 (11.8%)     4 (7.1%)    7 (14.0%)     3 (4.9%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      31.33        39.67        34.50        34.00        33.00        36.50   </span></span>
<span><span class="co"># WHITE                       8 (11.4%)    6 (11.8%)    7 (12.5%)    7 (14.0%)    8 (13.1%)    10 (14.7%)</span></span>
<span><span class="co">#   C                          2 (2.9%)     2 (3.9%)     3 (5.4%)     0 (0.0%)     4 (6.6%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      35.50        44.00        44.67          NA         38.50        35.00   </span></span>
<span><span class="co">#   B                          4 (5.7%)     3 (5.9%)     1 (1.8%)     4 (8.0%)     3 (4.9%)     1 (1.5%) </span></span>
<span><span class="co">#     Mean                      37.00        43.67        48.00        36.75        34.33        36.00   </span></span>
<span><span class="co">#   A                          2 (2.9%)     1 (2.0%)     3 (5.4%)     3 (6.0%)     1 (1.6%)     5 (7.4%) </span></span>
<span><span class="co">#     Mean                      34.00        45.00        29.33        33.33        35.00        32.80</span></span></code></pre>
<div class="section level4">
<h4 id="sorting-within-an-analysis-subtable">Sorting Within an Analysis Subtable<a class="anchor" aria-label="anchor" href="#sorting-within-an-analysis-subtable"></a>
</h4>
<p>When sorting within an analysis subtable (e.g., the subtable
generated when your analysis function generates more than one row per
group of data), the name of that subtable (generally the name of the
variable being analyzed) must appear in the path, <em><strong>even if
the variable label is not displayed when the table is
printed</strong></em></p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">silly_afun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/in_rows.html">in_rows</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fu"><a href="../reference/rcell.html">rcell</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>            b <span class="op">=</span> <span class="fu"><a href="../reference/rcell.html">rcell</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span>,</span>
<span>            c <span class="op">=</span> <span class="fu"><a href="../reference/rcell.html">rcell</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="va">sillytbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_table.html">basic_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/split_rows_by.html">split_rows_by</a></span><span class="op">(</span><span class="st">"cyl"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"mpg"</span>, <span class="va">silly_afun</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co"># Split var [cyl] was not character or factor. Converting to factor</span></span></code></pre>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sillytbl</span></span></code></pre></div>
<pre><code><span><span class="co">#       all obs</span></span>
<span><span class="co"># —————————————</span></span>
<span><span class="co"># 6            </span></span>
<span><span class="co">#   a      2   </span></span>
<span><span class="co">#   b      3   </span></span>
<span><span class="co">#   c      1   </span></span>
<span><span class="co"># 4            </span></span>
<span><span class="co">#   a      2   </span></span>
<span><span class="co">#   b      3   </span></span>
<span><span class="co">#   c      1   </span></span>
<span><span class="co"># 8            </span></span>
<span><span class="co">#   a      2   </span></span>
<span><span class="co">#   b      3   </span></span>
<span><span class="co">#   c      1</span></span></code></pre>
<p>The path required to sort the rows inside our “analysis” of
<code>mpg</code>, then is <code>c("cyl", "*", "mpg")</code>:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">scorefun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tt</span><span class="op">)</span> <span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="../reference/row_accessors.html">row_values</a></span><span class="op">(</span><span class="va">tt</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">}</span></span>
<span><span class="fu"><a href="../reference/sort_at_path.html">sort_at_path</a></span><span class="op">(</span><span class="va">sillytbl</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cyl"</span>, <span class="st">"*"</span>, <span class="st">"mpg"</span><span class="op">)</span>, <span class="va">scorefun</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#       all obs</span></span>
<span><span class="co"># —————————————</span></span>
<span><span class="co"># 6            </span></span>
<span><span class="co">#   b      3   </span></span>
<span><span class="co">#   a      2   </span></span>
<span><span class="co">#   c      1   </span></span>
<span><span class="co"># 4            </span></span>
<span><span class="co">#   b      3   </span></span>
<span><span class="co">#   a      2   </span></span>
<span><span class="co">#   c      1   </span></span>
<span><span class="co"># 8            </span></span>
<span><span class="co">#   b      3   </span></span>
<span><span class="co">#   a      2   </span></span>
<span><span class="co">#   c      1</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="writing-custom-pruning-criteria-and-scoring-functions">Writing Custom Pruning Criteria and Scoring Functions<a class="anchor" aria-label="anchor" href="#writing-custom-pruning-criteria-and-scoring-functions"></a>
</h2>
<p>Pruning criteria and scoring functions map TableTree or TableRow
objects to a boolean value (for pruning criteria) or a sortable scalar
value (scoring functions). To do this we currently need to interact with
the structure of the objects in more than usual.</p>
<div class="section level3">
<h3 id="useful-functions-and-accessors">Useful Functions and Accessors<a class="anchor" aria-label="anchor" href="#useful-functions-and-accessors"></a>
</h3>
<p><code>content_table</code> Retrieves a <code>TableTree</code>
object’s content table (which contains its summary rows).</p>
<p><code>tree_children</code> Retrieves a <code>TableTree</code>
object’s children (either subtables, rows or possibly a mix thereof,
though that should not happen in practice)</p>
<p><code>row_values</code> Retrieves a <code>TableRow</code> object’s
values in the form of a list of length <code>ncol(tt)</code></p>
<p><code>vapply(row_values(tt), '[[', i=1, numeric(1))</code> will
retrieve the first element from each cell provided <code>tt</code> is a
TableRow (and the first element is a numeric value).</p>
<p><code>obj_name</code> Retrieves the name of an object. Note this can
differ from the label that is displayed (if any is) when printing. This
will match the element in the path.</p>
<p><code>obj_label</code> Retrieves the display label of an object. Note
this can differ from the name that appears in the path.</p>
</div>
<div class="section level3">
<h3 id="example-custom-scoring-functions">Example Custom Scoring Functions<a class="anchor" aria-label="anchor" href="#example-custom-scoring-functions"></a>
</h3>
<div class="section level4">
<h4 id="sort-by-a-character-score">Sort by a character “score”<a class="anchor" aria-label="anchor" href="#sort-by-a-character-score"></a>
</h4>
<p>In this case, for convenience/simplicity, we use the name of the
table element but any logic which returns a single string could be used
here.</p>
<p>We sort the ethnicities by alphabetical order (in practice undoing
our previous sorting by ethnicity above).</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">silly_name_scorer</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tt</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">nm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/formatters/man/lab_name.html" class="external-link">obj_name</a></span><span class="op">(</span><span class="va">tt</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">nm</span><span class="op">)</span></span>
<span>    <span class="va">nm</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="../reference/sort_at_path.html">sort_at_path</a></span><span class="op">(</span><span class="va">ethsort</span>, <span class="st">"RACE"</span>, <span class="va">silly_name_scorer</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co"># [1] "WHITE"</span></span>
<span><span class="co"># [1] "BLACK OR AFRICAN AMERICAN"</span></span>
<span><span class="co"># [1] "ASIAN"</span></span></code></pre>
<pre><code><span><span class="co">#                                    A: Drug X                B: Placebo              C: Combination     </span></span>
<span><span class="co">#                                 F            M            F            M            F            M     </span></span>
<span><span class="co"># ———————————————————————————————————————————————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># ASIAN                       44 (62.9%)   35 (68.6%)   37 (66.1%)   31 (62.0%)   40 (65.6%)   44 (64.7%)</span></span>
<span><span class="co">#   A                         15 (21.4%)   12 (23.5%)   14 (25.0%)   6 (12.0%)    15 (24.6%)   16 (23.5%)</span></span>
<span><span class="co">#     Mean                      30.40        34.42        35.43        30.33        37.40        36.25   </span></span>
<span><span class="co">#   B                         16 (22.9%)   8 (15.7%)    13 (23.2%)   16 (32.0%)   10 (16.4%)   12 (17.6%)</span></span>
<span><span class="co">#     Mean                      33.75        34.88        32.46        30.94        33.30        35.92   </span></span>
<span><span class="co">#   C                         13 (18.6%)   15 (29.4%)   10 (17.9%)   9 (18.0%)    15 (24.6%)   16 (23.5%)</span></span>
<span><span class="co">#     Mean                      36.92        35.60        34.00        31.89        33.47        31.38   </span></span>
<span><span class="co"># BLACK OR AFRICAN AMERICAN   18 (25.7%)   10 (19.6%)   12 (21.4%)   12 (24.0%)   13 (21.3%)   14 (20.6%)</span></span>
<span><span class="co">#   A                          5 (7.1%)     1 (2.0%)     5 (8.9%)     2 (4.0%)     4 (6.6%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      31.20        33.00        28.00        30.00        30.75        36.50   </span></span>
<span><span class="co">#   B                         7 (10.0%)     3 (5.9%)     3 (5.4%)     3 (6.0%)     6 (9.8%)     6 (8.8%) </span></span>
<span><span class="co">#     Mean                      36.14        34.33        29.67        32.00        36.33        31.00   </span></span>
<span><span class="co">#   C                          6 (8.6%)    6 (11.8%)     4 (7.1%)    7 (14.0%)     3 (4.9%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      31.33        39.67        34.50        34.00        33.00        36.50   </span></span>
<span><span class="co"># WHITE                       8 (11.4%)    6 (11.8%)    7 (12.5%)    7 (14.0%)    8 (13.1%)    10 (14.7%)</span></span>
<span><span class="co">#   A                          2 (2.9%)     1 (2.0%)     3 (5.4%)     3 (6.0%)     1 (1.6%)     5 (7.4%) </span></span>
<span><span class="co">#     Mean                      34.00        45.00        29.33        33.33        35.00        32.80   </span></span>
<span><span class="co">#   B                          4 (5.7%)     3 (5.9%)     1 (1.8%)     4 (8.0%)     3 (4.9%)     1 (1.5%) </span></span>
<span><span class="co">#     Mean                      37.00        43.67        48.00        36.75        34.33        36.00   </span></span>
<span><span class="co">#   C                          2 (2.9%)     2 (3.9%)     3 (5.4%)     0 (0.0%)     4 (6.6%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      35.50        44.00        44.67          NA         38.50        35.00</span></span></code></pre>
<p><strong>NOTE</strong> generally this would be more appropriately done
using the reorder_split_levels function within the layout rather than as
a sort postprocessing step, but other character scorers may or may not
not map as easily to layouting directives.</p>
</div>
<div class="section level4">
<h4 id="sort-by-the-percent-difference-in-counts-between-genders-in-arm-c">Sort by the Percent Difference in counts between genders in Arm
C<a class="anchor" aria-label="anchor" href="#sort-by-the-percent-difference-in-counts-between-genders-in-arm-c"></a>
</h4>
<p>We need the F and M percents, only for Arm C (ie columns 5 and 6),
differenced.</p>
<p>We will sort <em><strong>the strata within each
ethnicity</strong></em> by the percent difference in counts between
males and females in arm C. This is not statistically meaningful at all,
and is fact a terrible idea because it reorders the strata seemingly
(but not) at random within each race, but illustrates the various things
we need to do inside custom sorting functions.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">silly_gender_diffcount</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tt</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">ctable</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/content_table.html">content_table</a></span><span class="op">(</span><span class="va">tt</span><span class="op">)</span> <span class="co">## get summary table at this location</span></span>
<span>    <span class="va">crow</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tree_children.html">tree_children</a></span><span class="op">(</span><span class="va">ctable</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="co">## get first row in summary table</span></span>
<span>    <span class="va">vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/row_accessors.html">row_values</a></span><span class="op">(</span><span class="va">crow</span><span class="op">)</span></span>
<span>    <span class="co">## we need to have a better api for specificying location in column space but currently we don't</span></span>
<span>    <span class="va">mcount</span> <span class="op">&lt;-</span> <span class="va">vals</span><span class="op">[[</span><span class="fl">6</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">fcount</span> <span class="op">&lt;-</span> <span class="va">vals</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="op">(</span><span class="va">mcount</span> <span class="op">-</span> <span class="va">fcount</span><span class="op">)</span> <span class="op">/</span> <span class="va">fcount</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="../reference/sort_at_path.html">sort_at_path</a></span><span class="op">(</span><span class="va">pruned</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"RACE"</span>, <span class="st">"*"</span>, <span class="st">"STRATA1"</span><span class="op">)</span>, <span class="va">silly_gender_diffcount</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#                                    A: Drug X                B: Placebo              C: Combination     </span></span>
<span><span class="co">#                                 F            M            F            M            F            M     </span></span>
<span><span class="co"># ———————————————————————————————————————————————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># ASIAN                       44 (62.9%)   35 (68.6%)   37 (66.1%)   31 (62.0%)   40 (65.6%)   44 (64.7%)</span></span>
<span><span class="co">#   B                         16 (22.9%)   8 (15.7%)    13 (23.2%)   16 (32.0%)   10 (16.4%)   12 (17.6%)</span></span>
<span><span class="co">#     Mean                      33.75        34.88        32.46        30.94        33.30        35.92   </span></span>
<span><span class="co">#   A                         15 (21.4%)   12 (23.5%)   14 (25.0%)   6 (12.0%)    15 (24.6%)   16 (23.5%)</span></span>
<span><span class="co">#     Mean                      30.40        34.42        35.43        30.33        37.40        36.25   </span></span>
<span><span class="co">#   C                         13 (18.6%)   15 (29.4%)   10 (17.9%)   9 (18.0%)    15 (24.6%)   16 (23.5%)</span></span>
<span><span class="co">#     Mean                      36.92        35.60        34.00        31.89        33.47        31.38   </span></span>
<span><span class="co"># BLACK OR AFRICAN AMERICAN   18 (25.7%)   10 (19.6%)   12 (21.4%)   12 (24.0%)   13 (21.3%)   14 (20.6%)</span></span>
<span><span class="co">#   C                          6 (8.6%)    6 (11.8%)     4 (7.1%)    7 (14.0%)     3 (4.9%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      31.33        39.67        34.50        34.00        33.00        36.50   </span></span>
<span><span class="co">#   A                          5 (7.1%)     1 (2.0%)     5 (8.9%)     2 (4.0%)     4 (6.6%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      31.20        33.00        28.00        30.00        30.75        36.50   </span></span>
<span><span class="co">#   B                         7 (10.0%)     3 (5.9%)     3 (5.4%)     3 (6.0%)     6 (9.8%)     6 (8.8%) </span></span>
<span><span class="co">#     Mean                      36.14        34.33        29.67        32.00        36.33        31.00   </span></span>
<span><span class="co"># WHITE                       8 (11.4%)    6 (11.8%)    7 (12.5%)    7 (14.0%)    8 (13.1%)    10 (14.7%)</span></span>
<span><span class="co">#   A                          2 (2.9%)     1 (2.0%)     3 (5.4%)     3 (6.0%)     1 (1.6%)     5 (7.4%) </span></span>
<span><span class="co">#     Mean                      34.00        45.00        29.33        33.33        35.00        32.80   </span></span>
<span><span class="co">#   C                          2 (2.9%)     2 (3.9%)     3 (5.4%)     0 (0.0%)     4 (6.6%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      35.50        44.00        44.67          NA         38.50        35.00   </span></span>
<span><span class="co">#   B                          4 (5.7%)     3 (5.9%)     1 (1.8%)     4 (8.0%)     3 (4.9%)     1 (1.5%) </span></span>
<span><span class="co">#     Mean                      37.00        43.67        48.00        36.75        34.33        36.00</span></span></code></pre>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Gabriel Becker, Adrian Waddell.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
