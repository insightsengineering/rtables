<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Split functions — remove_split_levels • rtables</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Split functions — remove_split_levels"><meta property="og:description" content="Split functions"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rtables</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.5.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/baseline.html">Comparing Against Baselines or Control</a>
    </li>
    <li>
      <a href="../articles/clinical_trials.html">Example Clinical Trials Tables</a>
    </li>
    <li>
      <a href="../articles/introduction.html">Introduction to rtables</a>
    </li>
    <li>
      <a href="../articles/manual_table_construction.html">Constructing rtables Manually</a>
    </li>
    <li>
      <a href="../articles/sorting_pruning.html">Pruning and Sorting Tables</a>
    </li>
    <li>
      <a href="../articles/subsetting_tables.html">Subsetting Tables</a>
    </li>
    <li>
      <a href="../articles/tabulation_concepts.html">Tabulation Concepts</a>
    </li>
    <li>
      <a href="../articles/tabulation_dplyr.html">Comparison with dplyr Tabulation</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/roche/rtables/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Split functions</h1>
    <small class="dont-index">Source: <a href="https://github.com/roche/rtables/blob/HEAD/R/split_funs.R" class="external-link"><code>R/split_funs.R</code></a></small>
    <div class="hidden name"><code>split_funcs.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Split functions</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">remove_split_levels</span><span class="op">(</span><span class="va">excl</span><span class="op">)</span>

<span class="fu">keep_split_levels</span><span class="op">(</span><span class="va">only</span>, reorder <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="fu">drop_split_levels</span><span class="op">(</span><span class="va">df</span>, <span class="va">spl</span>, vals <span class="op">=</span> <span class="cn">NULL</span>, labels <span class="op">=</span> <span class="cn">NULL</span>, trim <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="fu">drop_and_remove_levels</span><span class="op">(</span><span class="va">excl</span><span class="op">)</span>

<span class="fu">reorder_split_levels</span><span class="op">(</span><span class="va">neworder</span>, newlabels <span class="op">=</span> <span class="va">neworder</span>, drlevels <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="fu">trim_levels_in_group</span><span class="op">(</span><span class="va">innervar</span>, drop_outlevs <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>excl</dt>
<dd><p>character. Levels to be excluded (they will not be reflected in the resulting table structure regardless
of presence in the data).</p></dd>
<dt>only</dt>
<dd><p>character. Levels to retain (all others will be dropped).</p></dd>
<dt>reorder</dt>
<dd><p>logical(1). Should the order of <code>only</code> be used as the order of the children of the split. defaults to <code>TRUE</code></p></dd>
<dt>df</dt>
<dd><p>dataset (data.frame or tibble)</p></dd>
<dt>spl</dt>
<dd><p>A Split object defining a partitioning or analysis/tabulation of the data.</p></dd>
<dt>vals</dt>
<dd><p>ANY. For internal use only.</p></dd>
<dt>labels</dt>
<dd><p>character. Labels to use for the remaining levels instead of the existing ones.</p></dd>
<dt>trim</dt>
<dd><p>logical(1). Should splits corresponding with 0 observations be kept when tabulating.</p></dd>
<dt>neworder</dt>
<dd><p>character. New order or factor levels.</p></dd>
<dt>newlabels</dt>
<dd><p>character. Labels for (new order of) factor levels</p></dd>
<dt>drlevels</dt>
<dd><p>logical(1). Should levels in the data which do not appear in <code>neworder</code> be dropped. Defaults to <code>TRUE</code></p></dd>
<dt>innervar</dt>
<dd><p>character(1). Variable whose factor levels should be trimmed (e.g., empty levels dropped) <em>separately within each grouping defined at this point in the structure</em></p></dd>
<dt>drop_outlevs</dt>
<dd><p>logical(1). Should empty levels in the variable being split on (ie the 'outer' variable, not <code>innervar</code>)
be dropped? Defaults to <code>TRUE</code></p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>a closure suitable for use as a splitting function (<code>splfun</code>) when creating a table layout</p>
    </div>
    <div id="custom-splitting-function-details">
    <h2>Custom Splitting Function Details</h2>
    


<p>User-defined custom split functions can perform any type of computation
on the incoming data provided that they meed the contract for generating
'splits' of the incoming data 'based on' the split object.</p>
<p>Split functions are functions that accept:</p><dl><dt>df</dt>
<dd><p>data.frame of incoming data to be split</p></dd>

<dt>spl</dt>
<dd><p>a Split object. this is largely an internal detail custom functions will not need to worry about,
but  <code>obj_name(spl)</code>, for example, will give the name of the split as it will appear in paths in the resulting table</p></dd>

<dt>vals</dt>
<dd><p>Any pre-calculated values. If given non-null values, the values returned should match these. Should be NULL in most cases and can likely be ignored</p></dd>

<dt>labels</dt>
<dd><p>Any pre-calculated value labels. Same as above for <code>values</code></p></dd>

<dt>trim</dt>
<dd><p>If <code>TRUE</code>, resulting splits that are empty should be removed</p></dd>

<dt>(Optional) .spl_context</dt>
<dd><p>a data.frame describing previously performed splits which collectively arrived at <code>df</code></p></dd>


</dl><p>The function must then output a <code>named list</code> with the following elements:</p>
<dl><dt>values</dt>
<dd><p>The vector of all values corresponding to the splits of <code>df</code></p></dd>

<dt>datasplit</dt>
<dd><p>a list of data.frames representing the groupings of the actual observations from <code>df</code>.</p></dd>

<dt>labels</dt>
<dd><p>a character vector giving a string label for each value listed in the <code>values</code> element above</p></dd>

<dt>(Optional) extras</dt>
<dd><p>If present, extra arguments to be passed to summary and analysis functions
whenever they are executed on the corresponding element of <code>datasplit</code> or a subset thereof</p></dd>


</dl><p>One way to generate custom splitting functions is to wrap existing split functions and modify either
the incoming data before they are called, or their outputs.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="va">l</span> <span class="op">&lt;-</span> <span class="fu"><a href="basic_table.html">basic_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span class="r-in">  <span class="fu"><a href="split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"ARM"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span class="r-in">  <span class="fu"><a href="split_rows_by.html">split_rows_by</a></span><span class="op">(</span><span class="st">"COUNTRY"</span>, split_fun <span class="op">=</span> <span class="fu">remove_split_levels</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"USA"</span>, <span class="st">"CAN"</span>, <span class="st">"CHE"</span>, <span class="st">"BRA"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span class="r-in">  <span class="fu"><a href="analyze.html">analyze</a></span><span class="op">(</span><span class="st">"AGE"</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="fu"><a href="build_table.html">build_table</a></span><span class="op">(</span><span class="va">l</span>, <span class="va">DM</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          A: Drug X   B: Placebo   C: Combination</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ————————————————————————————————————————————————</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> CHN                                             </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Mean     36.08       34.12          33.71     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PAK                                             </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Mean     35.38       33.12          36.75     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NGA                                             </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Mean     31.20       31.40          35.78     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> RUS                                             </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Mean     33.33       34.20          33.00     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> JPN                                             </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Mean     31.20       32.50          36.20     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> GBR                                             </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Mean     32.00       29.00          30.00     </span>
<span class="r-in"></span>
<span class="r-in"><span class="va">l</span> <span class="op">&lt;-</span> <span class="fu"><a href="basic_table.html">basic_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span class="r-in">  <span class="fu"><a href="split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"ARM"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span class="r-in">  <span class="fu"><a href="split_rows_by.html">split_rows_by</a></span><span class="op">(</span><span class="st">"COUNTRY"</span>, split_fun <span class="op">=</span> <span class="fu">keep_split_levels</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"USA"</span>, <span class="st">"CAN"</span>, <span class="st">"BRA"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span class="r-in">  <span class="fu"><a href="analyze.html">analyze</a></span><span class="op">(</span><span class="st">"AGE"</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="fu"><a href="build_table.html">build_table</a></span><span class="op">(</span><span class="va">l</span>, <span class="va">DM</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          A: Drug X   B: Placebo   C: Combination</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ————————————————————————————————————————————————</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> USA                                             </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Mean     36.77       32.57          36.41     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> CAN                                             </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Mean     36.00       34.00          29.50     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> BRA                                             </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Mean     31.78       30.62          36.14     </span>
<span class="r-in"><span class="va">l</span> <span class="op">&lt;-</span> <span class="fu"><a href="basic_table.html">basic_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span class="r-in">  <span class="fu"><a href="split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"ARM"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span class="r-in">  <span class="fu"><a href="split_rows_by.html">split_rows_by</a></span><span class="op">(</span><span class="st">"SEX"</span>, split_fun <span class="op">=</span> <span class="va">drop_split_levels</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span class="r-in">  <span class="fu"><a href="analyze.html">analyze</a></span><span class="op">(</span><span class="st">"AGE"</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="fu"><a href="build_table.html">build_table</a></span><span class="op">(</span><span class="va">l</span>, <span class="va">DM</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          A: Drug X   B: Placebo   C: Combination</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ————————————————————————————————————————————————</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> F                                               </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Mean     33.71       33.84          34.89     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> M                                               </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Mean     36.55       32.10          34.28     </span>
<span class="r-in"><span class="va">l</span> <span class="op">&lt;-</span> <span class="fu"><a href="basic_table.html">basic_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span class="r-in">  <span class="fu"><a href="split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"ARM"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span class="r-in">  <span class="fu"><a href="split_rows_by.html">split_rows_by</a></span><span class="op">(</span><span class="st">"SEX"</span>, split_fun <span class="op">=</span> <span class="fu">drop_and_remove_levels</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"M"</span>, <span class="st">"U"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span class="r-in">  <span class="fu"><a href="analyze.html">analyze</a></span><span class="op">(</span><span class="st">"AGE"</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="fu"><a href="build_table.html">build_table</a></span><span class="op">(</span><span class="va">l</span>, <span class="va">DM</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          A: Drug X   B: Placebo   C: Combination</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ————————————————————————————————————————————————</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> F                                               </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Mean     33.71       33.84          34.89     </span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Gabriel Becker, Adrian Waddell.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer></div>

  


  

  </body></html>

