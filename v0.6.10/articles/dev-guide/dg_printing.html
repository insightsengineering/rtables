<!DOCTYPE html>
<!-- Generated by pkgdown + https://github.com/insightsengineering/r-pkgdown-multiversion -->
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Printing Machinery • rtables</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../../deps/headroom-0.11.0/headroom.min.js"></script><script src="../../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../../deps/search-1.0.0/fuse.min.js"></script><script src="../../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><meta property="og:title" content="Printing Machinery">
<link rel="stylesheet" href="../../consent.css">
<script src="../../consent.js" type="text/javascript" charset="utf-8"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../../index.html">rtables</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6.10</small>

    <div style="width: 140px; margin-left: 0.5rem;"> <small class="nav-text text-muted me-auto">part of</small> <img src="https://github.com/insightsengineering/hex-stickers/blob/main/PNG/nest.png?raw=true" alt="NEST" style="height: 30px;"><a href="https://pharmaverse.org/" class="external-link"><img src="https://github.com/insightsengineering/hex-stickers/blob/main/PNG/pharmaverse.png?raw=true" alt="pharmaverse" style="height: 28px;"></a> </div>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../../articles/rtables.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Getting Started</h6></li>
    <li><a class="dropdown-item" href="../../articles/exploratory_analysis.html">Exploratory Analysis</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Clinical Trials</h6></li>
    <li><a class="dropdown-item" href="../../articles/clinical_trials.html">Example Clinical Trials Tables</a></li>
    <li><a class="dropdown-item" href="../../articles/baseline.html">Comparing Against Baselines or Control</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Table Customization</h6></li>
    <li><a class="dropdown-item" href="../../articles/custom_appearance.html">Customizing Appearance</a></li>
    <li><a class="dropdown-item" href="../../articles/title_footer.html">Titles, Footers, and Referential Footnotes</a></li>
    <li><a class="dropdown-item" href="../../articles/sorting_pruning.html">Pruning and Sorting Tables</a></li>
    <li><a class="dropdown-item" href="../../articles/col_counts.html">Column Counts and Formats</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../../articles/index.html">More articles...</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-developer-guide" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Developer Guide</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-developer-guide">
<li><a class="dropdown-item" href="../../articles/dev-guide/dg_split_machinery.html">Split Machinery</a></li>
    <li><a class="dropdown-item" href="../../articles/dev-guide/dg_tabulation.html">Tabulation</a></li>
    <li><a class="dropdown-item" href="../../articles/dev-guide/dg_table_hierarchy.html">Table Hierarchy</a></li>
    <li><a class="dropdown-item" href="../../articles/dev-guide/dg_debug_rtables.html">Debugging in {rtables} and Beyond</a></li>
    <li><a class="dropdown-item" href="../../articles/dev-guide/dg_notes.html">Sparse Notes on {rtables} Internals</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../../news/index.html">Changelog</a></li>
<li class="nav-item dropdown">

  <button class="nav-link dropdown-toggle" type="button" id="dropdown-reports" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Reports</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-reports">
<li><a class="dropdown-item" href="../../coverage-report/">Coverage report</a></li>
    <li><a class="dropdown-item" href="../../unit-test-report/">Unit test report</a></li>
    <li><a class="dropdown-item" href="../../unit-test-report-non-cran/">Non-CRAN unit test report</a></li>
  </ul>
</li>
      <li class="nav-item dropdown">
    <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-versions">Versions</a>
    <div class="dropdown-menu" aria-labelledby="dropdown-versions">
    <a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/release-candidate">release-candidate</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/main">main</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/latest-release">latest-release</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.12-rc2">v0.6.12-rc2</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.12-rc1">v0.6.12-rc1</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.11">v0.6.11</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.10">v0.6.10</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.9">v0.6.9</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.8">v0.6.8</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.7">v0.6.7</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.6">v0.6.6</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.6-rc1">v0.6.6-rc1</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.5">v0.6.5</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.4">v0.6.4</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.3">v0.6.3</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.2">v0.6.2</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.1">v0.6.1</a>
</div>
</li>
</ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/insightsengineering/rtables"><span class="fa fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../../logo.png" class="logo" alt=""><h1>Printing Machinery</h1>
                        <h4 data-toc-skip class="author">Davide
Garolini</h4>

            <h4 data-toc-skip class="date">2024-09-23</h4>

      <small class="dont-index">Source: <a href="https://github.com/insightsengineering/rtables/blob/main/vignettes/dev-guide/dg_printing.Rmd" class="external-link"><code>vignettes/dev-guide/dg_printing.Rmd</code></a></small>
      <div class="d-none name"><code>dg_printing.Rmd</code></div>
    </div>



<div class="section level2">
<h2 id="disclaimer">Disclaimer<a class="anchor" aria-label="anchor" href="#disclaimer"></a>
</h2>
<p>In comparison to other entries of the developer guide, this is
intended to keep track of the general concepts and processing pipeline
behind the printing machinery. It is not intended to be a complete
documentation of the machinery itself, but rather a collection of notes
that can be used to understand the machinery and its internals. Hence,
be aware that this is a working document that captures a snapshot of the
machinery at a certain point in time. It is not meant to be fully
maintained, but it can be used as a starting point for one. Compared to
other parts of the developer guide, this will contain the current state
of <code>rlistings</code>’ printing machinery, which is often a
simplified version of the machinery that is used in
<code>rtables</code>.</p>
<div class="section level3">
<h3 id="how-print-works">How <code>print</code> works<a class="anchor" aria-label="anchor" href="#how-print-works"></a>
</h3>
<p>Lets track down what is going under the hood when a standard table is
printed. The following is the code that is executed when a table is
printed:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/insightsengineering/rtables" class="external-link">rtables</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co"># Loading required package: formatters</span></span></code></pre>
<pre><code><span><span class="co"># </span></span>
<span><span class="co"># Attaching package: 'formatters'</span></span></code></pre>
<pre><code><span><span class="co"># The following object is masked from 'package:base':</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#     %||%</span></span></code></pre>
<pre><code><span><span class="co"># Loading required package: magrittr</span></span></code></pre>
<pre><code><span><span class="co"># </span></span>
<span><span class="co"># Attaching package: 'rtables'</span></span></code></pre>
<pre><code><span><span class="co"># The following object is masked from 'package:utils':</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#     str</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co"># </span></span>
<span><span class="co"># Attaching package: 'dplyr'</span></span></code></pre>
<pre><code><span><span class="co"># The following objects are masked from 'package:stats':</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#     filter, lag</span></span></code></pre>
<pre><code><span><span class="co"># The following objects are masked from 'package:base':</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#     intersect, setdiff, setequal, union</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lyt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/basic_table.html">basic_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/split_rows_by.html">split_rows_by</a></span><span class="op">(</span><span class="st">"SEX"</span>, split_fun <span class="op">=</span> <span class="fu"><a href="../../reference/split_funcs.html">keep_split_levels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"F"</span>, <span class="st">"M"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"ARM"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"BMRKR1"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co"># A Pre-data Table Layout</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Column-Split Structure:</span></span>
<span><span class="co"># ARM (lvls) </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Row-Split Structure:</span></span>
<span><span class="co"># SEX (lvls) -&gt; BMRKR1 (** analysis **)</span></span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">lyt</span>, <span class="va">ex_adsl</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#          A: Drug X   B: Placebo   C: Combination</span></span>
<span><span class="co"># ————————————————————————————————————————————————</span></span>
<span><span class="co"># F                                               </span></span>
<span><span class="co">#   Mean     5.75         5.59           5.68     </span></span>
<span><span class="co"># M                                               </span></span>
<span><span class="co">#   Mean     6.27         5.87           5.34</span></span></code></pre>
<p>We see that also a layout object (<code>PreDataTableLayouts</code>)
is created and printed. This is because <code>print</code> is a generic
function that dispatches to different methods depending on the class of
the object. In this case, the S4 class of the object is
<code>PreDataTableLayouts</code> and the method that is called is
<code>print</code>. In the case of {rtables} the method is dispatched
towards the <code>show</code> method of the class
<code>PreDataTableLayouts</code>. It can be found by searching
<code>A Pre-data Table Layout</code> into {rtables} source code. I think
R dispatcher for <code>print</code> methods looks for <code>show</code>
S4 methods instead if there are no S3 or S4 <code>print</code> methods
available. Indeed, this is the code that is executed:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span></span>
<span>  <span class="st">"show"</span>, <span class="st">"PreDataTableLayouts"</span>,</span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"A Pre-data Table Layout\n"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nColumn-Split Structure:\n"</span><span class="op">)</span></span>
<span>    <span class="fu">docat_predataxis</span><span class="op">(</span><span class="va">object</span><span class="op">@</span><span class="va">col_layout</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nRow-Split Structure:\n"</span><span class="op">)</span></span>
<span>    <span class="fu">docat_predataxis</span><span class="op">(</span><span class="va">object</span><span class="op">@</span><span class="va">row_layout</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This was evident if we searched for methods associated with the class
<code>PreDataTableLayouts</code>, where only <code>show</code> is
connected to a sort of printing machinery:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/methods.html" class="external-link">methods</a></span><span class="op">(</span>class <span class="op">=</span> <span class="st">"PreDataTableLayouts"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#  [1] .add_row_summary        clayout                 clayout&lt;-              </span></span>
<span><span class="co">#  [4] col_exprs               colcount_format         colcount_format&lt;-      </span></span>
<span><span class="co">#  [7] coltree                 header_section_div      header_section_div&lt;-   </span></span>
<span><span class="co"># [10] main_footer             main_footer&lt;-           main_title             </span></span>
<span><span class="co"># [13] main_title&lt;-            prov_footer             prov_footer&lt;-          </span></span>
<span><span class="co"># [16] show                    subtitles               subtitles&lt;-            </span></span>
<span><span class="co"># [19] table_inset             table_inset&lt;-           top_left               </span></span>
<span><span class="co"># [22] top_left&lt;-              top_level_section_div   top_level_section_div&lt;-</span></span>
<span><span class="co"># [25] vars_in_layout         </span></span>
<span><span class="co"># see '?methods' for accessing help and source code</span></span></code></pre>
<p>Now, lets see the same for our result table <code>tbl</code>:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">tbl</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co"># [1] "TableTree"</span></span>
<span><span class="co"># attr(,"package")</span></span>
<span><span class="co"># [1] "rtables"</span></span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/methods/getClass.html" class="external-link">getClass</a></span><span class="op">(</span><span class="st">"TableTree"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># Main object representing a table in {rtables}</span></span></code></pre></div>
<pre><code><span><span class="co"># Class "TableTree" [package "rtables"]</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Slots:</span></span>
<span><span class="co">#                                                                            </span></span>
<span><span class="co"># Name:                 content      page_title_prefix               children</span></span>
<span><span class="co"># Class:        ElementaryTable              character                   list</span></span>
<span><span class="co">#                                                                            </span></span>
<span><span class="co"># Name:                rowspans               labelrow            page_titles</span></span>
<span><span class="co"># Class:             data.frame               LabelRow              character</span></span>
<span><span class="co">#                                                                            </span></span>
<span><span class="co"># Name:          horizontal_sep     header_section_div   trailing_section_div</span></span>
<span><span class="co"># Class:              character              character              character</span></span>
<span><span class="co">#                                                                            </span></span>
<span><span class="co"># Name:                col_info                 format                 na_str</span></span>
<span><span class="co"># Class: InstantiatedColumnInfo             FormatSpec              character</span></span>
<span><span class="co">#                                                                            </span></span>
<span><span class="co"># Name:         indent_modifier            table_inset                  level</span></span>
<span><span class="co"># Class:                integer                integer                integer</span></span>
<span><span class="co">#                                                                            </span></span>
<span><span class="co"># Name:                    name             main_title              subtitles</span></span>
<span><span class="co"># Class:              character              character              character</span></span>
<span><span class="co">#                                                     </span></span>
<span><span class="co"># Name:             main_footer      provenance_footer</span></span>
<span><span class="co"># Class:              character              character</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Extends: </span></span>
<span><span class="co"># Class "VTableTree", directly</span></span>
<span><span class="co"># Class "VTableNodeInfo", by class "VTableTree", distance 2</span></span>
<span><span class="co"># Class "VTree", by class "VTableTree", distance 2</span></span>
<span><span class="co"># Class "VTitleFooter", by class "VTableTree", distance 2</span></span>
<span><span class="co"># Class "VNodeInfo", by class "VTableTree", distance 3</span></span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/methods.html" class="external-link">methods</a></span><span class="op">(</span>class <span class="op">=</span> <span class="st">"TableTree"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># more than 70 methods but no print method</span></span></code></pre></div>
<pre><code><span><span class="co">#  [1] [                    [&lt;-                  as.vector           </span></span>
<span><span class="co">#  [4] cell_footnotes       cell_values          clayout             </span></span>
<span><span class="co">#  [7] clear_indent_mods    col_counts           col_counts&lt;-        </span></span>
<span><span class="co"># [10] col_footnotes        col_info             col_info&lt;-          </span></span>
<span><span class="co"># [13] col_total            col_total&lt;-          colcount_format     </span></span>
<span><span class="co"># [16] colcount_format&lt;-    colcount_na_str      colcount_na_str&lt;-   </span></span>
<span><span class="co"># [19] colcount_visible     colcount_visible&lt;-   collect_leaves      </span></span>
<span><span class="co"># [22] coltree              content_table        content_table&lt;-     </span></span>
<span><span class="co"># [25] dim                  do_forced_paginate   facet_colcount      </span></span>
<span><span class="co"># [28] facet_colcount&lt;-     fnotes_at_path&lt;-     get_formatted_cells </span></span>
<span><span class="co"># [31] head                 header_section_div   header_section_div&lt;-</span></span>
<span><span class="co"># [34] horizontal_sep       horizontal_sep&lt;-     indent_mod          </span></span>
<span><span class="co"># [37] indent_mod&lt;-         insert_row_at_path   main_footer         </span></span>
<span><span class="co"># [40] main_footer&lt;-        main_title           main_title&lt;-        </span></span>
<span><span class="co"># [43] make_row_df          matrix_form          names               </span></span>
<span><span class="co"># [46] ncol                 no_colinfo           nrow                </span></span>
<span><span class="co"># [49] obj_format           obj_format&lt;-         obj_label           </span></span>
<span><span class="co"># [52] obj_label&lt;-          obj_na_str           obj_na_str&lt;-        </span></span>
<span><span class="co"># [55] obj_name             obj_name&lt;-           page_titles         </span></span>
<span><span class="co"># [58] page_titles&lt;-        prov_footer          prov_footer&lt;-       </span></span>
<span><span class="co"># [61] rbind                rbind2               rm_all_colcounts    </span></span>
<span><span class="co"># [64] row_footnotes        row.names            section_div         </span></span>
<span><span class="co"># [67] section_div&lt;-        show                 str                 </span></span>
<span><span class="co"># [70] subtitles            subtitles&lt;-          table_inset         </span></span>
<span><span class="co"># [73] table_inset&lt;-        tail                 top_left            </span></span>
<span><span class="co"># [76] top_left&lt;-           toString             tree_children       </span></span>
<span><span class="co"># [79] tree_children&lt;-      tt_at_path           tt_at_path&lt;-        </span></span>
<span><span class="co"># [82] value_at             value_formats       </span></span>
<span><span class="co"># see '?methods' for accessing help and source code</span></span></code></pre>
<p>Again, the class itself has only the <code>show</code> method.
Nonetheless, if you search for <code>VTableTree"</code> you will find
the <code>print</code> method for the <code>TableTree</code> class. This
is because <code>VTableTree</code> is a virtual class that is inherited
by <code>TableTree</code> and is almost identical to the
<code>show</code> method for <code>TableTree</code> objects. All the
different statements in this case (<code>show</code> or
<code>print</code>) do the same thing, i.e. they call
<code>toString</code> and <code>cat</code> on the object. Hence, we know
that every table is printed by <code>toString</code> with
<code>\n</code> as separator for different lines so that
<code>cat</code> renders it in its final format.</p>
</div>
<div class="section level3">
<h3 id="from-matrix_form-to-tostring">From <code>matrix_form</code> to <code>toString</code><a class="anchor" aria-label="anchor" href="#from-matrix_form-to-tostring"></a>
</h3>
<p>If we have source code of <code>formatters</code>,
<code>rtables</code>, and <code>rlistings</code> in our local we can
search for <code>"toString"</code> S4 method definition across these
source folders. We will find generics in <code>formatters</code> and
three different <code>setMethod(...)</code>. <code>toString</code> is
properly defined in <code>formatters</code>, but it is also present in
<code>rlistings</code> and<code>rtables</code>. Let’s take a look at the
latter first.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"toString"</span>, <span class="st">"VTableTree"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span>,</span>
<span>                                             <span class="va">widths</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                                             <span class="va">col_gap</span> <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                                             <span class="va">hsep</span> <span class="op">=</span> <span class="fu"><a href="../../reference/horizontal_sep.html">horizontal_sep</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>                                             <span class="va">indent_size</span> <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                                             <span class="va">tf_wrap</span> <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                             <span class="va">max_width</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://insightsengineering.github.io/formatters/latest-tag/reference/tostring.html" class="external-link">toString</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://insightsengineering.github.io/formatters/latest-tag/reference/matrix_form.html" class="external-link">matrix_form</a></span><span class="op">(</span><span class="va">x</span>,</span>
<span>      indent_rownames <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>      indent_size <span class="op">=</span> <span class="va">indent_size</span> <span class="co"># Only modifies the rownames in matrix_form</span></span>
<span>    <span class="op">)</span>,</span>
<span>    widths <span class="op">=</span> <span class="va">widths</span>, col_gap <span class="op">=</span> <span class="va">col_gap</span>,</span>
<span>    hsep <span class="op">=</span> <span class="va">hsep</span>,</span>
<span>    tf_wrap <span class="op">=</span> <span class="va">tf_wrap</span>,</span>
<span>    max_width <span class="op">=</span> <span class="va">max_width</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>This is only a wrapper/dispatcher to the core <code>toString</code>
function in <code>formatters</code>, beside the <code>indent_size</code>
specification. This is based on the “rendering-ready” class
<code>MatrixPrintForm</code> that is produced by
<code>matrix_form</code>. The latter is the first core transformation
that we need to know to understand the printing process. All exporters
and printers are based on <code>MatrixPrintForm</code> objects, hence
any bug or problem needs to tracked down to this function or
<code>toString</code>. If we take a look at <code>toString</code> for
<code>"listing_df"</code> in <code>rlistings</code>, we will find a
shallow wrapper that dispatches to <code>MatrixPrintForm</code>
objects:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"toString"</span>, <span class="st">"listing_df"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://insightsengineering.github.io/formatters/latest-tag/reference/tostring.html" class="external-link">toString</a></span><span class="op">(</span><span class="fu"><a href="https://insightsengineering.github.io/formatters/latest-tag/reference/matrix_form.html" class="external-link">matrix_form</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Hence lets take a look at <code>"matrix_form"</code> (if there are
quotes, it is an S4 function from now on). Beside generics and self
calls
(<code>setMethod("matrix_form", "MatrixPrintForm", [...] obj)</code>),
<code>rlistings</code> and <code>rtables</code> have their own
“constructor” of <code>MatrixPrintForm</code> (the real one can be found
in <code>formatters</code>). Let’s start with the latter
<code>"matrix_form"</code> which is dispatched when dealing with
<code>VTableTree</code>s.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Entering matrix_form for VTableTree</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/trace.html" class="external-link">trace</a></span><span class="op">(</span><span class="st">"matrix_form"</span>, signature <span class="op">=</span> <span class="st">"VTableTree"</span>, tracer <span class="op">=</span> <span class="va">browser</span>, exit <span class="op">=</span> <span class="va">browser</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://insightsengineering.github.io/formatters/latest-tag/reference/matrix_form.html" class="external-link">matrix_form</a></span><span class="op">(</span><span class="va">tbl</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/trace.html" class="external-link">untrace</a></span><span class="op">(</span><span class="st">"matrix_form"</span>, signature <span class="op">=</span> <span class="st">"VTableTree"</span><span class="op">)</span></span></code></pre></div>
<p>Now lets see the newly commented code for <code>matrix_form</code>.
With <code>#-&gt;</code> I will comment some suggestions for further
understandings.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span></span>
<span>  <span class="st">"matrix_form"</span>, <span class="st">"VTableTree"</span>,</span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">obj</span>,</span>
<span>           <span class="va">indent_rownames</span> <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>           <span class="va">expand_newlines</span> <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>           <span class="va">indent_size</span> <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/methods/is.html" class="external-link">is</a></span><span class="op">(</span><span class="va">obj</span>, <span class="st">"VTableTree"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co">#-&gt; Read .tbl_header_mat and subfunctions (based largely on cinfo) it can help for understanding</span></span>
<span>    <span class="co">#   column structure and how it is printed (we can add a description of this process xxx)</span></span>
<span>    <span class="co">#   Note: it contains the display of column counts directives and specifics</span></span>
<span>    <span class="va">header_content</span> <span class="op">&lt;-</span> <span class="fu">.tbl_header_mat</span><span class="op">(</span><span class="va">obj</span><span class="op">)</span> <span class="co"># first col are for row.names or topleft info</span></span>
<span>    <span class="va">nr_header</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">header_content</span><span class="op">$</span><span class="va">body</span><span class="op">)</span> <span class="co"># colcounts were added in .tbl_header_mat</span></span>
<span></span>
<span>    <span class="co">#-&gt; As before, reading this function can help understanding how the content of the table is transformed</span></span>
<span>    <span class="co">#   in row content and how the structure of the table is preserved in a compact manner. It is complex</span></span>
<span>    <span class="co">#   function as it is a recursive one with the different dispatcher but following how different section_div</span></span>
<span>    <span class="co">#   are printed (with the dedicated assignment function) can help understanding the table structure and its</span></span>
<span>    <span class="co">#   row-wise transformation.</span></span>
<span>    <span class="co"># Summary of row contents - reprint_inds specifies which rows to reprint (hence the grouping)</span></span>
<span>    <span class="va">sr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://insightsengineering.github.io/formatters/latest-tag/reference/make_row_df.html" class="external-link">make_row_df</a></span><span class="op">(</span><span class="va">obj</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># With get_formatted_cells we get relevant information inside the table tree</span></span>
<span>    <span class="va">body_content_strings</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">NROW</a></span><span class="op">(</span><span class="va">sr</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="co">#-&gt; get_formatted_cells is an interesting function to understand the structure of the table as</span></span>
<span>      <span class="co">#   it is design to extract only the "data" of the table as strings. Note how the label rows are</span></span>
<span>      <span class="co">#   taken from make_row_df instead. Check shell = TRUE afterwards to see how the format are retrieved.</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">sr</span><span class="op">$</span><span class="va">label</span><span class="op">)</span>, <span class="fu"><a href="../../reference/gfc.html">get_formatted_cells</a></span><span class="op">(</span><span class="va">obj</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="va">formats_strings</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">NROW</a></span><span class="op">(</span><span class="va">sr</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="st">""</span>, <span class="fu"><a href="../../reference/gfc.html">get_formatted_cells</a></span><span class="op">(</span><span class="va">obj</span>, shell <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="co">#-&gt; Here spans are extracted for each row. Spans are rarely modified beyond its standard values.</span></span>
<span>    <span class="co"># Takes the flatten spans for each row and repeats them according to the number elements</span></span>
<span>    <span class="va">tsptmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="../../reference/collect_leaves.html">collect_leaves</a></span><span class="op">(</span><span class="va">obj</span>, <span class="cn">TRUE</span>, <span class="cn">TRUE</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">rr</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/int_methods.html">row_cspans</a></span><span class="op">(</span><span class="va">rr</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">sp</span>, times <span class="op">=</span> <span class="va">sp</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co">## the 1 is for row labels</span></span>
<span>    <span class="va">body_spans</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">obj</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1L</span>, <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">tsptmp</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>, nrow <span class="op">=</span> <span class="fl">0</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">obj</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="va">body_aligns</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">NROW</a></span><span class="op">(</span><span class="va">sr</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="fu"><a href="../../reference/gfc.html">get_cell_aligns</a></span><span class="op">(</span><span class="va">obj</span><span class="op">)</span><span class="op">)</span> <span class="co">#-&gt; extracts align values for each cell</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="va">body</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/rbind.html">rbind</a></span><span class="op">(</span><span class="va">header_content</span><span class="op">$</span><span class="va">body</span>, <span class="va">body_content_strings</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Init column format for header (empty if not for column counts)</span></span>
<span>    <span class="va">hdr_fmt_blank</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="st">""</span>,</span>
<span>      nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">header_content</span><span class="op">$</span><span class="va">body</span><span class="op">)</span>,</span>
<span>      ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">header_content</span><span class="op">$</span><span class="va">body</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="co"># If column counts are displayed, add column count format</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="../../reference/int_methods.html">disp_ccounts</a></span><span class="op">(</span><span class="va">obj</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">hdr_fmt_blank</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">hdr_fmt_blank</span><span class="op">)</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="../../reference/int_methods.html">colcount_format</a></span><span class="op">(</span><span class="va">obj</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">obj</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="va">formats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/rbind.html">rbind</a></span><span class="op">(</span><span class="va">hdr_fmt_blank</span>, <span class="va">formats_strings</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">spans</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/rbind.html">rbind</a></span><span class="op">(</span><span class="va">header_content</span><span class="op">$</span><span class="va">span</span>, <span class="va">body_spans</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">spans</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span></span>
<span>    <span class="va">aligns</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/rbind.html">rbind</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"center"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">header_content</span><span class="op">$</span><span class="va">body</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">header_content</span><span class="op">$</span><span class="va">body</span><span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>      <span class="va">body_aligns</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>    <span class="va">aligns</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"left"</span> <span class="co"># row names and topleft (still needed for topleft)</span></span>
<span></span>
<span>    <span class="co"># Main indentation of the table rownames #-&gt; Main indentation facility</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">indent_rownames</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">body</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/indent_string.html">indent_string</a></span><span class="op">(</span><span class="va">body</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">nr_header</span><span class="op">)</span>, <span class="va">sr</span><span class="op">$</span><span class="va">indent</span><span class="op">)</span>,</span>
<span>        incr <span class="op">=</span> <span class="va">indent_size</span></span>
<span>      <span class="op">)</span></span>
<span>      <span class="va">formats</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/indent_string.html">indent_string</a></span><span class="op">(</span><span class="va">formats</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">nr_header</span><span class="op">)</span>, <span class="va">sr</span><span class="op">$</span><span class="va">indent</span><span class="op">)</span>,</span>
<span>        incr <span class="op">=</span> <span class="va">indent_size</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="co">#-&gt; referential strings are added to the table. get_ref_matrix is the core of this process</span></span>
<span>    <span class="co">#   along with format_fnote_ref that in this case is used to format the reference string and their</span></span>
<span>    <span class="co">#   indices. Note that the footnotes for the header is taken from the output of .tbl_header_mat</span></span>
<span>    <span class="co"># Handling of references in header and body</span></span>
<span>    <span class="va">col_ref_strs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span><span class="va">header_content</span><span class="op">$</span><span class="va">footnotes</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="st">""</span></span>
<span>      <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">format_fnote_ref</span>, <span class="st">""</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">" "</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span>, <span class="st">""</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">body</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">body_ref_strs</span> <span class="op">&lt;-</span> <span class="fu">get_ref_matrix</span><span class="op">(</span><span class="va">obj</span><span class="op">)</span></span>
<span>    <span class="va">body</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>        <span class="va">body</span>,</span>
<span>        <span class="fu"><a href="../../reference/rbind.html">rbind</a></span><span class="op">(</span></span>
<span>          <span class="va">col_ref_strs</span>, <span class="co">#-&gt; col_ref_strs are added to the body as a separate section</span></span>
<span>          <span class="va">body_ref_strs</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>      nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">body</span><span class="op">)</span>,</span>
<span>      ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">body</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Solve \n in titles # This is something that is relevant in toString - NO MORE USED HERE</span></span>
<span>    <span class="co"># if (any(grepl("\n", all_titles(obj)))) {</span></span>
<span>    <span class="co">#   if (any(grepl("\n", main_title(obj)))) {</span></span>
<span>    <span class="co">#     tmp_title_vec &lt;- .quick_handle_nl(main_title(obj))</span></span>
<span>    <span class="co">#     main_title(obj) &lt;- tmp_title_vec[1]</span></span>
<span>    <span class="co">#     subtitles(obj) &lt;- c(tmp_title_vec[-1], .quick_handle_nl(subtitles(obj)))</span></span>
<span>    <span class="co">#   } else {</span></span>
<span>    <span class="co">#     subtitles(obj) &lt;- .quick_handle_nl(subtitles(obj))</span></span>
<span>    <span class="co">#   }</span></span>
<span>    <span class="co"># }</span></span>
<span>    <span class="co">#</span></span>
<span>    <span class="co"># # Solve \n in footers</span></span>
<span>    <span class="co"># main_footer(obj) &lt;- .quick_handle_nl(main_footer(obj))</span></span>
<span>    <span class="co"># prov_footer(obj) &lt;- .quick_handle_nl(prov_footer(obj))</span></span>
<span></span>
<span>    <span class="co">#-&gt; this is still under development as indicated by xxx. The idea is to allow \n also in peculiar</span></span>
<span>    <span class="co">#   cases, such as page titles and referential footnotes. The latter are resolved in toString (pagination</span></span>
<span>    <span class="co">#   will not count them as more than one line each), while for the former we do not have any coverage yet.</span></span>
<span>    <span class="co"># xxx \n in page titles are not working atm (I think)</span></span>
<span>    <span class="co"># ref_fnotes &lt;- strsplit(get_formatted_fnotes(obj), "\n", fixed = TRUE)</span></span>
<span>    <span class="va">ref_fnotes</span> <span class="op">&lt;-</span> <span class="fu">get_formatted_fnotes</span><span class="op">(</span><span class="va">obj</span><span class="op">)</span> <span class="co"># pagination will not count extra lines coming from here</span></span>
<span>    <span class="va">pag_titles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://insightsengineering.github.io/formatters/latest-tag/reference/title_footer.html" class="external-link">page_titles</a></span><span class="op">(</span><span class="va">obj</span><span class="op">)</span></span>
<span></span>
<span>    <span class="fu"><a href="https://insightsengineering.github.io/formatters/latest-tag/reference/MatrixPrintForm.html" class="external-link">MatrixPrintForm</a></span><span class="op">(</span></span>
<span>      strings <span class="op">=</span> <span class="va">body</span>, <span class="co">#-&gt; FUNDAMENTAL: this is the matrix that contains all the cell strings</span></span>
<span>      spans <span class="op">=</span> <span class="va">spans</span>,</span>
<span>      aligns <span class="op">=</span> <span class="va">aligns</span>,</span>
<span>      formats <span class="op">=</span> <span class="va">formats</span>,</span>
<span>      <span class="co">## display = display, purely a function of spans, handled in constructor now</span></span>
<span>      row_info <span class="op">=</span> <span class="va">sr</span>, <span class="co">#-&gt; FUNDAMENTAL: this is the data.frame that contains all the information about the rows</span></span>
<span>      <span class="co">#   it is the most complex data brought forward into toString</span></span>
<span>      <span class="co">## line_grouping handled internally now line_grouping = 1:nrow(body),</span></span>
<span>      ref_fnotes <span class="op">=</span> <span class="va">ref_fnotes</span>,</span>
<span>      nlines_header <span class="op">=</span> <span class="va">nr_header</span>, <span class="co">## this is fixed internally</span></span>
<span>      nrow_header <span class="op">=</span> <span class="va">nr_header</span>,</span>
<span>      expand_newlines <span class="op">=</span> <span class="va">expand_newlines</span>,</span>
<span>      has_rowlabs <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>      has_topleft <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co">#-&gt; I think topleft material is handled later in toString</span></span>
<span>      main_title <span class="op">=</span> <span class="fu"><a href="https://insightsengineering.github.io/formatters/latest-tag/reference/title_footer.html" class="external-link">main_title</a></span><span class="op">(</span><span class="va">obj</span><span class="op">)</span>,</span>
<span>      subtitles <span class="op">=</span> <span class="fu"><a href="https://insightsengineering.github.io/formatters/latest-tag/reference/title_footer.html" class="external-link">subtitles</a></span><span class="op">(</span><span class="va">obj</span><span class="op">)</span>,</span>
<span>      page_titles <span class="op">=</span> <span class="va">pag_titles</span>,</span>
<span>      main_footer <span class="op">=</span> <span class="fu"><a href="https://insightsengineering.github.io/formatters/latest-tag/reference/title_footer.html" class="external-link">main_footer</a></span><span class="op">(</span><span class="va">obj</span><span class="op">)</span>,</span>
<span>      prov_footer <span class="op">=</span> <span class="fu"><a href="https://insightsengineering.github.io/formatters/latest-tag/reference/title_footer.html" class="external-link">prov_footer</a></span><span class="op">(</span><span class="va">obj</span><span class="op">)</span>,</span>
<span>      table_inset <span class="op">=</span> <span class="fu"><a href="https://insightsengineering.github.io/formatters/latest-tag/reference/table_inset.html" class="external-link">table_inset</a></span><span class="op">(</span><span class="va">obj</span><span class="op">)</span>,</span>
<span>      header_section_div <span class="op">=</span> <span class="fu"><a href="../../reference/section_div.html">header_section_div</a></span><span class="op">(</span><span class="va">obj</span><span class="op">)</span>,</span>
<span>      horizontal_sep <span class="op">=</span> <span class="fu"><a href="../../reference/horizontal_sep.html">horizontal_sep</a></span><span class="op">(</span><span class="va">obj</span><span class="op">)</span>,</span>
<span>      indent_size <span class="op">=</span> <span class="va">indent_size</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Now lets see the <code>matrix_form</code> in
<code>rlistings</code>:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://insightsengineering.github.io/rlistings/" class="external-link">rlistings</a></span><span class="op">)</span></span>
<span><span class="va">lsting</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://insightsengineering.github.io/rlistings/latest-tag/reference/listings.html" class="external-link">as_listing</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/trace.html" class="external-link">trace</a></span><span class="op">(</span><span class="st">"matrix_form"</span>, signature <span class="op">=</span> <span class="st">"listing_df"</span>, tracer <span class="op">=</span> <span class="va">browser</span>, exit <span class="op">=</span> <span class="va">browser</span><span class="op">)</span></span>
<span><span class="va">mf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://insightsengineering.github.io/formatters/latest-tag/reference/matrix_form.html" class="external-link">matrix_form</a></span><span class="op">(</span><span class="va">lsting</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/trace.html" class="external-link">untrace</a></span><span class="op">(</span><span class="st">"matrix_form"</span>, signature <span class="op">=</span> <span class="st">"listing_df"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span></span>
<span>  <span class="st">"matrix_form"</span>, <span class="st">"listing_df"</span>,</span>
<span>  <span class="va">rix_form</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">obj</span>, <span class="va">indent_rownames</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co">#-&gt; I have no idea why here there is an assignment xxx</span></span>
<span>    <span class="co">##  we intentionally silently ignore indent_rownames because listings have</span></span>
<span>    <span class="co">## no rownames, but formatters::vert_pag_indices calls matrix_form(obj, TRUE)</span></span>
<span>    <span class="co">## unconditionally.</span></span>
<span></span>
<span>    <span class="co"># Keeping only displayed columns</span></span>
<span>    <span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">obj</span>, <span class="st">"listing_dispcols"</span><span class="op">)</span> <span class="co"># this is the list of columns to be displayed</span></span>
<span>    <span class="va">listing</span> <span class="op">&lt;-</span> <span class="va">obj</span><span class="op">[</span>, <span class="va">cols</span><span class="op">]</span></span>
<span>    <span class="va">atts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes</a></span><span class="op">(</span><span class="va">obj</span><span class="op">)</span></span>
<span>    <span class="va">atts</span><span class="op">$</span><span class="va">names</span> <span class="op">&lt;-</span> <span class="va">cols</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes</a></span><span class="op">(</span><span class="va">listing</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">atts</span></span>
<span>    <span class="va">keycols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://insightsengineering.github.io/rlistings/latest-tag/reference/listings.html" class="external-link">get_keycols</a></span><span class="op">(</span><span class="va">listing</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">bodymat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="st">""</span>,</span>
<span>      nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">listing</span><span class="op">)</span>,</span>
<span>      ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">listing</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">bodymat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">listing</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Print only first appearer of key columns if repeated</span></span>
<span>    <span class="va">curkey</span> <span class="op">&lt;-</span> <span class="st">""</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">keycols</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">kcol</span> <span class="op">&lt;-</span> <span class="va">keycols</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>      <span class="va">kcolvec</span> <span class="op">&lt;-</span> <span class="va">listing</span><span class="op">[[</span><span class="va">kcol</span><span class="op">]</span><span class="op">]</span></span>
<span>      <span class="co">#-&gt; format_value transforms the values of the column into strings</span></span>
<span>      <span class="va">kcolvec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span><span class="va">kcolvec</span>, <span class="va">format_value</span>, <span class="st">""</span>, format <span class="op">=</span> <span class="fu"><a href="https://insightsengineering.github.io/formatters/latest-tag/reference/lab_name.html" class="external-link">obj_format</a></span><span class="op">(</span><span class="va">kcolvec</span><span class="op">)</span>, na_str <span class="op">=</span> <span class="fu"><a href="https://insightsengineering.github.io/formatters/latest-tag/reference/lab_name.html" class="external-link">obj_na_str</a></span><span class="op">(</span><span class="va">kcolvec</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">curkey</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">curkey</span>, <span class="va">kcolvec</span><span class="op">)</span></span>
<span>      <span class="va">disp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="fu"><a href="../../reference/head_tail.html">tail</a></span><span class="op">(</span><span class="va">curkey</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">!=</span> <span class="fu"><a href="../../reference/head_tail.html">head</a></span><span class="op">(</span><span class="va">curkey</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="co">#-&gt; This condition only show the first appearer of a key</span></span>
<span>      <span class="va">bodymat</span><span class="op">[</span><span class="va">disp</span>, <span class="va">kcol</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">kcolvec</span><span class="op">[</span><span class="va">disp</span><span class="op">]</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="co"># Print all other columns directly</span></span>
<span>    <span class="va">nonkeycols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">listing</span><span class="op">)</span>, <span class="va">keycols</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">nonkeycols</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw">for</span> <span class="op">(</span><span class="va">nonk</span> <span class="kw">in</span> <span class="va">nonkeycols</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">vec</span> <span class="op">&lt;-</span> <span class="va">listing</span><span class="op">[[</span><span class="va">nonk</span><span class="op">]</span><span class="op">]</span></span>
<span>        <span class="va">vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span><span class="va">vec</span>, <span class="va">format_value</span>, <span class="st">""</span>, format <span class="op">=</span> <span class="fu"><a href="https://insightsengineering.github.io/formatters/latest-tag/reference/lab_name.html" class="external-link">obj_format</a></span><span class="op">(</span><span class="va">vec</span><span class="op">)</span>, na_str <span class="op">=</span> <span class="fu"><a href="https://insightsengineering.github.io/formatters/latest-tag/reference/lab_name.html" class="external-link">obj_na_str</a></span><span class="op">(</span><span class="va">vec</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="va">bodymat</span><span class="op">[</span>, <span class="va">nonk</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">vec</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="va">fullmat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/rbind.html">rbind</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://insightsengineering.github.io/formatters/latest-tag/reference/var_labels.html" class="external-link">var_labels</a></span><span class="op">(</span><span class="va">listing</span>, fill <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="co"># Extracts the variable labels</span></span>
<span>      <span class="va">bodymat</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>    <span class="va">colaligns</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/rbind.html">rbind</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"center"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">cols</span><span class="op">)</span><span class="op">)</span>, <span class="co"># Col names are always centered?</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">listing</span>, <span class="va">obj_align</span><span class="op">)</span>,</span>
<span>        ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">cols</span><span class="op">)</span>,</span>
<span>        nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">fullmat</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>,</span>
<span>        byrow <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>    <span class="fu"><a href="https://insightsengineering.github.io/formatters/latest-tag/reference/MatrixPrintForm.html" class="external-link">MatrixPrintForm</a></span><span class="op">(</span></span>
<span>      strings <span class="op">=</span> <span class="va">fullmat</span>,</span>
<span>      spans <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>,</span>
<span>        nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">fullmat</span><span class="op">)</span>,</span>
<span>        ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">fullmat</span><span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>      ref_fnotes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      aligns <span class="op">=</span> <span class="va">colaligns</span>,</span>
<span>      formats <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>,</span>
<span>        nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">fullmat</span><span class="op">)</span>,</span>
<span>        ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">fullmat</span><span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>      row_info <span class="op">=</span> <span class="fu"><a href="https://insightsengineering.github.io/formatters/latest-tag/reference/make_row_df.html" class="external-link">make_row_df</a></span><span class="op">(</span><span class="va">obj</span><span class="op">)</span>,</span>
<span>      nlines_header <span class="op">=</span> <span class="fl">1</span>, <span class="co">## XXX this is probably wrong!!!</span></span>
<span>      nrow_header <span class="op">=</span> <span class="fl">1</span>,</span>
<span>      has_topleft <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>      has_rowlabs <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>      expand_newlines <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># Always expand newlines, but this happens later!! XXX to fix</span></span>
<span>      main_title <span class="op">=</span> <span class="fu"><a href="https://insightsengineering.github.io/formatters/latest-tag/reference/title_footer.html" class="external-link">main_title</a></span><span class="op">(</span><span class="va">obj</span><span class="op">)</span>,</span>
<span>      subtitles <span class="op">=</span> <span class="fu"><a href="https://insightsengineering.github.io/formatters/latest-tag/reference/title_footer.html" class="external-link">subtitles</a></span><span class="op">(</span><span class="va">obj</span><span class="op">)</span>,</span>
<span>      page_titles <span class="op">=</span> <span class="fu"><a href="https://insightsengineering.github.io/formatters/latest-tag/reference/title_footer.html" class="external-link">page_titles</a></span><span class="op">(</span><span class="va">obj</span><span class="op">)</span>,</span>
<span>      main_footer <span class="op">=</span> <span class="fu"><a href="https://insightsengineering.github.io/formatters/latest-tag/reference/title_footer.html" class="external-link">main_footer</a></span><span class="op">(</span><span class="va">obj</span><span class="op">)</span>,</span>
<span>      prov_footer <span class="op">=</span> <span class="fu"><a href="https://insightsengineering.github.io/formatters/latest-tag/reference/title_footer.html" class="external-link">prov_footer</a></span><span class="op">(</span><span class="va">obj</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We device here the good developer to search and understand the
various methods associated with <code>MatrixPrintForm</code> objects. It
is relevant to remember how this printed form is meant to</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example quick table</span></span>
<span><span class="va">summary_list</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">a_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/qtable_layout.html">qtable</a></span><span class="op">(</span><span class="va">ex_adsl</span>, row_vars <span class="op">=</span> <span class="st">"SEX"</span>, col_vars <span class="op">=</span> <span class="st">"ARM"</span>, avar <span class="op">=</span> <span class="st">"AGE"</span>, afun <span class="op">=</span> <span class="va">summary_list</span><span class="op">)</span></span>
<span><span class="va">tbl_methods</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/methods.html" class="external-link">methods</a></span><span class="op">(</span>class <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">a_table</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mpf_methods</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/methods.html" class="external-link">methods</a></span><span class="op">(</span>class <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="fu"><a href="https://insightsengineering.github.io/formatters/latest-tag/reference/matrix_form.html" class="external-link">matrix_form</a></span><span class="op">(</span><span class="va">a_table</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="co"># it is a list of values</span></span>
<span></span>
<span><span class="co"># Cleaning values</span></span>
<span><span class="va">tbl_methods</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">tbl_methods</span>, <span class="st">","</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mpf_methods</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">mpf_methods</span>, <span class="st">","</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="va">tbl_methods</span>, <span class="va">mpf_methods</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#  [1] "["                    "as.vector"            "cell_footnotes"      </span></span>
<span><span class="co">#  [4] "cell_values"          "clayout"              "clear_indent_mods"   </span></span>
<span><span class="co">#  [7] "col_counts"           "col_counts&lt;-"         "col_footnotes"       </span></span>
<span><span class="co"># [10] "col_info"             "col_info&lt;-"           "col_total"           </span></span>
<span><span class="co"># [13] "col_total&lt;-"          "colcount_format"      "colcount_format&lt;-"   </span></span>
<span><span class="co"># [16] "colcount_na_str"      "colcount_na_str&lt;-"    "colcount_visible"    </span></span>
<span><span class="co"># [19] "colcount_visible&lt;-"   "collect_leaves"       "coltree"             </span></span>
<span><span class="co"># [22] "content_table"        "content_table&lt;-"      "dim"                 </span></span>
<span><span class="co"># [25] "do_forced_paginate"   "facet_colcount"       "facet_colcount&lt;-"    </span></span>
<span><span class="co"># [28] "fnotes_at_path&lt;-"     "get_formatted_cells"  "head"                </span></span>
<span><span class="co"># [31] "header_section_div"   "header_section_div&lt;-" "horizontal_sep"      </span></span>
<span><span class="co"># [34] "horizontal_sep&lt;-"     "indent_mod"           "indent_mod&lt;-"        </span></span>
<span><span class="co"># [37] "insert_row_at_path"   "names"                "no_colinfo"          </span></span>
<span><span class="co"># [40] "nrow"                 "obj_format"           "obj_format&lt;-"        </span></span>
<span><span class="co"># [43] "obj_label"            "obj_label&lt;-"          "obj_na_str"          </span></span>
<span><span class="co"># [46] "obj_na_str&lt;-"         "obj_name"             "obj_name&lt;-"          </span></span>
<span><span class="co"># [49] "rbind"                "rbind2"               "rm_all_colcounts"    </span></span>
<span><span class="co"># [52] "row_footnotes"        "row.names"            "show"                </span></span>
<span><span class="co"># [55] "str"                  "tail"                 "top_left"            </span></span>
<span><span class="co"># [58] "top_left&lt;-"           "tree_children"        "tree_children&lt;-"     </span></span>
<span><span class="co"># [61] "tt_at_path"           "tt_at_path&lt;-"         "value_at"            </span></span>
<span><span class="co"># [64] "value_formats"</span></span></code></pre>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="va">mpf_methods</span>, <span class="va">tbl_methods</span><span class="op">)</span> <span class="co"># much less unique methods</span></span></code></pre></div>
<pre><code><span><span class="co"># [1] "coerce"         "coerce&lt;-"       "nlines"         "num_rep_cols"  </span></span>
<span><span class="co"># [5] "num_rep_cols&lt;-" "Ops"            "rawvalues"      "value_names"</span></span></code></pre>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">intersect</a></span><span class="op">(</span><span class="va">tbl_methods</span>, <span class="va">mpf_methods</span><span class="op">)</span> <span class="co"># interesting to discover the different behaviors of same functions</span></span></code></pre></div>
<pre><code><span><span class="co">#  [1] "[&lt;-"           "main_footer"   "main_footer&lt;-" "main_title"   </span></span>
<span><span class="co">#  [5] "main_title&lt;-"  "make_row_df"   "matrix_form"   "ncol"         </span></span>
<span><span class="co">#  [9] "page_titles"   "page_titles&lt;-" "prov_footer"   "prov_footer&lt;-"</span></span>
<span><span class="co"># [13] "section_div"   "section_div&lt;-" "subtitles"     "subtitles&lt;-"  </span></span>
<span><span class="co"># [17] "table_inset"   "table_inset&lt;-" "toString"</span></span></code></pre>
<p>Let’s now take a look at the final function of all this:
<code>toString</code> from <code>formatters</code>:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"toString"</span>, <span class="st">"MatrixPrintForm"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span>,</span>
<span>                                                  <span class="va">widths</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                                                  <span class="va">tf_wrap</span> <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                                  <span class="va">max_width</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                                                  <span class="va">col_gap</span> <span class="op">=</span> <span class="fu"><a href="https://insightsengineering.github.io/formatters/latest-tag/reference/mpf_accessors.html" class="external-link">mf_colgap</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>                                                  <span class="va">hsep</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                                                  <span class="va">fontspec</span> <span class="op">=</span> <span class="fu"><a href="https://insightsengineering.github.io/formatters/latest-tag/reference/font_spec.html" class="external-link">font_spec</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                                                  <span class="va">ttype_ok</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># part 1: checks and widths/max width estimation for columns - propose_column_widths and .handle_max_width</span></span>
<span>  <span class="co">#</span></span>
<span>  <span class="co"># part 2: wrapping for the table - do_cell_fnotes_wrap</span></span>
<span>  <span class="co">#</span></span>
<span>  <span class="co"># part 3: column gap and cell widths calculations (after wrapping) - .calc_cell_widths</span></span>
<span>  <span class="co">#</span></span>
<span>  <span class="co"># part 4: collapse text body and wrapping titles/footers</span></span>
<span>  <span class="co">#</span></span>
<span>  <span class="co"># part 5: final cat()</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>We rely on the future developer to fill in the blanks in the above
description and to follow up the various functions to their core
mechanics.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="nest">
  <p>rtables is a part of the <strong>NEST</strong> and <a href="https://pharmaverse.org/" class="external-link"><strong>pharmaverse</strong></a>.</p>
</div>
<script type="text/javascript" src="../../analytics.js"></script></footer>
</div>





  </body>
</html>
