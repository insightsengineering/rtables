<!DOCTYPE html>
<!-- Generated by pkgdown + https://github.com/insightsengineering/r-pkgdown-multiversion -->
<html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Pruning and Sorting Tables • rtables</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Pruning and Sorting Tables">
<link rel="stylesheet" href="../consent.css">
<script src="../consent.js" type="text/javascript" charset="utf-8"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rtables</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6.13</small>

    <div style="width: 140px; margin-left: 0.5rem;"> <small class="nav-text text-muted me-auto">part of</small> <img src="https://github.com/insightsengineering/hex-stickers/blob/main/PNG/nest.png?raw=true" alt="NEST" style="height: 30px;"><a href="https://pharmaverse.org/" class="external-link"><img src="https://github.com/insightsengineering/hex-stickers/blob/main/PNG/pharmaverse.png?raw=true" alt="pharmaverse" style="height: 28px;"></a> </div>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/rtables.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Getting Started</h6></li>
    <li><a class="dropdown-item" href="../articles/exploratory_analysis.html">Exploratory Analysis</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Clinical Trials</h6></li>
    <li><a class="dropdown-item" href="../articles/clinical_trials.html">Example Clinical Trials Tables</a></li>
    <li><a class="dropdown-item" href="../articles/baseline.html">Comparing Against Baselines or Control</a></li>
    <li><a class="dropdown-item" href="../articles/ard_how_to.html">Generating QC-Ready Result Data Frames (ARDs) from Tables</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Table Customization</h6></li>
    <li><a class="dropdown-item" href="../articles/custom_appearance.html">Customizing Appearance</a></li>
    <li><a class="dropdown-item" href="../articles/title_footer.html">Titles, Footers, and Referential Footnotes</a></li>
    <li><a class="dropdown-item" href="../articles/sorting_pruning.html">Pruning and Sorting Tables</a></li>
    <li><a class="dropdown-item" href="../articles/col_counts.html">Column Counts and Formats</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-developer-guide" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Developer Guide</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-developer-guide">
<li><a class="dropdown-item" href="../articles/dev-guide/dg_split_machinery.html">Split Machinery</a></li>
    <li><a class="dropdown-item" href="../articles/dev-guide/dg_tabulation.html">Tabulation</a></li>
    <li><a class="dropdown-item" href="../articles/dev-guide/dg_table_hierarchy.html">Table Hierarchy</a></li>
    <li><a class="dropdown-item" href="../articles/dev-guide/dg_debug_rtables.html">Debugging in {rtables} and Beyond</a></li>
    <li><a class="dropdown-item" href="../articles/dev-guide/dg_notes.html">Sparse Notes on {rtables} Internals</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-reports" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Reports</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-reports">
<li><a class="dropdown-item" href="../coverage-report/">Coverage report</a></li>
    <li><a class="dropdown-item" href="../unit-test-report/">Unit test report</a></li>
    <li><a class="dropdown-item" href="../unit-test-report-non-cran/">Non-CRAN unit test report</a></li>
  </ul>
</li>
      <div><li class="nav-item dropdown">
    <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-versions">Versions</a>
    <div class="dropdown-menu" aria-labelledby="dropdown-versions">
    <a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/release-candidate">release-candidate</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/main">main</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/latest-tag">latest-tag</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.15">v0.6.15</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.14">v0.6.14</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.13">v0.6.13</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.13-rc2">v0.6.13-rc2</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.13-rc1">v0.6.13-rc1</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.12">v0.6.12</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.12-rc2">v0.6.12-rc2</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.12-rc1">v0.6.12-rc1</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.11">v0.6.11</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.10">v0.6.10</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.9">v0.6.9</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.8">v0.6.8</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.7">v0.6.7</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.6">v0.6.6</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.6-rc1">v0.6.6-rc1</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.5">v0.6.5</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.4">v0.6.4</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.3">v0.6.3</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.2">v0.6.2</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rtables/v0.6.1">v0.6.1</a>
</div>
</li></div>
</ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/insightsengineering/rtables"><span class="fa fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Pruning and Sorting Tables</h1>
                        <h4 data-toc-skip class="author">Gabriel Becker,
Adrian Waddell and Davide Garolini</h4>
            
            <h4 data-toc-skip class="date">2025-06-20</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/insightsengineering/rtables/blob/main/vignettes/sorting_pruning.Rmd" class="external-link"><code>vignettes/sorting_pruning.Rmd</code></a></small>
      <div class="d-none name"><code>sorting_pruning.Rmd</code></div>
    </div>

    
    
<style type="text/css">
.reveal .r code {
    white-space: pre;
}
</style>
<div class="section level3">
<h3 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h3>
<p>Often we want to filter or reorder elements of a table in ways that
take into account the table structure. For example:</p>
<ul>
<li>Sorting subtables corresponding to factor levels so that most
commonly observed levels occur first in the table.</li>
<li>Sorting rows within a single subtable</li>
<li>Removing subtables which represent 0 observations or which after
other filtering contain 0 rows.</li>
</ul>
</div>
<div class="section level3">
<h3 id="a-table-in-need-of-attention">A Table In Need of Attention<a class="anchor" aria-label="anchor" href="#a-table-in-need-of-attention"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/insightsengineering/rtables" class="external-link">rtables</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">raw_lyt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_table.html">basic_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"ARM"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"SEX"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_rows_by.html">split_rows_by</a></span><span class="op">(</span><span class="st">"RACE"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/summarize_row_groups.html">summarize_row_groups</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_rows_by.html">split_rows_by</a></span><span class="op">(</span><span class="st">"STRATA1"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/summarize_row_groups.html">summarize_row_groups</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"AGE"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">raw_tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">raw_lyt</span>, <span class="va">DM</span><span class="op">)</span></span>
<span><span class="va">raw_tbl</span></span>
<span><span class="co">#                                                                  A: Drug X                                              B: Placebo                                           C: Combination                   </span></span>
<span><span class="co">#                                                 F            M           U      UNDIFFERENTIATED       F            M           U      UNDIFFERENTIATED       F            M           U      UNDIFFERENTIATED</span></span>
<span><span class="co"># ——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># ASIAN                                       44 (62.9%)   35 (68.6%)   0 (NA%)       0 (NA%)        37 (66.1%)   31 (62.0%)   0 (NA%)       0 (NA%)        40 (65.6%)   44 (64.7%)   0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#   A                                         15 (21.4%)   12 (23.5%)   0 (NA%)       0 (NA%)        14 (25.0%)   6 (12.0%)    0 (NA%)       0 (NA%)        15 (24.6%)   16 (23.5%)   0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                                      30.40        34.42        NA             NA            35.43        30.33        NA             NA            37.40        36.25        NA             NA       </span></span>
<span><span class="co">#   B                                         16 (22.9%)   8 (15.7%)    0 (NA%)       0 (NA%)        13 (23.2%)   16 (32.0%)   0 (NA%)       0 (NA%)        10 (16.4%)   12 (17.6%)   0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                                      33.75        34.88        NA             NA            32.46        30.94        NA             NA            33.30        35.92        NA             NA       </span></span>
<span><span class="co">#   C                                         13 (18.6%)   15 (29.4%)   0 (NA%)       0 (NA%)        10 (17.9%)   9 (18.0%)    0 (NA%)       0 (NA%)        15 (24.6%)   16 (23.5%)   0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                                      36.92        35.60        NA             NA            34.00        31.89        NA             NA            33.47        31.38        NA             NA       </span></span>
<span><span class="co"># BLACK OR AFRICAN AMERICAN                   18 (25.7%)   10 (19.6%)   0 (NA%)       0 (NA%)        12 (21.4%)   12 (24.0%)   0 (NA%)       0 (NA%)        13 (21.3%)   14 (20.6%)   0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#   A                                          5 (7.1%)     1 (2.0%)    0 (NA%)       0 (NA%)         5 (8.9%)     2 (4.0%)    0 (NA%)       0 (NA%)         4 (6.6%)     4 (5.9%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                                      31.20        33.00        NA             NA            28.00        30.00        NA             NA            30.75        36.50        NA             NA       </span></span>
<span><span class="co">#   B                                         7 (10.0%)     3 (5.9%)    0 (NA%)       0 (NA%)         3 (5.4%)     3 (6.0%)    0 (NA%)       0 (NA%)         6 (9.8%)     6 (8.8%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                                      36.14        34.33        NA             NA            29.67        32.00        NA             NA            36.33        31.00        NA             NA       </span></span>
<span><span class="co">#   C                                          6 (8.6%)    6 (11.8%)    0 (NA%)       0 (NA%)         4 (7.1%)    7 (14.0%)    0 (NA%)       0 (NA%)         3 (4.9%)     4 (5.9%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                                      31.33        39.67        NA             NA            34.50        34.00        NA             NA            33.00        36.50        NA             NA       </span></span>
<span><span class="co"># WHITE                                       8 (11.4%)    6 (11.8%)    0 (NA%)       0 (NA%)        7 (12.5%)    7 (14.0%)    0 (NA%)       0 (NA%)        8 (13.1%)    10 (14.7%)   0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#   A                                          2 (2.9%)     1 (2.0%)    0 (NA%)       0 (NA%)         3 (5.4%)     3 (6.0%)    0 (NA%)       0 (NA%)         1 (1.6%)     5 (7.4%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                                      34.00        45.00        NA             NA            29.33        33.33        NA             NA            35.00        32.80        NA             NA       </span></span>
<span><span class="co">#   B                                          4 (5.7%)     3 (5.9%)    0 (NA%)       0 (NA%)         1 (1.8%)     4 (8.0%)    0 (NA%)       0 (NA%)         3 (4.9%)     1 (1.5%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                                      37.00        43.67        NA             NA            48.00        36.75        NA             NA            34.33        36.00        NA             NA       </span></span>
<span><span class="co">#   C                                          2 (2.9%)     2 (3.9%)    0 (NA%)       0 (NA%)         3 (5.4%)     0 (0.0%)    0 (NA%)       0 (NA%)         4 (6.6%)     4 (5.9%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                                      35.50        44.00        NA             NA            44.67          NA         NA             NA            38.50        35.00        NA             NA       </span></span>
<span><span class="co"># AMERICAN INDIAN OR ALASKA NATIVE             0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#   A                                          0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                                        NA           NA         NA             NA              NA           NA         NA             NA              NA           NA         NA             NA       </span></span>
<span><span class="co">#   B                                          0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                                        NA           NA         NA             NA              NA           NA         NA             NA              NA           NA         NA             NA       </span></span>
<span><span class="co">#   C                                          0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                                        NA           NA         NA             NA              NA           NA         NA             NA              NA           NA         NA             NA       </span></span>
<span><span class="co"># MULTIPLE                                     0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#   A                                          0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                                        NA           NA         NA             NA              NA           NA         NA             NA              NA           NA         NA             NA       </span></span>
<span><span class="co">#   B                                          0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                                        NA           NA         NA             NA              NA           NA         NA             NA              NA           NA         NA             NA       </span></span>
<span><span class="co">#   C                                          0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                                        NA           NA         NA             NA              NA           NA         NA             NA              NA           NA         NA             NA       </span></span>
<span><span class="co"># NATIVE HAWAIIAN OR OTHER PACIFIC ISLANDER    0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#   A                                          0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                                        NA           NA         NA             NA              NA           NA         NA             NA              NA           NA         NA             NA       </span></span>
<span><span class="co">#   B                                          0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                                        NA           NA         NA             NA              NA           NA         NA             NA              NA           NA         NA             NA       </span></span>
<span><span class="co">#   C                                          0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                                        NA           NA         NA             NA              NA           NA         NA             NA              NA           NA         NA             NA       </span></span>
<span><span class="co"># OTHER                                        0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#   A                                          0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                                        NA           NA         NA             NA              NA           NA         NA             NA              NA           NA         NA             NA       </span></span>
<span><span class="co">#   B                                          0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                                        NA           NA         NA             NA              NA           NA         NA             NA              NA           NA         NA             NA       </span></span>
<span><span class="co">#   C                                          0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                                        NA           NA         NA             NA              NA           NA         NA             NA              NA           NA         NA             NA       </span></span>
<span><span class="co"># UNKNOWN                                      0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#   A                                          0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                                        NA           NA         NA             NA              NA           NA         NA             NA              NA           NA         NA             NA       </span></span>
<span><span class="co">#   B                                          0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                                        NA           NA         NA             NA              NA           NA         NA             NA              NA           NA         NA             NA       </span></span>
<span><span class="co">#   C                                          0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)         0 (0.0%)     0 (0.0%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                                        NA           NA         NA             NA              NA           NA         NA             NA              NA           NA         NA             NA</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="trimming">Trimming<a class="anchor" aria-label="anchor" href="#trimming"></a>
</h3>
<div class="section level4">
<h4 id="trimming-rows">Trimming Rows<a class="anchor" aria-label="anchor" href="#trimming-rows"></a>
</h4>
<p>Trimming represents a convenience wrapper around simple, direct
subsetting of the rows of a <code>TableTree</code>.</p>
<p>We use the <code><a href="../reference/trim_rows.html">trim_rows()</a></code> function with our table and a
criteria function. All rows where the criteria function returns
<code>TRUE</code> will be removed, and all others will be retained.</p>
<p><strong>NOTE</strong>: Each row is kept or removed completely
independently, with no awareness of the surrounding structure. This
means, for example, that a subtree could have all its analysis rows
removed and not be removed itself. This can easily result in a
<em>degenerate table</em> which has an invalid structure (see
<code><a href="../reference/validate_table_struct.html">?validate_table_struct</a></code>); for this reason trimming is
generally not suggested for tables with non-trivial row structures. For
structure-aware filtering of a table, we will use <em>pruning</em>
described in the next section.</p>
<p>A <em>trimming function</em> accepts a <code>TableRow</code> object
and returns <code>TRUE</code> if the row should be removed.</p>
<p>The default trimming function removes rows in which all columns have
no values in them, i.e. that have all <code>NA</code> values or all
<code>0</code> values:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/trim_rows.html">trim_rows</a></span><span class="op">(</span><span class="va">raw_tbl</span><span class="op">)</span></span>
<span><span class="co">#                                                  A: Drug X                                              B: Placebo                                           C: Combination                   </span></span>
<span><span class="co">#                                 F            M           U      UNDIFFERENTIATED       F            M           U      UNDIFFERENTIATED       F            M           U      UNDIFFERENTIATED</span></span>
<span><span class="co"># ——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># ASIAN                       44 (62.9%)   35 (68.6%)   0 (NA%)       0 (NA%)        37 (66.1%)   31 (62.0%)   0 (NA%)       0 (NA%)        40 (65.6%)   44 (64.7%)   0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#   A                         15 (21.4%)   12 (23.5%)   0 (NA%)       0 (NA%)        14 (25.0%)   6 (12.0%)    0 (NA%)       0 (NA%)        15 (24.6%)   16 (23.5%)   0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                      30.40        34.42        NA             NA            35.43        30.33        NA             NA            37.40        36.25        NA             NA       </span></span>
<span><span class="co">#   B                         16 (22.9%)   8 (15.7%)    0 (NA%)       0 (NA%)        13 (23.2%)   16 (32.0%)   0 (NA%)       0 (NA%)        10 (16.4%)   12 (17.6%)   0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                      33.75        34.88        NA             NA            32.46        30.94        NA             NA            33.30        35.92        NA             NA       </span></span>
<span><span class="co">#   C                         13 (18.6%)   15 (29.4%)   0 (NA%)       0 (NA%)        10 (17.9%)   9 (18.0%)    0 (NA%)       0 (NA%)        15 (24.6%)   16 (23.5%)   0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                      36.92        35.60        NA             NA            34.00        31.89        NA             NA            33.47        31.38        NA             NA       </span></span>
<span><span class="co"># BLACK OR AFRICAN AMERICAN   18 (25.7%)   10 (19.6%)   0 (NA%)       0 (NA%)        12 (21.4%)   12 (24.0%)   0 (NA%)       0 (NA%)        13 (21.3%)   14 (20.6%)   0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#   A                          5 (7.1%)     1 (2.0%)    0 (NA%)       0 (NA%)         5 (8.9%)     2 (4.0%)    0 (NA%)       0 (NA%)         4 (6.6%)     4 (5.9%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                      31.20        33.00        NA             NA            28.00        30.00        NA             NA            30.75        36.50        NA             NA       </span></span>
<span><span class="co">#   B                         7 (10.0%)     3 (5.9%)    0 (NA%)       0 (NA%)         3 (5.4%)     3 (6.0%)    0 (NA%)       0 (NA%)         6 (9.8%)     6 (8.8%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                      36.14        34.33        NA             NA            29.67        32.00        NA             NA            36.33        31.00        NA             NA       </span></span>
<span><span class="co">#   C                          6 (8.6%)    6 (11.8%)    0 (NA%)       0 (NA%)         4 (7.1%)    7 (14.0%)    0 (NA%)       0 (NA%)         3 (4.9%)     4 (5.9%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                      31.33        39.67        NA             NA            34.50        34.00        NA             NA            33.00        36.50        NA             NA       </span></span>
<span><span class="co"># WHITE                       8 (11.4%)    6 (11.8%)    0 (NA%)       0 (NA%)        7 (12.5%)    7 (14.0%)    0 (NA%)       0 (NA%)        8 (13.1%)    10 (14.7%)   0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#   A                          2 (2.9%)     1 (2.0%)    0 (NA%)       0 (NA%)         3 (5.4%)     3 (6.0%)    0 (NA%)       0 (NA%)         1 (1.6%)     5 (7.4%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                      34.00        45.00        NA             NA            29.33        33.33        NA             NA            35.00        32.80        NA             NA       </span></span>
<span><span class="co">#   B                          4 (5.7%)     3 (5.9%)    0 (NA%)       0 (NA%)         1 (1.8%)     4 (8.0%)    0 (NA%)       0 (NA%)         3 (4.9%)     1 (1.5%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                      37.00        43.67        NA             NA            48.00        36.75        NA             NA            34.33        36.00        NA             NA       </span></span>
<span><span class="co">#   C                          2 (2.9%)     2 (3.9%)    0 (NA%)       0 (NA%)         3 (5.4%)     0 (0.0%)    0 (NA%)       0 (NA%)         4 (6.6%)     4 (5.9%)    0 (NA%)       0 (NA%)     </span></span>
<span><span class="co">#     Mean                      35.50        44.00        NA             NA            44.67          NA         NA             NA            38.50        35.00        NA             NA</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="trimming-columns">Trimming Columns<a class="anchor" aria-label="anchor" href="#trimming-columns"></a>
</h4>
<p>There are currently no special utilities for trimming columns but we
can remove the empty columns with fairly straightforward column
subsetting using the <code><a href="../reference/col_accessors.html">col_counts()</a></code> function:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coltrimmed</span> <span class="op">&lt;-</span> <span class="va">raw_tbl</span><span class="op">[</span>, <span class="fu"><a href="../reference/col_accessors.html">col_counts</a></span><span class="op">(</span><span class="va">raw_tbl</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span></span>
<span><span class="co"># Note: method with signature 'VTableTree#missing#ANY' chosen for function '[',</span></span>
<span><span class="co">#  target signature 'TableTree#missing#logical'.</span></span>
<span><span class="co">#  "VTableTree#ANY#logical" would also be valid</span></span>
<span><span class="va">h_coltrimmed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/head_tail.html">head</a></span><span class="op">(</span><span class="va">coltrimmed</span>, n <span class="op">=</span> <span class="fl">14</span><span class="op">)</span></span>
<span><span class="va">h_coltrimmed</span></span>
<span><span class="co">#                                    A: Drug X                B: Placebo              C: Combination     </span></span>
<span><span class="co">#                                 F            M            F            M            F            M     </span></span>
<span><span class="co"># ———————————————————————————————————————————————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># ASIAN                       44 (62.9%)   35 (68.6%)   37 (66.1%)   31 (62.0%)   40 (65.6%)   44 (64.7%)</span></span>
<span><span class="co">#   A                         15 (21.4%)   12 (23.5%)   14 (25.0%)   6 (12.0%)    15 (24.6%)   16 (23.5%)</span></span>
<span><span class="co">#     Mean                      30.40        34.42        35.43        30.33        37.40        36.25   </span></span>
<span><span class="co">#   B                         16 (22.9%)   8 (15.7%)    13 (23.2%)   16 (32.0%)   10 (16.4%)   12 (17.6%)</span></span>
<span><span class="co">#     Mean                      33.75        34.88        32.46        30.94        33.30        35.92   </span></span>
<span><span class="co">#   C                         13 (18.6%)   15 (29.4%)   10 (17.9%)   9 (18.0%)    15 (24.6%)   16 (23.5%)</span></span>
<span><span class="co">#     Mean                      36.92        35.60        34.00        31.89        33.47        31.38   </span></span>
<span><span class="co"># BLACK OR AFRICAN AMERICAN   18 (25.7%)   10 (19.6%)   12 (21.4%)   12 (24.0%)   13 (21.3%)   14 (20.6%)</span></span>
<span><span class="co">#   A                          5 (7.1%)     1 (2.0%)     5 (8.9%)     2 (4.0%)     4 (6.6%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      31.20        33.00        28.00        30.00        30.75        36.50   </span></span>
<span><span class="co">#   B                         7 (10.0%)     3 (5.9%)     3 (5.4%)     3 (6.0%)     6 (9.8%)     6 (8.8%) </span></span>
<span><span class="co">#     Mean                      36.14        34.33        29.67        32.00        36.33        31.00   </span></span>
<span><span class="co">#   C                          6 (8.6%)    6 (11.8%)     4 (7.1%)    7 (14.0%)     3 (4.9%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      31.33        39.67        34.50        34.00        33.00        36.50</span></span></code></pre></div>
<p>Now, it is interesting to see how this table is structured:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/table_structure.html">table_structure</a></span><span class="op">(</span><span class="va">h_coltrimmed</span><span class="op">)</span></span>
<span><span class="co"># [TableTree] RACE</span></span>
<span><span class="co">#  [TableTree] ASIAN [cont: 1 x 6]</span></span>
<span><span class="co">#   [TableTree] STRATA1</span></span>
<span><span class="co">#    [TableTree] A [cont: 1 x 6]</span></span>
<span><span class="co">#     [ElementaryTable] AGE (1 x 6)</span></span>
<span><span class="co">#    [TableTree] B [cont: 1 x 6]</span></span>
<span><span class="co">#     [ElementaryTable] AGE (1 x 6)</span></span>
<span><span class="co">#    [TableTree] C [cont: 1 x 6]</span></span>
<span><span class="co">#     [ElementaryTable] AGE (1 x 6)</span></span>
<span><span class="co">#  [TableTree] BLACK OR AFRICAN AMERICAN [cont: 1 x 6]</span></span>
<span><span class="co">#   [TableTree] STRATA1</span></span>
<span><span class="co">#    [TableTree] A [cont: 1 x 6]</span></span>
<span><span class="co">#     [ElementaryTable] AGE (1 x 6)</span></span>
<span><span class="co">#    [TableTree] B [cont: 1 x 6]</span></span>
<span><span class="co">#     [ElementaryTable] AGE (1 x 6)</span></span>
<span><span class="co">#    [TableTree] C [cont: 1 x 6]</span></span>
<span><span class="co">#     [ElementaryTable] AGE (1 x 6)</span></span></code></pre></div>
<p>For a deeper understanding of the fundamental structures in
<code>rtables</code>, we suggest taking a look at slides 69-76 of this
<a href="https://docs.google.com/presentation/d/1ygQE9UaoXY6C_FiQLkiYtXB_OnkVbXvsMIY6_MQPbx0/edit?usp=sharing" class="external-link">Slide
deck</a>.</p>
<p>In brief, it is important to notice how <code>[TableTree] RACE</code>
is the root of the table that is split (with
<code>split_rows_by("RACE") %&gt;%</code>) into two subtables:
<code>[TableTree] ASIAN [cont: 1 x 6]</code> and
<code>[TableTree] BLACK OR AFRICAN AMERICAN [cont: 1 x 6]</code>. These
are then “described” with <code>summarize_row_groups() %&gt;%</code>,
which creates for every split a “content” table containing 1 row (the 1
in <code>cont: 1 x 6</code>), which when rendered takes the place of
<code>LabelRow</code>.</p>
<p>Each of these two subtables then contain a <code>STRATA1</code>
table, representing the further <code>split_rows_by("STRATA1")</code> in
the layout, which, similar to the <code>RACE</code> table, is split into
subtables: one for each strata which have similar content tables; Each
individual strata subtable, then, contains an
<code>ElementaryTable</code> (whose children are individual rows)
generated by the <code>analyze("AGE")</code> layout directive,
i.e. <code>[ElementaryTable] AGE (1 x 6)</code>.</p>
<p>This subtable and row structure is very important for both sorting
and pruning; values in “content” (<code>ContentRow</code>) and “value”
(<code>DataRow</code>) rows use different access functions and they
should be treated differently.</p>
<p>Another interesting function that can be used to understand the
connection between row names and their representational path is the
following:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/row_paths_summary.html">row_paths_summary</a></span><span class="op">(</span><span class="va">h_coltrimmed</span><span class="op">)</span></span>
<span><span class="co"># rowname                      node_class    path                                                                </span></span>
<span><span class="co"># ———————————————————————————————————————————————————————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># ASIAN                        ContentRow    RACE, ASIAN, @content, ASIAN                                        </span></span>
<span><span class="co">#   A                          ContentRow    RACE, ASIAN, STRATA1, A, @content, A                                </span></span>
<span><span class="co">#     Mean                     DataRow       RACE, ASIAN, STRATA1, A, AGE, Mean                                  </span></span>
<span><span class="co">#   B                          ContentRow    RACE, ASIAN, STRATA1, B, @content, B                                </span></span>
<span><span class="co">#     Mean                     DataRow       RACE, ASIAN, STRATA1, B, AGE, Mean                                  </span></span>
<span><span class="co">#   C                          ContentRow    RACE, ASIAN, STRATA1, C, @content, C                                </span></span>
<span><span class="co">#     Mean                     DataRow       RACE, ASIAN, STRATA1, C, AGE, Mean                                  </span></span>
<span><span class="co"># BLACK OR AFRICAN AMERICAN    ContentRow    RACE, BLACK OR AFRICAN AMERICAN, @content, BLACK OR AFRICAN AMERICAN</span></span>
<span><span class="co">#   A                          ContentRow    RACE, BLACK OR AFRICAN AMERICAN, STRATA1, A, @content, A            </span></span>
<span><span class="co">#     Mean                     DataRow       RACE, BLACK OR AFRICAN AMERICAN, STRATA1, A, AGE, Mean              </span></span>
<span><span class="co">#   B                          ContentRow    RACE, BLACK OR AFRICAN AMERICAN, STRATA1, B, @content, B            </span></span>
<span><span class="co">#     Mean                     DataRow       RACE, BLACK OR AFRICAN AMERICAN, STRATA1, B, AGE, Mean              </span></span>
<span><span class="co">#   C                          ContentRow    RACE, BLACK OR AFRICAN AMERICAN, STRATA1, C, @content, C            </span></span>
<span><span class="co">#     Mean                     DataRow       RACE, BLACK OR AFRICAN AMERICAN, STRATA1, C, AGE, Mean</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="pruning">Pruning<a class="anchor" aria-label="anchor" href="#pruning"></a>
</h3>
<p>Pruning is similar in outcome to trimming, but more powerful and more
complex, as it takes structure into account.</p>
<p>Pruning is applied recursively, in that at each structural unit
(subtable, row) it applies the pruning function both at that level and
to all it’s children (up to a user-specifiable maximum depth).</p>
<p>The default pruning function, for example, determines if a subtree is
empty by:</p>
<ol style="list-style-type: decimal">
<li>Removing all children which contain a single content row which
contains all zeros or all <code>NA</code>s</li>
<li>Removing rows which contain either all zeros or all
<code>NA</code>s</li>
<li>Removing the full subtree if no unpruned children remain</li>
</ol>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pruned</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prune_table.html">prune_table</a></span><span class="op">(</span><span class="va">coltrimmed</span><span class="op">)</span></span>
<span><span class="va">pruned</span></span>
<span><span class="co">#                                    A: Drug X                B: Placebo              C: Combination     </span></span>
<span><span class="co">#                                 F            M            F            M            F            M     </span></span>
<span><span class="co"># ———————————————————————————————————————————————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># ASIAN                       44 (62.9%)   35 (68.6%)   37 (66.1%)   31 (62.0%)   40 (65.6%)   44 (64.7%)</span></span>
<span><span class="co">#   A                         15 (21.4%)   12 (23.5%)   14 (25.0%)   6 (12.0%)    15 (24.6%)   16 (23.5%)</span></span>
<span><span class="co">#     Mean                      30.40        34.42        35.43        30.33        37.40        36.25   </span></span>
<span><span class="co">#   B                         16 (22.9%)   8 (15.7%)    13 (23.2%)   16 (32.0%)   10 (16.4%)   12 (17.6%)</span></span>
<span><span class="co">#     Mean                      33.75        34.88        32.46        30.94        33.30        35.92   </span></span>
<span><span class="co">#   C                         13 (18.6%)   15 (29.4%)   10 (17.9%)   9 (18.0%)    15 (24.6%)   16 (23.5%)</span></span>
<span><span class="co">#     Mean                      36.92        35.60        34.00        31.89        33.47        31.38   </span></span>
<span><span class="co"># BLACK OR AFRICAN AMERICAN   18 (25.7%)   10 (19.6%)   12 (21.4%)   12 (24.0%)   13 (21.3%)   14 (20.6%)</span></span>
<span><span class="co">#   A                          5 (7.1%)     1 (2.0%)     5 (8.9%)     2 (4.0%)     4 (6.6%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      31.20        33.00        28.00        30.00        30.75        36.50   </span></span>
<span><span class="co">#   B                         7 (10.0%)     3 (5.9%)     3 (5.4%)     3 (6.0%)     6 (9.8%)     6 (8.8%) </span></span>
<span><span class="co">#     Mean                      36.14        34.33        29.67        32.00        36.33        31.00   </span></span>
<span><span class="co">#   C                          6 (8.6%)    6 (11.8%)     4 (7.1%)    7 (14.0%)     3 (4.9%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      31.33        39.67        34.50        34.00        33.00        36.50   </span></span>
<span><span class="co"># WHITE                       8 (11.4%)    6 (11.8%)    7 (12.5%)    7 (14.0%)    8 (13.1%)    10 (14.7%)</span></span>
<span><span class="co">#   A                          2 (2.9%)     1 (2.0%)     3 (5.4%)     3 (6.0%)     1 (1.6%)     5 (7.4%) </span></span>
<span><span class="co">#     Mean                      34.00        45.00        29.33        33.33        35.00        32.80   </span></span>
<span><span class="co">#   B                          4 (5.7%)     3 (5.9%)     1 (1.8%)     4 (8.0%)     3 (4.9%)     1 (1.5%) </span></span>
<span><span class="co">#     Mean                      37.00        43.67        48.00        36.75        34.33        36.00   </span></span>
<span><span class="co">#   C                          2 (2.9%)     2 (3.9%)     3 (5.4%)     0 (0.0%)     4 (6.6%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      35.50        44.00        44.67          NA         38.50        35.00</span></span></code></pre></div>
<p>We can also use the <code><a href="../reference/trim_prune_funs.html">low_obs_pruner()</a></code> pruning function
constructor to create a pruning function which removes subtrees with
content summaries whose first entries for each column sum or average are
below a specified number. (In the default summaries the first entry per
column is the count).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pruned2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prune_table.html">prune_table</a></span><span class="op">(</span><span class="va">coltrimmed</span>, <span class="fu"><a href="../reference/trim_prune_funs.html">low_obs_pruner</a></span><span class="op">(</span><span class="fl">10</span>, <span class="st">"mean"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pruned2</span></span>
<span><span class="co">#                   A: Drug X                B: Placebo              C: Combination     </span></span>
<span><span class="co">#                F            M            F            M            F            M     </span></span>
<span><span class="co"># ——————————————————————————————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># ASIAN      44 (62.9%)   35 (68.6%)   37 (66.1%)   31 (62.0%)   40 (65.6%)   44 (64.7%)</span></span>
<span><span class="co">#   A        15 (21.4%)   12 (23.5%)   14 (25.0%)   6 (12.0%)    15 (24.6%)   16 (23.5%)</span></span>
<span><span class="co">#     Mean     30.40        34.42        35.43        30.33        37.40        36.25   </span></span>
<span><span class="co">#   B        16 (22.9%)   8 (15.7%)    13 (23.2%)   16 (32.0%)   10 (16.4%)   12 (17.6%)</span></span>
<span><span class="co">#     Mean     33.75        34.88        32.46        30.94        33.30        35.92   </span></span>
<span><span class="co">#   C        13 (18.6%)   15 (29.4%)   10 (17.9%)   9 (18.0%)    15 (24.6%)   16 (23.5%)</span></span>
<span><span class="co">#     Mean     36.92        35.60        34.00        31.89        33.47        31.38</span></span></code></pre></div>
<p>Note that because the pruning is being applied recursively, only the
<code>ASIAN</code> subtree remains because even though the full
<code>BLACK OR AFRICAN AMERICAN</code> subtree encompassed enough
observations, the strata within it did not. We can take care of this by
setting the <code>stop_depth</code> for pruning to <code>1</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pruned3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prune_table.html">prune_table</a></span><span class="op">(</span><span class="va">coltrimmed</span>, <span class="fu"><a href="../reference/trim_prune_funs.html">low_obs_pruner</a></span><span class="op">(</span><span class="fl">10</span>, <span class="st">"sum"</span><span class="op">)</span>, stop_depth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">pruned3</span></span>
<span><span class="co">#                                    A: Drug X                B: Placebo              C: Combination     </span></span>
<span><span class="co">#                                 F            M            F            M            F            M     </span></span>
<span><span class="co"># ———————————————————————————————————————————————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># ASIAN                       44 (62.9%)   35 (68.6%)   37 (66.1%)   31 (62.0%)   40 (65.6%)   44 (64.7%)</span></span>
<span><span class="co">#   A                         15 (21.4%)   12 (23.5%)   14 (25.0%)   6 (12.0%)    15 (24.6%)   16 (23.5%)</span></span>
<span><span class="co">#     Mean                      30.40        34.42        35.43        30.33        37.40        36.25   </span></span>
<span><span class="co">#   B                         16 (22.9%)   8 (15.7%)    13 (23.2%)   16 (32.0%)   10 (16.4%)   12 (17.6%)</span></span>
<span><span class="co">#     Mean                      33.75        34.88        32.46        30.94        33.30        35.92   </span></span>
<span><span class="co">#   C                         13 (18.6%)   15 (29.4%)   10 (17.9%)   9 (18.0%)    15 (24.6%)   16 (23.5%)</span></span>
<span><span class="co">#     Mean                      36.92        35.60        34.00        31.89        33.47        31.38   </span></span>
<span><span class="co"># BLACK OR AFRICAN AMERICAN   18 (25.7%)   10 (19.6%)   12 (21.4%)   12 (24.0%)   13 (21.3%)   14 (20.6%)</span></span>
<span><span class="co">#   A                          5 (7.1%)     1 (2.0%)     5 (8.9%)     2 (4.0%)     4 (6.6%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      31.20        33.00        28.00        30.00        30.75        36.50   </span></span>
<span><span class="co">#   B                         7 (10.0%)     3 (5.9%)     3 (5.4%)     3 (6.0%)     6 (9.8%)     6 (8.8%) </span></span>
<span><span class="co">#     Mean                      36.14        34.33        29.67        32.00        36.33        31.00   </span></span>
<span><span class="co">#   C                          6 (8.6%)    6 (11.8%)     4 (7.1%)    7 (14.0%)     3 (4.9%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      31.33        39.67        34.50        34.00        33.00        36.50   </span></span>
<span><span class="co"># WHITE                       8 (11.4%)    6 (11.8%)    7 (12.5%)    7 (14.0%)    8 (13.1%)    10 (14.7%)</span></span>
<span><span class="co">#   A                          2 (2.9%)     1 (2.0%)     3 (5.4%)     3 (6.0%)     1 (1.6%)     5 (7.4%) </span></span>
<span><span class="co">#     Mean                      34.00        45.00        29.33        33.33        35.00        32.80   </span></span>
<span><span class="co">#   B                          4 (5.7%)     3 (5.9%)     1 (1.8%)     4 (8.0%)     3 (4.9%)     1 (1.5%) </span></span>
<span><span class="co">#     Mean                      37.00        43.67        48.00        36.75        34.33        36.00   </span></span>
<span><span class="co">#   C                          2 (2.9%)     2 (3.9%)     3 (5.4%)     0 (0.0%)     4 (6.6%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      35.50        44.00        44.67          NA         38.50        35.00</span></span></code></pre></div>
<p>We can also see that pruning to a lower number of observations, say,
to a total of <code>16</code>, with no <code>stop_depth</code> removes
some but not all of the strata from our third race
(<code>WHITE</code>).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pruned4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prune_table.html">prune_table</a></span><span class="op">(</span><span class="va">coltrimmed</span>, <span class="fu"><a href="../reference/trim_prune_funs.html">low_obs_pruner</a></span><span class="op">(</span><span class="fl">16</span>, <span class="st">"sum"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pruned4</span></span>
<span><span class="co">#                                    A: Drug X                B: Placebo              C: Combination     </span></span>
<span><span class="co">#                                 F            M            F            M            F            M     </span></span>
<span><span class="co"># ———————————————————————————————————————————————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># ASIAN                       44 (62.9%)   35 (68.6%)   37 (66.1%)   31 (62.0%)   40 (65.6%)   44 (64.7%)</span></span>
<span><span class="co">#   A                         15 (21.4%)   12 (23.5%)   14 (25.0%)   6 (12.0%)    15 (24.6%)   16 (23.5%)</span></span>
<span><span class="co">#     Mean                      30.40        34.42        35.43        30.33        37.40        36.25   </span></span>
<span><span class="co">#   B                         16 (22.9%)   8 (15.7%)    13 (23.2%)   16 (32.0%)   10 (16.4%)   12 (17.6%)</span></span>
<span><span class="co">#     Mean                      33.75        34.88        32.46        30.94        33.30        35.92   </span></span>
<span><span class="co">#   C                         13 (18.6%)   15 (29.4%)   10 (17.9%)   9 (18.0%)    15 (24.6%)   16 (23.5%)</span></span>
<span><span class="co">#     Mean                      36.92        35.60        34.00        31.89        33.47        31.38   </span></span>
<span><span class="co"># BLACK OR AFRICAN AMERICAN   18 (25.7%)   10 (19.6%)   12 (21.4%)   12 (24.0%)   13 (21.3%)   14 (20.6%)</span></span>
<span><span class="co">#   A                          5 (7.1%)     1 (2.0%)     5 (8.9%)     2 (4.0%)     4 (6.6%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      31.20        33.00        28.00        30.00        30.75        36.50   </span></span>
<span><span class="co">#   B                         7 (10.0%)     3 (5.9%)     3 (5.4%)     3 (6.0%)     6 (9.8%)     6 (8.8%) </span></span>
<span><span class="co">#     Mean                      36.14        34.33        29.67        32.00        36.33        31.00   </span></span>
<span><span class="co">#   C                          6 (8.6%)    6 (11.8%)     4 (7.1%)    7 (14.0%)     3 (4.9%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      31.33        39.67        34.50        34.00        33.00        36.50   </span></span>
<span><span class="co"># WHITE                       8 (11.4%)    6 (11.8%)    7 (12.5%)    7 (14.0%)    8 (13.1%)    10 (14.7%)</span></span>
<span><span class="co">#   B                          4 (5.7%)     3 (5.9%)     1 (1.8%)     4 (8.0%)     3 (4.9%)     1 (1.5%) </span></span>
<span><span class="co">#     Mean                      37.00        43.67        48.00        36.75        34.33        36.00</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="sorting">Sorting<a class="anchor" aria-label="anchor" href="#sorting"></a>
</h3>
<div class="section level4">
<h4 id="sorting-fundamentals">Sorting Fundamentals<a class="anchor" aria-label="anchor" href="#sorting-fundamentals"></a>
</h4>
<p>Sorting of an <code>rtables</code> table is done <strong>at a
path</strong>, meaning a sort operation will occur at a particular
location within the table, and the <em>direct children</em> of the
element at that path will be reordered. This occurs whether those
children are subtables themselves, or individual rows. Sorting is done
via the <code><a href="../reference/sort_at_path.html">sort_at_path()</a></code> function, which accepts both a (row)
path and a scoring function. See the <a href="pathing.html">pathing
vignette</a> for details about paths.</p>
<p>A <em>score function</em> accepts a subtree or <code>TableRow</code>
and returns a single orderable (typically numeric) value. Within the
subtable currently being sorted, the children are then reordered by the
value of the score function. Importantly, “content”
(<code>ContentRow</code>) and “values” (<code>DataRow</code>) need to be
treated differently in the scoring function as they are retrieved: the
<em>content</em> of a subtable is retrieved via the
<code>content _table</code> accessor.</p>
<p>The <code><a href="../reference/score_funs.html">cont_n_allcols()</a></code> scoring function provided by
<code>rtables</code>, works by scoring subtables by the sum of the first
elements in the first row of the subtable’s <em>content</em> table. Note
that this function fails if the child being scored does not have a
content function (i.e., if <code><a href="../reference/summarize_row_groups.html">summarize_row_groups()</a></code> was not
used at the corresponding point in the layout). We can see this in it’s
definition, below:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cont_n_allcols</span></span>
<span><span class="co"># function (tt) </span></span>
<span><span class="co"># {</span></span>
<span><span class="co">#     ctab &lt;- content_table(tt)</span></span>
<span><span class="co">#     if (NROW(ctab) == 0) {</span></span>
<span><span class="co">#         stop("cont_n_allcols score function used at subtable [", </span></span>
<span><span class="co">#             obj_name(tt), "] that has no content table.")</span></span>
<span><span class="co">#     }</span></span>
<span><span class="co">#     sum(sapply(row_values(tree_children(ctab)[[1]]), function(cv) cv[1]))</span></span>
<span><span class="co"># }</span></span>
<span><span class="co"># &lt;bytecode: 0x55bcb3f01478&gt;</span></span>
<span><span class="co"># &lt;environment: namespace:rtables&gt;</span></span></code></pre></div>
<p>Therefore, a fundamental difference between pruning and sorting is
that sorting occurs at particular places in the table, as defined by a
path.</p>
<p>For example, we can sort the strata values (<code>ContentRow</code>)
by observation counts within just the <code>ASIAN</code> subtable:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/sort_at_path.html">sort_at_path</a></span><span class="op">(</span><span class="va">pruned</span>, path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"RACE"</span>, <span class="st">"ASIAN"</span>, <span class="st">"STRATA1"</span><span class="op">)</span>, scorefun <span class="op">=</span> <span class="va">cont_n_allcols</span><span class="op">)</span></span>
<span><span class="co">#                                    A: Drug X                B: Placebo              C: Combination     </span></span>
<span><span class="co">#                                 F            M            F            M            F            M     </span></span>
<span><span class="co"># ———————————————————————————————————————————————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># ASIAN                       44 (62.9%)   35 (68.6%)   37 (66.1%)   31 (62.0%)   40 (65.6%)   44 (64.7%)</span></span>
<span><span class="co">#   A                         15 (21.4%)   12 (23.5%)   14 (25.0%)   6 (12.0%)    15 (24.6%)   16 (23.5%)</span></span>
<span><span class="co">#     Mean                      30.40        34.42        35.43        30.33        37.40        36.25   </span></span>
<span><span class="co">#   C                         13 (18.6%)   15 (29.4%)   10 (17.9%)   9 (18.0%)    15 (24.6%)   16 (23.5%)</span></span>
<span><span class="co">#     Mean                      36.92        35.60        34.00        31.89        33.47        31.38   </span></span>
<span><span class="co">#   B                         16 (22.9%)   8 (15.7%)    13 (23.2%)   16 (32.0%)   10 (16.4%)   12 (17.6%)</span></span>
<span><span class="co">#     Mean                      33.75        34.88        32.46        30.94        33.30        35.92   </span></span>
<span><span class="co"># BLACK OR AFRICAN AMERICAN   18 (25.7%)   10 (19.6%)   12 (21.4%)   12 (24.0%)   13 (21.3%)   14 (20.6%)</span></span>
<span><span class="co">#   A                          5 (7.1%)     1 (2.0%)     5 (8.9%)     2 (4.0%)     4 (6.6%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      31.20        33.00        28.00        30.00        30.75        36.50   </span></span>
<span><span class="co">#   B                         7 (10.0%)     3 (5.9%)     3 (5.4%)     3 (6.0%)     6 (9.8%)     6 (8.8%) </span></span>
<span><span class="co">#     Mean                      36.14        34.33        29.67        32.00        36.33        31.00   </span></span>
<span><span class="co">#   C                          6 (8.6%)    6 (11.8%)     4 (7.1%)    7 (14.0%)     3 (4.9%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      31.33        39.67        34.50        34.00        33.00        36.50   </span></span>
<span><span class="co"># WHITE                       8 (11.4%)    6 (11.8%)    7 (12.5%)    7 (14.0%)    8 (13.1%)    10 (14.7%)</span></span>
<span><span class="co">#   A                          2 (2.9%)     1 (2.0%)     3 (5.4%)     3 (6.0%)     1 (1.6%)     5 (7.4%) </span></span>
<span><span class="co">#     Mean                      34.00        45.00        29.33        33.33        35.00        32.80   </span></span>
<span><span class="co">#   B                          4 (5.7%)     3 (5.9%)     1 (1.8%)     4 (8.0%)     3 (4.9%)     1 (1.5%) </span></span>
<span><span class="co">#     Mean                      37.00        43.67        48.00        36.75        34.33        36.00   </span></span>
<span><span class="co">#   C                          2 (2.9%)     2 (3.9%)     3 (5.4%)     0 (0.0%)     4 (6.6%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      35.50        44.00        44.67          NA         38.50        35.00</span></span>
<span><span class="co"># B and C are swapped as the global count (sum of all column counts) of strata C is higher than the one of strata B</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="wildcards-in-sort-paths">Wildcards in Sort Paths<a class="anchor" aria-label="anchor" href="#wildcards-in-sort-paths"></a>
</h4>
<p>A sorting path can contain one or more instances of the “*” wildcard.
Each of these indicates that the children of each subtable matching this
<code>*</code> element of the path should be sorted
<strong>separately</strong> as indicated by the remainder of the path
after the <code>*</code> and the score function.</p>
<p>Thus we can extend our sorting of strata within the
<code>ASIAN</code> subtable to all race-specific subtables by using the
wildcard:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/sort_at_path.html">sort_at_path</a></span><span class="op">(</span><span class="va">pruned</span>, path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"RACE"</span>, <span class="st">"*"</span>, <span class="st">"STRATA1"</span><span class="op">)</span>, scorefun <span class="op">=</span> <span class="va">cont_n_allcols</span><span class="op">)</span></span>
<span><span class="co">#                                    A: Drug X                B: Placebo              C: Combination     </span></span>
<span><span class="co">#                                 F            M            F            M            F            M     </span></span>
<span><span class="co"># ———————————————————————————————————————————————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># ASIAN                       44 (62.9%)   35 (68.6%)   37 (66.1%)   31 (62.0%)   40 (65.6%)   44 (64.7%)</span></span>
<span><span class="co">#   A                         15 (21.4%)   12 (23.5%)   14 (25.0%)   6 (12.0%)    15 (24.6%)   16 (23.5%)</span></span>
<span><span class="co">#     Mean                      30.40        34.42        35.43        30.33        37.40        36.25   </span></span>
<span><span class="co">#   C                         13 (18.6%)   15 (29.4%)   10 (17.9%)   9 (18.0%)    15 (24.6%)   16 (23.5%)</span></span>
<span><span class="co">#     Mean                      36.92        35.60        34.00        31.89        33.47        31.38   </span></span>
<span><span class="co">#   B                         16 (22.9%)   8 (15.7%)    13 (23.2%)   16 (32.0%)   10 (16.4%)   12 (17.6%)</span></span>
<span><span class="co">#     Mean                      33.75        34.88        32.46        30.94        33.30        35.92   </span></span>
<span><span class="co"># BLACK OR AFRICAN AMERICAN   18 (25.7%)   10 (19.6%)   12 (21.4%)   12 (24.0%)   13 (21.3%)   14 (20.6%)</span></span>
<span><span class="co">#   C                          6 (8.6%)    6 (11.8%)     4 (7.1%)    7 (14.0%)     3 (4.9%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      31.33        39.67        34.50        34.00        33.00        36.50   </span></span>
<span><span class="co">#   B                         7 (10.0%)     3 (5.9%)     3 (5.4%)     3 (6.0%)     6 (9.8%)     6 (8.8%) </span></span>
<span><span class="co">#     Mean                      36.14        34.33        29.67        32.00        36.33        31.00   </span></span>
<span><span class="co">#   A                          5 (7.1%)     1 (2.0%)     5 (8.9%)     2 (4.0%)     4 (6.6%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      31.20        33.00        28.00        30.00        30.75        36.50   </span></span>
<span><span class="co"># WHITE                       8 (11.4%)    6 (11.8%)    7 (12.5%)    7 (14.0%)    8 (13.1%)    10 (14.7%)</span></span>
<span><span class="co">#   B                          4 (5.7%)     3 (5.9%)     1 (1.8%)     4 (8.0%)     3 (4.9%)     1 (1.5%) </span></span>
<span><span class="co">#     Mean                      37.00        43.67        48.00        36.75        34.33        36.00   </span></span>
<span><span class="co">#   A                          2 (2.9%)     1 (2.0%)     3 (5.4%)     3 (6.0%)     1 (1.6%)     5 (7.4%) </span></span>
<span><span class="co">#     Mean                      34.00        45.00        29.33        33.33        35.00        32.80   </span></span>
<span><span class="co">#   C                          2 (2.9%)     2 (3.9%)     3 (5.4%)     0 (0.0%)     4 (6.6%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      35.50        44.00        44.67          NA         38.50        35.00</span></span>
<span><span class="co"># All subtables, i.e. ASIAN, BLACK..., and WHITE, are reordered separately</span></span></code></pre></div>
<p>The above is equivalent to separately calling the following:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmptbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sort_at_path.html">sort_at_path</a></span><span class="op">(</span><span class="va">pruned</span>, path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"RACE"</span>, <span class="st">"ASIAN"</span>, <span class="st">"STRATA1"</span><span class="op">)</span>, scorefun <span class="op">=</span> <span class="va">cont_n_allcols</span><span class="op">)</span></span>
<span><span class="va">tmptbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sort_at_path.html">sort_at_path</a></span><span class="op">(</span><span class="va">tmptbl</span>, path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"RACE"</span>, <span class="st">"BLACK OR AFRICAN AMERICAN"</span>, <span class="st">"STRATA1"</span><span class="op">)</span>, scorefun <span class="op">=</span> <span class="va">cont_n_allcols</span><span class="op">)</span></span>
<span><span class="va">tmptbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sort_at_path.html">sort_at_path</a></span><span class="op">(</span><span class="va">tmptbl</span>, path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"RACE"</span>, <span class="st">"WHITE"</span>, <span class="st">"STRATA1"</span><span class="op">)</span>, scorefun <span class="op">=</span> <span class="va">cont_n_allcols</span><span class="op">)</span></span>
<span><span class="va">tmptbl</span></span>
<span><span class="co">#                                    A: Drug X                B: Placebo              C: Combination     </span></span>
<span><span class="co">#                                 F            M            F            M            F            M     </span></span>
<span><span class="co"># ———————————————————————————————————————————————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># ASIAN                       44 (62.9%)   35 (68.6%)   37 (66.1%)   31 (62.0%)   40 (65.6%)   44 (64.7%)</span></span>
<span><span class="co">#   A                         15 (21.4%)   12 (23.5%)   14 (25.0%)   6 (12.0%)    15 (24.6%)   16 (23.5%)</span></span>
<span><span class="co">#     Mean                      30.40        34.42        35.43        30.33        37.40        36.25   </span></span>
<span><span class="co">#   C                         13 (18.6%)   15 (29.4%)   10 (17.9%)   9 (18.0%)    15 (24.6%)   16 (23.5%)</span></span>
<span><span class="co">#     Mean                      36.92        35.60        34.00        31.89        33.47        31.38   </span></span>
<span><span class="co">#   B                         16 (22.9%)   8 (15.7%)    13 (23.2%)   16 (32.0%)   10 (16.4%)   12 (17.6%)</span></span>
<span><span class="co">#     Mean                      33.75        34.88        32.46        30.94        33.30        35.92   </span></span>
<span><span class="co"># BLACK OR AFRICAN AMERICAN   18 (25.7%)   10 (19.6%)   12 (21.4%)   12 (24.0%)   13 (21.3%)   14 (20.6%)</span></span>
<span><span class="co">#   C                          6 (8.6%)    6 (11.8%)     4 (7.1%)    7 (14.0%)     3 (4.9%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      31.33        39.67        34.50        34.00        33.00        36.50   </span></span>
<span><span class="co">#   B                         7 (10.0%)     3 (5.9%)     3 (5.4%)     3 (6.0%)     6 (9.8%)     6 (8.8%) </span></span>
<span><span class="co">#     Mean                      36.14        34.33        29.67        32.00        36.33        31.00   </span></span>
<span><span class="co">#   A                          5 (7.1%)     1 (2.0%)     5 (8.9%)     2 (4.0%)     4 (6.6%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      31.20        33.00        28.00        30.00        30.75        36.50   </span></span>
<span><span class="co"># WHITE                       8 (11.4%)    6 (11.8%)    7 (12.5%)    7 (14.0%)    8 (13.1%)    10 (14.7%)</span></span>
<span><span class="co">#   B                          4 (5.7%)     3 (5.9%)     1 (1.8%)     4 (8.0%)     3 (4.9%)     1 (1.5%) </span></span>
<span><span class="co">#     Mean                      37.00        43.67        48.00        36.75        34.33        36.00   </span></span>
<span><span class="co">#   A                          2 (2.9%)     1 (2.0%)     3 (5.4%)     3 (6.0%)     1 (1.6%)     5 (7.4%) </span></span>
<span><span class="co">#     Mean                      34.00        45.00        29.33        33.33        35.00        32.80   </span></span>
<span><span class="co">#   C                          2 (2.9%)     2 (3.9%)     3 (5.4%)     0 (0.0%)     4 (6.6%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      35.50        44.00        44.67          NA         38.50        35.00</span></span></code></pre></div>
<p>It is possible to understand better pathing with
<code><a href="../reference/table_structure.html">table_structure()</a></code> that highlights the tree-like structure
and the node names:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/table_structure.html">table_structure</a></span><span class="op">(</span><span class="va">pruned</span><span class="op">)</span></span>
<span><span class="co"># [TableTree] RACE</span></span>
<span><span class="co">#  [TableTree] ASIAN [cont: 1 x 6]</span></span>
<span><span class="co">#   [TableTree] STRATA1</span></span>
<span><span class="co">#    [TableTree] A [cont: 1 x 6]</span></span>
<span><span class="co">#     [ElementaryTable] AGE (1 x 6)</span></span>
<span><span class="co">#    [TableTree] B [cont: 1 x 6]</span></span>
<span><span class="co">#     [ElementaryTable] AGE (1 x 6)</span></span>
<span><span class="co">#    [TableTree] C [cont: 1 x 6]</span></span>
<span><span class="co">#     [ElementaryTable] AGE (1 x 6)</span></span>
<span><span class="co">#  [TableTree] BLACK OR AFRICAN AMERICAN [cont: 1 x 6]</span></span>
<span><span class="co">#   [TableTree] STRATA1</span></span>
<span><span class="co">#    [TableTree] A [cont: 1 x 6]</span></span>
<span><span class="co">#     [ElementaryTable] AGE (1 x 6)</span></span>
<span><span class="co">#    [TableTree] B [cont: 1 x 6]</span></span>
<span><span class="co">#     [ElementaryTable] AGE (1 x 6)</span></span>
<span><span class="co">#    [TableTree] C [cont: 1 x 6]</span></span>
<span><span class="co">#     [ElementaryTable] AGE (1 x 6)</span></span>
<span><span class="co">#  [TableTree] WHITE [cont: 1 x 6]</span></span>
<span><span class="co">#   [TableTree] STRATA1</span></span>
<span><span class="co">#    [TableTree] A [cont: 1 x 6]</span></span>
<span><span class="co">#     [ElementaryTable] AGE (1 x 6)</span></span>
<span><span class="co">#    [TableTree] B [cont: 1 x 6]</span></span>
<span><span class="co">#     [ElementaryTable] AGE (1 x 6)</span></span>
<span><span class="co">#    [TableTree] C [cont: 1 x 6]</span></span>
<span><span class="co">#     [ElementaryTable] AGE (1 x 6)</span></span></code></pre></div>
<p>or with <code>row_paths_summary</code>:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/row_paths_summary.html">row_paths_summary</a></span><span class="op">(</span><span class="va">pruned</span><span class="op">)</span></span>
<span><span class="co"># rowname                      node_class    path                                                                </span></span>
<span><span class="co"># ———————————————————————————————————————————————————————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># ASIAN                        ContentRow    RACE, ASIAN, @content, ASIAN                                        </span></span>
<span><span class="co">#   A                          ContentRow    RACE, ASIAN, STRATA1, A, @content, A                                </span></span>
<span><span class="co">#     Mean                     DataRow       RACE, ASIAN, STRATA1, A, AGE, Mean                                  </span></span>
<span><span class="co">#   B                          ContentRow    RACE, ASIAN, STRATA1, B, @content, B                                </span></span>
<span><span class="co">#     Mean                     DataRow       RACE, ASIAN, STRATA1, B, AGE, Mean                                  </span></span>
<span><span class="co">#   C                          ContentRow    RACE, ASIAN, STRATA1, C, @content, C                                </span></span>
<span><span class="co">#     Mean                     DataRow       RACE, ASIAN, STRATA1, C, AGE, Mean                                  </span></span>
<span><span class="co"># BLACK OR AFRICAN AMERICAN    ContentRow    RACE, BLACK OR AFRICAN AMERICAN, @content, BLACK OR AFRICAN AMERICAN</span></span>
<span><span class="co">#   A                          ContentRow    RACE, BLACK OR AFRICAN AMERICAN, STRATA1, A, @content, A            </span></span>
<span><span class="co">#     Mean                     DataRow       RACE, BLACK OR AFRICAN AMERICAN, STRATA1, A, AGE, Mean              </span></span>
<span><span class="co">#   B                          ContentRow    RACE, BLACK OR AFRICAN AMERICAN, STRATA1, B, @content, B            </span></span>
<span><span class="co">#     Mean                     DataRow       RACE, BLACK OR AFRICAN AMERICAN, STRATA1, B, AGE, Mean              </span></span>
<span><span class="co">#   C                          ContentRow    RACE, BLACK OR AFRICAN AMERICAN, STRATA1, C, @content, C            </span></span>
<span><span class="co">#     Mean                     DataRow       RACE, BLACK OR AFRICAN AMERICAN, STRATA1, C, AGE, Mean              </span></span>
<span><span class="co"># WHITE                        ContentRow    RACE, WHITE, @content, WHITE                                        </span></span>
<span><span class="co">#   A                          ContentRow    RACE, WHITE, STRATA1, A, @content, A                                </span></span>
<span><span class="co">#     Mean                     DataRow       RACE, WHITE, STRATA1, A, AGE, Mean                                  </span></span>
<span><span class="co">#   B                          ContentRow    RACE, WHITE, STRATA1, B, @content, B                                </span></span>
<span><span class="co">#     Mean                     DataRow       RACE, WHITE, STRATA1, B, AGE, Mean                                  </span></span>
<span><span class="co">#   C                          ContentRow    RACE, WHITE, STRATA1, C, @content, C                                </span></span>
<span><span class="co">#     Mean                     DataRow       RACE, WHITE, STRATA1, C, AGE, Mean</span></span></code></pre></div>
<p>Note in the latter we see content rows as those with paths following
<code>@content</code>, e.g., <code>ASIAN, @content, ASIAN</code>. The
first of these at a given path (i.e.,
<code>&lt;path&gt;, @content, &lt;&gt;</code> are the rows which will be
used by the scoring functions which begin with <code>cont_</code>.</p>
<p>We can directly sort the ethnicity by observations in increasing
order:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ethsort</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sort_at_path.html">sort_at_path</a></span><span class="op">(</span><span class="va">pruned</span>, path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"RACE"</span><span class="op">)</span>, scorefun <span class="op">=</span> <span class="va">cont_n_allcols</span>, decreasing <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">ethsort</span></span>
<span><span class="co">#                                    A: Drug X                B: Placebo              C: Combination     </span></span>
<span><span class="co">#                                 F            M            F            M            F            M     </span></span>
<span><span class="co"># ———————————————————————————————————————————————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># WHITE                       8 (11.4%)    6 (11.8%)    7 (12.5%)    7 (14.0%)    8 (13.1%)    10 (14.7%)</span></span>
<span><span class="co">#   A                          2 (2.9%)     1 (2.0%)     3 (5.4%)     3 (6.0%)     1 (1.6%)     5 (7.4%) </span></span>
<span><span class="co">#     Mean                      34.00        45.00        29.33        33.33        35.00        32.80   </span></span>
<span><span class="co">#   B                          4 (5.7%)     3 (5.9%)     1 (1.8%)     4 (8.0%)     3 (4.9%)     1 (1.5%) </span></span>
<span><span class="co">#     Mean                      37.00        43.67        48.00        36.75        34.33        36.00   </span></span>
<span><span class="co">#   C                          2 (2.9%)     2 (3.9%)     3 (5.4%)     0 (0.0%)     4 (6.6%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      35.50        44.00        44.67          NA         38.50        35.00   </span></span>
<span><span class="co"># BLACK OR AFRICAN AMERICAN   18 (25.7%)   10 (19.6%)   12 (21.4%)   12 (24.0%)   13 (21.3%)   14 (20.6%)</span></span>
<span><span class="co">#   A                          5 (7.1%)     1 (2.0%)     5 (8.9%)     2 (4.0%)     4 (6.6%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      31.20        33.00        28.00        30.00        30.75        36.50   </span></span>
<span><span class="co">#   B                         7 (10.0%)     3 (5.9%)     3 (5.4%)     3 (6.0%)     6 (9.8%)     6 (8.8%) </span></span>
<span><span class="co">#     Mean                      36.14        34.33        29.67        32.00        36.33        31.00   </span></span>
<span><span class="co">#   C                          6 (8.6%)    6 (11.8%)     4 (7.1%)    7 (14.0%)     3 (4.9%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      31.33        39.67        34.50        34.00        33.00        36.50   </span></span>
<span><span class="co"># ASIAN                       44 (62.9%)   35 (68.6%)   37 (66.1%)   31 (62.0%)   40 (65.6%)   44 (64.7%)</span></span>
<span><span class="co">#   A                         15 (21.4%)   12 (23.5%)   14 (25.0%)   6 (12.0%)    15 (24.6%)   16 (23.5%)</span></span>
<span><span class="co">#     Mean                      30.40        34.42        35.43        30.33        37.40        36.25   </span></span>
<span><span class="co">#   B                         16 (22.9%)   8 (15.7%)    13 (23.2%)   16 (32.0%)   10 (16.4%)   12 (17.6%)</span></span>
<span><span class="co">#     Mean                      33.75        34.88        32.46        30.94        33.30        35.92   </span></span>
<span><span class="co">#   C                         13 (18.6%)   15 (29.4%)   10 (17.9%)   9 (18.0%)    15 (24.6%)   16 (23.5%)</span></span>
<span><span class="co">#     Mean                      36.92        35.60        34.00        31.89        33.47        31.38</span></span></code></pre></div>
<p>Within each ethnicity separately, sort the strata by number of
females in arm C (i.e. column position <code>5</code>):</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/sort_at_path.html">sort_at_path</a></span><span class="op">(</span><span class="va">pruned</span>, path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"RACE"</span>, <span class="st">"*"</span>, <span class="st">"STRATA1"</span><span class="op">)</span>, <span class="fu"><a href="../reference/score_funs.html">cont_n_onecol</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#                                    A: Drug X                B: Placebo              C: Combination     </span></span>
<span><span class="co">#                                 F            M            F            M            F            M     </span></span>
<span><span class="co"># ———————————————————————————————————————————————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># ASIAN                       44 (62.9%)   35 (68.6%)   37 (66.1%)   31 (62.0%)   40 (65.6%)   44 (64.7%)</span></span>
<span><span class="co">#   A                         15 (21.4%)   12 (23.5%)   14 (25.0%)   6 (12.0%)    15 (24.6%)   16 (23.5%)</span></span>
<span><span class="co">#     Mean                      30.40        34.42        35.43        30.33        37.40        36.25   </span></span>
<span><span class="co">#   C                         13 (18.6%)   15 (29.4%)   10 (17.9%)   9 (18.0%)    15 (24.6%)   16 (23.5%)</span></span>
<span><span class="co">#     Mean                      36.92        35.60        34.00        31.89        33.47        31.38   </span></span>
<span><span class="co">#   B                         16 (22.9%)   8 (15.7%)    13 (23.2%)   16 (32.0%)   10 (16.4%)   12 (17.6%)</span></span>
<span><span class="co">#     Mean                      33.75        34.88        32.46        30.94        33.30        35.92   </span></span>
<span><span class="co"># BLACK OR AFRICAN AMERICAN   18 (25.7%)   10 (19.6%)   12 (21.4%)   12 (24.0%)   13 (21.3%)   14 (20.6%)</span></span>
<span><span class="co">#   B                         7 (10.0%)     3 (5.9%)     3 (5.4%)     3 (6.0%)     6 (9.8%)     6 (8.8%) </span></span>
<span><span class="co">#     Mean                      36.14        34.33        29.67        32.00        36.33        31.00   </span></span>
<span><span class="co">#   A                          5 (7.1%)     1 (2.0%)     5 (8.9%)     2 (4.0%)     4 (6.6%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      31.20        33.00        28.00        30.00        30.75        36.50   </span></span>
<span><span class="co">#   C                          6 (8.6%)    6 (11.8%)     4 (7.1%)    7 (14.0%)     3 (4.9%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      31.33        39.67        34.50        34.00        33.00        36.50   </span></span>
<span><span class="co"># WHITE                       8 (11.4%)    6 (11.8%)    7 (12.5%)    7 (14.0%)    8 (13.1%)    10 (14.7%)</span></span>
<span><span class="co">#   C                          2 (2.9%)     2 (3.9%)     3 (5.4%)     0 (0.0%)     4 (6.6%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      35.50        44.00        44.67          NA         38.50        35.00   </span></span>
<span><span class="co">#   B                          4 (5.7%)     3 (5.9%)     1 (1.8%)     4 (8.0%)     3 (4.9%)     1 (1.5%) </span></span>
<span><span class="co">#     Mean                      37.00        43.67        48.00        36.75        34.33        36.00   </span></span>
<span><span class="co">#   A                          2 (2.9%)     1 (2.0%)     3 (5.4%)     3 (6.0%)     1 (1.6%)     5 (7.4%) </span></span>
<span><span class="co">#     Mean                      34.00        45.00        29.33        33.33        35.00        32.80</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="sorting-within-an-analysis-subtable">Sorting Within an Analysis Subtable<a class="anchor" aria-label="anchor" href="#sorting-within-an-analysis-subtable"></a>
</h4>
<p>When sorting within an analysis subtable (e.g., the subtable
generated when your analysis function generates more than one row per
group of data), the name of that subtable (generally the name of the
variable being analyzed) must appear in the path, <em><strong>even if
the variable label is not displayed when the table is
printed</strong></em>.</p>
<p>To show the differences between sorting an analysis subtable
(<code>DataRow</code>), and a content subtable
(<code>ContentRow</code>), we modify and prune (as before) a similar raw
table as before:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">more_analysis_fnc</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/in_rows.html">in_rows</a></span><span class="op">(</span></span>
<span>    <span class="st">"median"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>    <span class="st">"mean"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>    .formats <span class="op">=</span> <span class="st">"xx.x"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">raw_lyt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_table.html">basic_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"ARM"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_rows_by.html">split_rows_by</a></span><span class="op">(</span></span>
<span>    <span class="st">"RACE"</span>,</span>
<span>    split_fun <span class="op">=</span> <span class="fu"><a href="../reference/split_funcs.html">drop_and_remove_levels</a></span><span class="op">(</span><span class="st">"WHITE"</span><span class="op">)</span> <span class="co"># dropping WHITE levels</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/summarize_row_groups.html">summarize_row_groups</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_rows_by.html">split_rows_by</a></span><span class="op">(</span><span class="st">"STRATA1"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/summarize_row_groups.html">summarize_row_groups</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"AGE"</span>, afun <span class="op">=</span> <span class="va">more_analysis_fnc</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">raw_lyt</span>, <span class="va">DM</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/prune_table.html">prune_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#                             A: Drug X    B: Placebo   C: Combination</span></span>
<span><span class="co"># ————————————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># ASIAN                       79 (65.3%)   68 (64.2%)     84 (65.1%)  </span></span>
<span><span class="co">#   A                         27 (22.3%)   20 (18.9%)     31 (24.0%)  </span></span>
<span><span class="co">#     median                     30.0         33.0           36.0     </span></span>
<span><span class="co">#     mean                       32.2         33.9           36.8     </span></span>
<span><span class="co">#   B                         24 (19.8%)   29 (27.4%)     22 (17.1%)  </span></span>
<span><span class="co">#     median                     32.5         32.0           34.0     </span></span>
<span><span class="co">#     mean                       34.1         31.6           34.7     </span></span>
<span><span class="co">#   C                         28 (23.1%)   19 (17.9%)     31 (24.0%)  </span></span>
<span><span class="co">#     median                     36.5         34.0           33.0     </span></span>
<span><span class="co">#     mean                       36.2         33.0           32.4     </span></span>
<span><span class="co"># BLACK OR AFRICAN AMERICAN   28 (23.1%)   24 (22.6%)     27 (20.9%)  </span></span>
<span><span class="co">#   A                          6 (5.0%)     7 (6.6%)       8 (6.2%)   </span></span>
<span><span class="co">#     median                     32.0         29.0           32.5     </span></span>
<span><span class="co">#     mean                       31.5         28.6           33.6     </span></span>
<span><span class="co">#   B                         10 (8.3%)     6 (5.7%)      12 (9.3%)   </span></span>
<span><span class="co">#     median                     33.0         30.0           33.5     </span></span>
<span><span class="co">#     mean                       35.6         30.8           33.7     </span></span>
<span><span class="co">#   C                         12 (9.9%)    11 (10.4%)      7 (5.4%)   </span></span>
<span><span class="co">#     median                     33.0         36.0           32.0     </span></span>
<span><span class="co">#     mean                       35.5         34.2           35.0</span></span></code></pre></div>
<p>What should we do now if we want to sort each median and mean in each
of the strata variables? We need to write a custom score function as the
ready-made ones at the moment work only with content nodes
(<code><a href="../reference/content_table.html">content_table()</a></code> access function for
<code><a href="../reference/score_funs.html">cont_n_allcols()</a></code> and <code><a href="../reference/score_funs.html">cont_n_onecol()</a></code>, of which
we will talk in a moment). But before that, we need to think about what
are we ordering, i.e. we need to specify the right path. We suggest
looking at the structure first with <code><a href="../reference/table_structure.html">table_structure()</a></code> or
<code><a href="../reference/row_paths_summary.html">row_paths_summary()</a></code>.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/table_structure.html">table_structure</a></span><span class="op">(</span><span class="va">tbl</span><span class="op">)</span> <span class="co"># Direct inspection into the tree-like structure of rtables</span></span>
<span><span class="co"># [TableTree] RACE</span></span>
<span><span class="co">#  [TableTree] ASIAN [cont: 1 x 3]</span></span>
<span><span class="co">#   [TableTree] STRATA1</span></span>
<span><span class="co">#    [TableTree] A [cont: 1 x 3]</span></span>
<span><span class="co">#     [ElementaryTable] AGE (2 x 3)</span></span>
<span><span class="co">#    [TableTree] B [cont: 1 x 3]</span></span>
<span><span class="co">#     [ElementaryTable] AGE (2 x 3)</span></span>
<span><span class="co">#    [TableTree] C [cont: 1 x 3]</span></span>
<span><span class="co">#     [ElementaryTable] AGE (2 x 3)</span></span>
<span><span class="co">#  [TableTree] BLACK OR AFRICAN AMERICAN [cont: 1 x 3]</span></span>
<span><span class="co">#   [TableTree] STRATA1</span></span>
<span><span class="co">#    [TableTree] A [cont: 1 x 3]</span></span>
<span><span class="co">#     [ElementaryTable] AGE (2 x 3)</span></span>
<span><span class="co">#    [TableTree] B [cont: 1 x 3]</span></span>
<span><span class="co">#     [ElementaryTable] AGE (2 x 3)</span></span>
<span><span class="co">#    [TableTree] C [cont: 1 x 3]</span></span>
<span><span class="co">#     [ElementaryTable] AGE (2 x 3)</span></span></code></pre></div>
<p>We see that to order all of the <code>AGE</code> nodes we need to get
there with something like this:
<code>RACE, ASIAN, STRATA1, A, AGE</code> and no more as the next level
is what we need to sort. But we see now that this path would sort only
the first group. We need wildcards:
<code>RACE, *, STRATA1, *, AGE</code>.</p>
<p>Now, we have found a way to select relevant paths that we want to
sort. We want to construct a scoring function that works on the median
and mean and sort them. To do so, we may want to enter our scoring
function with <code><a href="https://rdrr.io/r/base/browser.html" class="external-link">browser()</a></code> to see what is fed to it and try to
retrieve the single value that is to be returned to do the sorting. We
allow the user to experiment with this, while here we show a possible
solution that considers summing all the column values that are retrieved
with <code>row_values(tt)</code> from the subtable that is fed to the
function itself. Note that any score function should be defined as
having a subtable <code>tt</code> as a unique input parameter and a
single numeric value as output.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">scorefun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tt</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Here we could use browser()</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="../reference/row_accessors.html">row_values</a></span><span class="op">(</span><span class="va">tt</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="../reference/sort_at_path.html">sort_at_path</a></span><span class="op">(</span><span class="va">tbl</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"RACE"</span>, <span class="st">"*"</span>, <span class="st">"STRATA1"</span>, <span class="st">"*"</span>, <span class="st">"AGE"</span><span class="op">)</span>, <span class="va">scorefun</span><span class="op">)</span></span>
<span><span class="co">#                             A: Drug X    B: Placebo   C: Combination</span></span>
<span><span class="co"># ————————————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># ASIAN                       79 (65.3%)   68 (64.2%)     84 (65.1%)  </span></span>
<span><span class="co">#   A                         27 (22.3%)   20 (18.9%)     31 (24.0%)  </span></span>
<span><span class="co">#     mean                       32.2         33.9           36.8     </span></span>
<span><span class="co">#     median                     30.0         33.0           36.0     </span></span>
<span><span class="co">#   B                         24 (19.8%)   29 (27.4%)     22 (17.1%)  </span></span>
<span><span class="co">#     mean                       34.1         31.6           34.7     </span></span>
<span><span class="co">#     median                     32.5         32.0           34.0     </span></span>
<span><span class="co">#   C                         28 (23.1%)   19 (17.9%)     31 (24.0%)  </span></span>
<span><span class="co">#     median                     36.5         34.0           33.0     </span></span>
<span><span class="co">#     mean                       36.2         33.0           32.4     </span></span>
<span><span class="co"># BLACK OR AFRICAN AMERICAN   28 (23.1%)   24 (22.6%)     27 (20.9%)  </span></span>
<span><span class="co">#   A                          6 (5.0%)     7 (6.6%)       8 (6.2%)   </span></span>
<span><span class="co">#     mean                       31.5         28.6           33.6     </span></span>
<span><span class="co">#     median                     32.0         29.0           32.5     </span></span>
<span><span class="co">#   B                         10 (8.3%)     6 (5.7%)      12 (9.3%)   </span></span>
<span><span class="co">#     mean                       35.6         30.8           33.7     </span></span>
<span><span class="co">#     median                     33.0         30.0           33.5     </span></span>
<span><span class="co">#   C                         12 (9.9%)    11 (10.4%)      7 (5.4%)   </span></span>
<span><span class="co">#     mean                       35.5         34.2           35.0     </span></span>
<span><span class="co">#     median                     33.0         36.0           32.0</span></span></code></pre></div>
<p>To help the user visualize what is happening in the score function we
show here an example of its exploration from the debugging:</p>
<pre><code>&gt; sort_at_path(tbl, c("RACE", "*", "STRATA1", "*", "AGE"), scorefun)
Called from: scorefun(x)
Browse[1]&gt; tt ### THIS IS THE LEAF LEVEL -&gt; DataRow ###
[DataRow indent_mod 0]: median   30.0   33.0   36.0
Browse[1]&gt; row_values(tt) ### Extraction of values -&gt; It will be a named list! ###
$`A: Drug X`
[1] 30

$`B: Placebo`
[1] 33

$`C: Combination`
[1] 36

Browse[1]&gt; sum(unlist(row_values(tt))) ### Final value we want to give back to sort_at_path ###
[1] 99</code></pre>
<p>We can see how powerful and pragmatic it might be to change the
sorting principles from within the custom scoring function. We show this
by selecting a specific column to sort. Looking at the pre-defined
function <code><a href="../reference/score_funs.html">cont_n_onecol()</a></code> gives us an insight into how to
proceed.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cont_n_onecol</span></span>
<span><span class="co"># function (j) </span></span>
<span><span class="co"># {</span></span>
<span><span class="co">#     function(tt) {</span></span>
<span><span class="co">#         ctab &lt;- content_table(tt)</span></span>
<span><span class="co">#         if (NROW(ctab) == 0) {</span></span>
<span><span class="co">#             stop("cont_n_allcols score function used at subtable [", </span></span>
<span><span class="co">#                 obj_name(tt), "] that has no content table.")</span></span>
<span><span class="co">#         }</span></span>
<span><span class="co">#         row_values(tree_children(ctab)[[1]])[[j]][1]</span></span>
<span><span class="co">#     }</span></span>
<span><span class="co"># }</span></span>
<span><span class="co"># &lt;bytecode: 0x55bcae75b1e0&gt;</span></span>
<span><span class="co"># &lt;environment: namespace:rtables&gt;</span></span></code></pre></div>
<p>We see that a similar function to <code><a href="../reference/score_funs.html">cont_n_allcols()</a></code> is
wrapped by one that allows a parameter <code>j</code> to be used to
select a specific column. We will do the same here for selecting which
column we want to sort.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">scorefun_onecol</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">colpath</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">tt</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Here we could use browser()</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="../reference/cell_values.html">cell_values</a></span><span class="op">(</span><span class="va">tt</span>, colpath <span class="op">=</span> <span class="va">colpath</span><span class="op">)</span>, use.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="co"># Modified to lose the list names</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="../reference/sort_at_path.html">sort_at_path</a></span><span class="op">(</span><span class="va">tbl</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"RACE"</span>, <span class="st">"*"</span>, <span class="st">"STRATA1"</span>, <span class="st">"*"</span>, <span class="st">"AGE"</span><span class="op">)</span>, <span class="fu">scorefun_onecol</span><span class="op">(</span>colpath <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ARM"</span>, <span class="st">"A: Drug X"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#                             A: Drug X    B: Placebo   C: Combination</span></span>
<span><span class="co"># ————————————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># ASIAN                       79 (65.3%)   68 (64.2%)     84 (65.1%)  </span></span>
<span><span class="co">#   A                         27 (22.3%)   20 (18.9%)     31 (24.0%)  </span></span>
<span><span class="co">#     mean                       32.2         33.9           36.8     </span></span>
<span><span class="co">#     median                     30.0         33.0           36.0     </span></span>
<span><span class="co">#   B                         24 (19.8%)   29 (27.4%)     22 (17.1%)  </span></span>
<span><span class="co">#     mean                       34.1         31.6           34.7     </span></span>
<span><span class="co">#     median                     32.5         32.0           34.0     </span></span>
<span><span class="co">#   C                         28 (23.1%)   19 (17.9%)     31 (24.0%)  </span></span>
<span><span class="co">#     median                     36.5         34.0           33.0     </span></span>
<span><span class="co">#     mean                       36.2         33.0           32.4     </span></span>
<span><span class="co"># BLACK OR AFRICAN AMERICAN   28 (23.1%)   24 (22.6%)     27 (20.9%)  </span></span>
<span><span class="co">#   A                          6 (5.0%)     7 (6.6%)       8 (6.2%)   </span></span>
<span><span class="co">#     median                     32.0         29.0           32.5     </span></span>
<span><span class="co">#     mean                       31.5         28.6           33.6     </span></span>
<span><span class="co">#   B                         10 (8.3%)     6 (5.7%)      12 (9.3%)   </span></span>
<span><span class="co">#     mean                       35.6         30.8           33.7     </span></span>
<span><span class="co">#     median                     33.0         30.0           33.5     </span></span>
<span><span class="co">#   C                         12 (9.9%)    11 (10.4%)      7 (5.4%)   </span></span>
<span><span class="co">#     mean                       35.5         34.2           35.0     </span></span>
<span><span class="co">#     median                     33.0         36.0           32.0</span></span></code></pre></div>
<p>In the above table we see that the mean and median rows are reordered
by their values in the first column, compared to the raw table, as
desired.</p>
<p>With this function we can also do the same for columns that are
nested within larger splits:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Simpler table</span></span>
<span><span class="va">tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_table.html">basic_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"ARM"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"SEX"</span>,</span>
<span>    split_fun <span class="op">=</span> <span class="fu"><a href="../reference/split_funcs.html">drop_and_remove_levels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"U"</span>, <span class="st">"UNDIFFERENTIATED"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"AGE"</span>, afun <span class="op">=</span> <span class="va">more_analysis_fnc</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">DM</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/prune_table.html">prune_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#           A: Drug X      B: Placebo      C: Combination  </span></span>
<span><span class="co">#            F      M       F       M        F         M   </span></span>
<span><span class="co"># —————————————————————————————————————————————————————————</span></span>
<span><span class="co"># median   32.0    35.0   33.0    31.0     35.0      32.0  </span></span>
<span><span class="co"># mean     33.7    36.5   33.8    32.1     34.9      34.3</span></span>
<span></span>
<span><span class="fu"><a href="../reference/sort_at_path.html">sort_at_path</a></span><span class="op">(</span><span class="va">tbl</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AGE"</span><span class="op">)</span>, <span class="fu">scorefun_onecol</span><span class="op">(</span>colpath <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ARM"</span>, <span class="st">"B: Placebo"</span>, <span class="st">"SEX"</span>, <span class="st">"F"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#           A: Drug X      B: Placebo      C: Combination  </span></span>
<span><span class="co">#            F      M       F       M        F         M   </span></span>
<span><span class="co"># —————————————————————————————————————————————————————————</span></span>
<span><span class="co"># mean     33.7    36.5   33.8    32.1     34.9      34.3  </span></span>
<span><span class="co"># median   32.0    35.0   33.0    31.0     35.0      32.0</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="writing-custom-pruning-criteria-and-scoring-functions">Writing Custom Pruning Criteria and Scoring Functions<a class="anchor" aria-label="anchor" href="#writing-custom-pruning-criteria-and-scoring-functions"></a>
</h2>
<p>Pruning criteria and scoring functions map <code>TableTree</code> or
<code>TableRow</code> objects to a Boolean value (for pruning criteria)
or a sortable scalar value (scoring functions). To do this we currently
need to interact with the structure of the objects more than usual.
Indeed, we showed already how sorting can be very complicated if the
concept of tree-like structure and pathing is not well understood. It is
important though to have in mind the following functions that can be
used in each pruning or sorting function to retrieve the relevant
information from the table.</p>
<div class="section level3">
<h3 id="useful-functions-and-accessors">Useful Functions and Accessors<a class="anchor" aria-label="anchor" href="#useful-functions-and-accessors"></a>
</h3>
<ul>
<li>
<code><a href="../reference/cell_values.html">cell_values()</a></code> - Retrieves a named list of a
<code>TableRow</code> or <code>TableTree</code> object’s values
<ul>
<li>accepts both <code>rowpath</code> and <code>colpath</code> to
restrict which cell values are returned</li>
</ul>
</li>
<li>
<code><a href="https://insightsengineering.github.io/formatters/latest-tag/reference/lab_name.html" class="external-link">obj_name()</a></code> - Retrieves the name of an object. Note this
can differ from the label that is displayed (if any is) when printing.
This will match the element in the path.</li>
<li>
<code><a href="https://insightsengineering.github.io/formatters/latest-tag/reference/lab_name.html" class="external-link">obj_label()</a></code> - Retrieves the display label of an object.
Note this can differ from the name that appears in the path.</li>
<li>
<code><a href="../reference/content_table.html">content_table()</a></code> - Retrieves a <code>TableTree</code>
object’s content table (which contains its summary rows).</li>
<li>
<code><a href="../reference/tree_children.html">tree_children()</a></code> - Retrieves a <code>TableTree</code>
object’s direct children (either subtables, rows or possibly a mix
thereof, though that should not happen in practice)</li>
</ul>
</div>
<div class="section level3">
<h3 id="example-custom-scoring-functions">Example Custom Scoring Functions<a class="anchor" aria-label="anchor" href="#example-custom-scoring-functions"></a>
</h3>
<div class="section level4">
<h4 id="sort-by-a-character-score">Sort by a character “score”<a class="anchor" aria-label="anchor" href="#sort-by-a-character-score"></a>
</h4>
<p>In this case, for convenience/simplicity, we use the name of the
table element but any logic which returns a single string could be used
here.</p>
<p>We sort the ethnicity by alphabetical order (in practice undoing our
previous sorting by ethnicity above).</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">silly_name_scorer</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tt</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">nm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://insightsengineering.github.io/formatters/latest-tag/reference/lab_name.html" class="external-link">obj_name</a></span><span class="op">(</span><span class="va">tt</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">nm</span><span class="op">)</span></span>
<span>  <span class="va">nm</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="../reference/sort_at_path.html">sort_at_path</a></span><span class="op">(</span><span class="va">ethsort</span>, <span class="st">"RACE"</span>, <span class="va">silly_name_scorer</span><span class="op">)</span> <span class="co"># Now, it is sorted alphabetically!</span></span>
<span><span class="co"># [1] "WHITE"</span></span>
<span><span class="co"># [1] "BLACK OR AFRICAN AMERICAN"</span></span>
<span><span class="co"># [1] "ASIAN"</span></span>
<span><span class="co">#                                    A: Drug X                B: Placebo              C: Combination     </span></span>
<span><span class="co">#                                 F            M            F            M            F            M     </span></span>
<span><span class="co"># ———————————————————————————————————————————————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># ASIAN                       44 (62.9%)   35 (68.6%)   37 (66.1%)   31 (62.0%)   40 (65.6%)   44 (64.7%)</span></span>
<span><span class="co">#   A                         15 (21.4%)   12 (23.5%)   14 (25.0%)   6 (12.0%)    15 (24.6%)   16 (23.5%)</span></span>
<span><span class="co">#     Mean                      30.40        34.42        35.43        30.33        37.40        36.25   </span></span>
<span><span class="co">#   B                         16 (22.9%)   8 (15.7%)    13 (23.2%)   16 (32.0%)   10 (16.4%)   12 (17.6%)</span></span>
<span><span class="co">#     Mean                      33.75        34.88        32.46        30.94        33.30        35.92   </span></span>
<span><span class="co">#   C                         13 (18.6%)   15 (29.4%)   10 (17.9%)   9 (18.0%)    15 (24.6%)   16 (23.5%)</span></span>
<span><span class="co">#     Mean                      36.92        35.60        34.00        31.89        33.47        31.38   </span></span>
<span><span class="co"># BLACK OR AFRICAN AMERICAN   18 (25.7%)   10 (19.6%)   12 (21.4%)   12 (24.0%)   13 (21.3%)   14 (20.6%)</span></span>
<span><span class="co">#   A                          5 (7.1%)     1 (2.0%)     5 (8.9%)     2 (4.0%)     4 (6.6%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      31.20        33.00        28.00        30.00        30.75        36.50   </span></span>
<span><span class="co">#   B                         7 (10.0%)     3 (5.9%)     3 (5.4%)     3 (6.0%)     6 (9.8%)     6 (8.8%) </span></span>
<span><span class="co">#     Mean                      36.14        34.33        29.67        32.00        36.33        31.00   </span></span>
<span><span class="co">#   C                          6 (8.6%)    6 (11.8%)     4 (7.1%)    7 (14.0%)     3 (4.9%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      31.33        39.67        34.50        34.00        33.00        36.50   </span></span>
<span><span class="co"># WHITE                       8 (11.4%)    6 (11.8%)    7 (12.5%)    7 (14.0%)    8 (13.1%)    10 (14.7%)</span></span>
<span><span class="co">#   A                          2 (2.9%)     1 (2.0%)     3 (5.4%)     3 (6.0%)     1 (1.6%)     5 (7.4%) </span></span>
<span><span class="co">#     Mean                      34.00        45.00        29.33        33.33        35.00        32.80   </span></span>
<span><span class="co">#   B                          4 (5.7%)     3 (5.9%)     1 (1.8%)     4 (8.0%)     3 (4.9%)     1 (1.5%) </span></span>
<span><span class="co">#     Mean                      37.00        43.67        48.00        36.75        34.33        36.00   </span></span>
<span><span class="co">#   C                          2 (2.9%)     2 (3.9%)     3 (5.4%)     0 (0.0%)     4 (6.6%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      35.50        44.00        44.67          NA         38.50        35.00</span></span></code></pre></div>
<p><strong>NOTE</strong>: Generally this would be more appropriately
done using the <code><a href="../reference/split_funcs.html">reorder_split_levels()</a></code> function within the
layout rather than as a sort post-processing step, but other character
scorers may or may not map as easily to layouting directives.</p>
</div>
<div class="section level4">
<h4 id="sort-by-the-percent-difference-in-counts-between-genders-in-arm-c">Sort by the Percent Difference in Counts Between Genders in Arm
C<a class="anchor" aria-label="anchor" href="#sort-by-the-percent-difference-in-counts-between-genders-in-arm-c"></a>
</h4>
<p>We need the F and M percents, only for Arm C (i.e. columns 5 and 6),
differenced.</p>
<p>We will sort <em><strong>the strata within each
ethnicity</strong></em> by the percent difference in counts between
males and females in arm C.</p>
<p>Note: this is not statistically meaningful at all, and is in fact a
terrible idea because it reorders the strata seemingly (but not) at
random within each race, but illustrates the various things we need to
do inside custom sorting functions.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">silly_gender_diffcount</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tt</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co">## (1st) content row has same name as object (STRATA1 level)</span></span>
<span>  <span class="va">rpath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://insightsengineering.github.io/formatters/latest-tag/reference/lab_name.html" class="external-link">obj_name</a></span><span class="op">(</span><span class="va">tt</span><span class="op">)</span>, <span class="st">"@content"</span>, <span class="fu"><a href="https://insightsengineering.github.io/formatters/latest-tag/reference/lab_name.html" class="external-link">obj_name</a></span><span class="op">(</span><span class="va">tt</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co">## the [1] below is cause these are count (pct%) cells</span></span>
<span>  <span class="co">## and we only want the count part!</span></span>
<span>  <span class="va">mcount</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="../reference/cell_values.html">cell_values</a></span><span class="op">(</span></span>
<span>    <span class="va">tt</span>,</span>
<span>    rowpath <span class="op">=</span> <span class="va">rpath</span>,</span>
<span>    colpath <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ARM"</span>, <span class="st">"C: Combination"</span>, <span class="st">"SEX"</span>, <span class="st">"M"</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">fcount</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="../reference/cell_values.html">cell_values</a></span><span class="op">(</span></span>
<span>    <span class="va">tt</span>,</span>
<span>    rowpath <span class="op">=</span> <span class="va">rpath</span>,</span>
<span>    colpath <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ARM"</span>, <span class="st">"C: Combination"</span>, <span class="st">"SEX"</span>, <span class="st">"F"</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="op">(</span><span class="va">mcount</span> <span class="op">-</span> <span class="va">fcount</span><span class="op">)</span> <span class="op">/</span> <span class="va">fcount</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="../reference/sort_at_path.html">sort_at_path</a></span><span class="op">(</span><span class="va">pruned</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"RACE"</span>, <span class="st">"*"</span>, <span class="st">"STRATA1"</span><span class="op">)</span>, <span class="va">silly_gender_diffcount</span><span class="op">)</span></span>
<span><span class="co">#                                    A: Drug X                B: Placebo              C: Combination     </span></span>
<span><span class="co">#                                 F            M            F            M            F            M     </span></span>
<span><span class="co"># ———————————————————————————————————————————————————————————————————————————————————————————————————————</span></span>
<span><span class="co"># ASIAN                       44 (62.9%)   35 (68.6%)   37 (66.1%)   31 (62.0%)   40 (65.6%)   44 (64.7%)</span></span>
<span><span class="co">#   B                         16 (22.9%)   8 (15.7%)    13 (23.2%)   16 (32.0%)   10 (16.4%)   12 (17.6%)</span></span>
<span><span class="co">#     Mean                      33.75        34.88        32.46        30.94        33.30        35.92   </span></span>
<span><span class="co">#   A                         15 (21.4%)   12 (23.5%)   14 (25.0%)   6 (12.0%)    15 (24.6%)   16 (23.5%)</span></span>
<span><span class="co">#     Mean                      30.40        34.42        35.43        30.33        37.40        36.25   </span></span>
<span><span class="co">#   C                         13 (18.6%)   15 (29.4%)   10 (17.9%)   9 (18.0%)    15 (24.6%)   16 (23.5%)</span></span>
<span><span class="co">#     Mean                      36.92        35.60        34.00        31.89        33.47        31.38   </span></span>
<span><span class="co"># BLACK OR AFRICAN AMERICAN   18 (25.7%)   10 (19.6%)   12 (21.4%)   12 (24.0%)   13 (21.3%)   14 (20.6%)</span></span>
<span><span class="co">#   C                          6 (8.6%)    6 (11.8%)     4 (7.1%)    7 (14.0%)     3 (4.9%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      31.33        39.67        34.50        34.00        33.00        36.50   </span></span>
<span><span class="co">#   A                          5 (7.1%)     1 (2.0%)     5 (8.9%)     2 (4.0%)     4 (6.6%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      31.20        33.00        28.00        30.00        30.75        36.50   </span></span>
<span><span class="co">#   B                         7 (10.0%)     3 (5.9%)     3 (5.4%)     3 (6.0%)     6 (9.8%)     6 (8.8%) </span></span>
<span><span class="co">#     Mean                      36.14        34.33        29.67        32.00        36.33        31.00   </span></span>
<span><span class="co"># WHITE                       8 (11.4%)    6 (11.8%)    7 (12.5%)    7 (14.0%)    8 (13.1%)    10 (14.7%)</span></span>
<span><span class="co">#   A                          2 (2.9%)     1 (2.0%)     3 (5.4%)     3 (6.0%)     1 (1.6%)     5 (7.4%) </span></span>
<span><span class="co">#     Mean                      34.00        45.00        29.33        33.33        35.00        32.80   </span></span>
<span><span class="co">#   C                          2 (2.9%)     2 (3.9%)     3 (5.4%)     0 (0.0%)     4 (6.6%)     4 (5.9%) </span></span>
<span><span class="co">#     Mean                      35.50        44.00        44.67          NA         38.50        35.00   </span></span>
<span><span class="co">#   B                          4 (5.7%)     3 (5.9%)     1 (1.8%)     4 (8.0%)     3 (4.9%)     1 (1.5%) </span></span>
<span><span class="co">#     Mean                      37.00        43.67        48.00        36.75        34.33        36.00</span></span></code></pre></div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="nest">
  <p>rtables is a part of the <strong>NEST</strong> and <a href="https://pharmaverse.org/" class="external-link"><strong>pharmaverse</strong></a>.</p>
</div>
<script type="text/javascript" src="../analytics.js"></script></footer>
</div>





  </body>
</html>
