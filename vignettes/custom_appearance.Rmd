---
title: "Customizing Appearance"
author: "Davide Garolini, Abinaya Yogasekaram, and Gabriel Becker"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Customizing Appearance}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---


```{r, echo=FALSE}
knitr::opts_chunk$set(comment = "#")
```

```{css, echo=FALSE}
.reveal .r code {
    white-space: pre;
}
```

## Customizing Appearance

In this vignette, we describe the various ways we can modify and customize the appearance of `rtables`.

Loading the package:
```{r, message=FALSE}
library(rtables)
```

### Rows and cell values alignments

It is possible to align the content by assigning `"left"`, `"center"` (default), and `"right"` to `.aligns` and `align` arguments in `in_rows()` and `rcell()`, respectively.

Please consider using `?in_rows` and `?rcell` for further clarifications on the two arguments, and use `rtables_aligns()` to see all available alignment options.

In the following we show two simplified examples that use `align` and `.aligns`, respectively.

```{r}
# In rcell we use align.
lyt <- basic_table() %>%
    analyze("AGE", function(x) {
        in_rows(left = rcell("l", align = "left"),
                right = rcell("r", align = "right"),
                center = rcell("c", align = "center"))
    })

build_table(lyt, DM)
```

```{r}
# In in_rows, we use .aligns. This can either set the general value or the
#   single values (see NB).
lyt2 <- basic_table() %>%
    analyze("AGE", function(x) {
        in_rows(left = rcell("l"),
                right = rcell("r"),
                center = rcell("c"),
                .aligns = c("right")) # NB: .aligns = c("right", "left", "center")
    })

build_table(lyt2, DM)
```

These concepts can be well applied to any clinical table as shown in the following, more complex, example.

```{r}
basic_table() %>%
  split_cols_by("ARM") %>%
  split_rows_by("SEX") %>%
  analyze(c("AGE", "STRATA1"), function(x) {
    if (is.numeric(x)) {
      in_rows(
        "mean" = rcell(mean(x)),
        "sd" = rcell(sd(x)),
        .formats = c("xx.x"), .aligns = "left"
      )
    } else if (is.factor(x)) {
      rcell(length(unique(x)), align = "right")
    } else {
      stop("Unsupported type")
    }
  }, show_labels = "visible", na_str = "NE") %>%
  build_table(ex_adsl)
```

### Top-left Materials

An rtables object can have \emph{top left material} which is a sequence of strings which are printed in the area of the table between the column header display
and the label of the first row.  This material can be modified with functions below.

```{r}
lyt <- basic_table() %>%
  split_cols_by("ARM") %>%
  split_rows_by("SEX") %>%
  analyze(c("AGE", "STRATA1"), function(x) {
    if (is.numeric(x)) {
      in_rows(
        "mean" = rcell(mean(x)),
        "sd" = rcell(sd(x)),
        .formats = c("xx.x"), .aligns = "left"
      )
    } else if (is.factor(x)) {
      rcell(length(unique(x)), align = "right")
    } else {
      stop("Unsupported type")
    }
  }, show_labels = "visible", na_str = "NE") %>%
  build_table(ex_adsl)

lyt

# Adding top-left material
top_left(lyt) <- "New top-left material here"

lyt
```


### Table Inset

Table title, table body, referential footnotes and and main footers can be inset from the left alignment of the titles and provenance footer materials.

Below is a simplified example:

```{r}
lyt <- basic_table() %>%
    analyze("AGE")

# without inset
tbl <- build_table(lyt, DM)
tbl

# with inset of 3 characters
table_inset(tbl) <- 3
tbl

```

Below is an example with a table produced for clinical data. Compare the inset of the table and main footer.

```{r}
lyt <- basic_table(title = "Study XXXXXXXX",
                   subtitles = c("subtitle YYYYYYYYYY", "subtitle2 ZZZZZZZZZ"),
                   main_footer = "Analysis was done using cool methods that are correct",
                   prov_footer = "file: /path/to/stuff/that/lives/there HASH:1ac41b242a") %>%
    split_cols_by("ARM") %>%
    split_rows_by("SEX", page_by = TRUE, page_prefix = "Patient Subset - Gender", split_fun = drop_split_levels) %>%
    split_rows_by("STRATA1") %>%
    analyze("AGE", mean, format = "xx.x")

# without inset
tbl <- build_table(lyt, DM)
tbl


# with inset
table_inset(tbl) <- 5
tbl
```


### Horizontal Separation
A character value can be specified to modify the horizontal separation between column headers and the table. Below, we replace the default line with "=".
```{bash}
tbl <- basic_table() %>%
        split_cols_by("Species") %>%
        add_colcounts() %>%
        analyze(c("Sepal.Length", "Petal.Width"), function(x) {
            in_rows(
                mean_sd = c(mean(x), sd(x)),
                var = var(x),
                min_max = range(x),
                .formats = c("xx.xx (xx.xx)", "xx.xxx", "xx.x - xx.x"),
                .labels = c("Mean (sd)", "Variance", "Min - Max")
            )
        }) %>%
        build_table(iris, hsep = "=")
tbl
```

### Section Dividers

A character value can be specified as a section divider which succeed every group defined by a split instruction. Below, a "+" is repeated and used as a section divider.

```{r}
l <- basic_table()%>%
    split_cols_by("Species")%>%
    analyze(head(names(iris), -1), afun = function(x) {
        list(
            "mean / sd" = rcell(c(mean(x), sd(x)), format = "xx.xx (xx.xx)"),
            "range" = rcell(diff(range(x)), format = "xx.xx")
        )
    }, section_div = "+")

build_table(l, iris)
```

### Indent Modifier

```{r}

```



### Variable Label Visibility

```{r}

```

